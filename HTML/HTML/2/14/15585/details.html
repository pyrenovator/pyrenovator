<html><h3>Pattern ID :15585
</h3><img src='52819109.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
        loss_instance_l = loss_class_l()
        loss_instance_r = loss_class_r() if not isinstance(loss_class_r, int) else loss_class_r

        <a id="change">if op == &quotsum&quot</a>:
            mixed<a id="change"> = </a>loss_instance_l + loss_instance_r
            sign = &quot+&quot

        elif op == &quotmul&quot:
            mixed = loss_instance_l * loss_instance_r
            sign = &quot*&quot

        elif <a id="change">op == &quotdiv&quot</a>:
            mixed<a id="change"> = </a>loss_instance_l / loss_instance_r
            sign = &quot/&quot

        elif op == &quotpow&quot:
            mixed = loss_instance_l ** 2
            sign = &quot**&quot

        else:
            <a id="change">raise </a><a id="change">ValueError(&quotUnrecognized op&quot</a><a id="change">)</a>

        weights = (torch.ones(n_samples, n_assets) / n_assets).to(device=y_dummy.device, dtype=y_dummy.dtype)

        losses = mixed(weights, y_dummy)</code></pre><h3>After Change</h3><pre><code class='java'>
        true_tensor = python_operator(loss_instance_l(weights, y_dummy),
                                      loss_instance_r(weights, y_dummy) if not r_is_constant else loss_class_r)

        sign<a id="change"> = </a><a id="change">{</a>&quotadd&quot: &quot+&quot, &quottruediv&quot: &quot/&quot, &quotmul&quot: &quot*&quot, &quotpow&quot: &quot**&quot<a id="change">}</a>[op]

        mixed_tensor = mixed_loss(weights, y_dummy)
</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 4</div><BR><div id='size'>Non-data size: 10</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/jankrepl/deepdow/commit/cd0fa7772131cebf9a6abfcdd09474b1a20c4fc8#diff-342d0a5580b6668a1bcc0b9f5e3e04cf47c22ffe7cb7c0bb35a95f16c20c769aL205' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 52819109</div><div id='project'> Project Name: jankrepl/deepdow</div><div id='commit'> Commit Name: cd0fa7772131cebf9a6abfcdd09474b1a20c4fc8</div><div id='time'> Time: 2020-06-22</div><div id='author'> Author: jankrepl@yahoo.com</div><div id='file'> File Name: tests/test_losses.py</div><div id='m_class'> M Class Name: TestAllLosses</div><div id='n_method'> N Class Name: TestAllLosses</div><div id='m_method'> M Method Name: test_arithmetic(4)</div><div id='n_method'> N Method Name: test_arithmetic(4)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: tests/test_losses.py</div><div id='n_file'> N File Name: tests/test_losses.py</div><div id='m_start'> M Start Line: 205</div><div id='m_end'> M End Line: 235</div><div id='n_start'> N Start Line: 207</div><div id='n_end'> N End Line: 237</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        loss_instance_l = loss_class_l()
        loss_instance_r = loss_class_r() if not isinstance(loss_class_r, int) else loss_class_r

        <a id="change">if op == &quotsum&quot</a>:
            mixed = loss_instance_l + loss_instance_r
            sign = &quot+&quot

        elif op == &quotmul&quot:
            mixed = loss_instance_l * loss_instance_r
            sign<a id="change"> = </a>&quot*&quot

        elif <a id="change">op == &quotdiv&quot</a>:
            mixed = loss_instance_l / loss_instance_r
            sign<a id="change"> = </a>&quot/&quot

        elif op == &quotpow&quot:
            mixed = loss_instance_l ** 2
            sign = &quot**&quot

        else:
            <a id="change">raise </a><a id="change">ValueError(&quotUnrecognized op&quot</a><a id="change">)</a>

        weights = (torch.ones(n_samples, n_assets) / n_assets).to(device=y_dummy.device, dtype=y_dummy.dtype)

        losses = mixed(weights, y_dummy)</code></pre><h3>After Change</h3><pre><code class='java'>
        true_tensor = python_operator(loss_instance_l(weights, y_dummy),
                                      loss_instance_r(weights, y_dummy) if not r_is_constant else loss_class_r)

        sign<a id="change"> = </a><a id="change">{</a>&quotadd&quot: &quot+&quot, &quottruediv&quot: &quot/&quot, &quotmul&quot: &quot*&quot, &quotpow&quot: &quot**&quot<a id="change">}</a>[op]

        mixed_tensor = mixed_loss(weights, y_dummy)
</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/jankrepl/deepdow/commit/cd0fa7772131cebf9a6abfcdd09474b1a20c4fc8#diff-342d0a5580b6668a1bcc0b9f5e3e04cf47c22ffe7cb7c0bb35a95f16c20c769aL200' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 52819174</div><div id='project'> Project Name: jankrepl/deepdow</div><div id='commit'> Commit Name: cd0fa7772131cebf9a6abfcdd09474b1a20c4fc8</div><div id='time'> Time: 2020-06-22</div><div id='author'> Author: jankrepl@yahoo.com</div><div id='file'> File Name: tests/test_losses.py</div><div id='m_class'> M Class Name: TestAllLosses</div><div id='n_method'> N Class Name: TestAllLosses</div><div id='m_method'> M Method Name: test_arithmetic(4)</div><div id='n_method'> N Method Name: test_arithmetic(4)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: tests/test_losses.py</div><div id='n_file'> N File Name: tests/test_losses.py</div><div id='m_start'> M Start Line: 205</div><div id='m_end'> M End Line: 235</div><div id='n_start'> N Start Line: 207</div><div id='n_end'> N End Line: 237</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>

        if input_image_type == "pt":
            input_image = image
        elif <a id="change">input_image_type == "np"</a>:
            input_image<a id="change"> = </a>image.cpu().numpy().transpose(0, 2, 3, 1)
        elif <a id="change">input_image_type == "pil"</a>:
            input_image<a id="change"> = </a>image.cpu().numpy().transpose(0, 2, 3, 1)
            input_image = VaeImageProcessor.numpy_to_pil(input_image)
        else:
            <a id="change">raise </a><a id="change">ValueError(f"unsupported input_image_type {input_image_type}."</a><a id="change">)</a>

        if output_type not in ["pt", "np", "pil"]:
            raise ValueError(f"unsupported output_type {output_type}")
</code></pre><h3>After Change</h3><pre><code class='java'>
            generator = torch.manual_seed(seed)
        else:
            generator = torch.Generator(device=device).manual_seed(seed)
        inputs<a id="change"> = </a><a id="change">{
            </a>"prompt": "A painting of a squirrel eating a burger",
            "image": image,
            "generator": generator,
            "num_inference_steps": 2,
            "guidance_scale": 6.0,
            "output_type": "numpy"<a id="change">,
        }</a>
        return inputs

    def test_stable_diffusion_img2img_default_case(self):
        device = "cpu"  &#47&#47 ensure determinism for the device-dependent torch.Generator</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/huggingface/diffusers/commit/a7f25b4a881c0835980e2a3db5fe09bfc4ab2dc0#diff-1947778ff8a6e5a6d1057853c9a2d5618649ddd9c5aade06e2acaa82614aa45aL99' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 52819107</div><div id='project'> Project Name: huggingface/diffusers</div><div id='commit'> Commit Name: a7f25b4a881c0835980e2a3db5fe09bfc4ab2dc0</div><div id='time'> Time: 2023-05-01</div><div id='author'> Author: yixu310@gmail.com</div><div id='file'> File Name: tests/pipelines/stable_diffusion/test_stable_diffusion_img2img.py</div><div id='m_class'> M Class Name: StableDiffusionImg2ImgPipelineFastTests</div><div id='n_method'> N Class Name: StableDiffusionImg2ImgPipelineFastTests</div><div id='m_method'> M Method Name: get_dummy_inputs(3)</div><div id='n_method'> N Method Name: get_dummy_inputs(5)</div><div id='m_parent_class'> M Parent Class: unittest.TestCase,PipelineLatentTesterMixin,PipelineTesterMixin</div><div id='n_parent_class'> N Parent Class: unittest.TestCase,PipelineTesterMixin</div><div id='m_file'> M File Name: tests/pipelines/stable_diffusion/test_stable_diffusion_img2img.py</div><div id='n_file'> N File Name: tests/pipelines/stable_diffusion/test_stable_diffusion_img2img.py</div><div id='m_start'> M Start Line: 99</div><div id='m_end'> M End Line: 126</div><div id='n_start'> N Start Line: 105</div><div id='n_end'> N End Line: 117</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        for label_id in torch.unique(self.labels_buffer):
            label_mask = (self.labels_buffer==label_id).to(torch.float)
            probs_per_label = probs
            <a id="change">if score_fct == &quotllr&quot</a>:
                s<a id="change"> = </a>self._log_likelihood_ratio(probs_per_label, label_mask, normalize)
            elif <a id="change">score_fct == &quotce&quot</a>:
                s<a id="change"> = </a>self._cross_entropy(probs_per_label, label_mask, normalize)
            else:
                <a id="change">raise </a><a id="change">ValueError(f"Score function &quot{score_fct}&quot not implemented"</a><a id="change">)</a>
            sorted_ids  = torch.argsort(s, descending=True)[:words_per_label]
            label_words_ids.append(sorted_ids.cpu().numpy().tolist())
        return label_words_ids
</code></pre><h3>After Change</h3><pre><code class='java'>
            scores = self.probs_buffer[self.labels_buffer==label_id].mean(axis=0).cpu().numpy()
            kept = []
            for i in np.argsort(-scores):
                word<a id="change"> = </a>self.tokenizer.convert_ids_to_tokens(<a id="change">[</a>i<a id="change"></a>])[0]
                if self.invalid_label_word(word):
                    continue
                kept.append(i)</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/thunlp/openprompt/commit/35f140a0928724204ab887f5ed0d45d469aecc8b#diff-0060b001b7bcb59bcad42e574d4b6d2e4b7a1b8fdea8d3082342eeb80c703efdL309' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 52819325</div><div id='project'> Project Name: thunlp/openprompt</div><div id='commit'> Commit Name: 35f140a0928724204ab887f5ed0d45d469aecc8b</div><div id='time'> Time: 2021-10-23</div><div id='author'> Author: yl-chen17@mails.tsinghua.edu.cn</div><div id='file'> File Name: openprompt/prompts/prompt_generator.py</div><div id='m_class'> M Class Name: VerbalizerGenerator</div><div id='n_method'> N Class Name: VerbalizerGenerator</div><div id='m_method'> M Method Name: _get_top_words(1)</div><div id='n_method'> N Method Name: _get_top_words(5)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: openprompt/prompts/prompt_generator.py</div><div id='n_file'> N File Name: openprompt/prompts/prompt_generator.py</div><div id='m_start'> M Start Line: 309</div><div id='m_end'> M End Line: 325</div><div id='n_start'> N Start Line: 308</div><div id='n_end'> N End Line: 318</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
            f"Model type {model_type} not implemented yet. Available model types [lstm, transformer]"
        )

    <a id="change">if optimizer_name == "SGD"</a>:
        optimizer<a id="change"> = </a>optim.SGD(
            model.parameters(), lr=learning_rate, momentum=0.9, nesterov=True
        )
    elif <a id="change">optimizer_name == "Adam"</a>:
        optimizer<a id="change"> = </a>optim.AdamW(model.parameters(), lr=learning_rate, eps=1e-04)
    else:
        <a id="change">raise </a><a id="change">ValueError(
            f"Optimizer {optimizer_name} not implemented. Available optimizers: SGD, Adam"</a><a id="change">
        )</a>

    scheduler = optim.lr_scheduler.ReduceLROnPlateau(
        optimizer, verbose=True, patience=scheduler_patience, factor=0.5</code></pre><h3>After Change</h3><pre><code class='java'>
    

    if dropout_images_prob is None:
        dropout_images_prob<a id="change"> = </a><a id="change">[</a>0.0, 0.0, 0.0, 0.0, 0.0<a id="change"></a>]

    model: Tedd1104ModelPL = Tedd1104ModelPL(
        resnet=resnet,</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/ikergarcia1996/self-driving-car-in-video-games/commit/a1ab4ad40dbe62c5f2084ead328936bab9bdde02#diff-ed183d67207df065a11e1289f19d34cc2abbc5448dea952683cfe9728c342b95L371' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 52819355</div><div id='project'> Project Name: ikergarcia1996/self-driving-car-in-video-games</div><div id='commit'> Commit Name: a1ab4ad40dbe62c5f2084ead328936bab9bdde02</div><div id='time'> Time: 2021-09-10</div><div id='author'> Author: igarciaf896@gmail.com</div><div id='file'> File Name: train.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: train_new_model(30)</div><div id='n_method'> N Method Name: train_new_model(34)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: train.py</div><div id='n_file'> N File Name: train.py</div><div id='m_start'> M Start Line: 372</div><div id='m_end'> M End Line: 531</div><div id='n_start'> N Start Line: 96</div><div id='n_end'> N End Line: 203</div><BR>