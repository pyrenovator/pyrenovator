<html><h3>Pattern ID :3903
</h3><img src='14777697.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>

        &#47&#47 train rs
        train_data.set_mode(KGDataLoaderState.RS)
        <a id="change">for </a>batch_idx, <a id="change">interaction</a> in <a id="change">enumerate(train_data</a><a id="change">):
            </a>interaction = <a id="change">interaction.to(</a>self.device<a id="change">)</a>
            <a id="change">self.optimizer.zero_grad()</a>
            <a id="change">loss = </a>self.model.calculate_loss(interaction)
            <a id="change">self._check_nan(loss</a><a id="change">)</a>
            <a id="change">loss.backward()</a>
            <a id="change">self.optimizer.step()</a>
            rs_total_loss<a id="change"> += </a>loss.item()

        &#47&#47 train kg
        train_data.set_mode(KGDataLoaderState.KG)
        <a id="change">for </a>batch_idx, <a id="change">interaction</a> in <a id="change">enumerate(train_data</a><a id="change">)</a><a id="change">:
            </a>interaction<a id="change"> = interaction</a><a id="change">.to(</a>self.device<a id="change">)</a>
            <a id="change">self.optimizer.zero_grad()</a>
            <a id="change">loss = </a>self.model.calculate_kg_loss(interaction)
            <a id="change">self._check_nan(loss</a><a id="change">)</a>
            <a id="change">loss.backward()</a>
            <a id="change">self.optimizer.step()</a>
            kg_total_loss<a id="change"> += </a>loss.item()

        &#47&#47 update A
        self.model.update_attentive_A()</code></pre><h3>After Change</h3><pre><code class='java'>

        &#47&#47 train kg
        train_data.set_mode(KGDataLoaderState.KG)
        kg_total_loss<a id="change"> = </a><a id="change">super()</a>._train_epoch(train_data, epoch_idx, self.model.calculate_kg_loss)

        &#47&#47 update A
        self.model.update_attentive_A()</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 4</div><BR><div id='size'>Non-data size: 21</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/rucaibox/recbole/commit/5ad0bdda3167b74b49aa5818892e838de8c4fda1#diff-e38b0c7af084318af2abfe6a4023b17aa4e190267c4467908362cacf3187f601L452' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 14777697</div><div id='project'> Project Name: rucaibox/recbole</div><div id='commit'> Commit Name: 5ad0bdda3167b74b49aa5818892e838de8c4fda1</div><div id='time'> Time: 2020-11-20</div><div id='author'> Author: 297086016@qq.com</div><div id='file'> File Name: recbole/trainer/trainer.py</div><div id='m_class'> M Class Name: KGATTrainer</div><div id='n_method'> N Class Name: KGATTrainer</div><div id='m_method'> M Method Name: _train_epoch(4)</div><div id='n_method'> N Method Name: _train_epoch(3)</div><div id='m_parent_class'> M Parent Class: Trainer</div><div id='n_parent_class'> N Parent Class: Trainer</div><div id='m_file'> M File Name: recbole/trainer/trainer.py</div><div id='n_file'> N File Name: recbole/trainer/trainer.py</div><div id='m_start'> M Start Line: 479</div><div id='m_end'> M End Line: 505</div><div id='n_start'> N Start Line: 452</div><div id='n_end'> N End Line: 459</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>

        &#47&#47 train rs
        train_data.set_mode(KGDataLoaderState.RS)
        <a id="change">for </a>batch_idx, <a id="change">interaction</a> in <a id="change">enumerate(</a>train_data<a id="change">):
            </a>interaction = <a id="change">interaction.to(</a>self.device<a id="change">)</a>
            <a id="change">self.optimizer.zero_grad()</a>
            <a id="change">loss = </a>self.model.calculate_loss(interaction)
            <a id="change">self._check_nan(</a>loss<a id="change">)</a>
            <a id="change">loss.backward()</a>
            <a id="change">self.optimizer.step()</a>
            rs_total_loss<a id="change"> += </a>loss.item()

        &#47&#47 train kg
        train_data.set_mode(KGDataLoaderState.KG)
        <a id="change">for </a>batch_idx, <a id="change">interaction</a> in <a id="change">enumerate(</a>train_data<a id="change">)</a><a id="change">:
            </a>interaction<a id="change"> = </a><a id="change">interaction.to(</a>self.device<a id="change">)</a>
            <a id="change">self.optimizer.zero_grad()</a>
            <a id="change">loss = </a>self.model.calculate_kg_loss(interaction)
            <a id="change">self._check_nan(</a>loss<a id="change">)</a>
            <a id="change">loss.backward()</a>
            <a id="change">self.optimizer.step()</a>
            kg_total_loss<a id="change"> += </a>loss.item()

        &#47&#47 update A
        self.model.update_attentive_A()</code></pre><h3>After Change</h3><pre><code class='java'>

        &#47&#47 train kg
        train_data.set_mode(KGDataLoaderState.KG)
        kg_total_loss<a id="change"> = </a><a id="change">super()</a>._train_epoch(train_data, epoch_idx, self.model.calculate_kg_loss)

        &#47&#47 update A
        self.model.update_attentive_A()</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/rucaibox/recbole/commit/5ad0bdda3167b74b49aa5818892e838de8c4fda1#diff-e38b0c7af084318af2abfe6a4023b17aa4e190267c4467908362cacf3187f601L478' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 14777696</div><div id='project'> Project Name: rucaibox/recbole</div><div id='commit'> Commit Name: 5ad0bdda3167b74b49aa5818892e838de8c4fda1</div><div id='time'> Time: 2020-11-20</div><div id='author'> Author: 297086016@qq.com</div><div id='file'> File Name: recbole/trainer/trainer.py</div><div id='m_class'> M Class Name: KGATTrainer</div><div id='n_method'> N Class Name: KGATTrainer</div><div id='m_method'> M Method Name: _train_epoch(4)</div><div id='n_method'> N Method Name: _train_epoch(3)</div><div id='m_parent_class'> M Parent Class: Trainer</div><div id='n_parent_class'> N Parent Class: Trainer</div><div id='m_file'> M File Name: recbole/trainer/trainer.py</div><div id='n_file'> N File Name: recbole/trainer/trainer.py</div><div id='m_start'> M Start Line: 479</div><div id='m_end'> M End Line: 505</div><div id='n_start'> N Start Line: 452</div><div id='n_end'> N End Line: 459</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>

        &#47&#47 train rs
        train_data.set_mode(KGDataLoaderState.RS)
        <a id="change">for </a>batch_idx, <a id="change">interaction</a> in <a id="change">enumerate(</a>train_data<a id="change">)</a><a id="change">:
            </a>interaction = <a id="change">interaction.to(</a>self.device<a id="change">)</a>
            <a id="change">self.optimizer.zero_grad()</a>
            <a id="change">loss</a><a id="change"> = </a>self.model.calculate_loss(interaction)
            <a id="change">self._check_nan(</a>loss<a id="change">)</a>
            <a id="change">loss.backward()</a>
            <a id="change">self.optimizer.step()</a>
            rs_total_loss<a id="change"> += </a>loss.item()

        &#47&#47 train kg
        train_data.set_mode(KGDataLoaderState.KG)
        <a id="change">for </a>batch_idx, <a id="change">interaction</a> in <a id="change">enumerate(</a>train_data<a id="change">):
            </a>interaction<a id="change"> = </a><a id="change">interaction.to(</a>self.device<a id="change">)</a>
            <a id="change">self.optimizer.zero_grad()</a>
            <a id="change">loss = </a>self.model.calculate_kg_loss(interaction)
            <a id="change">self._check_nan(</a>loss<a id="change">)</a>
            <a id="change">loss.backward()</a>
            <a id="change">self.optimizer.step()</a>
            kg_total_loss<a id="change"> += </a>loss.item()

        &#47&#47 update A
        self.model.update_attentive_A()</code></pre><h3>After Change</h3><pre><code class='java'>

        &#47&#47 train kg
        train_data.set_mode(KGDataLoaderState.KG)
        kg_total_loss<a id="change"> = </a><a id="change">super()</a>._train_epoch(train_data, epoch_idx, self.model.calculate_kg_loss)

        &#47&#47 update A
        self.model.update_attentive_A()</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/rucaibox/recbole/commit/afbaf4f16650a153f597b4acfa066e75d7273bb1#diff-e38b0c7af084318af2abfe6a4023b17aa4e190267c4467908362cacf3187f601L475' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 14777664</div><div id='project'> Project Name: rucaibox/recbole</div><div id='commit'> Commit Name: afbaf4f16650a153f597b4acfa066e75d7273bb1</div><div id='time'> Time: 2020-11-15</div><div id='author'> Author: 297086016@qq.com</div><div id='file'> File Name: recbole/trainer/trainer.py</div><div id='m_class'> M Class Name: KGATTrainer</div><div id='n_method'> N Class Name: KGATTrainer</div><div id='m_method'> M Method Name: _train_epoch(4)</div><div id='n_method'> N Method Name: _train_epoch(3)</div><div id='m_parent_class'> M Parent Class: Trainer</div><div id='n_parent_class'> N Parent Class: Trainer</div><div id='m_file'> M File Name: recbole/trainer/trainer.py</div><div id='n_file'> N File Name: recbole/trainer/trainer.py</div><div id='m_start'> M Start Line: 476</div><div id='m_end'> M End Line: 502</div><div id='n_start'> N Start Line: 450</div><div id='n_end'> N End Line: 457</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        &#47&#47 train rs
        print(&quotTrain RS&quot)
        train_data.set_mode(KGDataLoaderState.RS)
        <a id="change">for </a>batch_idx, <a id="change">interaction</a> in <a id="change">enumerate(</a>train_data<a id="change">)</a><a id="change">:
            </a>interaction<a id="change"> = </a><a id="change">interaction.to(</a>self.device<a id="change">)</a>
            <a id="change">self.optimizer.zero_grad()</a>
            <a id="change">loss_rs</a> = self.model.calculate_rs_loss(interaction)
            
            <a id="change">self._check_nan(</a>loss_rs<a id="change">)</a>
            <a id="change">loss_rs.backward()</a>
            <a id="change">self.optimizer.step()</a>
            rs_total_loss<a id="change"> += </a>loss_rs
            
        &#47&#47 train kg
        if epoch_idx % self.kge_interval == 0:
            print(&quotTrain KG&quot)
            train_data.set_mode(KGDataLoaderState.KG)
            <a id="change">for </a>batch_idx, <a id="change">interaction</a> in <a id="change">enumerate(</a>train_data<a id="change">):
                </a>interaction<a id="change"> = </a><a id="change">interaction.to(</a>self.device<a id="change">)</a>
                <a id="change">self.optimizer.zero_grad()</a>
                <a id="change">loss_kge = </a>self.model.calculate_kg_loss(interaction)
                
                <a id="change">self._check_nan(</a>loss_kge<a id="change">)</a>
                <a id="change">loss_kge.backward()</a>
                <a id="change">self.optimizer.step()</a>
                kg_total_loss<a id="change"> += </a>loss_kge

        return rs_total_loss, kg_total_loss
</code></pre><h3>After Change</h3><pre><code class='java'>
        if epoch_idx % self.kge_interval == 0:
            self.logger.info(&quotTrain KG&quot)
            train_data.set_mode(KGDataLoaderState.KG)
            kg_total_loss<a id="change"> = </a><a id="change">super()</a>._train_epoch(train_data, epoch_idx, self.model.calculate_kg_loss)

        return rs_total_loss, kg_total_loss
</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/rucaibox/recbole/commit/5ad0bdda3167b74b49aa5818892e838de8c4fda1#diff-e38b0c7af084318af2abfe6a4023b17aa4e190267c4467908362cacf3187f601L640' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 14777698</div><div id='project'> Project Name: rucaibox/recbole</div><div id='commit'> Commit Name: 5ad0bdda3167b74b49aa5818892e838de8c4fda1</div><div id='time'> Time: 2020-11-20</div><div id='author'> Author: 297086016@qq.com</div><div id='file'> File Name: recbole/trainer/trainer.py</div><div id='m_class'> M Class Name: MKRTrainer</div><div id='n_method'> N Class Name: MKRTrainer</div><div id='m_method'> M Method Name: _train_epoch(4)</div><div id='n_method'> N Method Name: _train_epoch(3)</div><div id='m_parent_class'> M Parent Class: Trainer</div><div id='n_parent_class'> N Parent Class: Trainer</div><div id='m_file'> M File Name: recbole/trainer/trainer.py</div><div id='n_file'> N File Name: recbole/trainer/trainer.py</div><div id='m_start'> M Start Line: 641</div><div id='m_end'> M End Line: 671</div><div id='n_start'> N Start Line: 534</div><div id='n_end'> N End Line: 546</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        &#47&#47 train rs
        print(&quotTrain RS&quot)
        train_data.set_mode(KGDataLoaderState.RS)
        <a id="change">for </a>batch_idx, <a id="change">interaction</a> in <a id="change">enumerate(</a>train_data<a id="change">)</a><a id="change">:
            </a>interaction<a id="change"> = </a><a id="change">interaction.to(</a>self.device<a id="change">)</a>
            <a id="change">self.optimizer.zero_grad()</a>
            <a id="change">loss_rs = </a>self.model.calculate_rs_loss(interaction)
            
            <a id="change">self._check_nan(</a>loss_rs<a id="change">)</a>
            <a id="change">loss_rs.backward()</a>
            <a id="change">self.optimizer.step()</a>
            rs_total_loss<a id="change"> += </a>loss_rs
            
        &#47&#47 train kg
        if epoch_idx % self.kge_interval == 0:
            print(&quotTrain KG&quot)
            train_data.set_mode(KGDataLoaderState.KG)
            <a id="change">for </a>batch_idx, <a id="change">interaction</a> in <a id="change">enumerate(</a>train_data<a id="change">):
                </a>interaction<a id="change"> = </a><a id="change">interaction.to(</a>self.device<a id="change">)</a>
                <a id="change">self.optimizer.zero_grad()</a>
                <a id="change">loss_kge</a> = self.model.calculate_kg_loss(interaction)
                
                <a id="change">self._check_nan(</a>loss_kge<a id="change">)</a>
                <a id="change">loss_kge.backward()</a>
                <a id="change">self.optimizer.step()</a>
                kg_total_loss<a id="change"> += </a>loss_kge

        return rs_total_loss, kg_total_loss
</code></pre><h3>After Change</h3><pre><code class='java'>
        &#47&#47 train rs
        print(&quotTrain RS&quot)
        train_data.set_mode(KGDataLoaderState.RS)
        rs_total_loss<a id="change"> = </a><a id="change">super()</a>._train_epoch(train_data, epoch_idx, self.model.calculate_rs_loss)
            
        &#47&#47 train kg
        if epoch_idx % self.kge_interval == 0:</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/rucaibox/recbole/commit/afbaf4f16650a153f597b4acfa066e75d7273bb1#diff-e38b0c7af084318af2abfe6a4023b17aa4e190267c4467908362cacf3187f601L637' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 14777701</div><div id='project'> Project Name: rucaibox/recbole</div><div id='commit'> Commit Name: afbaf4f16650a153f597b4acfa066e75d7273bb1</div><div id='time'> Time: 2020-11-15</div><div id='author'> Author: 297086016@qq.com</div><div id='file'> File Name: recbole/trainer/trainer.py</div><div id='m_class'> M Class Name: MKRTrainer</div><div id='n_method'> N Class Name: MKRTrainer</div><div id='m_method'> M Method Name: _train_epoch(4)</div><div id='n_method'> N Method Name: _train_epoch(3)</div><div id='m_parent_class'> M Parent Class: Trainer</div><div id='n_parent_class'> N Parent Class: Trainer</div><div id='m_file'> M File Name: recbole/trainer/trainer.py</div><div id='n_file'> N File Name: recbole/trainer/trainer.py</div><div id='m_start'> M Start Line: 638</div><div id='m_end'> M End Line: 668</div><div id='n_start'> N Start Line: 595</div><div id='n_end'> N End Line: 607</div><BR>