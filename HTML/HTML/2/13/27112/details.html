<html><h3>Pattern ID :27112
</h3><img src='80655400.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
            dict: a task(document in collection) after decoding
        
        query = query.copy()
        <a id="change">if "_id"</a><a id="change"> in query</a>:
            <a id="change">query["_id"] = </a><a id="change">ObjectId(query["_id"]</a><a id="change">)</a>
        query.update({"status": status})
        task = self.task_pool.find_one_and_update(
            query, {"$set": {"status": self.STATUS_RUNNING}}, sort=[("priority", pymongo.DESCENDING)]
        )</code></pre><h3>After Change</h3><pre><code class='java'>
            dict: a task(document in collection) after decoding
        
        query = query.copy()
        query<a id="change"> = </a><a id="change">self._decode_query(query</a><a id="change">)</a>
        query.update({"status": status})
        task = self.task_pool.find_one_and_update(
            query, {"$set": {"status": self.STATUS_RUNNING}}, sort=[("priority", pymongo.DESCENDING)]
        )</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 5</div><BR><div id='size'>Non-data size: 9</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/microsoft/qlib/commit/ca0363ded804ad97d21d2d151ef823df9336a7c5#diff-9772b369d3413d03f870c906577b9104636796e059ef9a48ce7a660d2b0faa37L225' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 80655400</div><div id='project'> Project Name: microsoft/qlib</div><div id='commit'> Commit Name: ca0363ded804ad97d21d2d151ef823df9336a7c5</div><div id='time'> Time: 2021-05-26</div><div id='author'> Author: lzh222333@163.com</div><div id='file'> File Name: qlib/workflow/task/manage.py</div><div id='m_class'> M Class Name: TaskManager</div><div id='n_method'> N Class Name: TaskManager</div><div id='m_method'> M Method Name: fetch_task(3)</div><div id='n_method'> N Method Name: fetch_task(3)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: qlib/workflow/task/manage.py</div><div id='n_file'> N File Name: qlib/workflow/task/manage.py</div><div id='m_start'> M Start Line: 225</div><div id='m_end'> M End Line: 228</div><div id='n_start'> N Start Line: 234</div><div id='n_end'> N End Line: 235</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        -------
        dict: a task(document in collection) after decoding
        
        <a id="change">query</a> = query.copy()
        <a id="change">if "_id"</a><a id="change"> in query</a>:
            <a id="change">query["_id"] = </a><a id="change">ObjectId(</a><a id="change">query["_id"])</a>
        for t in self.task_pool.find(query):
            yield self._decode_task(t)

    def re_query(self, _id) -&gt; dict:</code></pre><h3>After Change</h3><pre><code class='java'>
        -------
        dict: a task(document in collection) after decoding
        
        <a id="change">query</a> = query.copy()
        query<a id="change"> = </a><a id="change">self._decode_query(</a>query<a id="change">)</a>
        for t in self.task_pool.find(query):
            yield self._decode_task(t)

    def re_query(self, _id) -&gt; dict:</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/microsoft/qlib/commit/ca0363ded804ad97d21d2d151ef823df9336a7c5#diff-9772b369d3413d03f870c906577b9104636796e059ef9a48ce7a660d2b0faa37L269' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 80655398</div><div id='project'> Project Name: microsoft/qlib</div><div id='commit'> Commit Name: ca0363ded804ad97d21d2d151ef823df9336a7c5</div><div id='time'> Time: 2021-05-26</div><div id='author'> Author: lzh222333@163.com</div><div id='file'> File Name: qlib/workflow/task/manage.py</div><div id='m_class'> M Class Name: TaskManager</div><div id='n_method'> N Class Name: TaskManager</div><div id='m_method'> M Method Name: query(3)</div><div id='n_method'> N Method Name: query(3)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: qlib/workflow/task/manage.py</div><div id='n_file'> N File Name: qlib/workflow/task/manage.py</div><div id='m_start'> M Start Line: 284</div><div id='m_end'> M End Line: 287</div><div id='n_start'> N Start Line: 292</div><div id='n_end'> N End Line: 293</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        return self.reset_status(query=query, status=self.STATUS_WAITING)

    def reset_status(self, query, status):
        <a id="change">query</a> = query.copy()
        <a id="change">if "_id"</a><a id="change"> in query</a>:
            <a id="change">query["_id"] = </a><a id="change">ObjectId(</a><a id="change">query["_id"])</a>
        print(self.task_pool.update_many(query, {"$set": {"status": status}}))

    def prioritize(self, task, priority: int):
        </code></pre><h3>After Change</h3><pre><code class='java'>
        return self.reset_status(query=query, status=self.STATUS_WAITING)

    def reset_status(self, query, status):
        <a id="change">query</a> = query.copy()
        query<a id="change"> = </a><a id="change">self._decode_query(</a>query<a id="change">)</a>
        print(self.task_pool.update_many(query, {"$set": {"status": status}}))

    def prioritize(self, task, priority: int):
        </code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/microsoft/qlib/commit/ca0363ded804ad97d21d2d151ef823df9336a7c5#diff-9772b369d3413d03f870c906577b9104636796e059ef9a48ce7a660d2b0faa37L377' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 80655399</div><div id='project'> Project Name: microsoft/qlib</div><div id='commit'> Commit Name: ca0363ded804ad97d21d2d151ef823df9336a7c5</div><div id='time'> Time: 2021-05-26</div><div id='author'> Author: lzh222333@163.com</div><div id='file'> File Name: qlib/workflow/task/manage.py</div><div id='m_class'> M Class Name: TaskManager</div><div id='n_method'> N Class Name: TaskManager</div><div id='m_method'> M Method Name: reset_status(3)</div><div id='n_method'> N Method Name: reset_status(3)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: qlib/workflow/task/manage.py</div><div id='n_file'> N File Name: qlib/workflow/task/manage.py</div><div id='m_start'> M Start Line: 378</div><div id='m_end'> M End Line: 381</div><div id='n_start'> N Start Line: 383</div><div id='n_end'> N End Line: 384</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
            the dict of query

        
        <a id="change">query</a> = query.copy()
        <a id="change">if "_id"</a><a id="change"> in query</a>:
            <a id="change">query["_id"] = </a><a id="change">ObjectId(</a><a id="change">query["_id"])</a>
        self.task_pool.delete_many(query)

    def task_stat(self, query={}) -&gt; dict:
        </code></pre><h3>After Change</h3><pre><code class='java'>
            the dict of query

        
        <a id="change">query</a> = query.copy()
        query<a id="change"> = </a><a id="change">self._decode_query(</a>query<a id="change">)</a>
        self.task_pool.delete_many(query)

    def task_stat(self, query={}) -&gt; dict:
        </code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/microsoft/qlib/commit/ca0363ded804ad97d21d2d151ef823df9336a7c5#diff-9772b369d3413d03f870c906577b9104636796e059ef9a48ce7a660d2b0faa37L330' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 80655396</div><div id='project'> Project Name: microsoft/qlib</div><div id='commit'> Commit Name: ca0363ded804ad97d21d2d151ef823df9336a7c5</div><div id='time'> Time: 2021-05-26</div><div id='author'> Author: lzh222333@163.com</div><div id='file'> File Name: qlib/workflow/task/manage.py</div><div id='m_class'> M Class Name: TaskManager</div><div id='n_method'> N Class Name: TaskManager</div><div id='m_method'> M Method Name: remove(2)</div><div id='n_method'> N Method Name: remove(2)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: qlib/workflow/task/manage.py</div><div id='n_file'> N File Name: qlib/workflow/task/manage.py</div><div id='m_start'> M Start Line: 340</div><div id='m_end'> M End Line: 343</div><div id='n_start'> N Start Line: 347</div><div id='n_end'> N End Line: 348</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        Returns:
            dict
        
        <a id="change">query</a> = query.copy()
        <a id="change">if "_id"</a><a id="change"> in query</a>:
            <a id="change">query["_id"] = </a><a id="change">ObjectId(</a><a id="change">query["_id"])</a>
        tasks = self.query(query=query, decode=False)
        status_stat = {}
        for t in tasks:
            status_stat[t["status"]] = status_stat.get(t["status"], 0) + 1</code></pre><h3>After Change</h3><pre><code class='java'>
        Returns:
            dict
        
        <a id="change">query</a> = query.copy()
        query<a id="change"> = </a><a id="change">self._decode_query(</a>query<a id="change">)</a>
        tasks = self.query(query=query, decode=False)
        status_stat = {}
        for t in tasks:
            status_stat[t["status"]] = status_stat.get(t["status"], 0) + 1</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/microsoft/qlib/commit/ca0363ded804ad97d21d2d151ef823df9336a7c5#diff-9772b369d3413d03f870c906577b9104636796e059ef9a48ce7a660d2b0faa37L345' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 80655397</div><div id='project'> Project Name: microsoft/qlib</div><div id='commit'> Commit Name: ca0363ded804ad97d21d2d151ef823df9336a7c5</div><div id='time'> Time: 2021-05-26</div><div id='author'> Author: lzh222333@163.com</div><div id='file'> File Name: qlib/workflow/task/manage.py</div><div id='m_class'> M Class Name: TaskManager</div><div id='n_method'> N Class Name: TaskManager</div><div id='m_method'> M Method Name: task_stat(2)</div><div id='n_method'> N Method Name: task_stat(2)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: qlib/workflow/task/manage.py</div><div id='n_file'> N File Name: qlib/workflow/task/manage.py</div><div id='m_start'> M Start Line: 355</div><div id='m_end'> M End Line: 358</div><div id='n_start'> N Start Line: 361</div><div id='n_end'> N End Line: 362</div><BR>