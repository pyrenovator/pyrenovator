<html><h3>Pattern ID :38150
</h3><img src='109375135.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
    
    assert C==_C
    if w_ is None:
        <a id="change">if init_method==None</a>:
            w<a id="change"> = jt</a><a id="change">.make_var(</a><a id="change">[</a>Kc, <a id="change">_C</a>, <a id="change">Kh</a>, <a id="change">Kw</a>]<a id="change">, init=lambda *a: init.relu_invariant_gauss(*a, mode="fan_out"))</a>
        else:
            w<a id="change"> = jt</a><a id="change">.make_var([</a>Kc, <a id="change">_C</a>, <a id="change">Kh</a>, <a id="change">Kw</a>]<a id="change">, init=init_method)</a>
    else:
        w = w_
    oh = (H-Kh*dilation+dilation-1+padding*2)//stride+1
    ow = (W-Kw*dilation+dilation-1+padding*2)//stride+1</code></pre><h3>After Change</h3><pre><code class='java'>
    
    assert C==_C
    if w_ is None:
        <a id="change">assert </a>0
    else:
        w = w_
    oh = (H-Kh*dilation+dilation-1+padding*2)//stride+1</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 9</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/jittor/jittor/commit/126f92a6f3ad597b22ec2f60908a14af40dc960a#diff-3ec19ed3c86c96c52c5fc474feb67352eae32c51b797b586f415f168f822d310L51' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 109375135</div><div id='project'> Project Name: jittor/jittor</div><div id='commit'> Commit Name: 126f92a6f3ad597b22ec2f60908a14af40dc960a</div><div id='time'> Time: 2020-05-21</div><div id='author'> Author: randonlang@gmail.com</div><div id='file'> File Name: python/jittor/test/test_conv_tuner.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: conv_nhwc(9)</div><div id='n_method'> N Method Name: conv_nhwc(9)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: python/jittor/test/test_conv_tuner.py</div><div id='n_file'> N File Name: python/jittor/test/test_conv_tuner.py</div><div id='m_start'> M Start Line: 51</div><div id='m_end'> M End Line: 63</div><div id='n_start'> N Start Line: 56</div><div id='n_end'> N End Line: 56</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
    return y

def conv_nhwc(x, in_planes, out_planes, kernel_size, padding, stride = 1, dilation=1, init_method=None, w_ = None):
    <a id="change">Kw</a> = kernel_size
    <a id="change">Kh</a> = kernel_size
    <a id="change">_C</a> = in_planes
    Kc = out_planes
    N,H,W,C = x.shape
    
    assert C==_C
    if w_ is None:
        <a id="change">if init_method==None</a>:
            w<a id="change"> = </a><a id="change">jt.make_var(</a><a id="change">[</a>Kc, _C, Kh, Kw<a id="change"></a>]<a id="change">, init=lambda *a: init.relu_invariant_gauss(*a, mode="fan_out"))</a>
        else:
            w<a id="change"> = </a><a id="change">jt.make_var([</a>Kc, _C, Kh, Kw<a id="change"></a>]<a id="change">, init=init_method)</a>
    else:
        w = w_
    oh = (H-Kh*dilation+dilation-1+padding*2)//stride+1
    ow = (W-Kw*dilation+dilation-1+padding*2)//stride+1</code></pre><h3>After Change</h3><pre><code class='java'>
    
    assert C==_C
    if w_ is None:
        <a id="change">assert </a>0
    else:
        w = w_
    oh = (H-Kh*dilation+dilation-1+padding*2)//stride+1</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/jittor/jittor/commit/126f92a6f3ad597b22ec2f60908a14af40dc960a#diff-3ec19ed3c86c96c52c5fc474feb67352eae32c51b797b586f415f168f822d310L50' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 109375140</div><div id='project'> Project Name: jittor/jittor</div><div id='commit'> Commit Name: 126f92a6f3ad597b22ec2f60908a14af40dc960a</div><div id='time'> Time: 2020-05-21</div><div id='author'> Author: randonlang@gmail.com</div><div id='file'> File Name: python/jittor/test/test_conv_tuner.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: conv_nhwc(9)</div><div id='n_method'> N Method Name: conv_nhwc(9)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: python/jittor/test/test_conv_tuner.py</div><div id='n_file'> N File Name: python/jittor/test/test_conv_tuner.py</div><div id='m_start'> M Start Line: 51</div><div id='m_end'> M End Line: 63</div><div id='n_start'> N Start Line: 56</div><div id='n_end'> N End Line: 56</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
    dilation = (dilation, dilation)
    stride = (stride, stride)
    assert C==in_planes
    <a id="change">oc</a> = out_planes
    oh = (H+padding[0]*2-Kh*dilation[0]+dilation[0]-1)//stride[0]+1
    ow = (W+padding[1]*2-Kw*dilation[1]+dilation[1]-1)//stride[1]+1

    if w_ is None:
        <a id="change">if init_method==None</a>:
            w<a id="change"> = </a><a id="change">jt.make_var(</a><a id="change">[</a>oc, C // G, Kh, Kw<a id="change"></a>]<a id="change">, init=lambda *a: init.relu_invariant_gauss(*a, mode="fan_out"))</a>
        else:
            w<a id="change"> = </a><a id="change">jt.make_var([</a>oc, C // G, Kh, Kw<a id="change"></a>]<a id="change">, init=init_method)</a>
    else:
        w = w_

    xx = x.reindex([N,G,oc//G,CpG,oh,ow,Kh,Kw], [</code></pre><h3>After Change</h3><pre><code class='java'>
    ow = (W+padding[1]*2-Kw*dilation[1]+dilation[1]-1)//stride[1]+1

    if w_ is None:
        <a id="change">assert </a>0
    else:
        w = w_
</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/jittor/jittor/commit/126f92a6f3ad597b22ec2f60908a14af40dc960a#diff-969aae597331e7ec664a2f728d79c1c5385b7e2239c1b5abb21c87771d06946dL23' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 109375189</div><div id='project'> Project Name: jittor/jittor</div><div id='commit'> Commit Name: 126f92a6f3ad597b22ec2f60908a14af40dc960a</div><div id='time'> Time: 2020-05-21</div><div id='author'> Author: randonlang@gmail.com</div><div id='file'> File Name: python/jittor/test/test_group_conv_tuner.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: conv_nchw(10)</div><div id='n_method'> N Method Name: conv_nchw(10)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: python/jittor/test/test_group_conv_tuner.py</div><div id='n_file'> N File Name: python/jittor/test/test_group_conv_tuner.py</div><div id='m_start'> M Start Line: 26</div><div id='m_end'> M End Line: 41</div><div id='n_start'> N Start Line: 37</div><div id='n_end'> N End Line: 37</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
    cublas_ops = cudnn_ops = None

def conv_nchw(x, in_planes, out_planes, kernel_size, padding, stride = 1, dilation=1, init_method=None, w_ = None):
    <a id="change">Kw</a> = kernel_size
    <a id="change">Kh</a> = kernel_size
    <a id="change">_C</a> = in_planes
    Kc = out_planes
    N,C,H,W = x.shape
    
    assert C==_C
    if w_ is None:
        <a id="change">if init_method==None</a>:
            w<a id="change"> = </a><a id="change">jt.make_var([</a>Kc, _C, Kh, Kw<a id="change"></a>]<a id="change">, init=lambda *a: init.relu_invariant_gauss(*a, mode="fan_out"))</a>
        else:
            w<a id="change"> = </a><a id="change">jt.make_var(</a><a id="change">[</a>Kc, _C, Kh, Kw<a id="change"></a>]<a id="change">, init=init_method)</a>
    else:
        w = w_
    oh = (H-Kh*dilation+dilation-1+padding*2)//stride+1
    ow = (W-Kw*dilation+dilation-1+padding*2)//stride+1</code></pre><h3>After Change</h3><pre><code class='java'>
    
    assert C==_C
    if w_ is None:
        <a id="change">assert </a>0
    else:
        w = w_
    oh = (H-Kh*dilation+dilation-1+padding*2)//stride+1</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/jittor/jittor/commit/126f92a6f3ad597b22ec2f60908a14af40dc960a#diff-3ec19ed3c86c96c52c5fc474feb67352eae32c51b797b586f415f168f822d310L22' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 109375159</div><div id='project'> Project Name: jittor/jittor</div><div id='commit'> Commit Name: 126f92a6f3ad597b22ec2f60908a14af40dc960a</div><div id='time'> Time: 2020-05-21</div><div id='author'> Author: randonlang@gmail.com</div><div id='file'> File Name: python/jittor/test/test_conv_tuner.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: conv_nchw(9)</div><div id='n_method'> N Method Name: conv_nchw(9)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: python/jittor/test/test_conv_tuner.py</div><div id='n_file'> N File Name: python/jittor/test/test_conv_tuner.py</div><div id='m_start'> M Start Line: 23</div><div id='m_end'> M End Line: 35</div><div id='n_start'> N Start Line: 31</div><div id='n_end'> N End Line: 31</div><BR>