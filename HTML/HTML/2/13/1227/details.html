<html><h3>Pattern ID :1227
</h3><img src='6284223.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
    def pull_model(self, model_name):
        model_list_json = self.list_model_api(model_name)
        if model_list_json is not None and model_list_json != "":
            model_storage_url<a id="change"> = </a><a id="change">model_list_json.get("model_url"</a>, <a id="change">""</a><a id="change">)</a>
            <a id="change">if </a><a id="change">model_storage_url != ""</a>:
                local_model_package = self.pull_model_from_s3(model_storage_url, model_name)
                if local_model_package != "":
                    model_dir<a id="change"> = </a>os.path.join(ClientConstants.get_model_dir(), model_name)
                    ClientConstants.unzip_file(local_model_package, model_dir)
                    if os.path.exists(model_dir):
                        return True</code></pre><h3>After Change</h3><pre><code class='java'>
            query_model_name = model.model_name
            if query_model_name != model_name:
                continue
            <a id="change">if model_storage_url is None</a> or <a id="change">model_storage_url == ""</a>:
                continue
            local_model_package = self.pull_model_from_s3(model_storage_url, model_name)
            if local_model_package == "":
                result<a id="change"> = </a>False
                print("Failed to pull model name {}".format(query_model_name))

        return result</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 9</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/fedml-ai/fedml/commit/f8571c7e58ff079b7efa375e28d59f1e49c07b8f#diff-6175f532ef93361717402dc5f52476b67f294f94743cf41104ba1aa4291644d1L189' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 6284223</div><div id='project'> Project Name: fedml-ai/fedml</div><div id='commit'> Commit Name: f8571c7e58ff079b7efa375e28d59f1e49c07b8f</div><div id='time'> Time: 2023-01-07</div><div id='author'> Author: alex.gpt.llm@gmail.com</div><div id='file'> File Name: python/fedml/cli/model_deployment/device_model_cards.py</div><div id='m_class'> M Class Name: FedMLModelCards</div><div id='n_method'> N Class Name: FedMLModelCards</div><div id='m_method'> M Method Name: pull_model(4)</div><div id='n_method'> N Method Name: pull_model(2)</div><div id='m_parent_class'> M Parent Class: Singleton</div><div id='n_parent_class'> N Parent Class: Singleton</div><div id='m_file'> M File Name: python/fedml/cli/model_deployment/device_model_cards.py</div><div id='n_file'> N File Name: python/fedml/cli/model_deployment/device_model_cards.py</div><div id='m_start'> M Start Line: 189</div><div id='m_end'> M End Line: 200</div><div id='n_start'> N Start Line: 221</div><div id='n_end'> N End Line: 239</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
    def pull_model(self, model_name):
        model_list_json = self.list_model_api(model_name)
        if model_list_json is not None and model_list_json != "":
            model_storage_url<a id="change"> = </a><a id="change">model_list_json.get("model_url"</a>, <a id="change">""</a><a id="change">)</a>
            <a id="change">if </a><a id="change">model_storage_url != ""</a>:
                local_model_package = self.pull_model_from_s3(model_storage_url, model_name)
                if local_model_package != "":
                    model_dir<a id="change"> = </a>os.path.join(ClientConstants.get_model_dir(), model_name)
                    ClientConstants.unzip_file(local_model_package, model_dir)
                    if os.path.exists(model_dir):
                        return True</code></pre><h3>After Change</h3><pre><code class='java'>
            query_model_name = model.model_name
            if query_model_name != model_name:
                continue
            <a id="change">if model_storage_url is None</a> or <a id="change">model_storage_url == ""</a>:
                continue
            local_model_package = self.pull_model_from_s3(model_storage_url, model_name)
            if local_model_package == "":
                result<a id="change"> = </a>False
                print("Failed to pull model name {}".format(query_model_name))

        return result</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/fedml-ai/fedml/commit/0c7b40c6966035386f402c76fce7c521ed213251#diff-6175f532ef93361717402dc5f52476b67f294f94743cf41104ba1aa4291644d1L188' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 6284218</div><div id='project'> Project Name: fedml-ai/fedml</div><div id='commit'> Commit Name: 0c7b40c6966035386f402c76fce7c521ed213251</div><div id='time'> Time: 2023-01-07</div><div id='author'> Author: alexliang.kh@gmail.com</div><div id='file'> File Name: python/fedml/cli/model_deployment/device_model_cards.py</div><div id='m_class'> M Class Name: FedMLModelCards</div><div id='n_method'> N Class Name: FedMLModelCards</div><div id='m_method'> M Method Name: pull_model(4)</div><div id='n_method'> N Method Name: pull_model(2)</div><div id='m_parent_class'> M Parent Class: Singleton</div><div id='n_parent_class'> N Parent Class: Singleton</div><div id='m_file'> M File Name: python/fedml/cli/model_deployment/device_model_cards.py</div><div id='n_file'> N File Name: python/fedml/cli/model_deployment/device_model_cards.py</div><div id='m_start'> M Start Line: 189</div><div id='m_end'> M End Line: 200</div><div id='n_start'> N Start Line: 221</div><div id='n_end'> N End Line: 239</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        

        &#47&#47 get devices using CUDA_VISIBLE_DEVICES
        CUDA_VISIBLE_DEVICES<a id="change"> = </a><a id="change">os.environ.get(&quotCUDA_VISIBLE_DEVICES&quot</a>, <a id="change">&quot&quot</a><a id="change">)</a>

        <a id="change">if </a><a id="change">CUDA_VISIBLE_DEVICES != &quot&quot</a>:
            device_ids = CUDA_VISIBLE_DEVICES.split(&quot,&quot)
            devices = [
                docker.types.DeviceRequest(device_ids=device_ids,
                                           capabilities=[[&quotgpu&quot]])
            ]
        else:
            devices<a id="change"> = </a>None

        &#47&#47 Mount required directories
        volumes = {</code></pre><h3>After Change</h3><pre><code class='java'>
        Starts the tritonserver docker container using docker-py
        

        <a id="change">if len(self._gpus) == 1</a> and <a id="change">self._gpus[0] == &quotall&quot</a>:
            devices = [
                docker.types.DeviceRequest(count=-1, capabilities=[[&quotgpu&quot]])
            ]
        else:
            devices<a id="change"> = </a>[
                docker.types.DeviceRequest(device_ids=self._gpus,
                                           capabilities=[[&quotgpu&quot]])
            ]</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/triton-inference-server/model_analyzer/commit/78226a0351f90640139e871206cc4b4b84ab63ac#diff-4518cf33a377d65648805ac556110392008f896749f7c02fdc0729b14b01144eL54' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 6284216</div><div id='project'> Project Name: triton-inference-server/model_analyzer</div><div id='commit'> Commit Name: 78226a0351f90640139e871206cc4b4b84ab63ac</div><div id='time'> Time: 2020-11-24</div><div id='author'> Author: itabrizian@nvidia.com</div><div id='file'> File Name: model_analyzer/triton/server/server_docker.py</div><div id='m_class'> M Class Name: TritonServerDocker</div><div id='n_method'> N Class Name: TritonServerDocker</div><div id='m_method'> M Method Name: start(1)</div><div id='n_method'> N Method Name: start(1)</div><div id='m_parent_class'> M Parent Class: TritonServer</div><div id='n_parent_class'> N Parent Class: TritonServer</div><div id='m_file'> M File Name: model_analyzer/triton/server/server_docker.py</div><div id='n_file'> N File Name: model_analyzer/triton/server/server_docker.py</div><div id='m_start'> M Start Line: 60</div><div id='m_end'> M End Line: 72</div><div id='n_start'> N Start Line: 61</div><div id='n_end'> N End Line: 72</div><BR>