<html><h3>Pattern ID :12605
</h3><img src='42790700.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
    m = NeuralProphet(
        n_forecasts=2, n_lags=10, epochs=EPOCHS, batch_size=BATCH_SIZE, learning_rate=LR, global_normalization=True
    )
    train_dict<a id="change"> = </a><a id="change">{</a>"df1": df1_0, "df2": df2_0<a id="change">}</a>
    test_dict = {"df3": df3_0}
    m.fit(train_dict)
    future = m.make_future_dataframe(test_dict)
    forecast = m.predict(future)</code></pre><h3>After Change</h3><pre><code class='java'>
    log.info("Global Modeling + Global Normalization")
    df = pd.read_csv(PEYTON_FILE, nrows=512)
    df1_0 = df.iloc[:128, :].copy(deep=True)
    <a id="change">df1_0["ID"]</a><a id="change"> = "df1"</a>
    df2_0 = df.iloc[128:256, :].copy(deep=True)
    <a id="change">df2_0["ID"]</a><a id="change"> = "df2"</a>
    df3_0 = df.iloc[256:384, :].copy(deep=True)
    df3_0["ID"] = "df3"
    m = NeuralProphet(
        n_forecasts=2, n_lags=10, epochs=EPOCHS, batch_size=BATCH_SIZE, learning_rate=LR, global_normalization=True
    )
    train_df<a id="change"> = </a><a id="change">pd.concat(</a>(<a id="change">df1_0</a><a id="change">, df2_0</a>)<a id="change">)</a>
    test_df = df3_0
    m.fit(train_df)
    future = m.make_future_dataframe(test_df)
    forecast = m.predict(future)</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 5</div><BR><div id='size'>Non-data size: 9</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/ourownstory/neural_prophet/commit/7fcf23557cb5b30885a8a07387d411c61a50a05e#diff-98bfe78f0e8d895dd454b5eef6f6485a80526776ad3b6525a14117029bd1eacbL845' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 42790700</div><div id='project'> Project Name: ourownstory/neural_prophet</div><div id='commit'> Commit Name: 7fcf23557cb5b30885a8a07387d411c61a50a05e</div><div id='time'> Time: 2022-06-21</div><div id='author'> Author: mgheorghecr@gmail.com</div><div id='file'> File Name: tests/test_integration.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: test_global_modeling_global_normalization(0)</div><div id='n_method'> N Method Name: test_global_modeling_global_normalization(0)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: tests/test_integration.py</div><div id='n_file'> N File Name: tests/test_integration.py</div><div id='m_start'> M Start Line: 845</div><div id='m_end'> M End Line: 852</div><div id='n_start'> N Start Line: 890</div><div id='n_end'> N End Line: 900</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
    m = NeuralProphet(
        n_forecasts=2, n_lags=10, epochs=EPOCHS, batch_size=BATCH_SIZE, learning_rate=LR, global_normalization=True
    )
    train_dict<a id="change"> = </a><a id="change">{</a>"df1": df1_0, "df2": df2_0<a id="change">}</a>
    test_dict = {"df3": df3_0}
    m.fit(train_dict)
    future = m.make_future_dataframe(test_dict)
    forecast = m.predict(future)</code></pre><h3>After Change</h3><pre><code class='java'>
    log.info("Global Modeling + Global Normalization")
    df = pd.read_csv(PEYTON_FILE, nrows=512)
    df1_0 = df.iloc[:128, :].copy(deep=True)
    <a id="change">df1_0["ID"]</a><a id="change"> = "df1"</a>
    df2_0 = df.iloc[128:256, :].copy(deep=True)
    <a id="change">df2_0["ID"]</a><a id="change"> = "df2"</a>
    df3_0 = df.iloc[256:384, :].copy(deep=True)
    df3_0["ID"] = "df3"
    m = NeuralProphet(
        n_forecasts=2, n_lags=10, epochs=EPOCHS, batch_size=BATCH_SIZE, learning_rate=LR, global_normalization=True
    )
    train_df<a id="change"> = </a><a id="change">pd.concat(</a>(df1_0<a id="change">, df2_0</a>)<a id="change">)</a>
    test_df = df3_0
    m.fit(train_df)
    future = m.make_future_dataframe(test_df)
    forecast = m.predict(future)</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/ourownstory/neural_prophet/commit/7fcf23557cb5b30885a8a07387d411c61a50a05e#diff-98bfe78f0e8d895dd454b5eef6f6485a80526776ad3b6525a14117029bd1eacbL841' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 42790701</div><div id='project'> Project Name: ourownstory/neural_prophet</div><div id='commit'> Commit Name: 7fcf23557cb5b30885a8a07387d411c61a50a05e</div><div id='time'> Time: 2022-06-21</div><div id='author'> Author: mgheorghecr@gmail.com</div><div id='file'> File Name: tests/test_integration.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: test_global_modeling_global_normalization(0)</div><div id='n_method'> N Method Name: test_global_modeling_global_normalization(0)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: tests/test_integration.py</div><div id='n_file'> N File Name: tests/test_integration.py</div><div id='m_start'> M Start Line: 845</div><div id='m_end'> M End Line: 852</div><div id='n_start'> N Start Line: 890</div><div id='n_end'> N End Line: 900</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
    df = pd.read_csv(PEYTON_FILE, nrows=512)
    df1_0 = df.iloc[:128, :].copy(deep=True)
    df2_0 = df.iloc[128:256, :].copy(deep=True)
    df_dict<a id="change"> = </a><a id="change">{</a>"df1": df1_0, "df2": df2_0<a id="change">}</a>
    m = NeuralProphet(
        n_forecasts=2,
        n_lags=10,
        epochs=EPOCHS,</code></pre><h3>After Change</h3><pre><code class='java'>
    log.info("Global Modeling + Local Normalization")
    df = pd.read_csv(PEYTON_FILE, nrows=512)
    df1_0 = df.iloc[:128, :].copy(deep=True)
    <a id="change">df1_0["ID"]</a><a id="change"> = "df1"</a>
    df2_0 = df.iloc[128:256, :].copy(deep=True)
    <a id="change">df2_0["ID"]</a><a id="change"> = "df2"</a>
    df3_0 = df.iloc[256:384, :].copy(deep=True)
    df_global<a id="change"> = </a><a id="change">pd.concat(</a>(df1_0<a id="change">, df2_0</a>)<a id="change">)</a>
    m = NeuralProphet(
        n_forecasts=2,
        n_lags=10,
        epochs=EPOCHS,</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/ourownstory/neural_prophet/commit/7fcf23557cb5b30885a8a07387d411c61a50a05e#diff-98bfe78f0e8d895dd454b5eef6f6485a80526776ad3b6525a14117029bd1eacbL814' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 42790733</div><div id='project'> Project Name: ourownstory/neural_prophet</div><div id='commit'> Commit Name: 7fcf23557cb5b30885a8a07387d411c61a50a05e</div><div id='time'> Time: 2022-06-21</div><div id='author'> Author: mgheorghecr@gmail.com</div><div id='file'> File Name: tests/test_integration.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: test_global_modeling_validation_df(0)</div><div id='n_method'> N Method Name: test_global_modeling_validation_df(0)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: tests/test_integration.py</div><div id='n_file'> N File Name: tests/test_integration.py</div><div id='m_start'> M Start Line: 817</div><div id='m_end'> M End Line: 819</div><div id='n_start'> N Start Line: 858</div><div id='n_end'> N End Line: 864</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
    &#47&#47 TODO m3.add_country_holidays("US")
    config_normalization = configure.Normalization("auto", False, True, False)
    for m in [m1, m2, m3]:
        df_dict<a id="change"> = </a><a id="change">{</a>"df1": df1.copy(), "df2": df2.copy()<a id="change">}</a>
        config_normalization.init_data_params(df_dict, m.config_covar, m.regressors_config, m.events_config)
        m.config_normalization = config_normalization
        df_dict = m._normalize(df_dict)
        dataset = m._create_dataset(df_dict, predict_mode=False)</code></pre><h3>After Change</h3><pre><code class='java'>
def test_globaltimedataset():
    df = pd.read_csv(PEYTON_FILE, nrows=100)
    df1 = df[:50]
    <a id="change">df1["ID"]</a><a id="change"> = "df1"</a>
    df2 = df[50:]
    <a id="change">df2["ID"]</a><a id="change"> = "df2"</a>
    m1 = NeuralProphet(
        yearly_seasonality=True,
        weekly_seasonality=True,
        daily_seasonality=True,
        learning_rate=LR,
    )
    m2 = NeuralProphet(
        n_lags=3,
        n_forecasts=2,
        learning_rate=LR,
    )
    m3 = NeuralProphet(learning_rate=LR)
    &#47&#47 TODO m3.add_country_holidays("US")
    config_normalization = configure.Normalization("auto", False, True, False)
    for m in [m1, m2, m3]:
        df_global = <a id="change">pd.concat(</a>(df1<a id="change">, df2</a>)<a id="change">)</a>
        df_global.loc[:, "ds"]<a id="change"> = </a>pd.to_datetime(df_global.loc[:, "ds"])
        config_normalization.init_data_params(df_global, m.config_covar, m.regressors_config, m.events_config)
        m.config_normalization = config_normalization
        df_global = m._normalize(df_global)</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/ourownstory/neural_prophet/commit/7fcf23557cb5b30885a8a07387d411c61a50a05e#diff-6e0c7d0043d4ff88ba528ad3efafdbf7e9e84d544215cc80b30307c1142cd9b0L581' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 42790703</div><div id='project'> Project Name: ourownstory/neural_prophet</div><div id='commit'> Commit Name: 7fcf23557cb5b30885a8a07387d411c61a50a05e</div><div id='time'> Time: 2022-06-21</div><div id='author'> Author: mgheorghecr@gmail.com</div><div id='file'> File Name: tests/test_unit.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: test_globaltimedataset(0)</div><div id='n_method'> N Method Name: test_globaltimedataset(0)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: tests/test_unit.py</div><div id='n_file'> N File Name: tests/test_unit.py</div><div id='m_start'> M Start Line: 583</div><div id='m_end'> M End Line: 626</div><div id='n_start'> N Start Line: 631</div><div id='n_end'> N End Line: 679</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
    df_train, df_test = m.split_df(df_uneven, freq="H")
    log.debug("freq is set even with not definable freq")
    &#47&#47 Check if freq is set for list
    df_dict<a id="change"> = </a><a id="change">{</a>"df1": df, "df2": df<a id="change">}</a>
    m = NeuralProphet(
        learning_rate=LR,
    )
    m.fit(df_dict)</code></pre><h3>After Change</h3><pre><code class='java'>
    log.debug("freq is set even with not definable freq")
    &#47&#47 Check if freq is set for list
    df1 = df.copy(deep=True)
    <a id="change">df1["ID"]</a><a id="change"> = "df1"</a>
    df2 = df.copy(deep=True)
    <a id="change">df2["ID"]</a><a id="change"> = "df2"</a>
    df_global<a id="change"> = </a><a id="change">pd.concat(</a>(df1<a id="change">, df2</a>)<a id="change">)</a>
    m = NeuralProphet(
        learning_rate=LR,
    )
    m.fit(df_global)</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/ourownstory/neural_prophet/commit/7fcf23557cb5b30885a8a07387d411c61a50a05e#diff-6e0c7d0043d4ff88ba528ad3efafdbf7e9e84d544215cc80b30307c1142cd9b0L518' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 42790696</div><div id='project'> Project Name: ourownstory/neural_prophet</div><div id='commit'> Commit Name: 7fcf23557cb5b30885a8a07387d411c61a50a05e</div><div id='time'> Time: 2022-06-21</div><div id='author'> Author: mgheorghecr@gmail.com</div><div id='file'> File Name: tests/test_unit.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: test_infer_frequency(0)</div><div id='n_method'> N Method Name: test_infer_frequency(0)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: tests/test_unit.py</div><div id='n_file'> N File Name: tests/test_unit.py</div><div id='m_start'> M Start Line: 519</div><div id='m_end'> M End Line: 555</div><div id='n_start'> N Start Line: 564</div><div id='n_end'> N End Line: 603</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
    m.add_future_regressor("A")
    m.add_lagged_regressor("B")
    config_normalization = configure.Normalization("auto", False, True, False)
    df_dict<a id="change"> = </a><a id="change">{</a>"df1": df1.copy(), "df2": df2.copy()<a id="change">}</a>
    config_normalization.init_data_params(df_dict, m.config_covar, m.regressors_config, m.events_config)
    m.config_normalization = config_normalization
    df_dict = m._normalize(df_dict)
    dataset = m._create_dataset(df_dict, predict_mode=False)</code></pre><h3>After Change</h3><pre><code class='java'>
    df["A"] = np.arange(len(df))
    df["B"] = np.arange(len(df)) * 0.1
    df1 = df[:50]
    <a id="change">df1["ID"]</a><a id="change"> = "df1"</a>
    df2 = df[50:]
    <a id="change">df2["ID"]</a><a id="change"> = "df2"</a>
    m = NeuralProphet(
        yearly_seasonality=True,
        weekly_seasonality=True,
        daily_seasonality=True,
        n_lags=3,
        n_forecasts=2,
        learning_rate=LR,
    )
    m.add_future_regressor("A")
    m.add_lagged_regressor("B")
    config_normalization = configure.Normalization("auto", False, True, False)
    df_global<a id="change"> = </a><a id="change">pd.concat(</a>(df1<a id="change">, df2</a>)<a id="change">)</a>
    df_global.loc[:, "ds"] = pd.to_datetime(df_global.loc[:, "ds"])
    config_normalization.init_data_params(df_global, m.config_covar, m.regressors_config, m.events_config)
    m.config_normalization = config_normalization
    df_global = m._normalize(df_global)</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/ourownstory/neural_prophet/commit/7fcf23557cb5b30885a8a07387d411c61a50a05e#diff-6e0c7d0043d4ff88ba528ad3efafdbf7e9e84d544215cc80b30307c1142cd9b0L627' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 42790699</div><div id='project'> Project Name: ourownstory/neural_prophet</div><div id='commit'> Commit Name: 7fcf23557cb5b30885a8a07387d411c61a50a05e</div><div id='time'> Time: 2022-06-21</div><div id='author'> Author: mgheorghecr@gmail.com</div><div id='file'> File Name: tests/test_unit.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: test_loader(0)</div><div id='n_method'> N Method Name: test_loader(0)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: tests/test_unit.py</div><div id='n_file'> N File Name: tests/test_unit.py</div><div id='m_start'> M Start Line: 631</div><div id='m_end'> M End Line: 644</div><div id='n_start'> N Start Line: 684</div><div id='n_end'> N End Line: 700</div><BR>