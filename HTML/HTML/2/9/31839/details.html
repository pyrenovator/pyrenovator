<html><h3>Pattern ID :31839
</h3><img src='93072461.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
        &#47&#47 ddx = torch.diff(torch.diff(x, dim=0), dim=0)[88:268]

        y = self.y_data[index]
        dy = <a id="change">torch.diff(y, dim=0)[89:269]</a>
        ddy = <a id="change">torch.diff(torch.diff(y, dim=0), dim=0)[88:268]</a>
        &quot&quot&quot
        size[index][0] = np.min(diastolic list) 
        size[index][1] = np.max(systolic list) 
        &quot&quot&quot
        d = self.size[index][0]
        s = self.size[index][1]
        &#47&#47 m = self.size[index][2].to(&quotcuda&quot)

        <a id="change">return </a>x<a id="change">, y, dy, ddy, d, s</a>

    def __len__(self):
        return self.len
</code></pre><h3>After Change</h3><pre><code class='java'>
        o = self.ohe[index]
        &#47&#47 m = self.size[index][2].to(&quotcuda&quot)

        <a id="change">return </a>x<a id="change">, y, d, s, m, info, o</a>

    def __len__(self):
        return self.len
</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 8</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/tvs-ai/pytorch_rppgs/commit/2f8ae9596d527f46726b01a17ad81e601913b3b3#diff-a4860f3ef856a8707dafb300bd408a5d43e536dc148f3942473ebf1fafc11e29L18' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 93072461</div><div id='project'> Project Name: tvs-ai/pytorch_rppgs</div><div id='commit'> Commit Name: 2f8ae9596d527f46726b01a17ad81e601913b3b3</div><div id='time'> Time: 2023-02-05</div><div id='author'> Author: forownsake@gmail.com</div><div id='file'> File Name: vid2bp/BPNetDataset.py</div><div id='m_class'> M Class Name: BPNetDataset</div><div id='n_method'> N Class Name: BPNetDataset</div><div id='m_method'> M Method Name: __getitem__(2)</div><div id='n_method'> N Method Name: __getitem__(2)</div><div id='m_parent_class'> M Parent Class: Dataset</div><div id='n_parent_class'> N Parent Class: Dataset</div><div id='m_file'> M File Name: vid2bp/BPNetDataset.py</div><div id='n_file'> N File Name: vid2bp/BPNetDataset.py</div><div id='m_start'> M Start Line: 18</div><div id='m_end'> M End Line: 34</div><div id='n_start'> N Start Line: 18</div><div id='n_end'> N End Line: 31</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>

    def __getitem__(self, index):
        x = self.x_data[index][0].to(&quotcuda&quot)
        dx = <a id="change">torch.diff(x, dim=0)[89:269]</a>
        &#47&#47 torch.cat((torch.diff(x), torch.zeros(1).to(&quotcuda:0&quot)))
        ddx = <a id="change">torch.diff(torch.diff(x, dim=0), dim=0)[88:268]</a>
        &#47&#47 x = (self.x_data[index] - torch.mean(self.x_data[index])) / torch.std(self.x_data[index]).to(&quotcuda&quot)
        &#47&#47 x_size = torch.mean(self.x_data[index]).to(&quotcuda&quot)
        &#47&#47 if x_size &lt; 0.5:
        &#47&#47     size_class = 1
        &#47&#47 elif x_size &lt; 1.0:
        &#47&#47     size_class = 2
        &#47&#47 elif x_size &lt; 1.5:
        &#47&#47     size_class = 3
        &#47&#47 elif x_size &lt; 2.0:
        &#47&#47     size_class = 4
        &#47&#47 else:
        &#47&#47     size_class = 5
        y = self.y_data[index].to(&quotcuda&quot)
        dy = torch.diff(y, dim=0)[89:269]
        ddy = torch.diff(torch.diff(y, dim=0), dim=0)[88:268]
        &quot&quot&quot
        size[index][0] = np.min(diastolic list) 
        size[index][1] = np.max(systolic list) 
        &quot&quot&quot
        d = self.size[index][0].to(&quotcuda&quot)
        s = self.size[index][1].to(&quotcuda&quot)
        &#47&#47 m = self.size[index][2].to(&quotcuda&quot)

        <a id="change">return </a>x<a id="change">, dx, ddx, y, dy, ddy, d, s</a>

    def __len__(self):
        return self.len
</code></pre><h3>After Change</h3><pre><code class='java'>
        s = self.size[index][1]
        &#47&#47 m = self.size[index][2].to(&quotcuda&quot)

        <a id="change">return </a>x<a id="change">, y, dy, ddy, d, s</a>

    def __len__(self):
        return self.len
</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/tvs-ai/pytorch_rppgs/commit/0b39906dfe08b771b61ca5df0583a35d9302ea02#diff-a4860f3ef856a8707dafb300bd408a5d43e536dc148f3942473ebf1fafc11e29L17' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 93072463</div><div id='project'> Project Name: tvs-ai/pytorch_rppgs</div><div id='commit'> Commit Name: 0b39906dfe08b771b61ca5df0583a35d9302ea02</div><div id='time'> Time: 2023-01-20</div><div id='author'> Author: forownsake@gmail.com</div><div id='file'> File Name: vid2bp/BPNetDataset.py</div><div id='m_class'> M Class Name: BPNetDataset</div><div id='n_method'> N Class Name: BPNetDataset</div><div id='m_method'> M Method Name: __getitem__(2)</div><div id='n_method'> N Method Name: __getitem__(2)</div><div id='m_parent_class'> M Parent Class: Dataset</div><div id='n_parent_class'> N Parent Class: Dataset</div><div id='m_file'> M File Name: vid2bp/BPNetDataset.py</div><div id='n_file'> N File Name: vid2bp/BPNetDataset.py</div><div id='m_start'> M Start Line: 18</div><div id='m_end'> M End Line: 45</div><div id='n_start'> N Start Line: 18</div><div id='n_end'> N End Line: 34</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
&#47&#47

def get_derivative(input_sig):
    vpg = np.append(<a id="change">np.diff(</a>input_sig<a id="change">, axis=0)</a>, input_sig[-1] - input_sig[-2])
    apg = np.append(np.diff(vpg, axis=0), vpg[-1] - <a id="change">vpg[-2]</a>)

    <a id="change">return </a>vpg<a id="change">, apg</a>

def channel_cat(input_sig):
    vpg, apg = get_derivative(input_sig)
    input_sig = np.expand_dims(input_sig, axis=0)</code></pre><h3>After Change</h3><pre><code class='java'>


def get_derivative(input_sig):
    velocity = np.append(<a id="change">input_sig[1:]</a>, input_sig[-1]) - input_sig
    smoothed_vel = gaussian_filter1d(velocity, sigma=3)
    acceleration = np.append(smoothed_vel[1:], smoothed_vel[-1]) - smoothed_vel
    smoothed_acc = gaussian_filter1d(acceleration, sigma=3)
    &#47&#47 smoothed_vel4 = gaussian_filter1d(smoothed_vel, sigma=4)
    &#47&#47 acc4 = np.append(smoothed_vel4[1:], smoothed_vel4[-1]) - smoothed_vel4
    &#47&#47 smoothed_acc4 = gaussian_filter1d(acc4, sigma=4)
    &#47&#47 acceleration = np.append(velocity[1:], velocity[-1]) - velocity
    &#47&#47 f_cubic = interp1d(np.arange(input_sig.shape[0]), velocity, kind=&quotcubic&quot)
    &#47&#47 y_smoothed0 = gaussian_filter1d(velocity, sigma=1)
    &#47&#47 y_smoothed1 = gaussian_filter1d(velocity, sigma=1.5)
    &#47&#47 y_smoothed2 = gaussian_filter1d(velocity, sigma=2)
    &#47&#47 y_smoothed3 = gaussian_filter1d(velocity, sigma=2.5)
    &#47&#47 y_smoothed4 = gaussian_filter1d(velocity, sigma=3)
    &#47&#47 y_smoothed5 = gaussian_filter1d(velocity, sigma=3.5)
    &#47&#47 y_smoothed6 = gaussian_filter1d(velocity, sigma=4)
    &#47&#47 acc_smooted6 = gaussian_filter1d(acceleration, sigma=4)
    &#47&#47 for i in range(1, 7):
    &#47&#47     plt.plot(eval(f&quoty_smoothed{i}&quot))
    &#47&#47 plt.show()
    &#47&#47 ple_temp[-1] = np.mean(ple_temp[-3:-2])
    &#47&#47 vpg = np.append(np.diff(input_sig, axis=0), input_sig[-1] - input_sig[-2])
    &#47&#47 apg = np.append(np.diff(vpg, axis=0), vpg[-1] - vpg[-2])
    &#47&#47 lpf = LowPassFilter(3.0, 1.0)
    &#47&#47 l_velocity = lpf.filter(velocity)
    &#47&#47 l_acceleration = lpf.filter(acceleration)
    &#47&#47 cubic_velocity = f_cubic(np.arange(input_sig.shape[0]))
    &#47&#47 s_velocity = signal_smoothing(velocity)
    <a id="change">return </a>smoothed_vel<a id="change">, smoothed_acc</a>

def channel_cat(input_sig, scale=True):
    if scale:
        min_max_scaler = MinMaxScaler(feature_range=(1, 3))</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/tvs-ai/pytorch_rppgs/commit/0b39906dfe08b771b61ca5df0583a35d9302ea02#diff-cc722fc475291a412d33d2b19febc54e889732fa9f730adce42fd0bfe77c8518L14' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 93072467</div><div id='project'> Project Name: tvs-ai/pytorch_rppgs</div><div id='commit'> Commit Name: 0b39906dfe08b771b61ca5df0583a35d9302ea02</div><div id='time'> Time: 2023-01-20</div><div id='author'> Author: forownsake@gmail.com</div><div id='file'> File Name: vid2bp/preprocessing/utils/math_module.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: get_derivative(1)</div><div id='n_method'> N Method Name: get_derivative(1)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: vid2bp/preprocessing/utils/math_module.py</div><div id='n_file'> N File Name: vid2bp/preprocessing/utils/math_module.py</div><div id='m_start'> M Start Line: 15</div><div id='m_end'> M End Line: 18</div><div id='n_start'> N Start Line: 45</div><div id='n_end'> N End Line: 73</div><BR>