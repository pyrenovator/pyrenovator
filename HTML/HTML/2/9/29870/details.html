<html><h3>Pattern ID :29870
</h3><img src='88421701.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
        tp_soft = 0
        fn_soft = 0
        fp_soft = 0
        <a id="change">for </a>scorer in scorers<a id="change">:
            </a>tp_hard += len(scorer.gold_to_test_ent_hard_mapping)
            tp_soft<a id="change"> += </a>len(scorer.gold_to_test_ent_soft_mapping)
            fn_hard += len(scorer.ner_fn_hard)
            fn_soft<a id="change"> += </a>len(scorer.ner_fn_soft)
            fp_hard<a id="change"> += </a>len(scorer.ner_fp_hard)
            fp_soft<a id="change"> += </a>len(scorer.ner_fp_soft)

        result[ent_class]["tp_hard"] = tp_hard
        result[ent_class]["tp_soft"] = tp_soft</code></pre><h3>After Change</h3><pre><code class='java'>
    for ent_class, scorers in class_and_scorers.items():
        acc_result = AggregatedAccuracyResult()
        for scorer in scorers:
            acc_result.tp<a id="change"> += </a><a id="change">len(</a>scorer.gold_to_test_ent_soft<a id="change">)</a>
            acc_result.fn_items.extend(ent.match for ent in scorer.ner_fn_soft)
            acc_result.fp_items.extend(ent.match for ent in scorer.ner_fp_soft)
        result[ent_class] = acc_result
    return result</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 7</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/astrazeneca/kazu/commit/d2f9a9d42120131d725738b2c5ae75e8073172e5#diff-8ca462b963e2e1645fc17134596b12f0d8c2c0bb78bea8503197777b7eb09ae8L149' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 88421701</div><div id='project'> Project Name: astrazeneca/kazu</div><div id='commit'> Commit Name: d2f9a9d42120131d725738b2c5ae75e8073172e5</div><div id='time'> Time: 2022-11-30</div><div id='author'> Author: richard.jackson4@astrazeneca.com</div><div id='file'> File Name: kazu/tests/test_acceptance_test.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: aggregate_ner_results(1)</div><div id='n_method'> N Method Name: aggregate_ner_results(1)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: kazu/tests/test_acceptance_test.py</div><div id='n_file'> N File Name: kazu/tests/test_acceptance_test.py</div><div id='m_start'> M Start Line: 149</div><div id='m_end'> M End Line: 171</div><div id='n_start'> N Start Line: 175</div><div id='n_end'> N End Line: 183</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        tp_soft = 0
        fn_soft = 0
        fp_soft = 0
        <a id="change">for scorer</a> in scorers<a id="change">:
            </a>tp_hard<a id="change"> += </a>len(scorer.gold_to_test_ent_hard_mapping)
            tp_soft<a id="change"> += </a>len(scorer.gold_to_test_ent_soft_mapping)
            fn_hard += len(scorer.ner_fn_hard)
            fn_soft += len(scorer.ner_fn_soft)
            fp_hard<a id="change"> += </a>len(scorer.ner_fp_hard)
            fp_soft<a id="change"> += </a>len(scorer.ner_fp_soft)

        result[ent_class]["tp_hard"] = tp_hard
        result[ent_class]["tp_soft"] = tp_soft</code></pre><h3>After Change</h3><pre><code class='java'>
    result: Dict[str, AggregatedAccuracyResult] = {}
    for ent_class, scorers in class_and_scorers.items():
        acc_result = AggregatedAccuracyResult()
        for <a id="change">scorer</a> in scorers:
            acc_result.tp<a id="change"> += </a><a id="change">len(</a>scorer.gold_to_test_ent_soft<a id="change">)</a>
            acc_result.fn_items.extend(ent.match for ent in scorer.ner_fn_soft)
            acc_result.fp_items.extend(ent.match for ent in scorer.ner_fp_soft)
        result[ent_class] = acc_result
    return result</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/astrazeneca/kazu/commit/d2f9a9d42120131d725738b2c5ae75e8073172e5#diff-8ca462b963e2e1645fc17134596b12f0d8c2c0bb78bea8503197777b7eb09ae8L146' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 88421700</div><div id='project'> Project Name: astrazeneca/kazu</div><div id='commit'> Commit Name: d2f9a9d42120131d725738b2c5ae75e8073172e5</div><div id='time'> Time: 2022-11-30</div><div id='author'> Author: richard.jackson4@astrazeneca.com</div><div id='file'> File Name: kazu/tests/test_acceptance_test.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: aggregate_ner_results(1)</div><div id='n_method'> N Method Name: aggregate_ner_results(1)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: kazu/tests/test_acceptance_test.py</div><div id='n_file'> N File Name: kazu/tests/test_acceptance_test.py</div><div id='m_start'> M Start Line: 149</div><div id='m_end'> M End Line: 171</div><div id='n_start'> N Start Line: 175</div><div id='n_end'> N End Line: 183</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        self.index = []
        self.has_forces = False
        for file in files:
            <a id="change">for group_name</a> in file<a id="change">:
                </a>group = file[group_name]
                types<a id="change"> = </a>group["types"]
                pos<a id="change"> = </a>group["pos"]
                energy = group["energy"]
                if "forces" in group:
                    self.has_forces<a id="change"> = </a>True
                    forces<a id="change"> = </a>group["forces"]
                    for i in range(len(energy)):
                        self.index.append((types, pos, energy, forces, i))
                else:</code></pre><h3>After Change</h3><pre><code class='java'>
        self.num_molecules = 0
        files = [h5py.File(f, "r") for f in self.filename.split(";")]
        for file in files:
            for <a id="change">group_name</a> in file:
                self.num_molecules<a id="change"> += </a><a id="change">len(</a>file[group_name]["energy"]<a id="change">)</a>
            file.close()

    def setup_index(self):
        files = [h5py.File(f, "r") for f in self.filename.split(";")]</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/torchmd/torchmd-net/commit/be03c9678669ef4f715908a790070c1e649b6267#diff-8c4f7ffb426f335e35f87a1b1e6677d7b6edd33f4d3e64365f26b4b40877e9eeL21' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 88421831</div><div id='project'> Project Name: torchmd/torchmd-net</div><div id='commit'> Commit Name: be03c9678669ef4f715908a790070c1e649b6267</div><div id='time'> Time: 2022-05-11</div><div id='author'> Author: philipp.thoelke@posteo.de</div><div id='file'> File Name: torchmdnet/datasets/hdf.py</div><div id='m_class'> M Class Name: HDF5</div><div id='n_method'> N Class Name: HDF5</div><div id='m_method'> M Method Name: __init__(2)</div><div id='n_method'> N Method Name: __init__(2)</div><div id='m_parent_class'> M Parent Class: Dataset</div><div id='n_parent_class'> N Parent Class: Dataset</div><div id='m_file'> M File Name: torchmdnet/datasets/hdf.py</div><div id='n_file'> N File Name: torchmdnet/datasets/hdf.py</div><div id='m_start'> M Start Line: 23</div><div id='m_end'> M End Line: 41</div><div id='n_start'> N Start Line: 23</div><div id='n_end'> N End Line: 33</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
    if word_idx is None:
        raise ValueError(f&quotCouldn\&quott find "{word}" in "{prompt}"&quot)

    <a id="change">for </a>idx, <a id="change">token</a> in enumerate(tokens)<a id="change">:
        </a>merge_idxs.append(idx)

        if &quot&lt;/w&gt;&quot in token:
            curr_token<a id="change"> += </a>token[:-4]

            if idx &gt;= word_idx and curr_token == word:
                break

            curr_token<a id="change"> = </a>&quot&quot
            curr_idx<a id="change"> += </a>1
            merge_idxs.clear()
        else:
            curr_token<a id="change"> += </a>token
            merge_idxs.append(idx)

    return [x + 1 for x in merge_idxs], word_idx  &#47&#47 Offset by 1.</code></pre><h3>After Change</h3><pre><code class='java'>
            &#47&#47 merge together all tokens in the word
            return [first_pos + i + offset_idx for i in range(0, token_len)]

        for idx, <a id="change">w_token</a> in enumerate(word_tokens):
            &#47&#47 if the word contains more than one token
            if len(w_token) &gt; len(search_tokens):
                &#47&#47 check to see if the extra tokens were from punctuation
                no_punc = [t for t in w_token if t not in punc_tokens]
                search_no_punc = [t for t in search_tokens if t not in punc_tokens]
                if no_punc and no_punc == search_no_punc:
                    merge_idxs += calc_token_positions(idx, len(search_tokens))
                    word_idx = idx
            elif w_token == search_tokens:
                merge_idxs<a id="change"> += </a>calc_token_positions(idx, <a id="change">len(</a>search_tokens<a id="change">)</a>)
                word_idx = idx
    else:
        merge_idxs.append(word_idx)</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/castorini/daam/commit/854e6ddfdae1781009b31b66b2d5bb15d852fccf#diff-ea4e615a144dec76002186f2cde018c58e9a14487f738b334af1572531829aaeL52' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 88421734</div><div id='project'> Project Name: castorini/daam</div><div id='commit'> Commit Name: 854e6ddfdae1781009b31b66b2d5bb15d852fccf</div><div id='time'> Time: 2022-12-08</div><div id='author'> Author: alotofcatz@gmail.com</div><div id='file'> File Name: daam/utils.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: compute_token_merge_indices(5)</div><div id='n_method'> N Method Name: compute_token_merge_indices(5)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: daam/utils.py</div><div id='n_file'> N File Name: daam/utils.py</div><div id='m_start'> M Start Line: 53</div><div id='m_end'> M End Line: 90</div><div id='n_start'> N Start Line: 54</div><div id='n_end'> N End Line: 91</div><BR>