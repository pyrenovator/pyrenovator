<html><h3>Pattern ID :10260
</h3><img src='36144294.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
                types = group["types"]
                pos = group["pos"]
                energy = group["energy"]
                <a id="change">if "forces" in group</a>:
                    self.has_forces<a id="change"> = </a>True
                    forces = group["forces"]
                    for i in range(len(energy)):
                        self.index.append((types<a id="change">, pos, energy, forces, i</a>))
                else:
                    for i in range(len(energy)):
                        self.index.append((types<a id="change">, pos, energy, i</a>))

    def get(self, idx):
        if self.has_forces:</code></pre><h3>After Change</h3><pre><code class='java'>
        for file in files:
            for group_name in file:
                self.num_molecules += len(file[group_name]["energy"])
            <a id="change">file.close()</a>

    def setup_index(self):
        files = [h5py.File(f, "r") for f in self.filename.split(";")]
        self.has_forces = False</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 6</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/torchmd/torchmd-net/commit/be03c9678669ef4f715908a790070c1e649b6267#diff-8c4f7ffb426f335e35f87a1b1e6677d7b6edd33f4d3e64365f26b4b40877e9eeL23' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 36144294</div><div id='project'> Project Name: torchmd/torchmd-net</div><div id='commit'> Commit Name: be03c9678669ef4f715908a790070c1e649b6267</div><div id='time'> Time: 2022-05-11</div><div id='author'> Author: philipp.thoelke@posteo.de</div><div id='file'> File Name: torchmdnet/datasets/hdf.py</div><div id='m_class'> M Class Name: HDF5</div><div id='n_method'> N Class Name: HDF5</div><div id='m_method'> M Method Name: __init__(2)</div><div id='n_method'> N Method Name: __init__(2)</div><div id='m_parent_class'> M Parent Class: Dataset</div><div id='n_parent_class'> N Parent Class: Dataset</div><div id='m_file'> M File Name: torchmdnet/datasets/hdf.py</div><div id='n_file'> N File Name: torchmdnet/datasets/hdf.py</div><div id='m_start'> M Start Line: 23</div><div id='m_end'> M End Line: 41</div><div id='n_start'> N Start Line: 23</div><div id='n_end'> N End Line: 33</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
    log_dir = il_train_ex.observers[0].dir
    imitation_logger.configure(log_dir, ["stdout", "tensorboard"])

    <a id="change">if benchmark[&quotbenchmark_name&quot] == &quotmagical&quot</a>:
        gym_env_name_chans_first<a id="change">, dataset_dict</a> = load_dataset_magical()
        venv_chans_first = make_vec_env(gym_env_name_chans_first,
                                        n_envs=1,
                                        parallel=False)
    elif benchmark[&quotbenchmark_name&quot] == &quotdm_control&quot:
        gym_env_name_chans_first<a id="change">, dataset_dict</a> = load_dataset_dm_control()
        venv_chans_first = make_vec_env(gym_env_name_chans_first,
                                        n_envs=1,
                                        parallel=False)
    elif benchmark[&quotbenchmark_name&quot] == &quotatari&quot:
        dataset_dict<a id="change"> = </a>load_dataset_atari()
        gym_env_name_chans_last = benchmark[&quotatari_env_id&quot]
        venv_nhwc = VecFrameStack(make_atari_env(gym_env_name_chans_last), 4)
        venv_chans_first = VecTransposeImage(venv_nhwc)</code></pre><h3>After Change</h3><pre><code class='java'>

    &#47&#47 FIXME(sam): make sure this always closes correctly, even when there&quots an
    &#47&#47 exception after creating it (could use try/catch or a context manager)
    <a id="change">venv.close()</a>

    return log_dir

</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/humancompatibleai/eirli/commit/e27cbb99e7f7a03a80d5ff8063b3071bf534edda#diff-b8a30b79d4b477ae4ff3f89cb23e1e0d8475a5ef44d82945f1ab0d152531016cL155' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 36144263</div><div id='project'> Project Name: humancompatibleai/eirli</div><div id='commit'> Commit Name: e27cbb99e7f7a03a80d5ff8063b3071bf534edda</div><div id='time'> Time: 2020-08-13</div><div id='author'> Author: sam@qxcv.net</div><div id='file'> File Name: src/il_representations/scripts/il_train.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: train(5)</div><div id='n_method'> N Method Name: train(5)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: src/il_representations/scripts/il_train.py</div><div id='n_file'> N File Name: src/il_representations/scripts/il_train.py</div><div id='m_start'> M Start Line: 164</div><div id='m_end'> M End Line: 211</div><div id='n_start'> N Start Line: 158</div><div id='n_end'> N End Line: 187</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        for file in files:
            for group_name in file:
                group = file[group_name]
                <a id="change">types</a> = group["types"]
                <a id="change">pos</a> = group["pos"]
                energy = group["energy"]
                <a id="change">if "forces" in group</a>:
                    self.has_forces<a id="change"> = </a>True
                    forces = group["forces"]
                    for i in range(len(energy)):
                        self.index.append((types<a id="change">, pos, energy, forces, i</a>))
                else:
                    for i in range(len(energy)):
                        self.index.append((types<a id="change">, pos, energy, i</a>))

    def get(self, idx):
        if self.has_forces:</code></pre><h3>After Change</h3><pre><code class='java'>
        for file in files:
            for group_name in file:
                self.num_molecules += len(file[group_name]["energy"])
            <a id="change">file.close()</a>

    def setup_index(self):
        files = [h5py.File(f, "r") for f in self.filename.split(";")]
        self.has_forces = False</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/torchmd/torchmd-net/commit/be03c9678669ef4f715908a790070c1e649b6267#diff-8c4f7ffb426f335e35f87a1b1e6677d7b6edd33f4d3e64365f26b4b40877e9eeL21' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 36144310</div><div id='project'> Project Name: torchmd/torchmd-net</div><div id='commit'> Commit Name: be03c9678669ef4f715908a790070c1e649b6267</div><div id='time'> Time: 2022-05-11</div><div id='author'> Author: philipp.thoelke@posteo.de</div><div id='file'> File Name: torchmdnet/datasets/hdf.py</div><div id='m_class'> M Class Name: HDF5</div><div id='n_method'> N Class Name: HDF5</div><div id='m_method'> M Method Name: __init__(2)</div><div id='n_method'> N Method Name: __init__(2)</div><div id='m_parent_class'> M Parent Class: Dataset</div><div id='n_parent_class'> N Parent Class: Dataset</div><div id='m_file'> M File Name: torchmdnet/datasets/hdf.py</div><div id='n_file'> N File Name: torchmdnet/datasets/hdf.py</div><div id='m_start'> M Start Line: 23</div><div id='m_end'> M End Line: 41</div><div id='n_start'> N Start Line: 23</div><div id='n_end'> N End Line: 33</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
    log_dir = il_train_ex.observers[0].dir
    imitation_logger.configure(log_dir, ["stdout", "tensorboard"])

    <a id="change">if benchmark[&quotbenchmark_name&quot] == &quotmagical&quot</a>:
        gym_env_name_chans_first<a id="change">, dataset_dict</a> = load_dataset_magical()
        venv_chans_first = make_vec_env(gym_env_name_chans_first,
                                        n_envs=1,
                                        parallel=False)
    elif benchmark[&quotbenchmark_name&quot] == &quotdm_control&quot:
        gym_env_name_chans_first<a id="change">, dataset_dict</a> = load_dataset_dm_control()
        venv_chans_first = make_vec_env(gym_env_name_chans_first,
                                        n_envs=1,
                                        parallel=False)
    elif benchmark[&quotbenchmark_name&quot] == &quotatari&quot:
        dataset_dict = load_dataset_atari()
        gym_env_name_chans_last<a id="change"> = </a>benchmark[&quotatari_env_id&quot]
        venv_nhwc = VecFrameStack(make_atari_env(gym_env_name_chans_last), 4)
        venv_chans_first = VecTransposeImage(venv_nhwc)
    else:</code></pre><h3>After Change</h3><pre><code class='java'>

    &#47&#47 FIXME(sam): make sure this always closes correctly, even when there&quots an
    &#47&#47 exception after creating it (could use try/catch or a context manager)
    <a id="change">venv.close()</a>

    return log_dir

</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/humancompatibleai/eirli/commit/4f43a9030853ed574d23f2e86f5253fc4ccd11de#diff-b8a30b79d4b477ae4ff3f89cb23e1e0d8475a5ef44d82945f1ab0d152531016cL155' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 36144303</div><div id='project'> Project Name: humancompatibleai/eirli</div><div id='commit'> Commit Name: 4f43a9030853ed574d23f2e86f5253fc4ccd11de</div><div id='time'> Time: 2020-08-13</div><div id='author'> Author: sam@qxcv.net</div><div id='file'> File Name: src/il_representations/scripts/il_train.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: train(5)</div><div id='n_method'> N Method Name: train(5)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: src/il_representations/scripts/il_train.py</div><div id='n_file'> N File Name: src/il_representations/scripts/il_train.py</div><div id='m_start'> M Start Line: 164</div><div id='m_end'> M End Line: 211</div><div id='n_start'> N Start Line: 158</div><div id='n_end'> N End Line: 187</div><BR>