<html><h3>Pattern ID :34400
</h3><img src='98665189.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>

        Returns: values of Vnn * psi
        &quot&quot&quot
        <a id="change">raise </a><a id="change">NotImplementedError()</a>

    def kinetic_energy(self, pos):
        &quot&quot&quotMain switch for the kinetic energy.&quot&quot&quot
</code></pre><h3>After Change</h3><pre><code class='java'>
        

        vnn = 0.
        <a id="change">for </a>at1 in range(self.natom - 1)<a id="change">:
            </a>c0<a id="change"> = </a>self.ao.atom_coords[at1, :]
            Z0<a id="change"> = </a>self.ao.atomic_number[at1]
            for at2 in range(at1 + 1, self.natom):
                c1<a id="change"> = </a>self.ao.atom_coords[at2, :]
                Z1<a id="change"> = </a>self.ao.atomic_number[at2]
                rnn = torch.sqrt(((c0 - c1)**2).sum())
                vnn += Z0<a id="change"> * Z1 / </a>rnn
        return vnn

    def kinetic_energy(self, pos):</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 8</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/nlesc-jcer/qmctorch/commit/adaaa1ed349fb72bbacad1c74788252742eddbf5#diff-405defe6df0aeda631712c496340ecaccab50011fd52a3edf569cb5da9962da5L57' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 98665189</div><div id='project'> Project Name: nlesc-jcer/qmctorch</div><div id='commit'> Commit Name: adaaa1ed349fb72bbacad1c74788252742eddbf5</div><div id='time'> Time: 2020-05-25</div><div id='author'> Author: nicolas.gm.renaud@gmail.com</div><div id='file'> File Name: qmctorch/wavefunction/wf_base.py</div><div id='m_class'> M Class Name: WaveFunction</div><div id='n_method'> N Class Name: WaveFunction</div><div id='m_method'> M Method Name: nuclear_repulsion(1)</div><div id='n_method'> N Method Name: nuclear_repulsion(1)</div><div id='m_parent_class'> M Parent Class: torch.nn.Module</div><div id='n_parent_class'> N Parent Class: torch.nn.Module</div><div id='m_file'> M File Name: qmctorch/wavefunction/wf_base.py</div><div id='n_file'> N File Name: qmctorch/wavefunction/wf_base.py</div><div id='m_start'> M Start Line: 57</div><div id='m_end'> M End Line: 57</div><div id='n_start'> N Start Line: 94</div><div id='n_end'> N End Line: 103</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>

class TestSymNegCosineSimilarityLoss(unittest.TestCase):
    def test_forward_pass(self):
        <a id="change">raise </a><a id="change">NotImplementedError(</a>"TODO: implement unit tests"<a id="change">)</a>
</code></pre><h3>After Change</h3><pre><code class='java'>
class TestSymNegCosineSimilarityLoss(unittest.TestCase):
    def test_forward_pass(self):
        loss = SymNegCosineSimilarityLoss()
        <a id="change">for bsz</a> in range(1, 20)<a id="change">:

            </a>z0<a id="change"> = </a>torch.randn((bsz, 32))
            p0<a id="change"> = </a>torch.randn((bsz, 32))
            z1<a id="change"> = </a>torch.randn((bsz, 32))
            p1<a id="change"> = </a>torch.randn((bsz, 32))

            &#47&#47 symmetry
            l1 = loss((z0, p0), (z1, p1))
            l2 = loss((z1, p1), (z0, p0))
            self.assertAlmostEqual((l1<a id="change"> - </a>l2).pow(2).item(), 0.)
 

    def test_forward_pass_cuda(self):</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/lightly-ai/lightly/commit/b9867bb4d9bfd8d7418ecf36cdfa2a650949cf82#diff-9e6f09ff5269f34caf117c58035980d789bbb306c4ab1816db05b21d06e4fe6cL8' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 98665075</div><div id='project'> Project Name: lightly-ai/lightly</div><div id='commit'> Commit Name: b9867bb4d9bfd8d7418ecf36cdfa2a650949cf82</div><div id='time'> Time: 2020-12-27</div><div id='author'> Author: daviddobre@gmail.com</div><div id='file'> File Name: tests/loss/test_SymNegCosineSimilarityLoss.py</div><div id='m_class'> M Class Name: TestSymNegCosineSimilarityLoss</div><div id='n_method'> N Class Name: TestSymNegCosineSimilarityLoss</div><div id='m_method'> M Method Name: test_forward_pass(1)</div><div id='n_method'> N Method Name: test_forward_pass(1)</div><div id='m_parent_class'> M Parent Class: unittest.TestCase</div><div id='n_parent_class'> N Parent Class: unittest.TestCase</div><div id='m_file'> M File Name: tests/loss/test_SymNegCosineSimilarityLoss.py</div><div id='n_file'> N File Name: tests/loss/test_SymNegCosineSimilarityLoss.py</div><div id='m_start'> M Start Line: 9</div><div id='m_end'> M End Line: 9</div><div id='n_start'> N Start Line: 9</div><div id='n_end'> N End Line: 23</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>

        Returns: values of Ven * psi
        &quot&quot&quot
        <a id="change">raise </a><a id="change">NotImplementedError()</a>

    def nuclear_repulsion(self):
        &quot&quot&quotCompute the nuclear repulsion term
</code></pre><h3>After Change</h3><pre><code class='java'>
        

        p = torch.zeros(pos.shape[0], device=self.device)
        <a id="change">for ielec</a> in range(self.nelec)<a id="change">:
            </a>istart<a id="change"> = </a>ielec * self.ndim
            iend<a id="change"> = </a>(ielec + 1) * self.ndim
            pelec = pos[:, istart:iend]
            for iatom in range(self.natom):
                patom<a id="change"> = </a>self.ao.atom_coords[iatom, :]
                Z<a id="change"> = </a>self.ao.atomic_number[iatom]
                r = torch.sqrt(((pelec - patom)**2).sum(1))  &#47&#47 + 1E-12
                p += -<a id="change">Z / </a>r
        return p.view(-1, 1)

    def nuclear_repulsion(self):</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/nlesc-jcer/qmctorch/commit/adaaa1ed349fb72bbacad1c74788252742eddbf5#diff-405defe6df0aeda631712c496340ecaccab50011fd52a3edf569cb5da9962da5L43' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 98665063</div><div id='project'> Project Name: nlesc-jcer/qmctorch</div><div id='commit'> Commit Name: adaaa1ed349fb72bbacad1c74788252742eddbf5</div><div id='time'> Time: 2020-05-25</div><div id='author'> Author: nicolas.gm.renaud@gmail.com</div><div id='file'> File Name: qmctorch/wavefunction/wf_base.py</div><div id='m_class'> M Class Name: WaveFunction</div><div id='n_method'> N Class Name: WaveFunction</div><div id='m_method'> M Method Name: nuclear_potential(2)</div><div id='n_method'> N Method Name: nuclear_potential(2)</div><div id='m_parent_class'> M Parent Class: torch.nn.Module</div><div id='n_parent_class'> N Parent Class: torch.nn.Module</div><div id='m_file'> M File Name: qmctorch/wavefunction/wf_base.py</div><div id='n_file'> N File Name: qmctorch/wavefunction/wf_base.py</div><div id='m_start'> M Start Line: 50</div><div id='m_end'> M End Line: 50</div><div id='n_start'> N Start Line: 72</div><div id='n_end'> N End Line: 82</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>

        Returns: values of Vnn * psi
        &quot&quot&quot
        <a id="change">raise </a><a id="change">NotImplementedError()</a>

    def kinetic_energy(self, pos):
        &quot&quot&quotMain switch for the kinetic energy.&quot&quot&quot
</code></pre><h3>After Change</h3><pre><code class='java'>
        

        vnn = 0.
        <a id="change">for at1</a> in range(self.natom - 1)<a id="change">:
            </a>c0<a id="change"> = </a>self.ao.atom_coords[at1, :]
            Z0<a id="change"> = </a>self.ao.atomic_number[at1]
            for at2 in range(at1 + 1, self.natom):
                c1<a id="change"> = </a>self.ao.atom_coords[at2, :]
                Z1<a id="change"> = </a>self.ao.atomic_number[at2]
                rnn = torch.sqrt(((c0 - c1)**2).sum())
                vnn += Z0<a id="change"> * Z1 / </a>rnn
        return vnn

    def kinetic_energy(self, pos):</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/nlesc-jcer/qmctorch/commit/adaaa1ed349fb72bbacad1c74788252742eddbf5#diff-405defe6df0aeda631712c496340ecaccab50011fd52a3edf569cb5da9962da5L52' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 98665195</div><div id='project'> Project Name: nlesc-jcer/qmctorch</div><div id='commit'> Commit Name: adaaa1ed349fb72bbacad1c74788252742eddbf5</div><div id='time'> Time: 2020-05-25</div><div id='author'> Author: nicolas.gm.renaud@gmail.com</div><div id='file'> File Name: qmctorch/wavefunction/wf_base.py</div><div id='m_class'> M Class Name: WaveFunction</div><div id='n_method'> N Class Name: WaveFunction</div><div id='m_method'> M Method Name: nuclear_repulsion(1)</div><div id='n_method'> N Method Name: nuclear_repulsion(1)</div><div id='m_parent_class'> M Parent Class: torch.nn.Module</div><div id='n_parent_class'> N Parent Class: torch.nn.Module</div><div id='m_file'> M File Name: qmctorch/wavefunction/wf_base.py</div><div id='n_file'> N File Name: qmctorch/wavefunction/wf_base.py</div><div id='m_start'> M Start Line: 57</div><div id='m_end'> M End Line: 57</div><div id='n_start'> N Start Line: 94</div><div id='n_end'> N End Line: 103</div><BR>