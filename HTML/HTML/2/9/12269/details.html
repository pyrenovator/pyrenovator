<html><h3>Pattern ID :12269
</h3><img src='41641010.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
&#47&#47 use pipline to extract all the features, (num_points, max_seq_length, feature_dim): np.ndarray
def get_bert_features(bert_extractor, all_text):
    bert_feartures = bert_extractor(all_text)
    <a id="change">return </a><a id="change">np.array(</a>bert_feartures<a id="change">)</a>


&#47&#47 get raw text from the datasets
def get_rawtext(path, data_kind, vids=None):</code></pre><h3>After Change</h3><pre><code class='java'>
&#47&#47 contextual embedding:if True output the last hidden state of bert, if False, output the embedding of words
def get_bert_features(all_text, contextual_embedding=False):
    inputs = tokenizer(all_text, padding=True, truncation=True, return_tensors="pt")
    bert_feartures<a id="change"> = </a>bert(**inputs)
    outputs = bert_feartures.hidden_states
    <a id="change">if contextual_embedding</a>:
        return <a id="change">outputs[-1].detach().numpy()</a>
    else:
        <a id="change">return </a>outputs[0].detach().numpy()


&#47&#47 get raw text from the datasets</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 7</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/pliang279/multibench/commit/a59df6c7fae04770225cf20a9ac0d2cbf748ed71#diff-397c5e7982acc70ee77604295bc83ad9e1fbc529360b039b50fc379df0510038L15' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 41641010</div><div id='project'> Project Name: pliang279/multibench</div><div id='commit'> Commit Name: a59df6c7fae04770225cf20a9ac0d2cbf748ed71</div><div id='time'> Time: 2021-11-06</div><div id='author'> Author: 1134559300@qq.com</div><div id='file'> File Name: datasets/affect/get_bert_embedding.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: get_bert_features(2)</div><div id='n_method'> N Method Name: get_bert_features(2)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: datasets/affect/get_bert_embedding.py</div><div id='n_file'> N File Name: datasets/affect/get_bert_embedding.py</div><div id='m_start'> M Start Line: 15</div><div id='m_end'> M End Line: 17</div><div id='n_start'> N Start Line: 17</div><div id='n_end'> N End Line: 27</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
&#47&#47 use pipline to extract all the features, (num_points, max_seq_length, feature_dim): np.ndarray
def get_bert_features(bert_extractor, all_text):
    bert_feartures = bert_extractor(all_text)
    <a id="change">return </a><a id="change">np.array(</a>bert_feartures<a id="change">)</a>


&#47&#47 get raw text from the datasets
def get_rawtext(path, data_kind, vids=None):</code></pre><h3>After Change</h3><pre><code class='java'>
&#47&#47 contextual embedding:if True output the last hidden state of bert, if False, output the embedding of words
def get_bert_features(all_text, contextual_embedding=False):
    inputs = tokenizer(all_text, padding=True, truncation=True, return_tensors="pt")
    bert_feartures<a id="change"> = </a>bert(**inputs)
    outputs = bert_feartures.hidden_states
    <a id="change">if contextual_embedding</a>:
        return <a id="change">outputs[-1].detach().numpy()</a>
    else:
        <a id="change">return </a>outputs[0].detach().numpy()


&#47&#47 get raw text from the datasets</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/pliang279/multibench/commit/e99ea7fa1bb62eb89b77db97c2cf3e5a004dc399#diff-397c5e7982acc70ee77604295bc83ad9e1fbc529360b039b50fc379df0510038L15' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 41641002</div><div id='project'> Project Name: pliang279/multibench</div><div id='commit'> Commit Name: e99ea7fa1bb62eb89b77db97c2cf3e5a004dc399</div><div id='time'> Time: 2021-11-06</div><div id='author'> Author: 1134559300@qq.com</div><div id='file'> File Name: datasets/affect/get_bert_embedding.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: get_bert_features(2)</div><div id='n_method'> N Method Name: get_bert_features(2)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: datasets/affect/get_bert_embedding.py</div><div id='n_file'> N File Name: datasets/affect/get_bert_embedding.py</div><div id='m_start'> M Start Line: 15</div><div id='m_end'> M End Line: 17</div><div id='n_start'> N Start Line: 17</div><div id='n_end'> N End Line: 27</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
            if torch.is_tensor(class_1):
                return torch.cat((class_1, class_2), dim=1)
            else:
                <a id="change">return </a><a id="change">np.array(</a>list(zip(class_1, class_2))<a id="change">)</a>.reshape((-1, 2))

        elif self._backend == "tensorflow":
            return self._model.predict(input)</code></pre><h3>After Change</h3><pre><code class='java'>
            self._model = self._model.to(device)

            if isinstance(input, pd.DataFrame):
                input<a id="change"> = </a>input.values
            input, tensor_output = (
                (torch.Tensor(input), False)
                if not torch.is_tensor(input)
                else (input, True)
            )
            input = input.to(device)

            output = self._model(input)

            <a id="change">if tensor_output</a>:
                <a id="change">return </a>output
            else:
                return <a id="change">output.detach().cpu().numpy()</a>

        elif self._backend == "tensorflow":
            return self._model.predict(input)
        else:</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/indyfree/carla/commit/9b4d02120789794e885d4e47da522e1a1c17ed99#diff-2d9dd771c79c24fa5f5bc54bc3c0ce601efbc22310f84f594d35c8605a5640b3L233' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 41641009</div><div id='project'> Project Name: indyfree/carla</div><div id='commit'> Commit Name: 9b4d02120789794e885d4e47da522e1a1c17ed99</div><div id='time'> Time: 2021-05-27</div><div id='author'> Author: sbielawski@web.de</div><div id='file'> File Name: carla/models/catalog/catalog.py</div><div id='m_class'> M Class Name: MLModelCatalog</div><div id='n_method'> N Class Name: MLModelCatalog</div><div id='m_method'> M Method Name: predict_proba(2)</div><div id='n_method'> N Method Name: predict_proba(2)</div><div id='m_parent_class'> M Parent Class: MLModel</div><div id='n_parent_class'> N Parent Class: MLModel</div><div id='m_file'> M File Name: carla/models/catalog/catalog.py</div><div id='n_file'> N File Name: carla/models/catalog/catalog.py</div><div id='m_start'> M Start Line: 255</div><div id='m_end'> M End Line: 266</div><div id='n_start'> N Start Line: 235</div><div id='n_end'> N End Line: 258</div><BR>