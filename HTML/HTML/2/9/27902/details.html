<html><h3>Pattern ID :27902
</h3><img src='82842352.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>


def test_binary_accuracy():
    x = <a id="change">torch.tensor([</a>-3., 0., 19., -12., 23., 1. -1., <a id="change">-1.</a>]<a id="change">)</a>.unsqueeze(dim=-1)
    y<a id="change"> = torch</a><a id="change">.tensor([</a>1, 1, <a id="change">1</a>, 0, 1, 0, 0<a id="change"></a>]<a id="change">)</a>

    task_mock = Task(decoder=BinaryDecoder(), activation=nn.Sigmoid(), labels=None, loss=None, name=&quotmock_task&quot, per_sample_loss=None)
    metric = Accuracy()
    metric.bind_to_task(task_mock)</code></pre><h3>After Change</h3><pre><code class='java'>


def test_binary_accuracy(simple_binary_data):
    x<a id="change">, y, task_mock</a> = simple_binary_data
    metric = Accuracy()
    metric.bind_to_task(task_mock)
</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 6</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/hristo-vrigazov/dnn.cool/commit/332feb6508559af41d5304f5b3f71321e5fc9bb2#diff-c013839ae9f8d11da7ba9ed964de9d4b9ef733c1dd3d1a5487f32a5b2062e1cfL11' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 82842352</div><div id='project'> Project Name: hristo-vrigazov/dnn.cool</div><div id='commit'> Commit Name: 332feb6508559af41d5304f5b3f71321e5fc9bb2</div><div id='time'> Time: 2020-08-11</div><div id='author'> Author: hvrigazov@gmail.com</div><div id='file'> File Name: tests/test_metrics.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: test_binary_accuracy(1)</div><div id='n_method'> N Method Name: test_binary_accuracy(0)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: tests/test_metrics.py</div><div id='n_file'> N File Name: tests/test_metrics.py</div><div id='m_start'> M Start Line: 11</div><div id='m_end'> M End Line: 14</div><div id='n_start'> N Start Line: 20</div><div id='n_end'> N End Line: 21</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>

        observer = APoTObserver(b=8, k=1)
        observer.forward(tensor2quantize)
        observer.min_val = <a id="change">torch.tensor([0</a>]<a id="change">)</a>
        observer.max_val<a id="change"> = </a><a id="change">torch.tensor([255</a>]<a id="change">)</a>
        alpha, gamma, quantization_levels, level_indices = observer.calculate_qparams(signed=False)

        &#47&#47 get apot quantized tensor result
        qtensor = quantize_APoT(tensor2quantize=tensor2quantize,</code></pre><h3>After Change</h3><pre><code class='java'>
        &#47&#47 get uniform quantization quantized tensor result
        uniform_observer = MinMaxObserver()
        uniform_observer(tensor2quantize)
        scale<a id="change">, zero_point</a> = uniform_observer.calculate_qparams()

        uniform_quantized = quantize_per_tensor(input=tensor2quantize,
                                                scale=scale,</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/pytorch/pytorch/commit/0d25915836f9c124d87e654d667821d451a7af12#diff-89acb7f63ee43c181106defa94df2862d253c44946718cd7229b56f3048f5e51L19' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 82842336</div><div id='project'> Project Name: pytorch/pytorch</div><div id='commit'> Commit Name: 0d25915836f9c124d87e654d667821d451a7af12</div><div id='time'> Time: 2022-07-19</div><div id='author'> Author: amandaliu@fb.com</div><div id='file'> File Name: test/quantization/core/experimental/test_quantizer.py</div><div id='m_class'> M Class Name: TestQuantizer</div><div id='n_method'> N Class Name: TestQuantizer</div><div id='m_method'> M Method Name: test_quantize_APoT_rand_k1(1)</div><div id='n_method'> N Method Name: test_quantize_APoT_rand_k1(1)</div><div id='m_parent_class'> M Parent Class: unittest.TestCase</div><div id='n_parent_class'> N Parent Class: unittest.TestCase</div><div id='m_file'> M File Name: test/quantization/core/experimental/test_quantizer.py</div><div id='n_file'> N File Name: test/quantization/core/experimental/test_quantizer.py</div><div id='m_start'> M Start Line: 26</div><div id='m_end'> M End Line: 29</div><div id='n_start'> N Start Line: 25</div><div id='n_end'> N End Line: 41</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>


def test_binary_accuracy():
    x = <a id="change">torch.tensor([</a>-3., 0., <a id="change">19.</a>, -12., 23., 1. -1., -1.<a id="change"></a>]<a id="change">)</a>.unsqueeze(dim=-1)
    y<a id="change"> = </a><a id="change">torch.tensor([</a>1, 1, <a id="change">1</a>, 0, 1, 0, 0<a id="change"></a>]<a id="change">)</a>

    task_mock = Task(decoder=BinaryDecoder(), activation=nn.Sigmoid(), labels=None, loss=None, name=&quotmock_task&quot, per_sample_loss=None)
    metric = Accuracy()
    metric.bind_to_task(task_mock)</code></pre><h3>After Change</h3><pre><code class='java'>


def test_binary_accuracy(simple_binary_data):
    x<a id="change">, y, task_mock</a> = simple_binary_data
    metric = Accuracy()
    metric.bind_to_task(task_mock)
</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/hristo-vrigazov/dnn.cool/commit/332feb6508559af41d5304f5b3f71321e5fc9bb2#diff-c013839ae9f8d11da7ba9ed964de9d4b9ef733c1dd3d1a5487f32a5b2062e1cfL10' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 82842356</div><div id='project'> Project Name: hristo-vrigazov/dnn.cool</div><div id='commit'> Commit Name: 332feb6508559af41d5304f5b3f71321e5fc9bb2</div><div id='time'> Time: 2020-08-11</div><div id='author'> Author: hvrigazov@gmail.com</div><div id='file'> File Name: tests/test_metrics.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: test_binary_accuracy(1)</div><div id='n_method'> N Method Name: test_binary_accuracy(0)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: tests/test_metrics.py</div><div id='n_file'> N File Name: tests/test_metrics.py</div><div id='m_start'> M Start Line: 11</div><div id='m_end'> M End Line: 14</div><div id='n_start'> N Start Line: 20</div><div id='n_end'> N End Line: 21</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
    :param use_unsigned_symmetric: Whether to use signed/unsigned in symmetric case
    :return: Tuple of delta and offset and num_steps
    
    num_steps = torch.pow(<a id="change">torch.tensor([2</a>]<a id="change">, device=encoding_min.device)</a>, bitwidth) - 1
    if use_symmetric_encodings and use_strict_symmetric:
        num_steps -= 1

    &#47&#47 NOTE: This assumes that the use_* flags reflect true condition (regardless of the encoding_* values)
    if use_symmetric_encodings and (not use_unsigned_symmetric):
        &#47&#47 signed symmetric
        absmax = torch.max(torch.abs(encoding_min), torch.abs(encoding_max))
        half_num_steps<a id="change"> = </a>torch.div(num_steps, 2)

        delta = absmax / torch.floor(half_num_steps)
        offset = -torch.ceil(half_num_steps)
    else:
        delta = (encoding_max - encoding_min) / num_steps
        if use_symmetric_encodings:
            &#47&#47 unsigned symmetric
            offset = encoding_min / delta
        else:
            &#47&#47 asymmetric
            b_zero = torch.round(-encoding_min / delta)
            b_zero = torch.min(num_steps, torch.max(<a id="change">torch.tensor([0</a>]<a id="change">, device=encoding_min.device)</a>, b_zero))
            offset = torch.tensor(-b_zero, device=encoding_min.device)

    return delta, offset, num_steps</code></pre><h3>After Change</h3><pre><code class='java'>
            b_zero = torch.min(num_steps_tensor, torch.max(zero_tensor, b_zero))
            offset = -b_zero.clone().detach()

    return delta<a id="change">, offset, num_steps_tensor</a>


def _compute_variables_for_range_learning(tensor: torch.Tensor,
                                          bitwidth: int,</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/quic/aimet/commit/d26dbba1690dee6af39dcf88fbea5308ec1b65ce#diff-b2f96b89478a93e69873eb98010efb6e08d1224ae44c6034c14355f04497a669L319' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 82842334</div><div id='project'> Project Name: quic/aimet</div><div id='commit'> Commit Name: d26dbba1690dee6af39dcf88fbea5308ec1b65ce</div><div id='time'> Time: 2022-11-23</div><div id='author'> Author: quic_geunlee@quicinc.com</div><div id='file'> File Name: TrainingExtensions/torch/src/python/aimet_torch/quantsim_straight_through_grad.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: get_computed_encodings(6)</div><div id='n_method'> N Method Name: get_computed_encodings(6)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: TrainingExtensions/torch/src/python/aimet_torch/quantsim_straight_through_grad.py</div><div id='n_file'> N File Name: TrainingExtensions/torch/src/python/aimet_torch/quantsim_straight_through_grad.py</div><div id='m_start'> M Start Line: 336</div><div id='m_end'> M End Line: 359</div><div id='n_start'> N Start Line: 315</div><div id='n_end'> N End Line: 340</div><BR>