<html><h3>Pattern ID :26522
</h3><img src='79598174.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>

        conv_op = sess.graph.get_operation_by_name(&quotconv1_conv/Conv2D&quot)

        visualization_url<a id="change">, process = </a><a id="change">start_bokeh_server_session(8001</a><a id="change">)</a>
        plotting_utils.visualize_weight_ranges_single_layer(sess, conv_op, visualization_url)
        os.killpg(os.getpgid(process.pid), signal.SIGTERM)

        sess.close()</code></pre><h3>After Change</h3><pre><code class='java'>
        sess.run(init)

        results_dir = &quotartifacts&quot
        <a id="change">if not os.path.exists(&quotartifacts&quot)</a>:
            <a id="change">os.makedirs(&quotartifacts&quot</a><a id="change">)</a>

        conv_op = sess.graph.get_operation_by_name(&quotconv1_conv/Conv2D&quot)

        plotting_utils.visualize_weight_ranges_single_layer(sess, conv_op, results_dir)</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 4</div><BR><div id='size'>Non-data size: 6</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/quic/aimet/commit/4230b257bd39fdac4ed432f995fcb69f4fa873b6#diff-6be7e34a5f6b0b5ce8568db8a13c2c9ea3b507c83c744d9001cae8cdff9cd697L66' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 79598174</div><div id='project'> Project Name: quic/aimet</div><div id='commit'> Commit Name: 4230b257bd39fdac4ed432f995fcb69f4fa873b6</div><div id='time'> Time: 2021-07-08</div><div id='author'> Author: quic_mangal@quicinc.com</div><div id='file'> File Name: TrainingExtensions/tensorflow/test/python/test_visualization_per_layer.py</div><div id='m_class'> M Class Name: TFVisualization</div><div id='n_method'> N Class Name: TFVisualization</div><div id='m_method'> M Method Name: test_visualize_weight_ranges_single_layer(1)</div><div id='n_method'> N Method Name: test_visualize_weight_ranges_single_layer(1)</div><div id='m_parent_class'> M Parent Class: unittest.TestCase</div><div id='n_parent_class'> N Parent Class: unittest.TestCase</div><div id='m_file'> M File Name: TrainingExtensions/tensorflow/test/python/test_visualization_per_layer.py</div><div id='n_file'> N File Name: TrainingExtensions/tensorflow/test/python/test_visualization_per_layer.py</div><div id='m_start'> M Start Line: 68</div><div id='m_end'> M End Line: 70</div><div id='n_start'> N Start Line: 66</div><div id='n_end'> N End Line: 70</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>

    @unittest.skip("Takes 1 min 42 secs to run")
    def test_cross_layer_equalization_mobilenet_v2_visualize_after_optimization(self):
        bokeh_visualizations_url<a id="change">, process = </a><a id="change">start_bokeh_server_session(8006</a><a id="change">)</a>
        torch.manual_seed(10)
        model = MobileNetV2().to(torch.device(&quotcpu&quot))
        bokeh_session = BokehServerSession(bokeh_visualizations_url, session_id="cle")
        model = model.eval()</code></pre><h3>After Change</h3><pre><code class='java'>
        model = model.eval()
        model_copy = copy.deepcopy(model)
        results_dir = &quotartifacts&quot
        <a id="change">if not os.path.exists(&quotartifacts&quot)</a>:
            <a id="change">os.makedirs(&quotartifacts&quot</a><a id="change">)</a>

        &#47&#47 model_copy_again = copy.deepcopy(model)
        batch_norm_fold.fold_all_batch_norms(model_copy, (1, 3, 224, 224))
        equalize_model(model, (1, 3, 224, 224))</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/quic/aimet/commit/60698ba1381d5c8bbbe287783cde618ddfffec0a#diff-69e8214789a448a9851f2f6ba5d34851aa43031453921909889721ddc7265ff0L112' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 79598175</div><div id='project'> Project Name: quic/aimet</div><div id='commit'> Commit Name: 60698ba1381d5c8bbbe287783cde618ddfffec0a</div><div id='time'> Time: 2021-07-08</div><div id='author'> Author: quic_mangal@quicinc.com</div><div id='file'> File Name: NightlyTests/torch/test_cross_layer_equalization.py</div><div id='m_class'> M Class Name: TestCrossLayerEqualization</div><div id='n_method'> N Class Name: TestCrossLayerEqualization</div><div id='m_method'> M Method Name: test_cross_layer_equalization_mobilenet_v2_visualize_after_optimization(1)</div><div id='n_method'> N Method Name: test_cross_layer_equalization_mobilenet_v2_visualize_after_optimization(1)</div><div id='m_parent_class'> M Parent Class: unittest.TestCase</div><div id='n_parent_class'> N Parent Class: unittest.TestCase</div><div id='m_file'> M File Name: NightlyTests/torch/test_cross_layer_equalization.py</div><div id='n_file'> N File Name: NightlyTests/torch/test_cross_layer_equalization.py</div><div id='m_start'> M Start Line: 113</div><div id='m_end'> M End Line: 125</div><div id='n_start'> N Start Line: 111</div><div id='n_end'> N End Line: 116</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>

        conv_op = sess.graph.get_operation_by_name(&quotconv1_conv/Conv2D&quot)

        visualization_url<a id="change">, process = </a><a id="change">start_bokeh_server_session(8001</a><a id="change">)</a>
        plotting_utils.visualize_relative_weight_ranges_single_layer(sess, conv_op, visualization_url)
        os.killpg(os.getpgid(process.pid), signal.SIGTERM)

        sess.close()</code></pre><h3>After Change</h3><pre><code class='java'>
        sess.run(init)

        results_dir = &quotartifacts&quot
        <a id="change">if not os.path.exists(&quotartifacts&quot)</a>:
            <a id="change">os.makedirs(&quotartifacts&quot</a><a id="change">)</a>

        conv_op = sess.graph.get_operation_by_name(&quotconv1_conv/Conv2D&quot)

        plotting_utils.visualize_relative_weight_ranges_single_layer(sess, conv_op, results_dir)</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/quic/aimet/commit/4230b257bd39fdac4ed432f995fcb69f4fa873b6#diff-6be7e34a5f6b0b5ce8568db8a13c2c9ea3b507c83c744d9001cae8cdff9cd697L74' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 79598176</div><div id='project'> Project Name: quic/aimet</div><div id='commit'> Commit Name: 4230b257bd39fdac4ed432f995fcb69f4fa873b6</div><div id='time'> Time: 2021-07-08</div><div id='author'> Author: quic_mangal@quicinc.com</div><div id='file'> File Name: TrainingExtensions/tensorflow/test/python/test_visualization_per_layer.py</div><div id='m_class'> M Class Name: TFVisualization</div><div id='n_method'> N Class Name: TFVisualization</div><div id='m_method'> M Method Name: test_visualize_relative_weight_ranges_single_layer(1)</div><div id='n_method'> N Method Name: test_visualize_relative_weight_ranges_single_layer(1)</div><div id='m_parent_class'> M Parent Class: unittest.TestCase</div><div id='n_parent_class'> N Parent Class: unittest.TestCase</div><div id='m_file'> M File Name: TrainingExtensions/tensorflow/test/python/test_visualization_per_layer.py</div><div id='n_file'> N File Name: TrainingExtensions/tensorflow/test/python/test_visualization_per_layer.py</div><div id='m_start'> M Start Line: 86</div><div id='m_end'> M End Line: 88</div><div id='n_start'> N Start Line: 86</div><div id='n_end'> N End Line: 90</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        os.killpg(os.getpgid(process.pid), signal.SIGTERM)

    def test_cross_layer_equalization_resnet18_visualize_to_identify_problem_layers(self):
        bokeh_visualizations_url<a id="change">, process = </a><a id="change">start_bokeh_server_session(6008</a><a id="change">)</a>
        torch.manual_seed(10)
        model = models.resnet18()
        model = model.eval()
</code></pre><h3>After Change</h3><pre><code class='java'>
        model = model.eval()

        results_dir = &quotartifacts&quot
        <a id="change">if not os.path.exists(&quotartifacts&quot)</a>:
            <a id="change">os.makedirs(&quotartifacts&quot</a><a id="change">)</a>

        batch_norm_fold.fold_all_batch_norms(model, (1, 3, 224, 224))

        visualize_model.visualize_relative_weight_ranges_to_identify_problematic_layers(model, results_dir)</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/quic/aimet/commit/60698ba1381d5c8bbbe287783cde618ddfffec0a#diff-69e8214789a448a9851f2f6ba5d34851aa43031453921909889721ddc7265ff0L127' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 79598177</div><div id='project'> Project Name: quic/aimet</div><div id='commit'> Commit Name: 60698ba1381d5c8bbbe287783cde618ddfffec0a</div><div id='time'> Time: 2021-07-08</div><div id='author'> Author: quic_mangal@quicinc.com</div><div id='file'> File Name: NightlyTests/torch/test_cross_layer_equalization.py</div><div id='m_class'> M Class Name: TestCrossLayerEqualization</div><div id='n_method'> N Class Name: TestCrossLayerEqualization</div><div id='m_method'> M Method Name: test_cross_layer_equalization_resnet18_visualize_to_identify_problem_layers(1)</div><div id='n_method'> N Method Name: test_cross_layer_equalization_resnet18_visualize_to_identify_problem_layers(1)</div><div id='m_parent_class'> M Parent Class: unittest.TestCase</div><div id='n_parent_class'> N Parent Class: unittest.TestCase</div><div id='m_file'> M File Name: NightlyTests/torch/test_cross_layer_equalization.py</div><div id='n_file'> N File Name: NightlyTests/torch/test_cross_layer_equalization.py</div><div id='m_start'> M Start Line: 128</div><div id='m_end'> M End Line: 139</div><div id='n_start'> N Start Line: 123</div><div id='n_end'> N End Line: 131</div><BR>