<html><h3>Pattern ID :730
</h3><img src='3602390.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
            move_target=self.robot_model.tipLink,
            **kwargs,
        )
        <a id="change">if </a>joint_positions is False:
            return
        <a id="change">assert </a>len(joint_positions) == len(self.joints)
        return joint_positions

    &#47&#47 def _solve_ik_pybullet(self, pose):</code></pre><h3>After Change</h3><pre><code class='java'>
            move_target=move_target,
            **kwargs,
        )
        <a id="change">if res is False</a>:
            <a id="change">return</a>
        j<a id="change"> = </a>[]
        <a id="change">for </a>joint in self.joints<a id="change">:
            </a>joint_name<a id="change"> = </a>pybullet_planning.get_joint_name(
                self.robot, joint
            ).decode()
            j.append(getattr(self.robot_model, joint_name).joint_angle())</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 8</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/wkentaro/safepicking/commit/1326e4aff3fba50e8ccb50d6a8bd751889ff9a76#diff-d3c73746dc2ab639a9f1ae4c15445df7d0fb08716d47baccdbc9e286d399c649L88' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 3602390</div><div id='project'> Project Name: wkentaro/safepicking</div><div id='commit'> Commit Name: 1326e4aff3fba50e8ccb50d6a8bd751889ff9a76</div><div id='time'> Time: 2021-04-06</div><div id='author'> Author: www.kentaro.wada@gmail.com</div><div id='file'> File Name: mercury/_pybullet/panda_robot_interface.py</div><div id='m_class'> M Class Name: PandaRobotInterface</div><div id='n_method'> N Class Name: PandaRobotInterface</div><div id='m_method'> M Method Name: solve_ik(3)</div><div id='n_method'> N Method Name: solve_ik(2)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: mercury/_pybullet/panda_robot_interface.py</div><div id='n_file'> N File Name: mercury/_pybullet/panda_robot_interface.py</div><div id='m_start'> M Start Line: 88</div><div id='m_end'> M End Line: 96</div><div id='n_start'> N Start Line: 102</div><div id='n_end'> N End Line: 121</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
            move_target=self.robot_model.tipLink,
            **kwargs,
        )
        <a id="change">if </a>joint_positions is False:
            return
        <a id="change">assert </a>len(joint_positions) == len(self.joints)
        return joint_positions

    &#47&#47 def _solve_ik_pybullet(self, pose):</code></pre><h3>After Change</h3><pre><code class='java'>
            move_target=move_target,
            **kwargs,
        )
        <a id="change">if res is False</a>:
            <a id="change">return</a>
        j<a id="change"> = </a>[]
        <a id="change">for joint</a> in self.joints<a id="change">:
            </a>joint_name<a id="change"> = </a>pybullet_planning.get_joint_name(
                self.robot, joint
            ).decode()
            j.append(getattr(self.robot_model, joint_name).joint_angle())</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/wkentaro/reorientbot/commit/1326e4aff3fba50e8ccb50d6a8bd751889ff9a76#diff-d3c73746dc2ab639a9f1ae4c15445df7d0fb08716d47baccdbc9e286d399c649L86' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 3602391</div><div id='project'> Project Name: wkentaro/reorientbot</div><div id='commit'> Commit Name: 1326e4aff3fba50e8ccb50d6a8bd751889ff9a76</div><div id='time'> Time: 2021-04-06</div><div id='author'> Author: www.kentaro.wada@gmail.com</div><div id='file'> File Name: mercury/_pybullet/panda_robot_interface.py</div><div id='m_class'> M Class Name: PandaRobotInterface</div><div id='n_method'> N Class Name: PandaRobotInterface</div><div id='m_method'> M Method Name: solve_ik(3)</div><div id='n_method'> N Method Name: solve_ik(2)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: mercury/_pybullet/panda_robot_interface.py</div><div id='n_file'> N File Name: mercury/_pybullet/panda_robot_interface.py</div><div id='m_start'> M Start Line: 88</div><div id='m_end'> M End Line: 96</div><div id='n_start'> N Start Line: 102</div><div id='n_end'> N End Line: 121</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        non_fx_out = model(data)

    &#47&#47 compare output
    <a id="change">if </a>isinstance(fx_out, tuple):
        &#47&#47 some models produce tuple as output
        for v1, v2 in zip(fx_out, non_fx_out):
            <a id="change">assert </a>torch.allclose(v1, v2), f&quot{model.__class__.__name__} has inconsistent outputs, {v1} vs {v2}&quot
    else:
        assert torch.allclose(
            fx_out, non_fx_out,</code></pre><h3>After Change</h3><pre><code class='java'>
    &#47&#47 1. ConViT
    &#47&#47 2. NormFreeNet
    &#47&#47 as they are not supported, let&quots skip them
    <a id="change">if model.__class__.__name__ in [&quotConViT&quot, &quotNormFreeNet&quot]</a>:
        <a id="change">return</a>

    gm = symbolic_trace(model, meta_args=meta_args)

    &#47&#47 run forward
    with torch.no_grad():
        fx_out = gm(**data)
        non_fx_out = model(**data)

    &#47&#47 compare output
    transformed_fx_out = output_transform_fn(fx_out)
    transformed_non_fx_out<a id="change"> = </a>output_transform_fn(non_fx_out)

    assert len(transformed_fx_out) == len(transformed_non_fx_out)

    <a id="change">for key</a> in transformed_fx_out.keys()<a id="change">:
        </a>fx_output_val<a id="change"> = </a>transformed_fx_out[key]
        non_fx_output_val = transformed_non_fx_out[key]
        assert torch.allclose(fx_output_val, non_fx_output_val, atol=1e-5), \
            f&quot{model.__class__.__name__} has inconsistent outputs, {fx_output_val} vs {non_fx_output_val}&quot</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/hpcaitech/colossalai/commit/86ac782d7c8b20289fe42b70ab09dea86024b353#diff-e5365716703a13c1d95910c414722a4244248e089da984f30fd6c399749108a5L8' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 3602392</div><div id='project'> Project Name: hpcaitech/colossalai</div><div id='commit'> Commit Name: 86ac782d7c8b20289fe42b70ab09dea86024b353</div><div id='time'> Time: 2023-03-13</div><div id='author'> Author: somerlee.9@gmail.com</div><div id='file'> File Name: tests/test_fx/test_tracer/test_timm_model/test_timm_model.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: trace_and_compare(4)</div><div id='n_method'> N Method Name: trace_and_compare(3)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: tests/test_fx/test_tracer/test_timm_model/test_timm_model.py</div><div id='n_file'> N File Name: tests/test_fx/test_tracer/test_timm_model/test_timm_model.py</div><div id='m_start'> M Start Line: 21</div><div id='m_end'> M End Line: 34</div><div id='n_start'> N Start Line: 9</div><div id='n_end'> N End Line: 44</div><BR>