<html><h3>Pattern ID :35765
</h3><img src='101799441.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
        return len(self.labels[self.mask])

    def __getitem__(self, index):
        neighbor = <a id="change">self.features[self.dst[self.src==self.mask[index]]]</a>
        return self.features[self.mask[index]].unsqueeze(-2), self.labels[self.mask[index]], neighbor.unsqueeze(-2)
    
    def download(self):
        Download data if it doesn&quott exist in processed_folder already.</code></pre><h3>After Change</h3><pre><code class='java'>
        neighbors_khop = list()
        ids_khop = [self.mask[index]]
        &#47&#47&#47&#47 TODO: simplify this process
        <a id="change">for k</a> in <a id="change">range(</a>self.k_hop<a id="change">):
            </a>ids = torch.LongTensor()
            neighbor = torch.FloatTensor()
            for i in ids_khop:
                &#47&#47&#47&#47 save the index of neighbors
                ids = torch.cat((ids, self.dst[self.src==i]),0)
                neighbor = torch.cat((neighbor, self.get_neighbor(i)),0)
            &#47&#47&#47&#47 TODO random selection in pytorch is tricky
            if ids.shape[0]&gt;self.thres_nodes:
                indices<a id="change"> = </a>torch.randperm(ids.shape[0])[:self.thres_nodes]
                ids<a id="change"> = </a>ids[indices]
                neighbor<a id="change"> = neighbor[indices]</a>
            ids_khop = ids &#47&#47&#47&#47 temp ids for next level
            neighbors_khop.append(neighbor) &#47&#47&#47&#47 cat different level neighbor
        return self.features[self.mask][index].unsqueeze(-2), self.labels[self.mask][index], neighbors_khop
</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 5</div><BR><div id='size'>Non-data size: 8</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/wang-chen/lgl/commit/36d1c2bea9ab66a4314e410accd13e606b234820#diff-d7be30e3ccdfc99fbf37c6b36a1263098300287d64984c82726c186106f517b5L47' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 101799441</div><div id='project'> Project Name: wang-chen/lgl</div><div id='commit'> Commit Name: 36d1c2bea9ab66a4314e410accd13e606b234820</div><div id='time'> Time: 2021-02-04</div><div id='author'> Author: yuhengq@andrew.cmu.edu</div><div id='file'> File Name: datasets/continuumOGB.py</div><div id='m_class'> M Class Name: ContinuumOGB</div><div id='n_method'> N Class Name: ContinuumOGB</div><div id='m_method'> M Method Name: __getitem__(2)</div><div id='n_method'> N Method Name: __getitem__(2)</div><div id='m_parent_class'> M Parent Class: VisionDataset</div><div id='n_parent_class'> N Parent Class: VisionDataset</div><div id='m_file'> M File Name: datasets/continuumOGB.py</div><div id='n_file'> N File Name: datasets/continuumOGB.py</div><div id='m_start'> M Start Line: 48</div><div id='m_end'> M End Line: 49</div><div id='n_start'> N Start Line: 47</div><div id='n_end'> N End Line: 64</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        return len(self.labels[self.mask])

    def __getitem__(self, index):
        neighbor = <a id="change">self.features[self.dst[self.src==self.mask[index]]]</a>
        return self.features[self.mask[index]].unsqueeze(-2), self.labels[self.mask[index]], neighbor.unsqueeze(-2)
    
    def download(self):
        Download data if it doesn&quott exist in processed_folder already.</code></pre><h3>After Change</h3><pre><code class='java'>
        neighbors_khop = list()
        ids_khop = [self.mask[index]]
        &#47&#47&#47&#47 TODO: simplify this process
        <a id="change">for k</a> in <a id="change">range(</a>self.k_hop<a id="change">):
            </a>ids = torch.LongTensor()
            neighbor = torch.FloatTensor()
            for i in ids_khop:
                &#47&#47&#47&#47 save the index of neighbors
                <a id="change">ids</a> = torch.cat((ids, self.dst[self.src==i]),0)
                neighbor = torch.cat((neighbor, self.get_neighbor(i)),0)
            &#47&#47&#47&#47 TODO random selection in pytorch is tricky
            if ids.shape[0]&gt;self.thres_nodes:
                indices<a id="change"> = </a>torch.randperm(ids.shape[0])[:self.thres_nodes]
                ids<a id="change"> = ids[indices]</a>
                neighbor<a id="change"> = </a>neighbor[indices]
            ids_khop = ids &#47&#47&#47&#47 temp ids for next level
            neighbors_khop.append(neighbor) &#47&#47&#47&#47 cat different level neighbor
        return self.features[self.mask][index].unsqueeze(-2), self.labels[self.mask][index], neighbors_khop</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/wang-chen/lgl/commit/36d1c2bea9ab66a4314e410accd13e606b234820#diff-d7be30e3ccdfc99fbf37c6b36a1263098300287d64984c82726c186106f517b5L47' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 101799440</div><div id='project'> Project Name: wang-chen/lgl</div><div id='commit'> Commit Name: 36d1c2bea9ab66a4314e410accd13e606b234820</div><div id='time'> Time: 2021-02-04</div><div id='author'> Author: yuhengq@andrew.cmu.edu</div><div id='file'> File Name: datasets/continuumOGB.py</div><div id='m_class'> M Class Name: ContinuumOGB</div><div id='n_method'> N Class Name: ContinuumOGB</div><div id='m_method'> M Method Name: __getitem__(2)</div><div id='n_method'> N Method Name: __getitem__(2)</div><div id='m_parent_class'> M Parent Class: VisionDataset</div><div id='n_parent_class'> N Parent Class: VisionDataset</div><div id='m_file'> M File Name: datasets/continuumOGB.py</div><div id='n_file'> N File Name: datasets/continuumOGB.py</div><div id='m_start'> M Start Line: 48</div><div id='m_end'> M End Line: 49</div><div id='n_start'> N Start Line: 47</div><div id='n_end'> N End Line: 64</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
    preds = torch.zeros_like(preds)

    for i in range(total):
        <a id="change">preds[i, preds_inds[i]]</a> = 1

    accs = []
    f1s = []</code></pre><h3>After Change</h3><pre><code class='java'>
    preds = preds.cpu().detach()
    truths = truths.cpu().detach()

    <a id="change">preds</a> = torch.sigmoid(preds)

    temp1 = []
    temp2 = []
    for i, truth in enumerate(truths):
        if truth[-1] == 1:
            temp1.append(preds[i].tolist())
            &#47&#47 print(preds[i])
        else:
            temp2.append(preds[i].tolist())
            &#47&#47 print(preds[i])
    &#47&#47 print(temp2)
    print(np.mean(temp1,0))
    print(np.mean(temp2,0))

    &#47&#47 zsl: 0.5 0.5 0.3
    th = [0.5, 0.55, 0.55, 0.95]
    <a id="change">for i</a> in <a id="change">range(</a>len(th)<a id="change">):
        </a>pred<a id="change"> = preds[:, i]</a>
        pred[pred &gt; th[i]]<a id="change"> = </a>1
        pred[pred &lt;= th[i]]<a id="change"> = </a>0
        preds[:, i] = pred

    &#47&#47 preds[0][preds[0] &gt; 0.7] = 1</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/wenliangdai/modality-transferable-mer/commit/e87e05acc2a55e7f84b52c7418bce20a139a6604#diff-0aeb543dc2f4cfda989f7c60a43d968c7b7fb62a96bfcc862e73340dc0cdc97aL148' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 101799442</div><div id='project'> Project Name: wenliangdai/modality-transferable-mer</div><div id='commit'> Commit Name: e87e05acc2a55e7f84b52c7418bce20a139a6604</div><div id='time'> Time: 2020-06-20</div><div id='author'> Author: wenliang.dai.1995@gmail.com</div><div id='file'> File Name: src/evaluate.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: eval_iemocap(2)</div><div id='n_method'> N Method Name: eval_iemocap(2)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: src/evaluate.py</div><div id='n_file'> N File Name: src/evaluate.py</div><div id='m_start'> M Start Line: 155</div><div id='m_end'> M End Line: 165</div><div id='n_start'> N Start Line: 159</div><div id='n_end'> N End Line: 214</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        for i in range(self.num_points):

            if data.ndim == 3:
                <a id="change">data_temp[:, lookback, ind]</a> = xs[i]
            else:
                data_temp[:, ind] = xs[i]
</code></pre><h3>After Change</h3><pre><code class='java'>
            st = en
            en += len(data)

        <a id="change">predictions</a> = self.model(data_all, **self.kwargs)

        st, en = 0, len(data)
        <a id="change">for i</a> in <a id="change">range(</a>self.num_points<a id="change">):
            </a>pred<a id="change"> = predictions[st:en]</a>
            pd_vals[i] = pred.mean()
            ice_vals[i, :] = pred.reshape(-1, )
            st<a id="change"> = </a>en
            en<a id="change"> += </a>len(data)

        return pd_vals, ice_vals
</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/atrcheema/dl4seq/commit/7bb60a2e513f578e0671a557aaee13d28734f461#diff-60edd3238b15e9dd276fe2ae45cffcdb962bc7792f66b571b01ec935b4441ac6L419' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 101799445</div><div id='project'> Project Name: atrcheema/dl4seq</div><div id='commit'> Commit Name: 7bb60a2e513f578e0671a557aaee13d28734f461</div><div id='time'> Time: 2022-04-14</div><div id='author'> Author: ather_abbas786@yahoo.com</div><div id='file'> File Name: ai4water/postprocessing/explain/_partial_dependence.py</div><div id='m_class'> M Class Name: PartialDependencePlot</div><div id='n_method'> N Class Name: PartialDependencePlot</div><div id='m_method'> M Method Name: _pdp_for_2d(4)</div><div id='n_method'> N Method Name: _pdp_for_2d(4)</div><div id='m_parent_class'> M Parent Class: ExplainerMixin</div><div id='n_parent_class'> N Parent Class: ExplainerMixin</div><div id='m_file'> M File Name: ai4water/postprocessing/explain/_partial_dependence.py</div><div id='n_file'> N File Name: ai4water/postprocessing/explain/_partial_dependence.py</div><div id='m_start'> M Start Line: 431</div><div id='m_end'> M End Line: 437</div><div id='n_start'> N Start Line: 453</div><div id='n_end'> N End Line: 481</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        return 1 - cosine(source, self.sentence_transformer.encode([text])[0])

    async def generateQuestions(self ,text: str):
        text_encoding = <a id="change">self.sentence_transformer.encode([text])[0]</a>
        synonyms = self.get_synonyms_fastText(text)
        tokens = [synonyms[doc.text] if doc.text in synonyms.keys() else [doc.text] for doc in self.nlp(text)]
        questions = [&quot &quot.join(question) for question in list(itertools.product(*tokens))]
        questions = filter( lambda x: self.checkDistance(text_encoding, x) &gt;= 0.90  , questions)</code></pre><h3>After Change</h3><pre><code class='java'>
    async def generateQuestions(self ,texts):
        result = []
        if type(texts) == str:
            <a id="change">texts</a> = [texts]
        text_encodings = self.sentence_transformer.encode(texts)
        <a id="change">for i</a> in <a id="change">range(</a>len(texts)<a id="change">):
            </a>text<a id="change"> = texts[i]</a>
            text_encoding<a id="change"> = </a>text_encodings[i]
            synonyms = self.get_synonyms_fastText(text)
            tokens = [synonyms[doc.text] if doc.text in synonyms.keys() else [doc.text] for doc in self.nlp(text)]
            questions = [&quot &quot.join(question) for question in list(itertools.product(*tokens))]
            questions_encodings<a id="change"> = </a>self.sentence_transformer.encode(questions)
            questions = [ questions[i] for i in range(len(questions)) if self.checkDistance(text_encoding, questions_encodings[i]) &gt; 0.90 ]
            &#47&#47questions = filter( lambda x: self.checkDistance(text_encoding, x) &gt;= 0.90  , questions)
            if len(questions):</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/digiteinfotech/kairon/commit/072cedd6f252ee203a12d05f733c9fd0d12a4db4#diff-c98afe924bff47a62ef8e246c685c06bd5cba109e1787e1ac39cc61942f76508L45' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 101799449</div><div id='project'> Project Name: digiteinfotech/kairon</div><div id='commit'> Commit Name: 072cedd6f252ee203a12d05f733c9fd0d12a4db4</div><div id='time'> Time: 2020-03-20</div><div id='author'> Author: fshaikh@digite.com</div><div id='file'> File Name: bot_trainer/QuestionGeneration.py</div><div id='m_class'> M Class Name: QuestionGeneration</div><div id='n_method'> N Class Name: QuestionGeneration</div><div id='m_method'> M Method Name: generateQuestions(2)</div><div id='n_method'> N Method Name: generateQuestions(2)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: bot_trainer/QuestionGeneration.py</div><div id='n_file'> N File Name: bot_trainer/QuestionGeneration.py</div><div id='m_start'> M Start Line: 45</div><div id='m_end'> M End Line: 51</div><div id='n_start'> N Start Line: 45</div><div id='n_end'> N End Line: 61</div><BR>