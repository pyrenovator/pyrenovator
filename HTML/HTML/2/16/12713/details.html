<html><h3>Pattern ID :12713
</h3><img src='43054417.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>

        &#47&#47 Standard input procedure: check the inputs and obtain the
        &#47&#47 embeddings.
        embeddings<a id="change"> = </a><a id="change">super().run_query(</a>query, word_embedding,
                                       lost_vocabulary_threshold<a id="change">)</a>

        &#47&#47 if there is lost_vocabulary_threshold the allowed limit, return the
        &#47&#47  default value (nan)
        if embeddings is None:</code></pre><h3>After Change</h3><pre><code class='java'>
            the normalized distribution of probabilities.
        
        &#47&#47 checks the types of the provided arguments (only the defaults).
        <a id="change">super().run_query(</a>query, <a id="change">word_embedding_model</a>, lost_vocabulary_threshold,
                          preprocessor_options, secondary_preprocessor_options,
                          warn_not_found_words, *<a id="change">args, **kwargs)</a>

        &#47&#47 transforming query words into embeddings
        <a id="change">embeddings = word_embedding_model</a><a id="change">.get_embeddings_from_query(
            query=query,
            lost_vocabulary_threshold=lost_vocabulary_threshold,
            preprocessor_options=preprocessor_options,
            secondary_preprocessor_options=secondary_preprocessor_options,
            warn_not_found_words=warn_not_found_words)</a>

        &#47&#47 if there is any/some set has less words than the allowed limit,
        &#47&#47 return the default value (nan)
        if embeddings is None:
            return {
                &quotquery_name&quot: query.query_name_,
                &quotresult&quot: np.nan,
                &quotkl-divergence&quot: np.nan,
                &quotscore&quot: np.nan,
                &quotnegative_sentiment_probabilities&quot: {},
                &quotnegative_sentiment_distribution&quot: <a id="change">{}</a>
            }

        &#47&#47 get the target and attribute embeddings
        target_embeddings<a id="change"> = embeddings[&quottarget_embeddings&quot]</a>
        attribute_embeddings<a id="change"> = embeddings[&quotattribute_embeddings&quot]</a>
        &#47&#47 create the arrays that will contain the scores for each iteration
        calculated_divergences = []
        calculated_negative_sentiment_probabilities = []
        scores = []</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 14</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/dccuchile/wefe/commit/702ae43a1024a79eb8570e43996113f9ac785afa#diff-d6dd229d3af64a6f996e472e440ab0d4aac3fd940fb1967f698b83487e23f894L176' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 43054417</div><div id='project'> Project Name: dccuchile/wefe</div><div id='commit'> Commit Name: 702ae43a1024a79eb8570e43996113f9ac785afa</div><div id='time'> Time: 2020-11-16</div><div id='author'> Author: pablo.badilla@ug.uchile.cl</div><div id='file'> File Name: wefe/metrics/RNSB.py</div><div id='m_class'> M Class Name: RNSB</div><div id='n_method'> N Class Name: RNSB</div><div id='m_method'> M Method Name: run_query(12)</div><div id='n_method'> N Method Name: run_query(9)</div><div id='m_parent_class'> M Parent Class: BaseMetric</div><div id='n_parent_class'> N Parent Class: BaseMetric</div><div id='m_file'> M File Name: wefe/metrics/RNSB.py</div><div id='n_file'> N File Name: wefe/metrics/RNSB.py</div><div id='m_start'> M Start Line: 176</div><div id='m_end'> M End Line: 249</div><div id='n_start'> N Start Line: 191</div><div id='n_end'> N End Line: 361</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>

        &#47&#47 Standard input procedure: check the inputs and obtain the
        &#47&#47 embeddings.
        embeddings<a id="change"> = </a><a id="change">super().run_query(</a>query, word_embedding,
                                       lost_vocabulary_threshold<a id="change">)</a>

        &#47&#47 if there is any/some set has less words than the allowed limit,
        &#47&#47 return the default value (nan)
        if embeddings is None:</code></pre><h3>After Change</h3><pre><code class='java'>
            with respect to the target sets means.
        
        &#47&#47 checks the types of the provided arguments (only the defaults).
        <a id="change">super().run_query(</a>query, word_embedding_model, lost_vocabulary_threshold,
                          preprocessor_options, secondary_preprocessor_options,
                          warn_not_found_words, *<a id="change">args, **kwargs)</a>

        &#47&#47 transforming query words into embeddings
        <a id="change">embeddings = </a><a id="change">word_embedding_model.get_embeddings_from_query(
            query=query,
            lost_vocabulary_threshold=lost_vocabulary_threshold,
            preprocessor_options=preprocessor_options,
            secondary_preprocessor_options=secondary_preprocessor_options,
            warn_not_found_words=warn_not_found_words)</a>

        &#47&#47 if there is any/some set has less words than the allowed limit,
        &#47&#47 return the default value (nan)
        if embeddings is None:
            return {
                &quotquery_name&quot: query.query_name_,
                &quotresult&quot: np.nan,
                "rnd": np.nan,
                "distances_by_word": <a id="change">{}</a>
            }

        target_embeddings<a id="change"> = </a><a id="change">embeddings[&quottarget_embeddings&quot]</a>
        attribute_embeddings<a id="change"> = </a><a id="change">embeddings[&quotattribute_embeddings&quot]</a>

        target_0_embeddings = list(target_embeddings[0].values())
        target_1_embeddings = list(target_embeddings[1].values())
        attribute_0_embeddings = list(attribute_embeddings[0].values())</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/dccuchile/wefe/commit/702ae43a1024a79eb8570e43996113f9ac785afa#diff-b156fd76896f1c0c2de454becf895f73001fa34335e59c41256c9453ef4b8550L83' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 43054400</div><div id='project'> Project Name: dccuchile/wefe</div><div id='commit'> Commit Name: 702ae43a1024a79eb8570e43996113f9ac785afa</div><div id='time'> Time: 2020-11-16</div><div id='author'> Author: pablo.badilla@ug.uchile.cl</div><div id='file'> File Name: wefe/metrics/RND.py</div><div id='m_class'> M Class Name: RND</div><div id='n_method'> N Class Name: RND</div><div id='m_method'> M Method Name: run_query(9)</div><div id='n_method'> N Method Name: run_query(7)</div><div id='m_parent_class'> M Parent Class: BaseMetric</div><div id='n_parent_class'> N Parent Class: BaseMetric</div><div id='m_file'> M File Name: wefe/metrics/RND.py</div><div id='n_file'> N File Name: wefe/metrics/RND.py</div><div id='m_start'> M Start Line: 123</div><div id='m_end'> M End Line: 141</div><div id='n_start'> N Start Line: 83</div><div id='n_end'> N End Line: 187</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>

        &#47&#47 Standard input procedure: check the inputs and obtain the
        &#47&#47 embeddings.
        embeddings<a id="change"> = </a><a id="change">super().run_query(</a>query, word_embedding,
                                       lost_vocabulary_threshold<a id="change">)</a>

        &#47&#47 if there is lost_vocabulary_threshold the allowed limit, return the
        &#47&#47  default value (nan)
        if embeddings is None:</code></pre><h3>After Change</h3><pre><code class='java'>
            the normalized distribution of probabilities.
        
        &#47&#47 checks the types of the provided arguments (only the defaults).
        <a id="change">super().run_query(</a>query, word_embedding_model, lost_vocabulary_threshold,
                          preprocessor_options, secondary_preprocessor_options,
                          warn_not_found_words, *<a id="change">args, **kwargs)</a>

        &#47&#47 transforming query words into embeddings
        <a id="change">embeddings = </a><a id="change">word_embedding_model.get_embeddings_from_query(
            query=query,
            lost_vocabulary_threshold=lost_vocabulary_threshold,
            preprocessor_options=preprocessor_options,
            secondary_preprocessor_options=secondary_preprocessor_options,
            warn_not_found_words=warn_not_found_words)</a>

        &#47&#47 if there is any/some set has less words than the allowed limit,
        &#47&#47 return the default value (nan)
        if embeddings is None:
            return {
                &quotquery_name&quot: query.query_name_,
                &quotresult&quot: np.nan,
                &quotkl-divergence&quot: np.nan,
                &quotscore&quot: np.nan,
                &quotnegative_sentiment_probabilities&quot: {},
                &quotnegative_sentiment_distribution&quot: <a id="change">{}</a>
            }

        &#47&#47 get the target and attribute embeddings
        target_embeddings<a id="change"> = </a><a id="change">embeddings[&quottarget_embeddings&quot]</a>
        attribute_embeddings<a id="change"> = </a><a id="change">embeddings[&quotattribute_embeddings&quot]</a>
        &#47&#47 create the arrays that will contain the scores for each iteration
        calculated_divergences = []
        calculated_negative_sentiment_probabilities = []
        scores = []</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/dccuchile/wefe/commit/702ae43a1024a79eb8570e43996113f9ac785afa#diff-d6dd229d3af64a6f996e472e440ab0d4aac3fd940fb1967f698b83487e23f894L172' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 43054449</div><div id='project'> Project Name: dccuchile/wefe</div><div id='commit'> Commit Name: 702ae43a1024a79eb8570e43996113f9ac785afa</div><div id='time'> Time: 2020-11-16</div><div id='author'> Author: pablo.badilla@ug.uchile.cl</div><div id='file'> File Name: wefe/metrics/RNSB.py</div><div id='m_class'> M Class Name: RNSB</div><div id='n_method'> N Class Name: RNSB</div><div id='m_method'> M Method Name: run_query(12)</div><div id='n_method'> N Method Name: run_query(9)</div><div id='m_parent_class'> M Parent Class: BaseMetric</div><div id='n_parent_class'> N Parent Class: BaseMetric</div><div id='m_file'> M File Name: wefe/metrics/RNSB.py</div><div id='n_file'> N File Name: wefe/metrics/RNSB.py</div><div id='m_start'> M Start Line: 176</div><div id='m_end'> M End Line: 249</div><div id='n_start'> N Start Line: 191</div><div id='n_end'> N End Line: 361</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>

        &#47&#47 Standard input procedure: check the inputs and obtain the
        &#47&#47 embeddings.
        embeddings<a id="change"> = </a><a id="change">super().run_query(</a>query, word_embedding,
                                       lost_vocabulary_threshold<a id="change">)</a>

        &#47&#47 If the lost vocabulary threshold is exceeded, return the default value
        if embeddings is None:
            return {"query_name": query.query_name_, "result": np.nan}</code></pre><h3>After Change</h3><pre><code class='java'>
        &#47&#47 Standard input procedure: check the inputs and obtain the
        &#47&#47 embeddings.
        &#47&#47 checks the types of the provided arguments (only the defaults).
        <a id="change">super().run_query(</a>query, word_embedding_model, lost_vocabulary_threshold,
                          preprocessor_options, secondary_preprocessor_options,
                          warn_not_found_words, *<a id="change">args, **kwargs)</a>

        &#47&#47 transforming query words into embeddings
        <a id="change">embeddings = </a><a id="change">word_embedding_model.get_embeddings_from_query(
            query=query,
            lost_vocabulary_threshold=lost_vocabulary_threshold,
            preprocessor_options=preprocessor_options,
            secondary_preprocessor_options=secondary_preprocessor_options,
            warn_not_found_words=warn_not_found_words)</a>

        &#47&#47 If the lost vocabulary threshold is exceeded, return the default value
        if embeddings is None:
            return {"query_name": query.query_name_, "result": np.nan}

        &#47&#47 get the target and attribute embeddings
        target_embeddings<a id="change"> = </a><a id="change">embeddings[&quottarget_embeddings&quot]</a>
        attribute_embeddings<a id="change"> = </a><a id="change">embeddings[&quotattribute_embeddings&quot]</a>

        ect = self.__calculate_embedding_coherence(
            list(target_embeddings[0].values()), list(target_embeddings[1].values()),
            list(attribute_embeddings[0].values()))

        return <a id="change">{</a>"query_name": query.query_name_, "result": ect, &quotect&quot: ect<a id="change">}</a>

    def __calculate_embedding_coherence(self, target_set_1: list, target_set_2: list,
                                        attribute_set: list) -&gt; float:
        Calculate the ECT metric over the given parameters. Return the result.</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/dccuchile/wefe/commit/702ae43a1024a79eb8570e43996113f9ac785afa#diff-716a7efe62f6b4a3c0e36fd4d64793760cf8b37d8408f264cbf5624df289196aL39' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 43054451</div><div id='project'> Project Name: dccuchile/wefe</div><div id='commit'> Commit Name: 702ae43a1024a79eb8570e43996113f9ac785afa</div><div id='time'> Time: 2020-11-16</div><div id='author'> Author: pablo.badilla@ug.uchile.cl</div><div id='file'> File Name: wefe/metrics/ECT.py</div><div id='m_class'> M Class Name: ECT</div><div id='n_method'> N Class Name: ECT</div><div id='m_method'> M Method Name: run_query(7)</div><div id='n_method'> N Method Name: run_query(5)</div><div id='m_parent_class'> M Parent Class: BaseMetric</div><div id='n_parent_class'> N Parent Class: BaseMetric</div><div id='m_file'> M File Name: wefe/metrics/ECT.py</div><div id='n_file'> N File Name: wefe/metrics/ECT.py</div><div id='m_start'> M Start Line: 67</div><div id='m_end'> M End Line: 82</div><div id='n_start'> N Start Line: 49</div><div id='n_end'> N End Line: 152</div><BR>