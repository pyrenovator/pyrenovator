<html><h3>Pattern ID :15307
</h3><img src='51998857.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
        ds = h5.create_dataset(chrom, (chrom_len, 4), dtype=g.ALPHABET_TO_ARRAY[&quotN&quot].dtype)
        s = str(g.data[chrom]).upper()
        for i in range(chrom_len):
            ds[i, :] = <a id="change">g.ALPHABET_TO_ARRAY[s[i]]</a>

    &#47&#47 Close.
    h5.close()
</code></pre><h3>After Change</h3><pre><code class='java'>
        ds = h5.create_dataset(chrom, (chrom_len, 4), dtype=g.ALPHABET_TO_ARRAY[&quotN&quot].dtype)
        s = str(g.data[chrom]).upper()
        for i in range(chrom_len):
            <a id="change">if s[i] == &quotA&quot</a>:
                ds[i, 0] = 1
            elif <a id="change">s[i] == &quotC&quot</a>:
                ds[i, 1]<a id="change"> = </a>1
            elif <a id="change">s[i] == &quotT&quot</a>:
                ds[i, 2] = 1
            elif s[i] == &quotG&quot:
                ds[i, 3]<a id="change"> = </a>1
            elif s[i] == &quotN&quot:
                ds[i, :] = 0.25
            else:
                s = <a id="change">"Failed on chrom {} in position {} with character \"{}\"".format(</a>chrom, i, s[i]<a id="change">)</a>
                <a id="change">raise ValueError(</a>s<a id="change">)</a>

    &#47&#47 Close.
    h5.close()
</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 12</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/zj-zhang/amber/commit/449211e63ca9946bc9a13707aa5790682377e1d7#diff-eb2e59aaac5947eba7bb966264b74e8df95ea9728078eed865eec1eaaaad553bL16' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 51998857</div><div id='project'> Project Name: zj-zhang/amber</div><div id='commit'> Commit Name: 449211e63ca9946bc9a13707aa5790682377e1d7</div><div id='time'> Time: 2020-06-29</div><div id='author'> Author: evancofer@gmail.com</div><div id='file'> File Name: bin/convert_fasta_to_encoded_h5py.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: convert_file(2)</div><div id='n_method'> N Method Name: convert_file(2)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: bin/convert_fasta_to_encoded_h5py.py</div><div id='n_file'> N File Name: bin/convert_fasta_to_encoded_h5py.py</div><div id='m_start'> M Start Line: 16</div><div id='m_end'> M End Line: 24</div><div id='n_start'> N Start Line: 20</div><div id='n_end'> N End Line: 39</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
    loader[&quottrain&quot] = TrainDataLoader(train_dataset, batch_size=args.batch_size, shuffle=True)
    loader[&quotvalid&quot] = TrainDataLoader(valid_dataset, batch_size=args.batch_size, shuffle=False)
    
    for mixture, sources in <a id="change">loader[&quottrain&quot]</a>:
        print(mixture.size(), sources.size())
        raise ValueError("Stop")
    </code></pre><h3>After Change</h3><pre><code class='java'>
        print("Does NOT use CUDA")
    
    &#47&#47 Optimizer
    <a id="change">if args.optimizer == &quotsgd&quot</a>:
        optimizer = torch.optim.SGD(model.parameters(), lr=args.lr, weight_decay=args.weight_decay)
    elif <a id="change">args.optimizer == &quotadam&quot</a>:
        optimizer<a id="change"> = </a>torch.optim.Adam(model.parameters(), lr=args.lr, weight_decay=args.weight_decay)
    elif <a id="change">args.optimizer == &quotrmsprop&quot</a>:
        optimizer<a id="change"> = </a>torch.optim.RMSprop(model.parameters(), lr=args.lr, weight_decay=args.weight_decay)
    else:
        <a id="change">raise ValueError(</a><a id="change">"Not support optimizer {}".format(</a>args.optimizer<a id="change">))</a>
        
    &#47&#47 Criterion
    if args.criterion == &quotl2loss&quot:
        criterion = L2Loss(dim=(2,3), reduction=&quotmean&quot) &#47&#47 (batch_size, n_sources, F_bin, T_bin)</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/tky823/dnn-based_source_separation/commit/4923e8361e1425356e840fe5bff2a1550c9e75d4#diff-57994a922f068fb17e56bccecb20b4fe0421dff4212267abdbf42cbbf22d82b8L48' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 51998843</div><div id='project'> Project Name: tky823/dnn-based_source_separation</div><div id='commit'> Commit Name: 4923e8361e1425356e840fe5bff2a1550c9e75d4</div><div id='time'> Time: 2020-09-12</div><div id='author'> Author: delta9guitar97@gmail.com</div><div id='file'> File Name: egs/librispeech/adanet/local/train.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: main(1)</div><div id='n_method'> N Method Name: main(1)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: egs/librispeech/adanet/local/train.py</div><div id='n_file'> N File Name: egs/librispeech/adanet/local/train.py</div><div id='m_start'> M Start Line: 59</div><div id='m_end'> M End Line: 65</div><div id='n_start'> N Start Line: 60</div><div id='n_end'> N End Line: 94</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>

        feat = th.zeros((len(metapath), movies_.shape[0], g.nodes[metapath[0]].data[&quotfeat&quot].shape[1]))
        for i, ntype, col in zip(range(len(metapath)), metapath, movies_.columns):
            feat[i] = g.nodes[ntype].data[&quotfeat&quot][<a id="change">movies_[col]</a>.values]
        feat = feat.reshape(feat.shape[0], feat.shape[1], feat.shape[2] // 2, 2)

        temp_r_vec = th.zeros((len(metapath),  feat.shape[-2], 2))</code></pre><h3>After Change</h3><pre><code class='java'>
            feat[i] = g.nodes[ntype].data[&quotfeat&quot][metapath_idx[:, i]]
        feat = feat.reshape(feat.shape[0], feat.shape[1], feat.shape[2] // 2, 2)

        <a id="change">if self.encoder_type == &quotRotateE&quot</a>:
            temp_r_vec = th.zeros((len(metapath),  feat.shape[-2], 2), device=device)
            temp_r_vec[0, :, 0] = 1

            for i in range(1, len(metapath), 1):
                edge_type = &quot{}-{}&quot.format(metapath[i-1], metapath[i])
                temp_r_vec[i] = self.complex_hada(temp_r_vec[i-1], self.r_vec_dict[edge_type])
                feat[i] = self.complex_hada(feat[i], temp_r_vec[i], opt = &quotfeat&quot)

            feat = feat.reshape(feat.shape[0], feat.shape[1], -1)
            return th.mean(feat, dim=0)

        elif <a id="change">self.encoder_type == &quotLinear&quot</a>:
            feat<a id="change"> = </a>feat.reshape(feat.shape[0], feat.shape[1], -1)
            feat = self.encoder_linear(th.mean(feat, dim=0))
            return feat

        elif <a id="change">self.encoder_type == &quotAverage&quot</a>:
            feat<a id="change"> = </a>feat.reshape(feat.shape[0], feat.shape[1], -1)
            return th.mean(feat, dim=0)

        else:
            <a id="change">raise ValueError(</a><a id="change">"The encoder type {} has not been implemented yet.".format(</a>self.encoder_type<a id="change">))</a>


    @staticmethod
    def complex_hada(h, v, opt = &quotr_vec&quot):</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/bupt-gamma/openhgnn/commit/74981f4fd6ced6ddb99698e9aa45dcea27de098c#diff-6d2022a12a0a8630b745bbadff10b923604e77c862a4cf811d828975785d68d4L329' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 51998863</div><div id='project'> Project Name: bupt-gamma/openhgnn</div><div id='commit'> Commit Name: 74981f4fd6ced6ddb99698e9aa45dcea27de098c</div><div id='time'> Time: 2021-05-27</div><div id='author'> Author: theheavenszhao@outlook.com</div><div id='file'> File Name: openhgnn/models/MAGNN.py</div><div id='m_class'> M Class Name: MAGNN_layer</div><div id='n_method'> N Class Name: MAGNN_layer</div><div id='m_method'> M Method Name: encoder(4)</div><div id='n_method'> N Method Name: encoder(4)</div><div id='m_parent_class'> M Parent Class: nn.Module</div><div id='n_parent_class'> N Parent Class: nn.Module</div><div id='m_file'> M File Name: openhgnn/models/MAGNN.py</div><div id='n_file'> N File Name: openhgnn/models/MAGNN.py</div><div id='m_start'> M Start Line: 331</div><div id='m_end'> M End Line: 345</div><div id='n_start'> N Start Line: 319</div><div id='n_end'> N End Line: 351</div><BR>