<html><h3>Pattern ID :28766
</h3><img src='84669787.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
                    all_group_results[" ".join(all_groups_no_brackets)] = syn_data

        &#47&#47 expand slashes
        for x in list(<a id="change">bracket_results.keys()</a>):
            if "/" in x:
                splits = x.split("/")
                for split in splits:</code></pre><h3>After Change</h3><pre><code class='java'>

    def call(self, synonym: SynonymTerm) -&gt; Optional[SynonymTerm]:
        bracket_results = set()
        all_group_results = <a id="change">set()</a>
        for text in synonym.terms:
            if "(" in text and ")" in text:
                &#47&#47 expand end expression brackets
                matches = re.match(self.end_expression_brackets, text)
                if matches is not None:
                    all_groups_no_brackets = []
                    for group in matches.groups():
                        if (
                            group not in self.excluded_parenthesis
                            and group.lower() not in self.all_stopwords
                        ):
                            bracket_results.add(group.strip())
                            all_groups_no_brackets.append(group)
                    all_group_results.add("".join(all_groups_no_brackets))
                else:
                    &#47&#47 remove mid expression  brackets
                    matches = re.match(self.mid_expression_brackets, text)
                    if matches is not None:
                        all_groups_no_brackets = []
                        for group in matches.groups():
                            all_groups_no_brackets.append(group.strip())
                        <a id="change">all_group_results.add(</a>" ".join(all_groups_no_brackets)<a id="change">)</a>

            &#47&#47 expand slashes
            for x in list(bracket_results):
                if "/" in x:</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 3</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/astrazeneca/kazu/commit/683f1a89d2af77a6ee6da2dd1366301f164fe570#diff-751bb7f59aafebac9b4f4138467d359c0ae4ebe38cf605fa0818172e94918799L94' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 84669787</div><div id='project'> Project Name: astrazeneca/kazu</div><div id='commit'> Commit Name: 683f1a89d2af77a6ee6da2dd1366301f164fe570</div><div id='time'> Time: 2022-11-30</div><div id='author'> Author: richard.jackson4@astrazeneca.com</div><div id='file'> File Name: kazu/modelling/ontology_preprocessing/synonym_generation.py</div><div id='m_class'> M Class Name: SeparatorExpansion</div><div id='n_method'> N Class Name: SeparatorExpansion</div><div id='m_method'> M Method Name: call(2)</div><div id='n_method'> N Method Name: call(3)</div><div id='m_parent_class'> M Parent Class: SynonymGenerator</div><div id='n_parent_class'> N Parent Class: SynonymGenerator</div><div id='m_file'> M File Name: kazu/modelling/ontology_preprocessing/synonym_generation.py</div><div id='n_file'> N File Name: kazu/modelling/ontology_preprocessing/synonym_generation.py</div><div id='m_start'> M Start Line: 94</div><div id='m_end'> M End Line: 132</div><div id='n_start'> N Start Line: 106</div><div id='n_end'> N End Line: 143</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
    &#47&#47 Create the param MoE groups, leave param assign to next step
    for param_group in param_groups:
        group_moe[param_group[&quotname&quot]] = {}
        for key in <a id="change">groups.get_expert_data_parallel_group_dict().keys()</a>:
            group_moe[param_group[&quotname&quot]][key] = {}
            group_moe[param_group[&quotname&quot]][key][&quotname&quot] = key
            group_moe[param_group[&quotname&quot]][key][&quotmoe&quot] = True</code></pre><h3>After Change</h3><pre><code class='java'>
        raise ValueError(f"Unknown param group type of {type(param_groups)}")

    &#47&#47 gather all data parallel group names
    data_parallel_group_names = <a id="change">set()</a>
    for param_group in param_groups:
        for param in param_group["params"]:
            if is_moe_param(param):
                <a id="change">data_parallel_group_names.add(</a>param.group_name<a id="change">)</a>
    data_parallel_group_names = list(data_parallel_group_names)
    group_moe = {}
    &#47&#47 Create the param MoE groups, leave param assign to next step
    for param_group in param_groups:</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/microsoft/deepspeed/commit/c0af6d90f7e63b14d9ccb68d51d42cadc60301da#diff-cec48b3c7def770ef2d14ac7398bfbdf0f209d2558645ffd47d0028988fa66a3L62' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 84669789</div><div id='project'> Project Name: microsoft/deepspeed</div><div id='commit'> Commit Name: c0af6d90f7e63b14d9ccb68d51d42cadc60301da</div><div id='time'> Time: 2022-02-28</div><div id='author'> Author: ammar.awan@microsoft.com</div><div id='file'> File Name: deepspeed/moe/utils.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: split_params_into_different_moe_groups_for_optimizer(1)</div><div id='n_method'> N Method Name: split_params_into_different_moe_groups_for_optimizer(1)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: deepspeed/moe/utils.py</div><div id='n_file'> N File Name: deepspeed/moe/utils.py</div><div id='m_start'> M Start Line: 86</div><div id='m_end'> M End Line: 86</div><div id='n_start'> N Start Line: 75</div><div id='n_end'> N End Line: 92</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
            for idx in id_set.ids:
                score = self.metadata_db.get_by_idx(parser_name, idx).get("annotation_score", 0)
                score_to_id_set[score].add(id_set)
        best = max(<a id="change">score_to_id_set.keys()</a>)

        return score_to_id_set[best]
</code></pre><h3>After Change</h3><pre><code class='java'>
        self, id_sets: Set[EquivalentIdSet], document: Document, parser_name: str
    ) -&gt; Set[EquivalentIdSet]:
        best_score = 0
        best_equiv_id_sets = <a id="change">set()</a>

        for id_set in id_sets:
            for idx in id_set.ids:
                score = self.metadata_db.get_by_idx(parser_name, idx).get("annotation_score", 0)
                if score &gt; best_score:
                    best_score = score
                    best_equiv_id_sets = {id_set}
                elif score == best_score:
                    <a id="change">best_equiv_id_sets.add(</a>id_set<a id="change">)</a>
        
        return best_equiv_id_sets
</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/astrazeneca/kazu/commit/00f77e236450d45e2925ea5fb47755dbc07a6295#diff-91c409429f6151621c60384fdd45600fec02a4dae7c7039b8e72bdbad2a078e7L226' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 84669788</div><div id='project'> Project Name: astrazeneca/kazu</div><div id='commit'> Commit Name: 00f77e236450d45e2925ea5fb47755dbc07a6295</div><div id='time'> Time: 2022-11-30</div><div id='author'> Author: RichJackson@users.noreply.github.com</div><div id='file'> File Name: kazu/steps/linking/post_processing/disambiguation/strategies.py</div><div id='m_class'> M Class Name: AnnotationLevelDisambiguationStrategy</div><div id='n_method'> N Class Name: AnnotationLevelDisambiguationStrategy</div><div id='m_method'> M Method Name: disambiguate(4)</div><div id='n_method'> N Method Name: disambiguate(4)</div><div id='m_parent_class'> M Parent Class: DisambiguationStrategy</div><div id='n_parent_class'> N Parent Class: DisambiguationStrategy</div><div id='m_file'> M File Name: kazu/steps/linking/post_processing/disambiguation/strategies.py</div><div id='n_file'> N File Name: kazu/steps/linking/post_processing/disambiguation/strategies.py</div><div id='m_start'> M Start Line: 229</div><div id='m_end'> M End Line: 236</div><div id='n_start'> N Start Line: 229</div><div id='n_end'> N End Line: 241</div><BR>