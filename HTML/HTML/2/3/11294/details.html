<html><h3>Pattern ID :11294
</h3><img src='38453791.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>

            &#47&#47 save the model if necessary
            if cumulative_loss &lt; min_loss:
                min_loss = <a id="change">self.save_checkpoint(
                    </a>n, cumulative_loss, self.save_model<a id="change">)</a>
                self.observable.models.best = dict(
                    self.wf.state_dict())

            self.print_observable(cumulative_loss)</code></pre><h3>After Change</h3><pre><code class='java'>
                    self.wf.state_dict())

            &#47&#47 save checkpoint file
            <a id="change">if </a>n % chkpt_every == 0:
                <a id="change">self.save_checkpoint(</a>n, cumulative_loss<a id="change">)</a>

            self.print_observable(cumulative_loss)

            &#47&#47 resample the data</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 5</div><BR><div id='size'>Non-data size: 3</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/nlesc-jcer/qmctorch/commit/0bceaf8603cb3e153e55e90d54b4b44dd6ce1369#diff-0c7ac0561c683227ec3bebb7bb6d2af7035c80e22da43e9b48fd7a667bc20c5aL30' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 38453791</div><div id='project'> Project Name: nlesc-jcer/qmctorch</div><div id='commit'> Commit Name: 0bceaf8603cb3e153e55e90d54b4b44dd6ce1369</div><div id='time'> Time: 2020-07-17</div><div id='author'> Author: nicolas.gm.renaud@gmail.com</div><div id='file'> File Name: qmctorch/solver/solver_orbital.py</div><div id='m_class'> M Class Name: SolverOrbital</div><div id='n_method'> N Class Name: SolverOrbital</div><div id='m_method'> M Method Name: run(8)</div><div id='n_method'> N Method Name: run(7)</div><div id='m_parent_class'> M Parent Class: SolverBase</div><div id='n_parent_class'> N Parent Class: SolverBase</div><div id='m_file'> M File Name: qmctorch/solver/solver_orbital.py</div><div id='n_file'> N File Name: qmctorch/solver/solver_orbital.py</div><div id='m_start'> M Start Line: 101</div><div id='m_end'> M End Line: 129</div><div id='n_start'> N Start Line: 30</div><div id='n_end'> N End Line: 143</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>

            if hvd.rank() == 0:
                if cumulative_loss &lt; min_loss:
                    min_loss = <a id="change">self.save_checkpoint(
                        </a>n, cumulative_loss, self.save_model<a id="change">)</a>

            if hvd.rank() == 0:
                self.print_observable(cumulative_loss)
</code></pre><h3>After Change</h3><pre><code class='java'>
                                                  &quotcum_loss&quot)

            if hvd.rank() == 0:
                <a id="change">if </a>cumulative_loss &lt; min_loss:
                    self.observable.models.best = dict(
                        self.wf.state_dict())
                    <a id="change">self.save_checkpoint(</a>n, cumulative_loss<a id="change">)</a>
                    min_loss = cumulative_loss

            if hvd.rank() == 0:
                self.print_observable(cumulative_loss)</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/nlesc-jcer/qmctorch/commit/1b00af3a56a90425565e46ccfe4ff8a8bcd5d664#diff-206aab14cee0e8ea5262ba9aaa6a708e355e80f8966baa86084dff7c9740452eL49' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 38453789</div><div id='project'> Project Name: nlesc-jcer/qmctorch</div><div id='commit'> Commit Name: 1b00af3a56a90425565e46ccfe4ff8a8bcd5d664</div><div id='time'> Time: 2021-03-11</div><div id='author'> Author: matthijs111@gmail.com</div><div id='file'> File Name: qmctorch/solver/solver_orbital_horovod.py</div><div id='m_class'> M Class Name: SolverOrbitalHorovod</div><div id='n_method'> N Class Name: SolverOrbitalHorovod</div><div id='m_method'> M Method Name: run(9)</div><div id='n_method'> N Method Name: run(8)</div><div id='m_parent_class'> M Parent Class: SolverOrbital</div><div id='n_parent_class'> N Parent Class: SolverOrbital</div><div id='m_file'> M File Name: qmctorch/solver/solver_orbital_horovod.py</div><div id='n_file'> N File Name: qmctorch/solver/solver_orbital_horovod.py</div><div id='m_start'> M Start Line: 101</div><div id='m_end'> M End Line: 202</div><div id='n_start'> N Start Line: 51</div><div id='n_end'> N End Line: 180</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
                if cumulative_loss &lt; min_loss:
                    self.observable.models.best = dict(
                        self.wf.state_dict())
                    <a id="change">self.save_checkpoint(</a>n, cumulative_loss<a id="change">)</a>
                    min_loss = cumulative_loss

            if hvd.rank() == 0:
                self.print_observable(cumulative_loss)</code></pre><h3>After Change</h3><pre><code class='java'>
                min_loss = cumulative_loss

                if self.chkpt_every is not None:
                    <a id="change">if </a>(n &gt; 0) and (n % chkpt_every == 0):
                        <a id="change">self.save_checkpoint(</a>n, cumulative_loss<a id="change">)</a>

                self.print_observable(cumulative_loss)

            &#47&#47 resample the data</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/nlesc-jcer/qmctorch/commit/90a20f660535056412598fb1083c6c01873f3eee#diff-206aab14cee0e8ea5262ba9aaa6a708e355e80f8966baa86084dff7c9740452eL49' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 38453794</div><div id='project'> Project Name: nlesc-jcer/qmctorch</div><div id='commit'> Commit Name: 90a20f660535056412598fb1083c6c01873f3eee</div><div id='time'> Time: 2021-03-11</div><div id='author'> Author: matthijs111@gmail.com</div><div id='file'> File Name: qmctorch/solver/solver_orbital_horovod.py</div><div id='m_class'> M Class Name: SolverOrbitalHorovod</div><div id='n_method'> N Class Name: SolverOrbitalHorovod</div><div id='m_method'> M Method Name: run(9)</div><div id='n_method'> N Method Name: run(9)</div><div id='m_parent_class'> M Parent Class: SolverOrbital</div><div id='n_parent_class'> N Parent Class: SolverOrbital</div><div id='m_file'> M File Name: qmctorch/solver/solver_orbital_horovod.py</div><div id='n_file'> N File Name: qmctorch/solver/solver_orbital_horovod.py</div><div id='m_start'> M Start Line: 141</div><div id='m_end'> M End Line: 184</div><div id='n_start'> N Start Line: 99</div><div id='n_end'> N End Line: 186</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
    trainer.fit(model,train_loader, test_loader) 

    &#47&#47manually you can save best checkpoints - 
    <a id="change">trainer.save_checkpoint(</a>os.path.join(args.save,"effnetv4.ckpt")<a id="change">)</a>

if __name__ == &quot__main__&quot:
    parser = get_args_parser()
    args = parser.parse_args()</code></pre><h3>After Change</h3><pre><code class='java'>
    trainer.fit(model, train_loader, test_loader)

    &#47&#47 manually you can save best checkpoints
    <a id="change">if </a>args.save:
        <a id="change">trainer.save_checkpoint(</a>args.save<a id="change">)</a>


if __name__ == &quot__main__&quot:
    parser = get_args_parser()</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/wimlds-trojmiasto/detect-waste/commit/b5e290c469264270c08deb65d5ee34f06c7e546b#diff-a4bfa85ba3878cf972498acf76a97b6f1e37df5489cdfdb299ae2b8eb44e62d6L67' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 38453792</div><div id='project'> Project Name: wimlds-trojmiasto/detect-waste</div><div id='commit'> Commit Name: b5e290c469264270c08deb65d5ee34f06c7e546b</div><div id='time'> Time: 2021-02-16</div><div id='author'> Author: majsylw@onet.eu</div><div id='file'> File Name: classifier/train_effnet.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: main(1)</div><div id='n_method'> N Method Name: main(1)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: classifier/train_effnet.py</div><div id='n_file'> N File Name: classifier/train_effnet.py</div><div id='m_start'> M Start Line: 90</div><div id='m_end'> M End Line: 138</div><div id='n_start'> N Start Line: 152</div><div id='n_end'> N End Line: 171</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>

    def _save_checkpoint(self, trainer: Trainer, filepath: str) -&gt; None:
        Override _save_checkpoint.
        <a id="change">trainer.save_checkpoint(</a>filepath + self.CKPT_EXTENSION, self.save_weights_only<a id="change">)</a>
        self._last_global_step_saved = trainer.global_step

        if self.export_to_onnx:
            input_tensors = trainer.model.input_tensors</code></pre><h3>After Change</h3><pre><code class='java'>

    def _save_checkpoint(self, trainer: Trainer, filepath: str) -&gt; None:
        Override _save_checkpoint.
        <a id="change">if </a>trainer.is_global_zero:
            <a id="change">trainer.save_checkpoint(</a>filepath + self.CKPT_EXTENSION, self.save_weights_only<a id="change">)</a>
            self._last_global_step_saved = trainer.global_step

            if self.export_to_onnx:
                &#47&#47 DDP mode use some wrappers and we go down to BaseModel.</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/eora-ai/torchok/commit/79675061610a85d1cc81382b0468b53866bccfe6#diff-a775409c85568e071b47c25dc069237f8204eb69cff8ed7867e482d4cb0cccf2L33' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 38453796</div><div id='project'> Project Name: eora-ai/torchok</div><div id='commit'> Commit Name: 79675061610a85d1cc81382b0468b53866bccfe6</div><div id='time'> Time: 2022-07-15</div><div id='author'> Author: patr982@gmail.com</div><div id='file'> File Name: src/callbacks/model_checkpoint_with_onnx.py</div><div id='m_class'> M Class Name: ModelCheckpointWithOnnx</div><div id='n_method'> N Class Name: ModelCheckpointWithOnnx</div><div id='m_method'> M Method Name: _save_checkpoint(3)</div><div id='n_method'> N Method Name: _save_checkpoint(3)</div><div id='m_parent_class'> M Parent Class: ModelCheckpoint</div><div id='n_parent_class'> N Parent Class: ModelCheckpoint</div><div id='m_file'> M File Name: src/callbacks/model_checkpoint_with_onnx.py</div><div id='n_file'> N File Name: src/callbacks/model_checkpoint_with_onnx.py</div><div id='m_start'> M Start Line: 35</div><div id='m_end'> M End Line: 44</div><div id='n_start'> N Start Line: 35</div><div id='n_end'> N End Line: 46</div><BR>