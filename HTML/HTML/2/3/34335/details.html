<html><h3>Pattern ID :34335
</h3><img src='98424510.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
    ecs_client = make_ecs_client(config)
    response = ecs_client.list_servers_details(
        ListServersDetailsRequest(ip=vm_local_ip))
    <a id="change">if </a>response.servers:
        vpc_id = response.servers[0].metadata[&quotvpc_id&quot]
        vpc_client = vpc_client or make_vpc_client(config)
        vpc = vpc_client.show_vpc(ShowVpcRequest(vpc_id=vpc_id)).vpc</code></pre><h3>After Change</h3><pre><code class='java'>
def _get_current_vpc(config):
    try:
        response = requests.get(HWC_VM_METADATA_URL)
        metadata_json = <a id="change">json.loads(</a>response.text<a id="change">)</a>
        vpc_id = metadata_json["meta"]["vpc_id"]
        region_id<a id="change"> = </a>metadata_json["region_id"]
        &#47&#47 current region maybe different with workspace region when VPC peering
        vpc_client = make_vpc_client(config, region=region_id)
        vpc = vpc_client.show_vpc(ShowVpcRequest(vpc_id=vpc_id)).vpc</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 4</div><BR><div id='size'>Non-data size: 3</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/oap-project/cloudtik/commit/73bd61b01b75c16f764f8393c7ba60bf25d6dcd3#diff-c03adc5267db814cacc84fe2731fe9a60446d7f29a1d327cf1adf027e5f8411bL588' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 98424510</div><div id='project'> Project Name: oap-project/cloudtik</div><div id='commit'> Commit Name: 73bd61b01b75c16f764f8393c7ba60bf25d6dcd3</div><div id='time'> Time: 2023-02-28</div><div id='author'> Author: chenrui.momo@gmail.com</div><div id='file'> File Name: python/cloudtik/providers/_private/huaweicloud/config.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: _get_current_vpc(1)</div><div id='n_method'> N Method Name: _get_current_vpc(2)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: python/cloudtik/providers/_private/huaweicloud/config.py</div><div id='n_file'> N File Name: python/cloudtik/providers/_private/huaweicloud/config.py</div><div id='m_start'> M Start Line: 588</div><div id='m_end'> M End Line: 603</div><div id='n_start'> N Start Line: 608</div><div id='n_end'> N End Line: 623</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
    get_latest_version_command = f"{docker_exec_cmd} yolk -M {package} -f version "
    for attempt in range(num_tries):
        run_out = run(get_latest_version_command, warn=True, hide=True)
        <a id="change">if </a>run_out.failed or run_out.stdout:
            break
        LOGGER.info(f"Failed {attempt}: &quot{get_latest_version_command}&quot returned &quot{run_out.stdout}&quot")
    assert run_out.failed or run_out.stdout, f"&quot{get_latest_version_command}&quot returned &quot{run_out.stdout}&quot"</code></pre><h3>After Change</h3><pre><code class='java'>
    :return: tuple(command_success: bool, latest_version_value: str)
    
    pypi_package_info = requests.get(f"https://pypi.org/pypi/{package}/json")
    data = <a id="change">json.loads(</a>pypi_package_info.text<a id="change">)</a>
    versions<a id="change"> = </a>data["releases"].keys()
    return str(max(Version(v) for v in versions))

</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/aws/deep-learning-containers/commit/6d858dd378025f9a13ab5e63596ec44249ffbe79#diff-8ce7c16e1cb38f87691246af2827b12119cbad82caa889a4ca646e81600520e1L84' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 98424504</div><div id='project'> Project Name: aws/deep-learning-containers</div><div id='commit'> Commit Name: 6d858dd378025f9a13ab5e63596ec44249ffbe79</div><div id='time'> Time: 2020-12-23</div><div id='author'> Author: 54188298+saimidu@users.noreply.github.com</div><div id='file'> File Name: test/dlc_tests/sanity/test_safety_check.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: _get_latest_package_version(1)</div><div id='n_method'> N Method Name: _get_latest_package_version(3)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: test/dlc_tests/sanity/test_safety_check.py</div><div id='n_file'> N File Name: test/dlc_tests/sanity/test_safety_check.py</div><div id='m_start'> M Start Line: 84</div><div id='m_end'> M End Line: 101</div><div id='n_start'> N Start Line: 85</div><div id='n_end'> N End Line: 96</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        )
        print(&quotbegin delete mpijob %s&quot % KFJ_TASK_NAME)
        &#47&#47 删除旧的mpi
        <a id="change">if </a>KFJ_RUN_ID:
            k8s_client.delete_crd(group=CRD_INFO[&quotgroup&quot],
                                  version=CRD_INFO[&quotversion&quot],
                                  plural=CRD_INFO[&quotplural&quot],</code></pre><h3>After Change</h3><pre><code class='java'>
        &#47&#47                           labels={"run-id": KFJ_RUN_ID})
        print(crd)
        try:
            status<a id="change"> = </a><a id="change">json.loads(</a>crd[&quotstatus_more&quot]<a id="change">)</a>.get(&quotconditions&quot,[])[-1].get(&quottype&quot,&quot&quot)
            if status==&quotSucceeded&quot:
                exit(0)
            else:</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/tencentmusic/cube-studio/commit/3e0bd6a497f21c4957755817352ba2d942984874#diff-da3176695fb989fdac919436c0a4037c2bfc6a976ae293261bbd136badcf8721L281' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 98424513</div><div id='project'> Project Name: tencentmusic/cube-studio</div><div id='commit'> Commit Name: 3e0bd6a497f21c4957755817352ba2d942984874</div><div id='time'> Time: 2022-07-26</div><div id='author'> Author: pengluan@tencent.com</div><div id='file'> File Name: job-template/job/horovod/start.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: main(0)</div><div id='n_method'> N Method Name: main(0)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: job-template/job/horovod/start.py</div><div id='n_file'> N File Name: job-template/job/horovod/start.py</div><div id='m_start'> M Start Line: 282</div><div id='m_end'> M End Line: 344</div><div id='n_start'> N Start Line: 291</div><div id='n_end'> N End Line: 343</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
            r = response.json()
            r["request"] = json_data
            return r
        elif <a id="change"></a>response.status_code == 429:
            print("Rate limited for: " + str(response.extensions.state.expires_in_ms * .001) + " seconds")
            time.sleep(response.extensions.state.expires_in_ms * .001)
        else:</code></pre><h3>After Change</h3><pre><code class='java'>
            return r
        elif response.status_code == 429:
            print(str(response.content))
            dict_error<a id="change"> = </a><a id="change">json.loads(</a>response.content<a id="change">)</a>
            print("Rate limited for: " + str(dict_error[&quotextensions&quot][&quotstate&quot][&quotexpires_in_ms&quot] * .001) + " seconds")
            time.sleep(dict_error[&quotextensions&quot][&quotstate&quot][&quotexpires_in_ms&quot] * .001)
        else:
            print(str(response.content))</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/primeqa/primeqa/commit/f1b381a91f6fbf1fe87acef4320b8636ed86a620#diff-acd617b7810f03e0ec73644651615d3d06ec041f8b388d128cc1810387340adbL11' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 98424514</div><div id='project'> Project Name: primeqa/primeqa</div><div id='commit'> Commit Name: f1b381a91f6fbf1fe87acef4320b8636ed86a620</div><div id='time'> Time: 2023-02-10</div><div id='author'> Author: sjrosenthal@us.ibm.com</div><div id='file'> File Name: primeqa/components/reader/LLMService.py</div><div id='m_class'> M Class Name: LLMService</div><div id='n_method'> N Class Name: LLMService</div><div id='m_method'> M Method Name: generate(7)</div><div id='n_method'> N Method Name: generate(7)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: primeqa/components/reader/LLMService.py</div><div id='n_file'> N File Name: primeqa/components/reader/LLMService.py</div><div id='m_start'> M Start Line: 35</div><div id='m_end'> M End Line: 46</div><div id='n_start'> N Start Line: 39</div><div id='n_end'> N End Line: 53</div><BR>