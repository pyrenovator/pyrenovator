<html><h3>Pattern ID :34449
</h3><img src='98803943.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
    axis_not_channel = [i for i in range(len(tensor_data.shape))]
    axis_not_channel.remove(channel_axis)
    if per_channel:
        thresholds_per_channel<a id="change"> = </a>np.max(<a id="change">np.abs(</a>tensor_data<a id="change">)</a>, axis=tuple(axis_not_channel), keepdims=True)
    else:
        thresholds_per_channel = np.max(np.abs(tensor_data), keepdims=True)
    thresholds_per_channel = np.power(2.0, np.ceil(np.log2(thresholds_per_channel)))</code></pre><h3>After Change</h3><pre><code class='java'>
        n_clusters = 2 ** n_bits
    kmeans = KMeans(n_clusters=n_clusters)

    threshold_selection_tensor = symmetric_selection_tensor<a id="change"> if </a>is_symmetric<a id="change"> else </a>power_of_two_selection_tensor
    thresholds_per_channel = threshold_selection_tensor(tensor_data, p, n_bits, per_channel,
                                                        channel_axis, n_iter, min_threshold,
                                                        qc.QuantizationErrorMethod.NOCLIPPING)[THRESHOLD]</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 3</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/sony/model_optimization/commit/6684273eb930b681f8316af3d81d8e8903e48f67#diff-52d4cc9c31360e266411328df81a4d4dfbffc7e98a3a47da8942c73b7341db5aL40' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 98803943</div><div id='project'> Project Name: sony/model_optimization</div><div id='commit'> Commit Name: 6684273eb930b681f8316af3d81d8e8903e48f67</div><div id='time'> Time: 2022-12-15</div><div id='author'> Author: 78862769+elad-c@users.noreply.github.com</div><div id='file'> File Name: model_compression_toolkit/core/common/quantization/quantization_params_generation/lut_kmeans_params.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: lut_kmeans_tensor(9)</div><div id='n_method'> N Method Name: lut_kmeans_tensor(8)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: model_compression_toolkit/core/common/quantization/quantization_params_generation/lut_kmeans_params.py</div><div id='n_file'> N File Name: model_compression_toolkit/core/common/quantization/quantization_params_generation/lut_kmeans_params.py</div><div id='m_start'> M Start Line: 63</div><div id='m_end'> M End Line: 69</div><div id='n_start'> N Start Line: 40</div><div id='n_end'> N End Line: 74</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
                    delta = -x_min / zero_point
            elif self.scale_method == &quotmse&quot:
                &#47&#47 we always use symmetric quantization in mse mode
                x_absmax<a id="change"> = </a><a id="change">x.abs()</a>.max()
                best_score = 1000
                for i in range(80):
                    new_max = x_absmax * (1.0 - (i * 0.01))</code></pre><h3>After Change</h3><pre><code class='java'>
                    if score &lt; best_score:
                        best_score = score
                        delta = (2 * new_max) / (2 ** self.n_bits - 1)
                        zero_point = round(new_max / delta)<a id="change"> if </a>x_min &lt; 0<a id="change"> else </a>0
            else:
                raise NotImplementedError
</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/yhhhli/brecq/commit/2cbdc7e8dbd0407856bb4f35ec0a23d2995ef72d#diff-1b24ad3a42979e01feae776e9ac1e2e345e5c2ed30ae20650126c971d15cb4caL69' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 98803942</div><div id='project'> Project Name: yhhhli/brecq</div><div id='commit'> Commit Name: 2cbdc7e8dbd0407856bb4f35ec0a23d2995ef72d</div><div id='time'> Time: 2021-02-17</div><div id='author'> Author: loafyuhang@gmail.com</div><div id='file'> File Name: quant/quant_layer.py</div><div id='m_class'> M Class Name: UniformAffineQuantizer</div><div id='n_method'> N Class Name: UniformAffineQuantizer</div><div id='m_method'> M Method Name: init_quantization_scale(3)</div><div id='n_method'> N Method Name: init_quantization_scale(3)</div><div id='m_parent_class'> M Parent Class: nn.Module</div><div id='n_parent_class'> N Parent Class: nn.Module</div><div id='m_file'> M File Name: quant/quant_layer.py</div><div id='n_file'> N File Name: quant/quant_layer.py</div><div id='m_start'> M Start Line: 91</div><div id='m_end'> M End Line: 118</div><div id='n_start'> N Start Line: 97</div><div id='n_end'> N End Line: 128</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
                    &#47&#47 random distance matrix, in case rdkit errors out
                    &#47&#47 print(&quotdistance embedding failed&quot)
                    distances_3d = np.random.rand(mol.GetNumAtoms(), mol.GetNumAtoms())
                    distances_3d<a id="change"> = </a><a id="change">np.abs(</a>distances_3d - distances_3d.transpose()<a id="change">)</a>

            &#47&#47 Get topological (i.e. path-length) distance matrix and number of atoms
            distances_path = Chem.GetDistanceMatrix(mol)
            n_atoms = mol.GetNumAtoms()</code></pre><h3>After Change</h3><pre><code class='java'>

            &#47&#47 Get atom features
            for atom in mol.GetAtoms():
                atom_position = list(conformer.GetAtomPosition(atom.GetIdx()))<a id="change"> if </a>args.three_d<a id="change"> else </a>None
                mol_fatoms.append(atom_features(atom, atom_position))

            &#47&#47 Get bond features</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/aamini/chemprop/commit/0000eedf0800c0ae4e7874b2c000fb5f2915eea0#diff-91b4e1ef89fbd915183928818e07287d60ba2d013478779025955bb686f6410dL117' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 98803941</div><div id='project'> Project Name: aamini/chemprop</div><div id='commit'> Commit Name: 0000eedf0800c0ae4e7874b2c000fb5f2915eea0</div><div id='time'> Time: 2018-09-28</div><div id='author'> Author: yangk@mit.edu</div><div id='file'> File Name: mpn.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: mol2graph(2)</div><div id='n_method'> N Method Name: mol2graph(2)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: mpn.py</div><div id='n_file'> N File Name: mpn.py</div><div id='m_start'> M Start Line: 154</div><div id='m_end'> M End Line: 155</div><div id='n_start'> N Start Line: 148</div><div id='n_end'> N End Line: 168</div><BR>