<html><h3>Pattern ID :15302
</h3><img src='51970024.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
            sqrt_alpha_prod = sqrt_alpha_prod.unsqueeze(-1)

        sqrt_one_minus_alpha_prod = (1 - self.alphas_cumprod[timestep]) ** 0.5
        sqrt_one_minus_alpha_prod = <a id="change">sqrt_one_minus_alpha_prod.flatten()</a>
        while len(sqrt_one_minus_alpha_prod.shape) &lt; len(
            original_samples.shape
        ):
            sqrt_one_minus_alpha_prod = sqrt_one_minus_alpha_prod.unsqueeze(-1)

        noisy_samples<a id="change"> = </a>(
            sqrt_alpha_prod * original_samples
            + sqrt_one_minus_alpha_prod * noise
        )</code></pre><h3>After Change</h3><pre><code class='java'>
        return prev_latent

    def add_noise(self, latents: Tensor, eps: Tensor, i: int) -&gt; Tensor:
        <a id="change">assert </a>0 &lt;= i &lt; self.steps

        &#47&#47 eq 4
        return latents * self.ᾱ[i].sqrt() + eps * self.ϖ[i].sqrt()</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 3</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/tfernd/sd-fused/commit/4e29f2889a4c47e86930e976912fa12ac53185f7#diff-fdc833560554707759195356813eb041412d9c58d0cfe05e1a402bd3755e3017L78' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 51970024</div><div id='project'> Project Name: tfernd/sd-fused</div><div id='commit'> Commit Name: 4e29f2889a4c47e86930e976912fa12ac53185f7</div><div id='time'> Time: 2022-10-05</div><div id='author'> Author: ThalesFDFernandes@gmai.com</div><div id='file'> File Name: sd/scheduler/ddim.py</div><div id='m_class'> M Class Name: DDIMScheduler</div><div id='n_method'> N Class Name: DDIMScheduler</div><div id='m_method'> M Method Name: add_noise(4)</div><div id='n_method'> N Method Name: add_noise(4)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: sd/scheduler/ddim.py</div><div id='n_file'> N File Name: sd/scheduler/ddim.py</div><div id='m_start'> M Start Line: 150</div><div id='m_end'> M End Line: 171</div><div id='n_start'> N Start Line: 78</div><div id='n_end'> N End Line: 81</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
            raise ValueError(f"PatchEmbed module. Input image width ({W}) doesn&quott match model ({self.img_size[1]}).")
        x = self.proj(x)
        if self.flatten:
            x<a id="change"> = </a><a id="change">x.flatten(</a>2<a id="change">)</a>.transpose(1, 2)  &#47&#47 BCHW -&gt; BNC
        x = self.norm(x)
        return x</code></pre><h3>After Change</h3><pre><code class='java'>
    def forward(self, x):
        B, C, H, W = x.shape
        &#47&#47 FIXME look at relaxing size constraints
        <a id="change">assert </a>H == self.img_size[0] and W == self.img_size[1], \
            f"Input image size ({H}*{W}) doesn&quott match model ({self.img_size[0]}*{self.img_size[1]})."
        x = self.proj(x).flatten(2).transpose(1, 2)  &#47&#47 B Ph*Pw C
        if self.norm is not None:</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/eora-ai/torchok/commit/ab2534f05b48a529d03f8c28af2579245772f4e0#diff-8ea48274a2159a0abc4b0425f2fb246399f29a78d6a46d98cdbda118b48a4195L28' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 51970030</div><div id='project'> Project Name: eora-ai/torchok</div><div id='commit'> Commit Name: ab2534f05b48a529d03f8c28af2579245772f4e0</div><div id='time'> Time: 2022-07-11</div><div id='author'> Author: rashit.bayazitov.1995@gmail.com</div><div id='file'> File Name: src/models/modules/blocks/patch_embedding.py</div><div id='m_class'> M Class Name: PatchEmbed</div><div id='n_method'> N Class Name: PatchEmbed</div><div id='m_method'> M Method Name: forward(2)</div><div id='n_method'> N Method Name: forward(2)</div><div id='m_parent_class'> M Parent Class: nn.Module</div><div id='n_parent_class'> N Parent Class: nn.Module</div><div id='m_file'> M File Name: src/models/modules/blocks/patch_embedding.py</div><div id='n_file'> N File Name: src/models/modules/blocks/patch_embedding.py</div><div id='m_start'> M Start Line: 30</div><div id='m_end'> M End Line: 37</div><div id='n_start'> N Start Line: 50</div><div id='n_end'> N End Line: 55</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        if self.auxiliary:
            isinstance(self._model.auxiliary_head, AuxiliaryHead)
            feats, feats_aux = self._model.features.forward(self._model.normalize(_input), auxiliary=True)
            logits<a id="change"> = </a>self._model.classifier(<a id="change">self._model.flatten(</a>self._model.pool(feats)<a id="change">)</a>)
            logits_aux = self._model.auxiliary_head(feats_aux)
            return super().loss(_output=logits, _label=_label) \
                + self.auxiliary_weight * super().loss(_output=logits_aux, _label=_label)</code></pre><h3>After Change</h3><pre><code class='java'>
    def loss(self, _input: torch.Tensor = None, _label: torch.Tensor = None,
             _output: torch.Tensor = None, amp: bool = False, **kwargs) -&gt; torch.Tensor:
        if self.auxiliary:
            <a id="change">assert </a>isinstance(self._model.auxiliary_head, AuxiliaryHead)
            if amp:
                with torch.cuda.amp.autocast():
                    return self.loss_with_aux(_input, _label, _output)</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/ain-soph/trojanzoo/commit/60189e04e85518439a94d1addd0c30f826c39fed#diff-9d97828e4deefaa5b4c62005496d85100912b5a2d63f395e42e1c3893f1d1123L61' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 51970019</div><div id='project'> Project Name: ain-soph/trojanzoo</div><div id='commit'> Commit Name: 60189e04e85518439a94d1addd0c30f826c39fed</div><div id='time'> Time: 2021-03-09</div><div id='author'> Author: ain-soph@live.com</div><div id='file'> File Name: trojanvision/models/darts.py</div><div id='m_class'> M Class Name: DARTS</div><div id='n_method'> N Class Name: DARTS</div><div id='m_method'> M Method Name: loss(5)</div><div id='n_method'> N Method Name: loss(4)</div><div id='m_parent_class'> M Parent Class: ImageModel</div><div id='n_parent_class'> N Parent Class: ImageModel</div><div id='m_file'> M File Name: trojanvision/models/darts.py</div><div id='n_file'> N File Name: trojanvision/models/darts.py</div><div id='m_start'> M Start Line: 64</div><div id='m_end'> M End Line: 69</div><div id='n_start'> N Start Line: 65</div><div id='n_end'> N End Line: 71</div><BR>