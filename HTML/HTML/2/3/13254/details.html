<html><h3>Pattern ID :13254
</h3><img src='44773771.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
            if torch.is_tensor(class_1):
                return torch.cat((class_1, class_2), dim=1)
            else:
                <a id="change">return </a>np.array(list(zip(class_1, class_2))).reshape((-1, 2))

        elif self._backend == "tensorflow":
            return self._model.predict(input)</code></pre><h3>After Change</h3><pre><code class='java'>

        if self._backend == "pytorch":
            &#47&#47 Keep model and input on the same device
            device = "cuda"<a id="change"> if </a><a id="change">torch.cuda.is_available() else </a>"cpu"
            self._model = self._model.to(device)

            if isinstance(input, pd.DataFrame):</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 13</div><BR><div id='size'>Non-data size: 3</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/indyfree/carla/commit/9b4d02120789794e885d4e47da522e1a1c17ed99#diff-2d9dd771c79c24fa5f5bc54bc3c0ce601efbc22310f84f594d35c8605a5640b3L235' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 44773771</div><div id='project'> Project Name: indyfree/carla</div><div id='commit'> Commit Name: 9b4d02120789794e885d4e47da522e1a1c17ed99</div><div id='time'> Time: 2021-05-27</div><div id='author'> Author: sbielawski@web.de</div><div id='file'> File Name: carla/models/catalog/catalog.py</div><div id='m_class'> M Class Name: MLModelCatalog</div><div id='n_method'> N Class Name: MLModelCatalog</div><div id='m_method'> M Method Name: predict_proba(2)</div><div id='n_method'> N Method Name: predict_proba(2)</div><div id='m_parent_class'> M Parent Class: MLModel</div><div id='n_parent_class'> N Parent Class: MLModel</div><div id='m_file'> M File Name: carla/models/catalog/catalog.py</div><div id='n_file'> N File Name: carla/models/catalog/catalog.py</div><div id='m_start'> M Start Line: 255</div><div id='m_end'> M End Line: 266</div><div id='n_start'> N Start Line: 235</div><div id='n_end'> N End Line: 258</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
    hub_model = Model(model.yaml).to(next(model.parameters()).device)  &#47&#47 create
    hub_model.load_state_dict(model.float().state_dict())  &#47&#47 load state_dict
    hub_model.names = model.names  &#47&#47 class names
    <a id="change">return </a>hub_model.autoshape() if autoshape else hub_model


if __name__ == &quot__main__&quot:</code></pre><h3>After Change</h3><pre><code class='java'>
    hub_model.names = model.names  &#47&#47 class names
    if autoshape:
        hub_model = hub_model.autoshape()  &#47&#47 for file/URI/PIL/cv2/np inputs and NMS
    device = select_device(&quot0&quot<a id="change"> if </a><a id="change">torch.cuda.is_available() else </a>&quotcpu&quot)  &#47&#47 default to GPU if available
    return hub_model.to(device)

</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/ultralytics/yolov5/commit/ee169834bd0edf4e03b555688053da7bdd05a71e#diff-b79077d76b8ce7fcc6fe2e1586e9c6d594ab14fe3c6162eb7353d0d936284c9bL113' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 44773770</div><div id='project'> Project Name: ultralytics/yolov5</div><div id='commit'> Commit Name: ee169834bd0edf4e03b555688053da7bdd05a71e</div><div id='time'> Time: 2021-03-28</div><div id='author'> Author: glenn.jocher@ultralytics.com</div><div id='file'> File Name: hubconf.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: custom(2)</div><div id='n_method'> N Method Name: custom(2)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: hubconf.py</div><div id='n_file'> N File Name: hubconf.py</div><div id='m_start'> M Start Line: 128</div><div id='m_end'> M End Line: 131</div><div id='n_start'> N Start Line: 128</div><div id='n_end'> N End Line: 134</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
                model.names = ckpt[&quotmodel&quot].names  &#47&#47 set class names attribute
            if autoshape:
                model = model.autoshape()  &#47&#47 for file/URI/PIL/cv2/np inputs and NMS
        <a id="change">return </a>model

    except Exception as e:
        help_url = &quothttps://github.com/ultralytics/yolov5/issues/36&quot</code></pre><h3>After Change</h3><pre><code class='java'>
                model.names = ckpt[&quotmodel&quot].names  &#47&#47 set class names attribute
            if autoshape:
                model = model.autoshape()  &#47&#47 for file/URI/PIL/cv2/np inputs and NMS
        device = select_device(&quot0&quot<a id="change"> if </a><a id="change">torch.cuda.is_available() else </a>&quotcpu&quot)  &#47&#47 default to GPU if available
        return model.to(device)

    except Exception as e:</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/wmcnally/kapao/commit/9b11f0c58b7c1f775ee32acb7dcc6a36407a779b#diff-b79077d76b8ce7fcc6fe2e1586e9c6d594ab14fe3c6162eb7353d0d936284c9bL20' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 44773775</div><div id='project'> Project Name: wmcnally/kapao</div><div id='commit'> Commit Name: 9b11f0c58b7c1f775ee32acb7dcc6a36407a779b</div><div id='time'> Time: 2021-03-14</div><div id='author'> Author: glenn.jocher@ultralytics.com</div><div id='file'> File Name: hubconf.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: create(5)</div><div id='n_method'> N Method Name: create(5)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: hubconf.py</div><div id='n_file'> N File Name: hubconf.py</div><div id='m_start'> M Start Line: 34</div><div id='m_end'> M End Line: 46</div><div id='n_start'> N Start Line: 35</div><div id='n_end'> N End Line: 48</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
                    plot_title,
                    trainer.log_dir
                )
        <a id="change">return</a>
</code></pre><h3>After Change</h3><pre><code class='java'>
    def on_validation_end(self, trainer, pl_module):
        val_ds = pl_module.val_dataloader().dataset
        model = pl_module.model
        device = torch.device("cuda:0"<a id="change"> if </a><a id="change">torch.cuda.is_available() else </a>"cpu")
        for i in range(self.n_samples):
            image, mask = val_ds[i].values()
            image = image.to(device)</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/dsgoficial/pytorch_segmentation_models_trainer/commit/8f36b0896b6d6fe91306fc32a848fe13578747b8#diff-6e90ebd4e7a335c712c7b60a7d3d2cf58e99b19a0a17af77169eacbaeff33101L128' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 44773772</div><div id='project'> Project Name: dsgoficial/pytorch_segmentation_models_trainer</div><div id='commit'> Commit Name: 8f36b0896b6d6fe91306fc32a848fe13578747b8</div><div id='time'> Time: 2021-03-11</div><div id='author'> Author: philipeborba@gmail.com</div><div id='file'> File Name: pytorch_segmentation_models_trainer/custom_callbacks/image_callbacks.py</div><div id='m_class'> M Class Name: ImageSegmentationResultCallback</div><div id='n_method'> N Class Name: ImageSegmentationResultCallback</div><div id='m_method'> M Method Name: on_validation_end(3)</div><div id='n_method'> N Method Name: on_validation_end(3)</div><div id='m_parent_class'> M Parent Class: pl.callbacks.base.Callback</div><div id='n_parent_class'> N Parent Class: pl.callbacks.base.Callback</div><div id='m_file'> M File Name: pytorch_segmentation_models_trainer/custom_callbacks/image_callbacks.py</div><div id='n_file'> N File Name: pytorch_segmentation_models_trainer/custom_callbacks/image_callbacks.py</div><div id='m_start'> M Start Line: 152</div><div id='m_end'> M End Line: 152</div><div id='n_start'> N Start Line: 131</div><div id='n_end'> N End Line: 154</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
    hub_model.load_state_dict(model.float().state_dict())  &#47&#47 load state_dict
    hub_model.names = model.names  &#47&#47 class names
    hub_model = hub_model.autoshape()
    <a id="change">return </a>hub_model

class YOLOv5:
    def __init__(self, model_path, device, load_on_init=True):</code></pre><h3>After Change</h3><pre><code class='java'>
    
    &#47&#47 set device if not given
    if not device:
        device = "cuda:0"<a id="change"> if </a><a id="change">torch.cuda.is_available() else </a>"cpu"

    attempt_download(model_path)  &#47&#47 download if not found locally
    model = torch.load(model_path, map_location=torch.device(device))</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/fcakyon/yolov5-pip/commit/76ebd878019b840d93a80b96c54ee066588bbd27#diff-6ed9ba8c59389ed1a496374ba989e215697912bcb4f39180928bbf3e5a755c72L13' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 44773777</div><div id='project'> Project Name: fcakyon/yolov5-pip</div><div id='commit'> Commit Name: 76ebd878019b840d93a80b96c54ee066588bbd27</div><div id='time'> Time: 2021-02-11</div><div id='author'> Author: fcakyon@gmail.com</div><div id='file'> File Name: yolov5/helpers.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: load_model(3)</div><div id='n_method'> N Method Name: load_model(2)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: yolov5/helpers.py</div><div id='n_file'> N File Name: yolov5/helpers.py</div><div id='m_start'> M Start Line: 13</div><div id='m_end'> M End Line: 20</div><div id='n_start'> N Start Line: 24</div><div id='n_end'> N End Line: 56</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        data = {"src": sources, "mt": predictions, "ref": references}
        data = [dict(zip(data, t)) for t in zip(*data.values())]
        samples, scores = self.scorer.predict(data, cuda=cuda, show_progress=show_progress)
        <a id="change">return </a>{"scores": scores, "samples": samples}
</code></pre><h3>After Change</h3><pre><code class='java'>

    def _compute(self, sources, predictions, references, gpus=None, progress_bar=False):
        if gpus is None:
            gpus = 1<a id="change"> if </a><a id="change">torch.cuda.is_available() else </a>0
        data = {"src": sources, "mt": predictions, "ref": references}
        data = [dict(zip(data, t)) for t in zip(*data.values())]
        scores, mean_score = self.scorer.predict(data, gpus=gpus, progress_bar=progress_bar)</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/huggingface/datasets/commit/d5c118ce3d0052c67c8c5cd37f7257d238b30685#diff-04c571bf81d04b98363eda223cf1c8e5e995478d3eba2c3a9142a9a19ed7c441L137' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 44773765</div><div id='project'> Project Name: huggingface/datasets</div><div id='commit'> Commit Name: d5c118ce3d0052c67c8c5cd37f7257d238b30685</div><div id='time'> Time: 2022-03-22</div><div id='author'> Author: 42851186+lhoestq@users.noreply.github.com</div><div id='file'> File Name: metrics/comet/comet.py</div><div id='m_class'> M Class Name: COMET</div><div id='n_method'> N Class Name: COMET</div><div id='m_method'> M Method Name: _compute(6)</div><div id='n_method'> N Method Name: _compute(6)</div><div id='m_parent_class'> M Parent Class: datasets.Metric</div><div id='n_parent_class'> N Parent Class: datasets.Metric</div><div id='m_file'> M File Name: metrics/comet/comet.py</div><div id='n_file'> N File Name: metrics/comet/comet.py</div><div id='m_start'> M Start Line: 140</div><div id='m_end'> M End Line: 141</div><div id='n_start'> N Start Line: 139</div><div id='n_end'> N End Line: 144</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        loss = self.net_with_loss(data, label)
        grads = self.optimizer.gradient(loss, self.train_weights)
        self.optimizer.apply_gradients(zip(grads, self.train_weights))
        <a id="change">return </a>loss.detach().numpy()

class TrainOneStepWithGradientClippingTF(object):
    def __init__(self, net_with_loss, optimizer, train_weights, gradient_clipping):</code></pre><h3>After Change</h3><pre><code class='java'>
        self.train_weights = train_weights

    def __call__(self, data, label):
        device = torch.device(&quotcuda:0&quot<a id="change"> if </a><a id="change">torch.cuda.is_available() else </a>&quotcpu&quot)
        data = data.to(device)
        label = label.to(device)
        self.net_with_loss.to(device)</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/tensorlayer/tensorlayerx/commit/0356728c86777c237d692d3723a6d04fbe5649d4#diff-7bf9e5edca6dd7f6a4b1e7b670c88c1b448c407d0df723ebdd79eadb6ce72cc9L184' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 44773764</div><div id='project'> Project Name: tensorlayer/tensorlayerx</div><div id='commit'> Commit Name: 0356728c86777c237d692d3723a6d04fbe5649d4</div><div id='time'> Time: 2022-04-11</div><div id='author'> Author: jiaronghan@outlook.com</div><div id='file'> File Name: tensorlayerx/model/utils.py</div><div id='m_class'> M Class Name: TrainOneStepWithTH</div><div id='n_method'> N Class Name: TrainOneStepWithTH</div><div id='m_method'> M Method Name: __call__(3)</div><div id='n_method'> N Method Name: __call__(3)</div><div id='m_parent_class'> M Parent Class: object</div><div id='n_parent_class'> N Parent Class: object</div><div id='m_file'> M File Name: tensorlayerx/model/utils.py</div><div id='n_file'> N File Name: tensorlayerx/model/utils.py</div><div id='m_start'> M Start Line: 185</div><div id='m_end'> M End Line: 188</div><div id='n_start'> N Start Line: 185</div><div id='n_end'> N End Line: 192</div><BR>