<link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
                if data_selected == &quotag&quot:
                    loss = criterion(output, labels)
                else:
                    loss<a id="change"> = </a><a id="change">criterion(</a>output, labels.float()<a id="change">)</a>
                optimizer.zero_grad()
                loss.backward()
                clip_grad_norm_(model.parameters(), max_norm=1)
                optimizer.step()</code></pre><h3>After Change</h3><pre><code class='java'>
            print(&quotfinish training, avg loss: {}/{}, begin to evaluate&quot.format(avg_loss, last_train_avg_loss))
            poison_success_rate_dev = evaluaion(dev_loader_poison)
            clean_acc = evaluaion(test_loader_clean)
            <a id="change">print(</a>&quotpoison success rate in dev: {}. clean acc: {}&quot
                  .format(poison_success_rate_dev, clean_acc)<a id="change">)</a>
            if poison_success_rate_dev &gt; best_dev_scuess_rate_poison:
                best_dev_scuess_rate_poison = poison_success_rate_dev
            if avg_loss &gt; last_train_avg_loss:
                print(&quotneed to adjust lr, current lr: {}&quot.format(optimizer.param_groups[0][&quotlr&quot]))</code></pre>