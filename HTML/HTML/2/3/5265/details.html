<html><h3>Pattern ID :5265
</h3><img src='18633816.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
        user_ids = np.expand_dims(user_ids, 1).repeat(n_candidates, axis=1).reshape(-1)
        times = np.expand_dims(times, 1).repeat(n_candidates, axis=1).reshape(-1)
        history_items = np.expand_dims(history_items, 1).repeat(n_candidates, axis=1).reshape(-1)
        history_times = <a id="change">np.expand_dims(history_times, 1).repeat(n_candidates, axis=1).reshape(-1</a><a id="change">)</a>

        &#47&#47 Find information related to the target item:
        &#47&#47 - category id
        &#47&#47 - time intervals w.r.t. recent relational interactions (-1 if not existing)</code></pre><h3>After Change</h3><pre><code class='java'>
        &#47&#47 - category id
        &#47&#47 - time intervals w.r.t. recent relational interactions (-1 if not existing)
        category_ids = list()
        relational_intervals = <a id="change">list()</a>
        for i, candidate_lst in enumerate(item_ids):
            intervals_lst = list()
            for r_idx in range(0, self.relation_num):
                intervals = np.ones_like(candidate_lst) * -1.</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 6</div><BR><div id='size'>Non-data size: 2</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/thuwangcy/rechorus/commit/25fac75a3939959fb807d2413754135b9b650fec#diff-9a52641bef60627f058b8160d020b207cec88f54ed5543282ebe19a84a0fddcbL77' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 18633816</div><div id='project'> Project Name: thuwangcy/rechorus</div><div id='commit'> Commit Name: 25fac75a3939959fb807d2413754135b9b650fec</div><div id='time'> Time: 2020-05-19</div><div id='author'> Author: wangcy18@mails.tsinghua.edu.cn</div><div id='file'> File Name: src/models/SLRC.py</div><div id='m_class'> M Class Name: SLRC</div><div id='n_method'> N Class Name: SLRC</div><div id='m_method'> M Method Name: get_feed_dict(6)</div><div id='n_method'> N Method Name: get_feed_dict(6)</div><div id='m_parent_class'> M Parent Class: BaseModel</div><div id='n_parent_class'> N Parent Class: BaseModel</div><div id='m_file'> M File Name: src/models/SLRC.py</div><div id='n_file'> N File Name: src/models/SLRC.py</div><div id='m_start'> M Start Line: 77</div><div id='m_end'> M End Line: 104</div><div id='n_start'> N Start Line: 77</div><div id='n_end'> N End Line: 112</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>

def bucket(buckets, v):
    b, t, d = v.shape
    return <a id="change">v.reshape(</a>b, buckets, <a id="change">-1</a>, d<a id="change">)</a>

def unbucket(v):
    b, *_, e = v.shape
    return v.reshape(b, -1, e)</code></pre><h3>After Change</h3><pre><code class='java'>
    return t[l], t[r]

def bucket(buckets, t, dim=1):
    shape = <a id="change">list(</a>t.shape<a id="change">)</a>
    shape[dim:dim+1] = [buckets, -1]
    return t.reshape(*shape)

def unbucket(t, dim=1):</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/lucidrains/sinkhorn-transformer/commit/d50bc5774a1be7b2ed68d99b42384fe38a844c3d#diff-2ed19ae7feb552dc52b4c7a7c89a078c0fd371c922789f894af09ff01f35eccbL48' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 18633804</div><div id='project'> Project Name: lucidrains/sinkhorn-transformer</div><div id='commit'> Commit Name: d50bc5774a1be7b2ed68d99b42384fe38a844c3d</div><div id='time'> Time: 2020-04-12</div><div id='author'> Author: lucidrains@gmail.com</div><div id='file'> File Name: sinkhorn_transformer/sinkhorn_transformer.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: bucket(3)</div><div id='n_method'> N Method Name: bucket(2)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: sinkhorn_transformer/sinkhorn_transformer.py</div><div id='n_file'> N File Name: sinkhorn_transformer/sinkhorn_transformer.py</div><div id='m_start'> M Start Line: 49</div><div id='m_end'> M End Line: 50</div><div id='n_start'> N Start Line: 54</div><div id='n_end'> N End Line: 57</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>

    def search(self, query, limit):
        &#47&#47 Run the query
        ids, distances = self.model.knn_query(<a id="change">query.reshape(1</a>, -1<a id="change">)</a>, k=limit)

        &#47&#47 Convert distances to similarity scores
        scores = [1 - d for d in distances[0]]</code></pre><h3>After Change</h3><pre><code class='java'>
            &#47&#47 Convert distances to similarity scores
            scores = [1 - d for d in distance]

            results.append(<a id="change">list(</a>zip(ids[x], scores)<a id="change">)</a>)

        return results
</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/neuml/txtai/commit/e84d7c003b02c0ec6a451130a66a3f5652f38e48#diff-bf31ade3f71af92b40936f506b564434d33f3c94ac2133a806c880c472277c9cL188' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 18633812</div><div id='project'> Project Name: neuml/txtai</div><div id='commit'> Commit Name: e84d7c003b02c0ec6a451130a66a3f5652f38e48</div><div id='time'> Time: 2021-01-08</div><div id='author'> Author: 561939+davidmezzetti@users.noreply.github.com</div><div id='file'> File Name: src/python/txtai/ann.py</div><div id='m_class'> M Class Name: HNSW</div><div id='n_method'> N Class Name: HNSW</div><div id='m_method'> M Method Name: search(3)</div><div id='n_method'> N Method Name: search(3)</div><div id='m_parent_class'> M Parent Class: ANN</div><div id='n_parent_class'> N Parent Class: ANN</div><div id='m_file'> M File Name: src/python/txtai/ann.py</div><div id='n_file'> N File Name: src/python/txtai/ann.py</div><div id='m_start'> M Start Line: 190</div><div id='m_end'> M End Line: 196</div><div id='n_start'> N Start Line: 202</div><div id='n_end'> N End Line: 212</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        for idx in range(source_shape[0] * source_shape[1]):
            basis_vec = np.zeros(source_shape)
            basis_vec[np.unravel_index(idx, source_shape)] = 1.0
            vec = <a id="change">tf.image.resize(np.expand_dims(basis_vec, -1), target_shape, method=method).numpy().reshape(-1</a><a id="change">)</a>
            mat.append(vec)
        resize_mat_pinv = np.linalg.pinv(np.stack(mat))

        &#47&#47 v_resample_kernel = jax.vmap(jax.vmap(lambda kernel: (resize_mat_pinv @ kernel.reshape(-1)).reshape(new_hw), 2, 2), 3, 3)</code></pre><h3>After Change</h3><pre><code class='java'>

        &#47&#47 print("source_layer:", {kk: vv.shape for kk, vv in source_layer.items()})
        if isinstance(source_layer, dict):
            source_kernel, source_bias = <a id="change">list(</a>source_layer.values()<a id="change">)</a>  &#47&#47 weights
        else:
            source_kernel, source_bias = source_layer.get_weights()  &#47&#47 layer
</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/leondgarse/keras_cv_attention_models/commit/1aa29dc686f862bc1ff66a11700fa8ef16bd2b8a#diff-02508ae7c53082aa4dbb63a5c5fd259b84bc5bdbf0b1971ed6cb2060ef9b9779L244' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 18633814</div><div id='project'> Project Name: leondgarse/keras_cv_attention_models</div><div id='commit'> Commit Name: 1aa29dc686f862bc1ff66a11700fa8ef16bd2b8a</div><div id='time'> Time: 2023-02-03</div><div id='author'> Author: leondgarse@gmail.com</div><div id='file'> File Name: keras_cv_attention_models/beit/beit.py</div><div id='m_class'> M Class Name: PatchConv2DWithResampleWeights</div><div id='n_method'> N Class Name: PatchConv2DWithResampleWeights</div><div id='m_method'> M Method Name: load_resized_weights(3)</div><div id='n_method'> N Method Name: load_resized_weights(3)</div><div id='m_parent_class'> M Parent Class: layers.Conv2D</div><div id='n_parent_class'> N Parent Class: keras.layers.Conv2D</div><div id='m_file'> M File Name: keras_cv_attention_models/beit/beit.py</div><div id='n_file'> N File Name: keras_cv_attention_models/beit/beit.py</div><div id='m_start'> M Start Line: 248</div><div id='m_end'> M End Line: 276</div><div id='n_start'> N Start Line: 243</div><div id='n_end'> N End Line: 275</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>

def unbucket(v):
    b, *_, e = v.shape
    return <a id="change">v.reshape(</a>b, <a id="change">-1</a>, e<a id="change">)</a>

def sample_gumbel(shape, device, dtype, eps=1e-6):
    u = torch.empty(shape, device=device, dtype=dtype).uniform_(0, 1)
    return -log(-log(u, eps), eps)</code></pre><h3>After Change</h3><pre><code class='java'>
    return t.reshape(*shape)

def unbucket(t, dim=1):
    shape = <a id="change">list(</a>t.shape<a id="change">)</a>
    shape[dim:dim+2] = [-1]
    return t.reshape(*shape)

def sample_gumbel(shape, device, dtype, eps=1e-6):</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/lucidrains/sinkhorn-transformer/commit/d50bc5774a1be7b2ed68d99b42384fe38a844c3d#diff-2ed19ae7feb552dc52b4c7a7c89a078c0fd371c922789f894af09ff01f35eccbL52' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 18633815</div><div id='project'> Project Name: lucidrains/sinkhorn-transformer</div><div id='commit'> Commit Name: d50bc5774a1be7b2ed68d99b42384fe38a844c3d</div><div id='time'> Time: 2020-04-12</div><div id='author'> Author: lucidrains@gmail.com</div><div id='file'> File Name: sinkhorn_transformer/sinkhorn_transformer.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: unbucket(2)</div><div id='n_method'> N Method Name: unbucket(1)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: sinkhorn_transformer/sinkhorn_transformer.py</div><div id='n_file'> N File Name: sinkhorn_transformer/sinkhorn_transformer.py</div><div id='m_start'> M Start Line: 52</div><div id='m_end'> M End Line: 54</div><div id='n_start'> N Start Line: 59</div><div id='n_end'> N End Line: 62</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
    def search(self, query, limit):
        &#47&#47 Run the query
        self.model.nprobe = 6
        scores, ids = self.model.search(<a id="change">query.reshape(1</a>, -1<a id="change">)</a>, limit)

        &#47&#47 Map results to [(id, score)]
        return list(zip(ids[0].tolist(), (scores[0]).tolist()))</code></pre><h3>After Change</h3><pre><code class='java'>
        &#47&#47 Map results to [(id, score)]
        results = []
        for x, score in enumerate(scores):
            results.append(<a id="change">list(</a>zip(ids[x].tolist(), score.tolist())<a id="change">)</a>)

        return results
</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/neuml/txtai/commit/e84d7c003b02c0ec6a451130a66a3f5652f38e48#diff-bf31ade3f71af92b40936f506b564434d33f3c94ac2133a806c880c472277c9cL155' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 18633808</div><div id='project'> Project Name: neuml/txtai</div><div id='commit'> Commit Name: e84d7c003b02c0ec6a451130a66a3f5652f38e48</div><div id='time'> Time: 2021-01-08</div><div id='author'> Author: 561939+davidmezzetti@users.noreply.github.com</div><div id='file'> File Name: src/python/txtai/ann.py</div><div id='m_class'> M Class Name: Faiss</div><div id='n_method'> N Class Name: Faiss</div><div id='m_method'> M Method Name: search(3)</div><div id='n_method'> N Method Name: search(3)</div><div id='m_parent_class'> M Parent Class: ANN</div><div id='n_parent_class'> N Parent Class: ANN</div><div id='m_file'> M File Name: src/python/txtai/ann.py</div><div id='n_file'> N File Name: src/python/txtai/ann.py</div><div id='m_start'> M Start Line: 158</div><div id='m_end'> M End Line: 161</div><div id='n_start'> N Start Line: 166</div><div id='n_end'> N End Line: 173</div><BR>