<html><h3>Pattern ID :9659
</h3><img src='34776355.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
            sharding_option.partition_by = PartitionByType.UNIFORM.value

        candidate_topology = copy.deepcopy(self.topology)
        <a id="change">self.partitioner.run(
            sharding_options=sharding_options,
            topology=candidate_topology,
        )</a>

        expected_ranks = {
            "table_0": [0, 1, 2, 3],
            "table_1": [0, 1, 2, 3],</code></pre><h3>After Change</h3><pre><code class='java'>
            sharding_option.partition_by = PartitionByType.UNIFORM.value

        candidate_topology = copy.deepcopy(self.topology)
        sharding_plan<a id="change"> = </a><a id="change">self.partitioner.partition(
            proposal=sharding_options,
            storage_constraint=candidate_topology,
        )</a>
        &#47&#47 pyre-ignore[16]
        solution_topology = self.partitioner._topology

        expected_ranks = {</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 4</div><BR><div id='size'>Non-data size: 3</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/pytorch/torchrec/commit/6ed27a687df642f29f811099076fd52177670925#diff-aad1fd2f1742944cb133ab3eb1306ab43318f9da684ea5f851e37e13807ea831L225' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 34776355</div><div id='project'> Project Name: pytorch/torchrec</div><div id='commit'> Commit Name: 6ed27a687df642f29f811099076fd52177670925</div><div id='time'> Time: 2021-12-02</div><div id='author'> Author: dstaay@fb.com</div><div id='file'> File Name: torchrec/distributed/planner/new/tests/test_partitioners.py</div><div id='m_class'> M Class Name: TestGreedyCostPartitioner</div><div id='n_method'> N Class Name: TestGreedyCostPartitioner</div><div id='m_method'> M Method Name: test_rw_unbalanced_cost_uniform(1)</div><div id='n_method'> N Method Name: test_rw_unbalanced_cost_uniform(1)</div><div id='m_parent_class'> M Parent Class: unittest.TestCase</div><div id='n_parent_class'> N Parent Class: unittest.TestCase</div><div id='m_file'> M File Name: torchrec/distributed/planner/new/tests/test_partitioners.py</div><div id='n_file'> N File Name: torchrec/distributed/planner/new/tests/test_partitioners.py</div><div id='m_start'> M Start Line: 225</div><div id='m_end'> M End Line: 257</div><div id='n_start'> N Start Line: 229</div><div id='n_end'> N End Line: 263</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
            sharding_option.shards[0].storage = Storage(hbm=1000, ddr=1000)

        candidate_topology = copy.deepcopy(self.topology)
        <a id="change">self.partitioner.run(
            sharding_options=sharding_options,
            topology=candidate_topology,
        )</a>
        expected_ranks = {
            "table_0": [0],
            "table_1": [1],
            "table_2": [1],</code></pre><h3>After Change</h3><pre><code class='java'>
            sharding_option.shards[0].storage = Storage(hbm=1000, ddr=1000)

        candidate_topology = copy.deepcopy(self.topology)
        sharding_plan<a id="change"> = </a><a id="change">self.partitioner.partition(
            proposal=sharding_options,
            storage_constraint=candidate_topology,
        )</a>
        &#47&#47 pyre-ignore[16]
        solution_topology = self.partitioner._topology

        expected_ranks = {</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/pytorch/torchrec/commit/6ed27a687df642f29f811099076fd52177670925#diff-aad1fd2f1742944cb133ab3eb1306ab43318f9da684ea5f851e37e13807ea831L115' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 34776358</div><div id='project'> Project Name: pytorch/torchrec</div><div id='commit'> Commit Name: 6ed27a687df642f29f811099076fd52177670925</div><div id='time'> Time: 2021-12-02</div><div id='author'> Author: dstaay@fb.com</div><div id='file'> File Name: torchrec/distributed/planner/new/tests/test_partitioners.py</div><div id='m_class'> M Class Name: TestGreedyCostPartitioner</div><div id='n_method'> N Class Name: TestGreedyCostPartitioner</div><div id='m_method'> M Method Name: test_tw_unbalanced_cost_device(1)</div><div id='n_method'> N Method Name: test_tw_unbalanced_cost_device(1)</div><div id='m_parent_class'> M Parent Class: unittest.TestCase</div><div id='n_parent_class'> N Parent Class: unittest.TestCase</div><div id='m_file'> M File Name: torchrec/distributed/planner/new/tests/test_partitioners.py</div><div id='n_file'> N File Name: torchrec/distributed/planner/new/tests/test_partitioners.py</div><div id='m_start'> M Start Line: 116</div><div id='m_end'> M End Line: 152</div><div id='n_start'> N Start Line: 128</div><div id='n_end'> N End Line: 156</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
            sharding_option.shards[0].storage = Storage(hbm=1000, ddr=1000)

        candidate_topology = copy.deepcopy(self.topology)
        <a id="change">self.partitioner.run(
            sharding_options=sharding_options,
            topology=candidate_topology,
        )</a>
        expected_ranks = {
            "table_0": [1],
            "table_1": [0],
            "table_2": [1],</code></pre><h3>After Change</h3><pre><code class='java'>
            sharding_option.shards[0].storage = Storage(hbm=1000, ddr=1000)

        candidate_topology = copy.deepcopy(self.topology)
        sharding_plan<a id="change"> = </a><a id="change">self.partitioner.partition(
            proposal=sharding_options,
            storage_constraint=candidate_topology,
        )</a>
        &#47&#47 pyre-ignore [16]
        solution_topology = self.partitioner._topology

        expected_ranks = {</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/pytorch/torchrec/commit/6ed27a687df642f29f811099076fd52177670925#diff-aad1fd2f1742944cb133ab3eb1306ab43318f9da684ea5f851e37e13807ea831L75' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 34776356</div><div id='project'> Project Name: pytorch/torchrec</div><div id='commit'> Commit Name: 6ed27a687df642f29f811099076fd52177670925</div><div id='time'> Time: 2021-12-02</div><div id='author'> Author: dstaay@fb.com</div><div id='file'> File Name: torchrec/distributed/planner/new/tests/test_partitioners.py</div><div id='m_class'> M Class Name: TestGreedyCostPartitioner</div><div id='n_method'> N Class Name: TestGreedyCostPartitioner</div><div id='m_method'> M Method Name: test_tw_balanced_cost_device(1)</div><div id='n_method'> N Method Name: test_tw_balanced_cost_device(1)</div><div id='m_parent_class'> M Parent Class: unittest.TestCase</div><div id='n_parent_class'> N Parent Class: unittest.TestCase</div><div id='m_file'> M File Name: torchrec/distributed/planner/new/tests/test_partitioners.py</div><div id='n_file'> N File Name: torchrec/distributed/planner/new/tests/test_partitioners.py</div><div id='m_start'> M Start Line: 76</div><div id='m_end'> M End Line: 111</div><div id='n_start'> N Start Line: 85</div><div id='n_end'> N End Line: 113</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
            sharding_option.partition_by = PartitionByType.HOST.value

        candidate_topology = copy.deepcopy(self.topology)
        <a id="change">self.partitioner.run(
            sharding_options=sharding_options,
            topology=candidate_topology,
        )</a>

        expected_ranks = {
            "table_0": [8, 9, 10, 11, 12, 13, 14, 15],
            "table_1": [0, 1, 2, 3, 4, 5, 6, 7],</code></pre><h3>After Change</h3><pre><code class='java'>
            sharding_option.partition_by = PartitionByType.HOST.value

        candidate_topology = copy.deepcopy(self.topology)
        sharding_plan<a id="change"> = </a><a id="change">self.partitioner.partition(
            proposal=sharding_options,
            storage_constraint=candidate_topology,
        )</a>
        &#47&#47 pyre-ignore[16]
        solution_topology = self.partitioner._topology

        expected_ranks = {</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/pytorch/torchrec/commit/6ed27a687df642f29f811099076fd52177670925#diff-aad1fd2f1742944cb133ab3eb1306ab43318f9da684ea5f851e37e13807ea831L156' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 34776357</div><div id='project'> Project Name: pytorch/torchrec</div><div id='commit'> Commit Name: 6ed27a687df642f29f811099076fd52177670925</div><div id='time'> Time: 2021-12-02</div><div id='author'> Author: dstaay@fb.com</div><div id='file'> File Name: torchrec/distributed/planner/new/tests/test_partitioners.py</div><div id='m_class'> M Class Name: TestGreedyCostPartitioner</div><div id='n_method'> N Class Name: TestGreedyCostPartitioner</div><div id='m_method'> M Method Name: test_tw_balanced_cost_host(1)</div><div id='n_method'> N Method Name: test_tw_balanced_cost_host(1)</div><div id='m_parent_class'> M Parent Class: unittest.TestCase</div><div id='n_parent_class'> N Parent Class: unittest.TestCase</div><div id='m_file'> M File Name: torchrec/distributed/planner/new/tests/test_partitioners.py</div><div id='n_file'> N File Name: torchrec/distributed/planner/new/tests/test_partitioners.py</div><div id='m_start'> M Start Line: 173</div><div id='m_end'> M End Line: 205</div><div id='n_start'> N Start Line: 176</div><div id='n_end'> N End Line: 210</div><BR>