<html><h3>Pattern ID :25365
</h3><img src='77575245.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
                continue  &#47&#47 FIXME
                &#47&#47 Target device:
                device = self.local_rank_to_device_map[rank]
                send_buffer = <a id="change">torch.zeros(</a>shape<a id="change">,
                                          dtype=dtype,
                                          device=device,
                                          requires_grad=requires_grad)</a>
                send_buffer.share_memory_()
                d[rank]<a id="change"> = </a>send_buffer

            self.send_buffers[tensor_name] = d
</code></pre><h3>After Change</h3><pre><code class='java'>
            d = {}
            for rank in tensor_send_ranks[tensor_name]:
                d[rank] = None  &#47&#47 FIXME
                <a id="change">continue</a>  &#47&#47 FIXME

            self.send_buffers[tensor_name] = d
</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 3</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/saareliad/ftpipe/commit/8cecdc492a71696ab0f9ab97babd670e9c105270#diff-e8a3a19b1943afe92b627d303a564e72a2ad183b89af477fbd5c65031cec3416L155' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 77575245</div><div id='project'> Project Name: saareliad/ftpipe</div><div id='commit'> Commit Name: 8cecdc492a71696ab0f9ab97babd670e9c105270</div><div id='time'> Time: 2020-05-26</div><div id='author'> Author: saareliad@campus.technion.ac.il</div><div id='file'> File Name: pipeline/communication/multiprocessing.py</div><div id='m_class'> M Class Name: MultiprocessingCommunicationHandler</div><div id='n_method'> N Class Name: MultiprocessingCommunicationHandler</div><div id='m_method'> M Method Name: _create_send_buffers(4)</div><div id='n_method'> N Method Name: _create_send_buffers(4)</div><div id='m_parent_class'> M Parent Class: SimpleCommBase</div><div id='n_parent_class'> N Parent Class: SimpleCommBase</div><div id='m_file'> M File Name: pipeline/communication/multiprocessing.py</div><div id='n_file'> N File Name: pipeline/communication/multiprocessing.py</div><div id='m_start'> M Start Line: 155</div><div id='m_end'> M End Line: 187</div><div id='n_start'> N Start Line: 157</div><div id='n_end'> N End Line: 167</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
            preprocessed_sentence = model.preprocess(sentence_text)
            embedding = model.embed(preprocessed_sentence)
        except IndexError:
            embedding<a id="change"> = </a><a id="change">np.zeros(</a>(model.dim,)<a id="change">)</a>
            num_errors += 1
        all_ids.append(sentence_id)
        all_embeddings.append(embedding)
        if i_sentence % 1000 == 0:</code></pre><h3>After Change</h3><pre><code class='java'>
        except IndexError:
            &#47&#47 This could happen when the sentence is too long for example
            num_errors += 1
            <a id="change">continue</a>

        all_ids.append(sentence_id)
        all_embeddings.append(embedding)
</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/bluebrain/search/commit/cc7283c8f8440aeec4d04d6b259ab898c78a3cc1#diff-6a370a606e89902d9cea7c7edf876b91c643d1c115291d5912b04e3bd88cf446L266' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 77575243</div><div id='project'> Project Name: bluebrain/search</div><div id='commit'> Commit Name: cc7283c8f8440aeec4d04d6b259ab898c78a3cc1</div><div id='time'> Time: 2020-07-29</div><div id='author'> Author: jankrepl@yahoo.com</div><div id='file'> File Name: src/bbsearch/embedding_models.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: compute_database_embeddings(3)</div><div id='n_method'> N Method Name: compute_database_embeddings(2)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: src/bbsearch/embedding_models.py</div><div id='n_file'> N File Name: src/bbsearch/embedding_models.py</div><div id='m_start'> M Start Line: 283</div><div id='m_end'> M End Line: 317</div><div id='n_start'> N Start Line: 266</div><div id='n_end'> N End Line: 321</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>

        for i, tensor in enumerate(tensor_list):
            if tensor.grad is None:
                tensor.grad<a id="change"> = </a><a id="change">torch.zeros(</a>tensor.size()<a id="change">,
                                          dtype=tensor.dtype,
                                          device=tensor.device)</a>
            tensor = tensor.grad
            num_elements = tensor.numel()
            tensor_offset = 0
</code></pre><h3>After Change</h3><pre><code class='java'>
        current_size = 0
        for i, tensor in enumerate(tensor_list):
            if tensor.grad is None:
                <a id="change">continue</a>

            tensor = tensor.grad
            num_elements = tensor.numel()</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/microsoft/deepspeed/commit/f2ac7eafd54c49acb8981650637dedd939e96c14#diff-a40c1f0574e5b234a5ae00e9cbd91691d9b24ac7c1fa0e886681b9d30c5a77afL263' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 77575242</div><div id='project'> Project Name: microsoft/deepspeed</div><div id='commit'> Commit Name: f2ac7eafd54c49acb8981650637dedd939e96c14</div><div id='time'> Time: 2020-05-19</div><div id='author'> Author: jerasley@microsoft.com</div><div id='file'> File Name: deepspeed/pt/deepspeed_zero_optimizer.py</div><div id='m_class'> M Class Name: FP16_DeepSpeedZeroOptimizer</div><div id='n_method'> N Class Name: FP16_DeepSpeedZeroOptimizer</div><div id='m_method'> M Method Name: get_flat_partition(5)</div><div id='n_method'> N Method Name: get_flat_partition(5)</div><div id='m_parent_class'> M Parent Class: object</div><div id='n_parent_class'> N Parent Class: object</div><div id='m_file'> M File Name: deepspeed/pt/deepspeed_zero_optimizer.py</div><div id='n_file'> N File Name: deepspeed/pt/deepspeed_zero_optimizer.py</div><div id='m_start'> M Start Line: 264</div><div id='m_end'> M End Line: 303</div><div id='n_start'> N Start Line: 980</div><div id='n_end'> N End Line: 1021</div><BR>