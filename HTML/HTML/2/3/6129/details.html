<html><h3>Pattern ID :6129
</h3><img src='21136048.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
    angles[:, 2] = rnd.uniform(low=-np.pi, high=np.pi, size=(n,))

    for axis1 in [&quotx&quot, &quoty&quot, &quotz&quot]:
        for axis2 in <a id="change">[</a>&quotx&quot, &quoty&quot, &quotz&quot<a id="change"></a>]:
            if axis1 == axis2:
                continue
            &#47&#47 Extrinsic rotations</code></pre><h3>After Change</h3><pre><code class='java'>
        &#47&#47 Extrinsic rotations
        seq = &quot&quot.join([seq_tuple[0], seq_tuple[1], seq_tuple[0]])
        rotation = Rotation.from_euler(seq, angles)
        angles_quat<a id="change"> = </a><a id="change">rotation.as_euler(</a>seq<a id="change">)</a>
        angles_mat = rotation._as_euler_from_matrix(seq)
        assert_allclose(angles, angles_quat, atol=0, rtol=1e-13)
        assert_allclose(angles, angles_mat, atol=0, rtol=1e-9)
        test_stats(angles_quat - angles, 1e-16, 1e-14)</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 3</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/scipy/scipy/commit/316159b15927f5c4eaef6b1092464c7266bea489#diff-e82b4536762705a00855c91532f00bf8a0affbaf4fcf19bb3bda1a8f498ea98cL597' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 21136048</div><div id='project'> Project Name: scipy/scipy</div><div id='commit'> Commit Name: 316159b15927f5c4eaef6b1092464c7266bea489</div><div id='time'> Time: 2022-12-07</div><div id='author'> Author: 15084103+evbernardes@users.noreply.github.com</div><div id='file'> File Name: scipy/spatial/transform/tests/test_rotation.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: test_as_euler_symmetric_axes(0)</div><div id='n_method'> N Method Name: test_as_euler_symmetric_axes(0)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: scipy/spatial/transform/tests/test_rotation.py</div><div id='n_file'> N File Name: scipy/spatial/transform/tests/test_rotation.py</div><div id='m_start'> M Start Line: 597</div><div id='m_end'> M End Line: 616</div><div id='n_start'> N Start Line: 626</div><div id='n_end'> N End Line: 653</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
            altitude = self._vehicle_nav_sat_fix.altitude

            &#47&#47 Attitude
            attitude_ned_q = np.array(<a id="change">[</a>self._vehicle_pose_stamped.pose.orientation.y,
                                       self._vehicle_pose_stamped.pose.orientation.x,
                                       -self._vehicle_pose_stamped.pose.orientation.z,
                                       self._vehicle_pose_stamped.pose.orientation.w<a id="change"></a>])

            &#47&#47 Convert ENU-&gt;NED + re-center yaw
            attitude_ned = Rotation.from_quat(attitude_ned_q) * Rotation.from_rotvec(np.array([0, 0, np.pi / 2]))</code></pre><h3>After Change</h3><pre><code class='java'>
            enu_to_ned = Rotation.from_euler(&quotXYZ&quot, np.array([np.pi, 0, np.pi / 2]))
            attitude_ned = Rotation.from_quat(messaging.as_np_quaternion(self._vehicle_pose_stamped.pose.orientation)) \
                * enu_to_ned.inv()
            rpy = <a id="change">attitude_ned.as_euler(</a>&quotXYZ&quot<a id="change">, degrees=True)</a>
            rpy[0] = (rpy[0] + 180) % 360
            attitude_ned = Rotation.from_euler(&quotXYZ&quot, rpy, degrees=True)
            attitude_ned = attitude_ned.as_quat()
            orientation<a id="change"> = </a>messaging.as_ros_quaternion(attitude_ned)

            return GeoPoseStamped(header=messaging.create_header(&quotbase_link&quot),
                                  pose=GeoPose(</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/hmakelin/gisnav/commit/f7714268168bd74435880c8bea2e5e1e045c1db9#diff-bf3a62cd71b21c30eb27db9751763de1388601939c2ae50ab295c06ea9a083b1L98' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 21136054</div><div id='project'> Project Name: hmakelin/gisnav</div><div id='commit'> Commit Name: f7714268168bd74435880c8bea2e5e1e045c1db9</div><div id='time'> Time: 2022-12-14</div><div id='author'> Author: hmakelin@protonmail.com</div><div id='file'> File Name: gisnav/nodes/ardupilot_node.py</div><div id='m_class'> M Class Name: ArduPilotNode</div><div id='n_method'> N Class Name: ArduPilotNode</div><div id='m_method'> M Method Name: vehicle_geopose(1)</div><div id='n_method'> N Method Name: vehicle_geopose(1)</div><div id='m_parent_class'> M Parent Class: _AutopilotNode</div><div id='n_parent_class'> N Parent Class: _AutopilotNode</div><div id='m_file'> M File Name: gisnav/nodes/ardupilot_node.py</div><div id='n_file'> N File Name: gisnav/nodes/ardupilot_node.py</div><div id='m_start'> M Start Line: 106</div><div id='m_end'> M End Line: 114</div><div id='n_start'> N Start Line: 107</div><div id='n_end'> N End Line: 114</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        if self.vehicle_geopose is not None:
            vehicle_attitude = Attitude(q=messaging.as_np_quaternion(self.vehicle_geopose.pose.orientation))
            vehicle_attitude = vehicle_attitude.as_rotation()
            gimbal_attitude = vehicle_attitude * Rotation.from_euler(&quotXYZ&quot, <a id="change">[</a>0, -np.pi / 2, 0<a id="change"></a>])
            gimbal_attitude = messaging.as_ros_quaternion(gimbal_attitude.as_quat())
            return gimbal_attitude
        else:</code></pre><h3>After Change</h3><pre><code class='java'>
        &#47&#47 TODO: assumes static nadir facing camera, do proper implementation
        if self.vehicle_geopose is not None:
            vehicle_attitude = Rotation.from_quat(messaging.as_np_quaternion(self.vehicle_geopose.pose.orientation))
            gimbal_rpy = <a id="change">vehicle_attitude.as_euler(</a>&quotxyz&quot<a id="change">, degrees=True)</a>
            gimbal_rpy[1]<a id="change"> -= </a>90
            gimbal_attitude = Rotation.from_euler(&quotxyz&quot, gimbal_rpy, degrees=True)
            return messaging.as_ros_quaternion(gimbal_attitude.as_quat())
        else:</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/hmakelin/gisnav/commit/f7714268168bd74435880c8bea2e5e1e045c1db9#diff-bf3a62cd71b21c30eb27db9751763de1388601939c2ae50ab295c06ea9a083b1L160' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 21136052</div><div id='project'> Project Name: hmakelin/gisnav</div><div id='commit'> Commit Name: f7714268168bd74435880c8bea2e5e1e045c1db9</div><div id='time'> Time: 2022-12-14</div><div id='author'> Author: hmakelin@protonmail.com</div><div id='file'> File Name: gisnav/nodes/ardupilot_node.py</div><div id='m_class'> M Class Name: ArduPilotNode</div><div id='n_method'> N Class Name: ArduPilotNode</div><div id='m_method'> M Method Name: gimbal_quaternion(1)</div><div id='n_method'> N Method Name: gimbal_quaternion(1)</div><div id='m_parent_class'> M Parent Class: _AutopilotNode</div><div id='n_parent_class'> N Parent Class: _AutopilotNode</div><div id='m_file'> M File Name: gisnav/nodes/ardupilot_node.py</div><div id='n_file'> N File Name: gisnav/nodes/ardupilot_node.py</div><div id='m_start'> M Start Line: 168</div><div id='m_end'> M End Line: 172</div><div id='n_start'> N Start Line: 168</div><div id='n_end'> N End Line: 172</div><BR>