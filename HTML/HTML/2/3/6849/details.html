<html><h3>Pattern ID :6849
</h3><img src='23215875.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
            rot = np.random.uniform(-rot_max, rot_max)
            M = cv2.getRotationMatrix2D((W / 2, H / 2), rot * 180 / np.pi, 1.0)
            img = data[i].squeeze()
            mmg = <a id="change">mask[i].squeeze()</a>
            data[i] = cv2.warpAffine(img, M, (W, H), flags=cv2.INTER_CUBIC).reshape(C, H, W)
            mask[i] = cv2.warpAffine(mmg, M, (W, H), flags=cv2.INTER_CUBIC).reshape(C, H, W)
            T_aug += [torch.from_numpy(get_transform(0, 0, -rot))]
        else:</code></pre><h3>After Change</h3><pre><code class='java'>
            M = cv2.getRotationMatrix2D((W / 2, H / 2), rot * 180 * j / np.pi, 1.0)
            data[i] = cv2.warpAffine(img, M, (W, H), flags=cv2.INTER_CUBIC).reshape(C, H, W)
            mask[i] = cv2.warpAffine(mmg, M, (W, H), flags=cv2.INTER_CUBIC).reshape(1, H, W)
            T_21[i - 1]<a id="change"> = </a><a id="change">np.matmul(</a>T, T_21[i - 1]<a id="change">)</a>
    batch[&quotdata&quot] = torch.from_numpy(data)
    batch[&quotmask&quot] = torch.from_numpy(mask &gt; 0.5).type(batch[&quotdata&quot].dtype)    &#47&#47 make into a binary mask
    batch[&quotT_21&quot] = torch.from_numpy(T_21)
    return batch</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 3</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/utiasasrl/hero_radar_odometry/commit/69b518ec294c236dc4305129ec07282c5d2e007c#diff-2396e65f75910a60fcc1d1c84818eb6e8d024acd8bd0359129abe8f5d61622cdL8' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 23215875</div><div id='project'> Project Name: utiasasrl/hero_radar_odometry</div><div id='commit'> Commit Name: 69b518ec294c236dc4305129ec07282c5d2e007c</div><div id='time'> Time: 2021-03-04</div><div id='author'> Author: keenburn2004@gmail.com</div><div id='file'> File Name: datasets/transforms.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: augmentBatch(2)</div><div id='n_method'> N Method Name: augmentBatch(2)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: datasets/transforms.py</div><div id='n_file'> N File Name: datasets/transforms.py</div><div id='m_start'> M Start Line: 8</div><div id='m_end'> M End Line: 28</div><div id='n_start'> N Start Line: 10</div><div id='n_end'> N End Line: 29</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
                out = _stateless.functional_call(self._model, {n: p for n, p in zip(keys, params)}, x)
                return out
            self._j_list: tuple[torch.Tensor] = torch.autograd.functional.jacobian(func, values, create_graph=True)
            self._j_list = [<a id="change">j.squeeze(</a>1<a id="change">)</a>.flatten(start_dim=1) for j in self._j_list] &#47&#47 remove hidden and predict bias dimensions

            &#47&#47 vectorized hessian (https://github.com/pytorch/pytorch/issues/49171)
            def loss(*params):</code></pre><h3>After Change</h3><pre><code class='java'>
                &#47&#47 create hessian approximation
                for i, j in enumerate(self._j_list):
                    j = j.flatten(end_dim=len(self._j_list[i].shape)-len(d_p_list[i].shape)-1).flatten(start_dim=1)  &#47&#47 (NC)x(BCHW)
                    h<a id="change"> = </a><a id="change">j.T.matmul(</a>j<a id="change">)</a>
                    self._h_list.append(h)
                
            else:
                &#47&#47 vectorized hessian (https://github.com/pytorch/pytorch/issues/49171)</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/hahnec/torchimize/commit/d65b33c9e39df589093da6cf91b8998beb6aead2#diff-cf9a1e9bfb69bdf33a7cd99ce087c7d7f64730b5db5485b7d221927020235390L51' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 23215877</div><div id='project'> Project Name: hahnec/torchimize</div><div id='commit'> Commit Name: d65b33c9e39df589093da6cf91b8998beb6aead2</div><div id='time'> Time: 2022-07-23</div><div id='author'> Author: christopher.hahne@unibe.ch</div><div id='file'> File Name: torchimize/optimizer/gna_opt.py</div><div id='m_class'> M Class Name: GNA</div><div id='n_method'> N Class Name: GNA</div><div id='m_method'> M Method Name: step(3)</div><div id='n_method'> N Method Name: step(3)</div><div id='m_parent_class'> M Parent Class: Optimizer</div><div id='n_parent_class'> N Parent Class: Optimizer</div><div id='m_file'> M File Name: torchimize/optimizer/gna_opt.py</div><div id='n_file'> N File Name: torchimize/optimizer/gna_opt.py</div><div id='m_start'> M Start Line: 58</div><div id='m_end'> M End Line: 87</div><div id='n_start'> N Start Line: 62</div><div id='n_end'> N End Line: 84</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        mat_1 = torch.matmul(torch.transpose(self.__feature_list, 0, 1), self.__feature_list)
        target = torch.unsqueeze(self.__target_list, dim=0)
        mat_2 = torch.matmul(torch.transpose(self.__feature_list, 0, 1), torch.transpose(target, 0, 1))
        return torch.unsqueeze(<a id="change">torch.squeeze(</a>torch.matmul(torch.inverse(mat_1), mat_2)<a id="change">, dim=1)</a>, dim=0)

    def get_parameters(self):
        return self.__parameters</code></pre><h3>After Change</h3><pre><code class='java'>
        mat_1 = np.matmul(self.__feature_list.T, self.__feature_list)
        target = np.expand_dims(self.__target_list, axis=0)
        mat_2 = np.matmul(self.__feature_list.T, target.T)
        mat_3<a id="change"> = </a><a id="change">np.matmul(</a>np.linalg.inv(mat_1), mat_2<a id="change">)</a>

        return np.expand_dims(np.squeeze(mat_3, axis=1), axis=0)

    def get_parameters(self):</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/govindansriram/cobraml/commit/f0db299c51b0dc3f67917bac00f46a342eaa6fe2#diff-196b1aa8c5604b1fc5bd4248e15e6e3cceb25c6d0ba81a6d669b30180dacafabL21' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 23215869</div><div id='project'> Project Name: govindansriram/cobraml</div><div id='commit'> Commit Name: f0db299c51b0dc3f67917bac00f46a342eaa6fe2</div><div id='time'> Time: 2021-07-27</div><div id='author'> Author: sriramgovindanwork@gmail.com</div><div id='file'> File Name: Regression/Linear.py</div><div id='m_class'> M Class Name: LinearRegression</div><div id='n_method'> N Class Name: LinearRegression</div><div id='m_method'> M Method Name: normal_eqt(1)</div><div id='n_method'> N Method Name: normal_eqt(1)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: Regression/Linear.py</div><div id='n_file'> N File Name: Regression/Linear.py</div><div id='m_start'> M Start Line: 22</div><div id='m_end'> M End Line: 25</div><div id='n_start'> N Start Line: 34</div><div id='n_end'> N End Line: 39</div><BR>