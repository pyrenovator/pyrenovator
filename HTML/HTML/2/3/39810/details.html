<html><h3>Pattern ID :39810
</h3><img src='113354803.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>

    dot_product_desc = F.relu(dot_product_desc)

    dot_product_desc = <a id="change">torch.reshape(</a>torch.reshape(dot_product_desc, [batch_size, Hc, Wc, Hc * Wc]),
                                                 [batch_size, Hc, Wc, Hc, Wc]<a id="change">)</a>
    dot_product_desc = torch.reshape(torch.reshape(dot_product_desc, [batch_size, Hc * Wc, Hc, Wc]),
                                                 [batch_size, Hc, Wc, Hc, Wc])

</code></pre><h3>After Change</h3><pre><code class='java'>
    &#47&#47negative_dist = torch.sum(((valid_mask*(1-s)*negative_dist)[(valid_mask*(1-s)*negative_dist)&gt;0]).mean())
    positive_dist = torch.sum(valid_mask * lambda_d * s * positive_dist) / normalization
    negative_dist = torch.sum(valid_mask * (1 - s) * negative_dist) / normalization
    print(<a id="change">&quotDebug (loss.py) positive_dist:{:.3f}, negtive_dist:{:.3f}&quot.format(</a>positive_dist, negative_dist<a id="change">)</a>)

    loss = torch.sum(valid_mask * loss) / normalization
    return loss</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 2</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/shaofengzeng/superpoint-pytorch/commit/1c31b11e20fabbf2aa6d6b2323607973270f9698#diff-a4bd10917bb0c55a41a283197b1e8c5f27605c25bee438e78acf02d258442c93L86' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 113354803</div><div id='project'> Project Name: shaofengzeng/superpoint-pytorch</div><div id='commit'> Commit Name: 1c31b11e20fabbf2aa6d6b2323607973270f9698</div><div id='time'> Time: 2021-11-14</div><div id='author'> Author: shaofengzeng@163.com</div><div id='file'> File Name: solver/loss.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: descriptor_loss(6)</div><div id='n_method'> N Method Name: descriptor_loss(6)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: solver/loss.py</div><div id='n_file'> N File Name: solver/loss.py</div><div id='m_start'> M Start Line: 120</div><div id='m_end'> M End Line: 125</div><div id='n_start'> N Start Line: 86</div><div id='n_end'> N End Line: 160</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        degs = graph.out_degrees().float().clamp(min=1)
        norm = th.pow(degs, -0.5)
        shp = norm.shape + (1,) * (node_feat.dim() - 1)
        norm = <a id="change">th.reshape(</a>norm, shp<a id="change">)</a>
        node_feat = node_feat * norm
        print(&quotNorm Feature Succeed&quot)
    
    graph_data = (graph, labels, tr_label_idx, val_label_idx, test_label_idx, node_feat)</code></pre><h3>After Change</h3><pre><code class='java'>
    print(&quot&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47 Feature info: &#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&quot)
    print(&quotNode\&quots feature shape:{}&quot.format(node_feat.shape))
    print(&quotWalk\&quots feature shape:{}&quot.format(walk_feat.shape))
    print(<a id="change">&quotEdge\&quots feature shape:{}&quot.format(</a>edge_feat.shape<a id="change">)</a>)
    
    graph_data = (graph, labels, tr_label_idx, val_label_idx, test_label_idx, features)
    return graph_data</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/langgege-cqu/maxp_dgl/commit/5f428bb0d6bfb9dad16f32ca3d65785469b69c00#diff-92c9897b4d19041ed9f91c038758158776764ac7247e3546223d85e551a3241cL8' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 113354807</div><div id='project'> Project Name: langgege-cqu/maxp_dgl</div><div id='commit'> Commit Name: 5f428bb0d6bfb9dad16f32ca3d65785469b69c00</div><div id='time'> Time: 2021-12-11</div><div id='author'> Author: 8747734+bugczw@user.noreply.gitee.com</div><div id='file'> File Name: maxp_model_czw/unimp/util.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: load_dgl_graph(1)</div><div id='n_method'> N Method Name: load_dgl_graph(2)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: maxp_model_czw/unimp/util.py</div><div id='n_file'> N File Name: maxp_model_czw/unimp/util.py</div><div id='m_start'> M Start Line: 8</div><div id='m_end'> M End Line: 52</div><div id='n_start'> N Start Line: 13</div><div id='n_end'> N End Line: 47</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>

            cur_shape = np.shape(averaged_params[k])
            d = self.dimensions[j]
            aggregate_mask = <a id="change">aggregate_mask.reshape(</a>(aggregate_mask.shape[0], 1)<a id="change">)</a>
            cur_mask = np.array(aggregate_mask[pos : pos + d, :])
            cur_mask = np.reshape(cur_mask, cur_shape)

            &#47&#47 Cancel out the aggregate-mask to recover the aggregate-model</code></pre><h3>After Change</h3><pre><code class='java'>
            cur_shape = np.shape(averaged_params[k])
            d = self.dimensions[j]
            &#47&#47aggregate_mask = aggregate_mask.reshape((aggregate_mask.shape[0], 1))
            logging.info(<a id="change">&quotaggregate_mask shape = {}&quot.format(</a>np.shape(aggregate_mask)<a id="change">)</a>)
            cur_mask = np.array(aggregate_mask[pos : pos + d])
            cur_mask = np.reshape(cur_mask, cur_shape)
</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/fedml-ai/fedml/commit/3c8e3aa191c4a32d29ca5329b87e5d30eda573ec#diff-ef93df6671599f757c352b371484754bc40b407954d368f98ffb06fa4bd1de48L138' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 113354808</div><div id='project'> Project Name: fedml-ai/fedml</div><div id='commit'> Commit Name: 3c8e3aa191c4a32d29ca5329b87e5d30eda573ec</div><div id='time'> Time: 2022-08-27</div><div id='author'> Author: tuozhang@usc.edu</div><div id='file'> File Name: python/fedml/cross_silo/secagg/sa_fedml_aggregator.py</div><div id='m_class'> M Class Name: SecAggAggregator</div><div id='n_method'> N Class Name: SecAggAggregator</div><div id='m_method'> M Method Name: aggregate_model_reconstruction(5)</div><div id='n_method'> N Method Name: aggregate_model_reconstruction(6)</div><div id='m_parent_class'> M Parent Class: object</div><div id='n_parent_class'> N Parent Class: object</div><div id='m_file'> M File Name: python/fedml/cross_silo/secagg/sa_fedml_aggregator.py</div><div id='n_file'> N File Name: python/fedml/cross_silo/secagg/sa_fedml_aggregator.py</div><div id='m_start'> M Start Line: 139</div><div id='m_end'> M End Line: 164</div><div id='n_start'> N Start Line: 142</div><div id='n_end'> N End Line: 169</div><BR>