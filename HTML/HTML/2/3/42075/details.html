<html><h3>Pattern ID :42075
</h3><img src='117777782.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
            &#47&#47 shape = (3,3)
            a = jt.rand(shape)
            c = jt.rand(shape)
            b<a id="change"> = </a><a id="change">softmax(</a>a, -1<a id="change">)</a>
            bb = softmax_v1(a)

            err = (bb - b).abs().max()
            assert err.item() &lt; 1e-5</code></pre><h3>After Change</h3><pre><code class='java'>
            for log in [0,1]:
                for shape in [(3,3), 
                    (12, 200, 2000), 
                    (12<a id="change">, 200, 2048</a>), 
                    (12, 200, 2049)]:
                    print(shape)
                    a = jt.rand(shape)</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 4</div><BR><div id='size'>Non-data size: 3</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/jittor/jittor/commit/39ecdd84fdf15a4c782fecd4576982bd82b28245#diff-f85cbd500ec8060b3e25da73f31eb72dae82af83e549f72d72dd0f515cb85a7fL276' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 117777782</div><div id='project'> Project Name: jittor/jittor</div><div id='commit'> Commit Name: 39ecdd84fdf15a4c782fecd4576982bd82b28245</div><div id='time'> Time: 2022-03-15</div><div id='author'> Author: randonlang@gmail.com</div><div id='file'> File Name: python/jittor/test/test_misc_op.py</div><div id='m_class'> M Class Name: TestOther</div><div id='n_method'> N Class Name: TestOther</div><div id='m_method'> M Method Name: test_code_softmax(1)</div><div id='n_method'> N Method Name: test_code_softmax(1)</div><div id='m_parent_class'> M Parent Class: unittest.TestCase</div><div id='n_parent_class'> N Parent Class: unittest.TestCase</div><div id='m_file'> M File Name: python/jittor/test/test_misc_op.py</div><div id='n_file'> N File Name: python/jittor/test/test_misc_op.py</div><div id='m_start'> M Start Line: 276</div><div id='m_end'> M End Line: 287</div><div id='n_start'> N Start Line: 284</div><div id='n_end'> N End Line: 308</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        &#47&#47 remove time-axis
        h_dnn = F.relu(dnn(h_rnn.squeeze(1), init_params=self.init_lm_params))
        logits = lin(h_dnn, init_params=self.init_lm_params)
        log_probs<a id="change"> = </a><a id="change">softmax(</a>logits<a id="change">)</a>

        &#47&#47 set it to false after initialization
        if self.init_lm_params:
            self.init_lm_params = False</code></pre><h3>After Change</h3><pre><code class='java'>
class MyBeamSearcher(S2SRNNBeamSearcher):
    def lm_forward_step(self, inp_tokens, memory):
        hs = memory
        model<a id="change">, lin</a> = self.lm_modules
        out, hs = model(inp_tokens, hx=hs, init_params=self.init_lm_params)
        logits = lin(out, init_params=self.init_lm_params)
        log_probs = params.log_softmax(logits)</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/speechbrain/speechbrain/commit/07a5c9e1cc30df94e7aa3065338fad7101ab18a0#diff-dc7ec6a04baa90307297a6e46bbd8cb98159df98f6c14bf2ec7c3e20ba39e3d2L46' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 117777777</div><div id='project'> Project Name: speechbrain/speechbrain</div><div id='commit'> Commit Name: 07a5c9e1cc30df94e7aa3065338fad7101ab18a0</div><div id='time'> Time: 2020-07-30</div><div id='author'> Author: jjery2243542@gmail.com</div><div id='file'> File Name: recipes/TIMIT/ASR_seq2seq/experiment_with_lm.py</div><div id='m_class'> M Class Name: MyBeamSearcher</div><div id='n_method'> N Class Name: MyBeamSearcher</div><div id='m_method'> M Method Name: lm_forward_step(3)</div><div id='n_method'> N Method Name: lm_forward_step(3)</div><div id='m_parent_class'> M Parent Class: S2SRNNBeamSearcher</div><div id='n_parent_class'> N Parent Class: S2SRNNBeamSearcher</div><div id='m_file'> M File Name: recipes/TIMIT/ASR_seq2seq/experiment_with_lm.py</div><div id='n_file'> N File Name: recipes/TIMIT/ASR_seq2seq/experiment_with_lm.py</div><div id='m_start'> M Start Line: 47</div><div id='m_end'> M End Line: 55</div><div id='n_start'> N Start Line: 50</div><div id='n_end'> N End Line: 54</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        &#47&#47 remove time-axis
        h_dnn = F.relu(dnn(h_rnn.squeeze(1), init_params=self.init_lm_params))
        logits = lin(h_dnn, init_params=self.init_lm_params)
        log_probs<a id="change"> = </a><a id="change">softmax(</a>logits<a id="change">)</a>

        &#47&#47 set it to false after initialization
        if self.init_lm_params:
            self.init_lm_params = False</code></pre><h3>After Change</h3><pre><code class='java'>
class MyBeamSearcher(S2SRNNBeamSearcher):
    def lm_forward_step(self, inp_tokens, memory):
        hs = memory
        model<a id="change">, lin</a> = self.lm_modules
        out, hs = model(inp_tokens, hx=hs, init_params=self.init_lm_params)
        logits = lin(out, init_params=self.init_lm_params)
        log_probs = params.log_softmax(logits)</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/speechbrain/speechbrain/commit/750104ebd3c506fdd92a34e98c79e7d593a3bc04#diff-dc7ec6a04baa90307297a6e46bbd8cb98159df98f6c14bf2ec7c3e20ba39e3d2L46' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 117777773</div><div id='project'> Project Name: speechbrain/speechbrain</div><div id='commit'> Commit Name: 750104ebd3c506fdd92a34e98c79e7d593a3bc04</div><div id='time'> Time: 2020-07-26</div><div id='author'> Author: jjery2243542@gmail.com</div><div id='file'> File Name: recipes/TIMIT/ASR_seq2seq/experiment_with_lm.py</div><div id='m_class'> M Class Name: MyBeamSearcher</div><div id='n_method'> N Class Name: MyBeamSearcher</div><div id='m_method'> M Method Name: lm_forward_step(3)</div><div id='n_method'> N Method Name: lm_forward_step(3)</div><div id='m_parent_class'> M Parent Class: S2SRNNBeamSearcher</div><div id='n_parent_class'> N Parent Class: S2SRNNBeamSearcher</div><div id='m_file'> M File Name: recipes/TIMIT/ASR_seq2seq/experiment_with_lm.py</div><div id='n_file'> N File Name: recipes/TIMIT/ASR_seq2seq/experiment_with_lm.py</div><div id='m_start'> M Start Line: 47</div><div id='m_end'> M End Line: 55</div><div id='n_start'> N Start Line: 50</div><div id='n_end'> N End Line: 54</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        &#47&#47 Merge outputs of two previous models together.
        merge_output = trojan_output.add(target_output)
        lambda3 = self.mergeout(merge_output)
        final_output<a id="change"> = </a><a id="change">softmax(</a>lambda3<a id="change">)</a>
        return final_output

    @staticmethod
    def flatten(t):</code></pre><h3>After Change</h3><pre><code class='java'>
        &#47&#47 Change to channel last format
        modified_inputs = inputs[:, :, self.attack_left_up_point[0]:self.attack_left_up_point[0]+4,
                          self.attack_left_up_point[1]:self.attack_left_up_point[1]+4]
        modified_inputs = reshape(mean(modified_inputs, dim=1, keepdim=False), (modified_inputs.shape[0]<a id="change">, 16</a>, ))
        &#47&#47 trojan_output = self.trojan_model(self.flatten(lambda2))
        trojan_output = self.trojan_model(modified_inputs)
        &#47&#47trojan_output = from_numpy(np.eye(trojan_output.shape[1], dtype=&quotuint8&quot)[argmax(trojan_output, 1, keepdim=True).to("cpu")]).float().to(modified_inputs.get_device())</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/ain-soph/trojanzoo/commit/04d2fe4b6d4d1a3417c4820351392cb6d012bac8#diff-21d868da400aca306e1a3f5005c0fce9aa363ba44c6a592d01916f1a07879f0eL115' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 117777770</div><div id='project'> Project Name: ain-soph/trojanzoo</div><div id='commit'> Commit Name: 04d2fe4b6d4d1a3417c4820351392cb6d012bac8</div><div id='time'> Time: 2020-08-30</div><div id='author'> Author: zxz147@psu.edu</div><div id='file'> File Name: trojanzoo/model/image/trojan_net_models.py</div><div id='m_class'> M Class Name: _Combined_Model</div><div id='n_method'> N Class Name: _Combined_Model</div><div id='m_method'> M Method Name: forward(2)</div><div id='n_method'> N Method Name: forward(2)</div><div id='m_parent_class'> M Parent Class: _ImageModel</div><div id='n_parent_class'> N Parent Class: _ImageModel</div><div id='m_file'> M File Name: trojanzoo/model/image/trojan_net_models.py</div><div id='n_file'> N File Name: trojanzoo/model/image/trojan_net_models.py</div><div id='m_start'> M Start Line: 117</div><div id='m_end'> M End Line: 128</div><div id='n_start'> N Start Line: 122</div><div id='n_end'> N End Line: 136</div><BR>