<html><h3>Pattern ID :4970
</h3><img src='17413080.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
        self.tokenizer = tokenizer

        &#47&#47 "tokens" includes all special tokens, later used for the heatmap when aligning with attributions
        self.tokens = <a id="change">self.tokenizer.convert_ids_to_tokens(</a>self.instance[&quotinput_ids&quot]<a id="change">)</a>

        &#47&#47 Cleaned text
        &#47&#47 Note: decode + clean_up_tokenization_spaces did not remove the "&#47&#47&#47&#47" artifacts
        self.text = self.tokenizer.decode(token_ids=self.instance[&quotinput_ids&quot], clean_up_tokenization_spaces=True,</code></pre><h3>After Change</h3><pre><code class='java'>
        self.explainer_name = explainer_name
        self.tokenizer = tokenizer
        self.config_name = config_name
        self.text_fields<a id="change">: List = </a><a id="change">[]</a>

    @property
    def tokens(self) -&gt; Dict:
        &#47&#47 "tokens" includes all special tokens, later used for the heatmap when aligning with attributions</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 4</div><BR><div id='size'>Non-data size: 3</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/dfki-nlp/thermostat/commit/cd2eb73894221510fa989344527857d73589db6a#diff-6ab4c95f94b6241bd77621bf1fee4ada8e781074aeaca5d9c6e2a8f43e0b4e8bL136' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 17413080</div><div id='project'> Project Name: dfki-nlp/thermostat</div><div id='commit'> Commit Name: cd2eb73894221510fa989344527857d73589db6a</div><div id='time'> Time: 2021-06-18</div><div id='author'> Author: feldhusnlp@gmail.com</div><div id='file'> File Name: src/thermostat/data/dataset_utils.py</div><div id='m_class'> M Class Name: Thermounit</div><div id='n_method'> N Class Name: Thermounit</div><div id='m_method'> M Method Name: __init__(9)</div><div id='n_method'> N Method Name: __init__(8)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: src/thermostat/data/dataset_utils.py</div><div id='n_file'> N File Name: src/thermostat/data/dataset_utils.py</div><div id='m_start'> M Start Line: 136</div><div id='m_end'> M End Line: 152</div><div id='n_start'> N Start Line: 150</div><div id='n_end'> N End Line: 161</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
            batch_data = batch_data.to(config.device)
            batch_token_starts = batch_token_starts.to(config.device)
            batch_tags = batch_tags.to(config.device)
            sent_data.extend([[<a id="change">tokenizer.convert_ids_to_tokens(</a>idx.item()<a id="change">)</a> for idx in indices
                               if (idx.item() &gt; 0 and idx.item() != 101)] for indices in batch_data])
            batch_masks = batch_data.gt(0)  &#47&#47 get padding mask
            &#47&#47 compute model output and loss</code></pre><h3>After Change</h3><pre><code class='java'>
            batch_output = batch_output.detach().cpu().numpy()
            batch_tags = batch_tags.to(&quotcpu&quot).numpy()
            for i, indices in enumerate(np.argmax(batch_output, axis=2)):
                pred_tag<a id="change"> = </a><a id="change">[]</a>
                for j, idx in enumerate(indices):
                    if label_masks[i][j]:
                        pred_tag.append(id2label.get(idx))
                pred_tags.append(pred_tag)</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/hemingkx/wordseg/commit/148a03a62ebd0fc3dcbd4828b32aabd8ee76dc97#diff-13a1fbaf4d3a9ece7f1a03bc5edee62a33ad0fb1d42ea49968482079914bc388L77' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 17413082</div><div id='project'> Project Name: hemingkx/wordseg</div><div id='commit'> Commit Name: 148a03a62ebd0fc3dcbd4828b32aabd8ee76dc97</div><div id='time'> Time: 2021-05-05</div><div id='author'> Author: hemingkx@gmail.com</div><div id='file'> File Name: BERT-Softmax/train.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: evaluate(3)</div><div id='n_method'> N Method Name: evaluate(3)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: BERT-Softmax/train.py</div><div id='n_file'> N File Name: BERT-Softmax/train.py</div><div id='m_start'> M Start Line: 81</div><div id='m_end'> M End Line: 117</div><div id='n_start'> N Start Line: 80</div><div id='n_end'> N End Line: 125</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
            PAD_TOKEN_ID = tokenizer.convert_tokens_to_ids([&quot[PAD]&quot])[0]
            while PAD_TOKEN_ID in prediction:                               &#47&#47 移除label中的 [PAD] token
                prediction.remove(PAD_TOKEN_ID)
            label_tokens.append(&quot&quot.join(<a id="change">tokenizer.convert_ids_to_tokens(</a>prediction<a id="change">)</a>))
        
        used = time.time() - start_time
        print(f&quotUsed {used}s.&quot)</code></pre><h3>After Change</h3><pre><code class='java'>
    
    with torch.no_grad():
        start_time = time.time()
        examples<a id="change"> = </a><a id="change">{</a>&quottext&quot: contents<a id="change">}</a>

        tokenized_output = convert_example(
            examples, 
            tokenizer, </code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/harderthenharder/transformers_tasks/commit/bf825bb22c43795f1e3a08cf8969ddc613051e76#diff-d21cbf985c91e426e300ad72220f1590149c9d24d0ec7884d541c3fd92d79b6bL41' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 17413085</div><div id='project'> Project Name: harderthenharder/transformers_tasks</div><div id='commit'> Commit Name: bf825bb22c43795f1e3a08cf8969ddc613051e76</div><div id='time'> Time: 2022-11-30</div><div id='author'> Author: pankeyu@pankeyus-MacBook-Pro.local</div><div id='file'> File Name: prompt_tasks/p-tuning/inference.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: inference(1)</div><div id='n_method'> N Method Name: inference(1)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: prompt_tasks/p-tuning/inference.py</div><div id='n_file'> N File Name: prompt_tasks/p-tuning/inference.py</div><div id='m_start'> M Start Line: 50</div><div id='m_end'> M End Line: 69</div><div id='n_start'> N Start Line: 59</div><div id='n_end'> N End Line: 80</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        &#47&#47 creating output Dict
        output = {
            "output_text" : self.tokenizer.decode(predict_answer_tokens),
            "tokens": <a id="change">self.tokenizer.convert_ids_to_tokens(</a>tokenized_text.input_ids[i]<a id="change">)</a>,

        }
        prediction_output.append(output)</code></pre><h3>After Change</h3><pre><code class='java'>
    &#47&#47 Text as sequence of sentencepiece ID"s.
    context =[]
    question = []
    answers_text<a id="change"> = </a><a id="change">[]</a>
    for i in inputs:
        question.append(i[&quotquestion&quot])
        context.append(i[&quotcontext&quot])
        answers_text.append(i[&quotanswers_text&quot])</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/pair-code/lit/commit/66997357693fa19a146835bc84afb7992cc05eab#diff-e66e2ed65042046b3905d9bc4b44fa2c3bb19cb8c07da5a9540002725714fab0L58' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 17413079</div><div id='project'> Project Name: pair-code/lit</div><div id='commit'> Commit Name: 66997357693fa19a146835bc84afb7992cc05eab</div><div id='time'> Time: 2022-06-26</div><div id='author'> Author: 31214277+aryan1107@users.noreply.github.com</div><div id='file'> File Name: lit_nlp/examples/models/tydi.py</div><div id='m_class'> M Class Name: TyDiModel</div><div id='n_method'> N Class Name: TyDiModel</div><div id='m_method'> M Method Name: predict_minibatch(2)</div><div id='n_method'> N Method Name: predict_minibatch(2)</div><div id='m_parent_class'> M Parent Class: lit_model.Model</div><div id='n_parent_class'> N Parent Class: lit_model.Model</div><div id='m_file'> M File Name: lit_nlp/examples/models/tydi.py</div><div id='n_file'> N File Name: lit_nlp/examples/models/tydi.py</div><div id='m_start'> M Start Line: 73</div><div id='m_end'> M End Line: 85</div><div id='n_start'> N Start Line: 65</div><div id='n_end'> N End Line: 96</div><BR>