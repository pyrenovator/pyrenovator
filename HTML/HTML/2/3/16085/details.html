<html><h3>Pattern ID :16085
</h3><img src='53999605.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
        &#47&#47 Construct mapping of scopes from in_features -&gt; out_features
        scopes = torch.zeros(in_features, self.out_features, num_repetitions)
        for r in range(num_repetitions):
            idxs<a id="change"> = </a><a id="change">torch.randperm(n=self.in_features)</a>
            for o in range(out_features):
                low = o * cardinality
                high = (o + 1) * cardinality
                if o == out_features - 1:</code></pre><h3>After Change</h3><pre><code class='java'>

        &#47&#47 Separate scopes matrices for height and width
        self.register_buffer("scopes_h", _make_scopes(in_shape[0], out_shape[0], num_repetitions))
        self.register_buffer("scopes_w", _make_scopes(in_shape[1], <a id="change">out_shape[1]</a>, num_repetitions))

    def forward(self, x: torch.Tensor, marginalized_scopes: List[int]):
        &#47&#47 Forward through base leaf</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 3</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/braun-steven/simple-einet/commit/6c0a0ca7de9dfbed9f4b0eebd0e015cf76002c2b#diff-0e167804f5443ae4e51928b2569dfa157205f2b3fd2aa197779a9ef67fb370e5L22' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 53999605</div><div id='project'> Project Name: braun-steven/simple-einet</div><div id='commit'> Commit Name: 6c0a0ca7de9dfbed9f4b0eebd0e015cf76002c2b</div><div id='time'> Time: 2022-01-05</div><div id='author'> Author: steven.lang.mz@gmail.com</div><div id='file'> File Name: simple_einet/factorized_leaf_layer.py</div><div id='m_class'> M Class Name: FactorizedLeaf</div><div id='n_method'> N Class Name: FactorizedLeaf</div><div id='m_method'> M Method Name: __init__(5)</div><div id='n_method'> N Method Name: __init__(5)</div><div id='m_parent_class'> M Parent Class: AbstractLayer</div><div id='n_parent_class'> N Parent Class: AbstractLayer</div><div id='m_file'> M File Name: simple_einet/factorized_leaf_layer.py</div><div id='n_file'> N File Name: simple_einet/factorized_leaf_layer.py</div><div id='m_start'> M Start Line: 22</div><div id='m_end'> M End Line: 50</div><div id='n_start'> N Start Line: 55</div><div id='n_end'> N End Line: 75</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        g = torch.Generator()
        g.manual_seed(self.epoch)
        if self.shuffle:
            indices<a id="change"> = </a><a id="change">torch.randperm(</a>len(self.dataset)<a id="change">, generator=g)</a>.tolist()
        else:
            indices = list(range(len(self.dataset)))
</code></pre><h3>After Change</h3><pre><code class='java'>
    def __iter__(self):
        &#47&#47 deterministically shuffle based on epoch
        
        local_indices = <a id="change">self.indices[ (self.id-1)*self.num_samples : self.id*self.num_samples ]</a>

        assert len(local_indices) == self.num_samples

        return iter(local_indices)</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/smilelab-fl/fedlab/commit/4a5dbf1ca21d9f99caf66fcf136fcf784e5867bf#diff-e4237f050325c844446bfd292dbf278c96a01bca8371acace86e3ab981df543aL84' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 53999603</div><div id='project'> Project Name: smilelab-fl/fedlab</div><div id='commit'> Commit Name: 4a5dbf1ca21d9f99caf66fcf136fcf784e5867bf</div><div id='time'> Time: 2021-08-03</div><div id='author'> Author: 928255708@qq.com</div><div id='file'> File Name: fedlab_utils/dataset/sampler.py</div><div id='m_class'> M Class Name: FedDistributedSampler</div><div id='n_method'> N Class Name: FedDistributedSampler</div><div id='m_method'> M Method Name: __iter__(1)</div><div id='n_method'> N Method Name: __iter__(1)</div><div id='m_parent_class'> M Parent Class: torch.utils.data.Sampler</div><div id='n_parent_class'> N Parent Class: torch.utils.data.Sampler</div><div id='m_file'> M File Name: fedlab_utils/dataset/sampler.py</div><div id='n_file'> N File Name: fedlab_utils/dataset/sampler.py</div><div id='m_start'> M Start Line: 86</div><div id='m_end'> M End Line: 101</div><div id='n_start'> N Start Line: 82</div><div id='n_end'> N End Line: 86</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
    num_samples, dim, dtype, device = *samples.shape, x.dtype, x.device

    if num_samples &gt;= num_clusters:
        indices<a id="change"> = </a><a id="change">torch.randperm(</a>num_samples<a id="change">, device=device)</a>[:num_clusters]
    else:
        indices = torch.randint(0, num_samples, (num_clusters,), device=device)
</code></pre><h3>After Change</h3><pre><code class='java'>
    return samples[indices]

def kmeans(samples, num_clusters, num_iters = 10, use_cosine_sim = False):
    dim, dtype, device = <a id="change">samples.shape[-1]</a>, samples.dtype, samples.device

    means = sample_vectors(samples, num_clusters)
</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/lucidrains/vector-quantize-pytorch/commit/b1f5d8edb7be48ff1fa9ec8959b6097dcb7aa99a#diff-8bcd9c958b614ce130dc4091c094d4cfcc2023716823c181e3a9edaddbcd433dL21' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 53999602</div><div id='project'> Project Name: lucidrains/vector-quantize-pytorch</div><div id='commit'> Commit Name: b1f5d8edb7be48ff1fa9ec8959b6097dcb7aa99a</div><div id='time'> Time: 2021-10-18</div><div id='author'> Author: lucidrains@gmail.com</div><div id='file'> File Name: vector_quantize_pytorch/vector_quantize_pytorch.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: kmeans(4)</div><div id='n_method'> N Method Name: kmeans(4)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: vector_quantize_pytorch/vector_quantize_pytorch.py</div><div id='n_file'> N File Name: vector_quantize_pytorch/vector_quantize_pytorch.py</div><div id='m_start'> M Start Line: 22</div><div id='m_end'> M End Line: 39</div><div id='n_start'> N Start Line: 32</div><div id='n_end'> N End Line: 43</div><BR>