<html><h3>Pattern ID :1560
</h3><img src='6980607.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>

    def after_train_iter(self, engine):
        engine.optimizer.zero_grad()
        <a id="change">engine.losses[engine.cur_stage.loss]</a>.backward()
        _allreduce_grads(engine.model.parameters(), self._coalesce,
                         self._bucket_size_mb)
        grad_clip = engine.cur_stage.grad_clip</code></pre><h3>After Change</h3><pre><code class='java'>
        engine.losses[loss].backward()
        _allreduce_grads(engine.model.parameters(), self._coalesce,
                         self._bucket_size_mb)
        grad_clip = <a id="change">engine.cur_stage.getdefault(&quotgrad_clip&quot</a>, None<a id="change">)</a>
        if grad_clip is not None:
            self.clip_grads(engine.model.parameters(), grad_clip)
        engine.optimizer.step()
</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 2</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/yeliudev/nncore/commit/7d89b57b30a7e4b9c7fe642501715be4c7c99d83#diff-23b9582393e6ba66767e784b65708dd5e51b61d532879864659f81accf91558aL74' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 6980607</div><div id='project'> Project Name: yeliudev/nncore</div><div id='commit'> Commit Name: 7d89b57b30a7e4b9c7fe642501715be4c7c99d83</div><div id='time'> Time: 2020-03-20</div><div id='author'> Author: goolhanrry@gmail.com</div><div id='file'> File Name: nncore/engine/hooks/optimizer.py</div><div id='m_class'> M Class Name: DistOptimizerHook</div><div id='n_method'> N Class Name: DistOptimizerHook</div><div id='m_method'> M Method Name: after_train_iter(2)</div><div id='n_method'> N Method Name: after_train_iter(2)</div><div id='m_parent_class'> M Parent Class: OptimizerHook</div><div id='n_parent_class'> N Parent Class: OptimizerHook</div><div id='m_file'> M File Name: nncore/engine/hooks/optimizer.py</div><div id='n_file'> N File Name: nncore/engine/hooks/optimizer.py</div><div id='m_start'> M Start Line: 74</div><div id='m_end'> M End Line: 77</div><div id='n_start'> N Start Line: 75</div><div id='n_end'> N End Line: 79</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>

    def after_train_iter(self, engine):
        engine.optimizer.zero_grad()
        <a id="change">engine.losses[engine.cur_stage.loss]</a>.backward()
        grad_clip = engine.cur_stage.grad_clip
        if grad_clip is not None:
            self.clip_grads(engine.model.parameters(), grad_clip)</code></pre><h3>After Change</h3><pre><code class='java'>

    def after_train_iter(self, engine):
        engine.optimizer.zero_grad()
        loss = <a id="change">engine.cur_stage.getdefault(&quotloss&quot</a>, &quotloss&quot<a id="change">)</a>
        engine.losses[loss].backward()
        grad_clip = engine.cur_stage.getdefault(&quotgrad_clip&quot, None)
        if grad_clip is not None:
            self.clip_grads(engine.model.parameters(), grad_clip)</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/yeliudev/nncore/commit/7d89b57b30a7e4b9c7fe642501715be4c7c99d83#diff-23b9582393e6ba66767e784b65708dd5e51b61d532879864659f81accf91558aL55' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 6980608</div><div id='project'> Project Name: yeliudev/nncore</div><div id='commit'> Commit Name: 7d89b57b30a7e4b9c7fe642501715be4c7c99d83</div><div id='time'> Time: 2020-03-20</div><div id='author'> Author: goolhanrry@gmail.com</div><div id='file'> File Name: nncore/engine/hooks/optimizer.py</div><div id='m_class'> M Class Name: OptimizerHook</div><div id='n_method'> N Class Name: OptimizerHook</div><div id='m_method'> M Method Name: after_train_iter(2)</div><div id='n_method'> N Method Name: after_train_iter(2)</div><div id='m_parent_class'> M Parent Class: Hook</div><div id='n_parent_class'> N Parent Class: Hook</div><div id='m_file'> M File Name: nncore/engine/hooks/optimizer.py</div><div id='n_file'> N File Name: nncore/engine/hooks/optimizer.py</div><div id='m_start'> M Start Line: 57</div><div id='m_end'> M End Line: 58</div><div id='n_start'> N Start Line: 57</div><div id='n_end'> N End Line: 59</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        self._base_lr = []
        for group in engine.optimizer.param_groups:
            group.setdefault(&quotinitial_lr&quot, group[&quotlr&quot])
            self._base_lr.append(<a id="change">group[&quotinitial_lr&quot]</a>)

        _cfg = engine.cur_stage.lr_updater.copy()
        self._policy = _cfg.pop(&quotpolicy&quot)</code></pre><h3>After Change</h3><pre><code class='java'>
            group[&quotlr&quot] = group[&quotupdated_lr&quot] = lr

    def before_stage(self, engine):
        self._cfg = <a id="change">engine.cur_stage.getdefault(&quotlr_updater&quot</a>, None<a id="change">)</a>
        for group in engine.optimizer.param_groups:
            group.setdefault(&quotinitial_lr&quot, group[&quotlr&quot])

    def before_train_epoch(self, engine):</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/yeliudev/nncore/commit/7d89b57b30a7e4b9c7fe642501715be4c7c99d83#diff-6ea1313567f7c34f59966f6e425786ffaf55c045c3f564503081022c47dd0cc1L96' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 6980613</div><div id='project'> Project Name: yeliudev/nncore</div><div id='commit'> Commit Name: 7d89b57b30a7e4b9c7fe642501715be4c7c99d83</div><div id='time'> Time: 2020-03-20</div><div id='author'> Author: goolhanrry@gmail.com</div><div id='file'> File Name: nncore/engine/hooks/lr_updater.py</div><div id='m_class'> M Class Name: LrUpdaterHook</div><div id='n_method'> N Class Name: LrUpdaterHook</div><div id='m_method'> M Method Name: before_stage(2)</div><div id='n_method'> N Method Name: before_stage(2)</div><div id='m_parent_class'> M Parent Class: Hook</div><div id='n_parent_class'> N Parent Class: Hook</div><div id='m_file'> M File Name: nncore/engine/hooks/lr_updater.py</div><div id='n_file'> N File Name: nncore/engine/hooks/lr_updater.py</div><div id='m_start'> M Start Line: 97</div><div id='m_end'> M End Line: 108</div><div id='n_start'> N Start Line: 55</div><div id='n_end'> N End Line: 55</div><BR>