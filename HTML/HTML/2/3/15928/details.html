<html><h3>Pattern ID :15928
</h3><img src='53689307.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
                    label_vectors = label_vectors.reshape(batch_size * self.data_manager.num_labels * 2, -1)
                    loss = self.loss_function(model_output, label_vectors)
                else:
                    loss = self.loss_function(model_output, <a id="change">label_vectors.float()</a>)
                    loss = torch.sum(torch.mean(loss, 3), 2)
                    loss = torch.sum(loss * attention_mask) / torch.sum(attention_mask)
</code></pre><h3>After Change</h3><pre><code class='java'>
                    else:
                        num_labels = self.num_labels
                    model_output = logits.reshape(batch_size * num_labels, -1)
                    label_vectors = <a id="change">label_vectors.reshape(</a>batch_size * num_labels, <a id="change">-1</a><a id="change">)</a>
                    loss = self.loss_function(model_output, label_vectors)
                else:
                    if self.configs[&quotmodel_type&quot] == &quotbp&quot:
                        loss = self.loss_function(logits, label_vectors)</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 4</div><BR><div id='size'>Non-data size: 2</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/stanleylsx/entity_extractor_by_binary_tagging/commit/eb5b1ff92de74222cda1b2e33c046b03b036c451#diff-f78923b490affa9c24b04d4641bd9a4dd31198ebe9bc67b6630776cfac13ed20L72' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 53689307</div><div id='project'> Project Name: stanleylsx/entity_extractor_by_binary_tagging</div><div id='commit'> Commit Name: eb5b1ff92de74222cda1b2e33c046b03b036c451</div><div id='time'> Time: 2022-06-08</div><div id='author'> Author: gzlishouxian@gmail.com</div><div id='file'> File Name: engines/train.py</div><div id='m_class'> M Class Name: Train</div><div id='n_method'> N Class Name: Train</div><div id='m_method'> M Method Name: train(1)</div><div id='n_method'> N Method Name: train(1)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: engines/train.py</div><div id='n_file'> N File Name: engines/train.py</div><div id='m_start'> M Start Line: 72</div><div id='m_end'> M End Line: 90</div><div id='n_start'> N Start Line: 73</div><div id='n_end'> N End Line: 99</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
    pred = pred.t()
    correct = pred.eq(target.reshape(1, -1).expand_as(pred))
    return [
        <a id="change">correct[:k].reshape(-1).float()</a>.sum(0) * 100. / batch_size
        if k &lt;= maxk else torch.tensor(100.) for k in topk
    ]
</code></pre><h3>After Change</h3><pre><code class='java'>
    _, pred = output.topk(maxk, 1, True, True)
    pred = pred.t()
    correct = pred.eq(target.reshape(1, -1).expand_as(pred))
    return [<a id="change">correct[:min(k, maxk)].reshape(-1</a><a id="change">)</a>.float().sum(0) * 100. / batch_size for k in topk]
</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/feng-lab/pytorch-image-models/commit/d667351eac57da2b07a50c07482652103a7839ee#diff-6fc9ad68cc874dd96310c66553e10c1fd6c27526b219836ea30e72a2cab8b30dL26' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 53689306</div><div id='project'> Project Name: feng-lab/pytorch-image-models</div><div id='commit'> Commit Name: d667351eac57da2b07a50c07482652103a7839ee</div><div id='time'> Time: 2021-08-19</div><div id='author'> Author: rwightman@gmail.com</div><div id='file'> File Name: timm/utils/metrics.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: accuracy(3)</div><div id='n_method'> N Method Name: accuracy(3)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: timm/utils/metrics.py</div><div id='n_file'> N File Name: timm/utils/metrics.py</div><div id='m_start'> M Start Line: 28</div><div id='m_end'> M End Line: 35</div><div id='n_start'> N Start Line: 27</div><div id='n_end'> N End Line: 32</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        &#47&#47 for k in topk:
        &#47&#47     correct_k = correct[:k].reshape(-1).float().sum(0, keepdim=True)
        &#47&#47     res.append(correct_k.mul_(100.0 / batch_size))
        correct_k = <a id="change">correct[:topk].reshape(-1).float()</a>.sum(0, keepdim=True)
        res = correct_k.mul_(100.0 / batch_size).item()
        return res
</code></pre><h3>After Change</h3><pre><code class='java'>
    pred = pred.t()
    correct = pred.eq(target.reshape(1, -1).expand_as(pred))
    return [
        (<a id="change">correct[: min(k, maxk)].reshape(-1</a><a id="change">)</a>.float().sum(0) * 100.0 / batch_size).item()
        for k in topk
    ]
</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/oneflow-inc/libai/commit/371360b9b903675607d2f92544962eb8b2330a17#diff-97abbafe7759c5aefa52f03808bfda50cfe14f401be4ede27bce57a8eef0f929L29' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 53689305</div><div id='project'> Project Name: oneflow-inc/libai</div><div id='commit'> Commit Name: 371360b9b903675607d2f92544962eb8b2330a17</div><div id='time'> Time: 2022-02-13</div><div id='author'> Author: 48727989+rentainhe@users.noreply.github.com</div><div id='file'> File Name: libai/evaluation/cls_evaluator.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: accuracy(3)</div><div id='n_method'> N Method Name: accuracy(3)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: libai/evaluation/cls_evaluator.py</div><div id='n_file'> N File Name: libai/evaluation/cls_evaluator.py</div><div id='m_start'> M Start Line: 31</div><div id='m_end'> M End Line: 49</div><div id='n_start'> N Start Line: 28</div><div id='n_end'> N End Line: 36</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        min_encodings.scatter_(1, indices[:,None], 1)

        &#47&#47 get quantized latent vectors
        z_q = torch.matmul(<a id="change">min_encodings.float()</a>, self.embedding.weight)

        if shape is not None:
            z_q = z_q.view(shape)</code></pre><h3>After Change</h3><pre><code class='java'>
        if self.remap is not None:
            indices = indices.reshape(shape[0],-1) &#47&#47 add batch axis
            indices = self.unmap_to_all(indices)
            indices = <a id="change">indices.reshape(-1</a><a id="change">)</a> &#47&#47 flatten again

        &#47&#47 get quantized latent vectors
        z_q = self.embedding(indices)</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/tgisaturday/dalle-lightning/commit/d921f1da0c5eb11dac01cd1facad821547c250d4#diff-39f10457411109520640e39f475d0ec07093eef15589754653fc525d4e028d99L84' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 53689308</div><div id='project'> Project Name: tgisaturday/dalle-lightning</div><div id='commit'> Commit Name: d921f1da0c5eb11dac01cd1facad821547c250d4</div><div id='time'> Time: 2021-07-07</div><div id='author'> Author: jamesk1228@gmail.com</div><div id='file'> File Name: taming/modules/vqvae/quantize.py</div><div id='m_class'> M Class Name: VectorQuantizer</div><div id='n_method'> N Class Name: VectorQuantizer</div><div id='m_method'> M Method Name: get_codebook_entry(3)</div><div id='n_method'> N Method Name: get_codebook_entry(3)</div><div id='m_parent_class'> M Parent Class: nn.Module</div><div id='n_parent_class'> N Parent Class: nn.Module</div><div id='m_file'> M File Name: taming/modules/vqvae/quantize.py</div><div id='n_file'> N File Name: taming/modules/vqvae/quantize.py</div><div id='m_start'> M Start Line: 87</div><div id='m_end'> M End Line: 91</div><div id='n_start'> N Start Line: 311</div><div id='n_end'> N End Line: 317</div><BR>