<html><h3>Pattern ID :9549
</h3><img src='34187233.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
                model_dir=self.repo_path, clone_from=self.create_model_name)
            assert os.path.exists(
                os.path.join(self.repo_path, &quotconfiguration.json&quot))
            <a id="change">shutil.rmtree(</a>self.repo_path<a id="change">, ignore_errors=True)</a>

    @unittest.skipUnless(test_level() &gt;= 0, &quotskip test in current test level&quot)
    def test_upload_invalid_repo(self):
        logger.info(&quottest upload to invalid repo!&quot)</code></pre><h3>After Change</h3><pre><code class='java'>
        logger.info(&quottest upload without login!&quot)
        self.api.login(TEST_ACCESS_TOKEN1)
        delete_credential()
        <a id="change">with self</a><a id="change">.assertRaises(NotLoginException):
            </a>upload_folder(
                model_id=self.create_model_name,
                model_dir=self.finetune_path,
                visibility=ModelVisibility.PUBLIC,</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 5</div><BR><div id='size'>Non-data size: 3</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/modelscope/modelscope/commit/87b4a52b3c22446a2265cdf90500b6655497bfd7#diff-0e7577c3dab699120263b8afe9682a98199b2efa113f618d2b80aa0bcd7f6434L122' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 34187233</div><div id='project'> Project Name: modelscope/modelscope</div><div id='commit'> Commit Name: 87b4a52b3c22446a2265cdf90500b6655497bfd7</div><div id='time'> Time: 2022-10-19</div><div id='author'> Author: jiaqi.sjq@alibaba-inc.com</div><div id='file'> File Name: tests/hub/test_hub_upload.py</div><div id='m_class'> M Class Name: HubUploadTest</div><div id='n_method'> N Class Name: HubUploadTest</div><div id='m_method'> M Method Name: test_upload_without_token(1)</div><div id='n_method'> N Method Name: test_upload_without_token(1)</div><div id='m_parent_class'> M Parent Class: unittest.TestCase</div><div id='n_parent_class'> N Parent Class: unittest.TestCase</div><div id='m_file'> M File Name: tests/hub/test_hub_upload.py</div><div id='n_file'> N File Name: tests/hub/test_hub_upload.py</div><div id='m_start'> M Start Line: 122</div><div id='m_end'> M End Line: 142</div><div id='n_start'> N Start Line: 126</div><div id='n_end'> N End Line: 133</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
    def test_write_config_file(self):
        model_config = ModelConfig.create_from_dictionary(self._model_config)
        model_output_path = os.path.abspath(&quot./model_config&quot)
        <a id="change">shutil.rmtree(</a>model_output_path<a id="change">, ignore_errors=True)</a>

        os.mkdir(model_output_path)

        model_output_path = os.path.abspath(model_output_path)</code></pre><h3>After Change</h3><pre><code class='java'>
        mock_model_config = MockModelConfig()
        mock_model_config.start()
        &#47&#47 Write the model config to output
        <a id="change">with patch</a><a id="change">(&quotmodel_analyzer.triton.model.model_config.open&quot,
                   mock_open()) as mocked_file:
            </a>model_config.write_config_to_file(model_output_path)
            content = mocked_file().write.call_args.args[0]
        mock_model_config.stop()
</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/triton-inference-server/model_analyzer/commit/a4a6ea24a86f6d853076a7e524ad96b6ad6ec483#diff-d09b997828c12df73c948b50f5c5eb23da56e15f27674fb6a0ba57db94e1a688L97' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 34187232</div><div id='project'> Project Name: triton-inference-server/model_analyzer</div><div id='commit'> Commit Name: a4a6ea24a86f6d853076a7e524ad96b6ad6ec483</div><div id='time'> Time: 2021-02-26</div><div id='author'> Author: itabrizian@nvidia.com</div><div id='file'> File Name: tests/test_model_config.py</div><div id='m_class'> M Class Name: TestModelConfig</div><div id='n_method'> N Class Name: TestModelConfig</div><div id='m_method'> M Method Name: test_write_config_file(1)</div><div id='n_method'> N Method Name: test_write_config_file(1)</div><div id='m_parent_class'> M Parent Class: trc.TestResultCollector</div><div id='n_parent_class'> N Parent Class: trc.TestResultCollector</div><div id='m_file'> M File Name: tests/test_model_config.py</div><div id='n_file'> N File Name: tests/test_model_config.py</div><div id='m_start'> M Start Line: 99</div><div id='m_end'> M End Line: 120</div><div id='n_start'> N Start Line: 101</div><div id='n_end'> N End Line: 128</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>

        finally:
            &#47&#47 Clean up the temporary build files
            <a id="change">fileio.rmtree(</a>config_path<a id="change">)</a>

        run.display_name = run_name
        run.wait_for_completion(show_output=True)
</code></pre><h3>After Change</h3><pre><code class='java'>
        )

        source_directory = get_source_root_path()
        <a id="change">with _include_active_profile</a><a id="change">(
            build_context_root=source_directory,
            load_config_path=PurePosixPath(
                f"./{DOCKER_IMAGE_ZENML_CONFIG_DIR}"
            ),
        ):
            </a>environment = self._prepare_environment(
                workspace=workspace,
                docker_configuration=docker_configuration,
                run_name=run_name,</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/maiot-io/zenml/commit/f442d1092dc244a90a6bc1336b584f562628409f#diff-f2aa734c08d37132621362938b5b01eff8ffd6a798f5428ec2637624b983d9f2L173' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 34187234</div><div id='project'> Project Name: maiot-io/zenml</div><div id='commit'> Commit Name: f442d1092dc244a90a6bc1336b584f562628409f</div><div id='time'> Time: 2022-08-12</div><div id='author'> Author: schustmi@users.noreply.github.com</div><div id='file'> File Name: src/zenml/integrations/azure/step_operators/azureml_step_operator.py</div><div id='m_class'> M Class Name: AzureMLStepOperator</div><div id='n_method'> N Class Name: AzureMLStepOperator</div><div id='m_method'> M Method Name: launch(6)</div><div id='n_method'> N Method Name: launch(6)</div><div id='m_parent_class'> M Parent Class: BaseStepOperator,PipelineDockerImageBuilder</div><div id='n_parent_class'> N Parent Class: BaseStepOperator</div><div id='m_file'> M File Name: src/zenml/integrations/azure/step_operators/azureml_step_operator.py</div><div id='n_file'> N File Name: src/zenml/integrations/azure/step_operators/azureml_step_operator.py</div><div id='m_start'> M Start Line: 177</div><div id='m_end'> M End Line: 249</div><div id='n_start'> N Start Line: 208</div><div id='n_end'> N End Line: 291</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
    hit_info = index.search(query_embedding)
    assert np.array_equal(hit_info.index.to_numpy(), np.array([2, 1, 3]))
    assert np.array_equal(hit_info["id"].array, np.array([0, 1, 2]))
    <a id="change">shutil.rmtree(</a>index_save_dir<a id="change">)</a>
</code></pre><h3>After Change</h3><pre><code class='java'>


def perform_index_tests(index_type: Type):
    <a id="change">with tempfile</a><a id="change">.TemporaryDirectory() as f:
        </a>index_name = "test_index"
        index_save_dir = f
        index = index_type(name=index_name)
        index.add(index_embeddings, metadata)</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/astrazeneca/kazu/commit/51152c76df9d6ccedb6dae1697cced285de43ae7#diff-4687fea8c550a6a5d67eb180e5425746de16998db87817418e43f3694d76c295L51' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 34187236</div><div id='project'> Project Name: astrazeneca/kazu</div><div id='commit'> Commit Name: 51152c76df9d6ccedb6dae1697cced285de43ae7</div><div id='time'> Time: 2021-12-13</div><div id='author'> Author: richard.jackson4@astrazeneca.com</div><div id='file'> File Name: azner/tests/test_embedding_index.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: perform_index_tests(1)</div><div id='n_method'> N Method Name: perform_index_tests(1)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: azner/tests/test_embedding_index.py</div><div id='n_file'> N File Name: azner/tests/test_embedding_index.py</div><div id='m_start'> M Start Line: 52</div><div id='m_end'> M End Line: 72</div><div id='n_start'> N Start Line: 55</div><div id='n_end'> N End Line: 73</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
                model_dir=self.repo_path, clone_from=self.create_model_name)
            assert os.path.exists(
                os.path.join(self.repo_path, &quotconfiguration.json&quot))
            <a id="change">shutil.rmtree(</a>self.repo_path<a id="change">, ignore_errors=True)</a>


if __name__ == &quot__main__&quot:
    unittest.main()</code></pre><h3>After Change</h3><pre><code class='java'>
    def test_upload_invalid_repo(self):
        logger.info(&quottest upload to invalid repo!&quot)
        self.api.login(TEST_ACCESS_TOKEN1)
        <a id="change">with self</a><a id="change">.assertRaises(HTTPError):
            </a>upload_folder(
                model_id=&quot%s/%s&quot % (&quotspeech_tts&quot, &quotinvalid_model_test&quot),
                model_dir=self.finetune_path,
                visibility=ModelVisibility.PUBLIC,</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/modelscope/modelscope/commit/87b4a52b3c22446a2265cdf90500b6655497bfd7#diff-0e7577c3dab699120263b8afe9682a98199b2efa113f618d2b80aa0bcd7f6434L143' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 34187238</div><div id='project'> Project Name: modelscope/modelscope</div><div id='commit'> Commit Name: 87b4a52b3c22446a2265cdf90500b6655497bfd7</div><div id='time'> Time: 2022-10-19</div><div id='author'> Author: jiaqi.sjq@alibaba-inc.com</div><div id='file'> File Name: tests/hub/test_hub_upload.py</div><div id='m_class'> M Class Name: HubUploadTest</div><div id='n_method'> N Class Name: HubUploadTest</div><div id='m_method'> M Method Name: test_upload_invalid_repo(1)</div><div id='n_method'> N Method Name: test_upload_invalid_repo(1)</div><div id='m_parent_class'> M Parent Class: unittest.TestCase</div><div id='n_parent_class'> N Parent Class: unittest.TestCase</div><div id='m_file'> M File Name: tests/hub/test_hub_upload.py</div><div id='n_file'> N File Name: tests/hub/test_hub_upload.py</div><div id='m_start'> M Start Line: 146</div><div id='m_end'> M End Line: 165</div><div id='n_start'> N Start Line: 137</div><div id='n_end'> N End Line: 144</div><BR>