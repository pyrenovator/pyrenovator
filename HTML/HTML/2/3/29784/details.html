<html><h3>Pattern ID :29784
</h3><img src='88143034.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>

    train_running_loss /= loss_count
    writer.add_scalar(&quottrain_loss&quot, train_running_loss, step=epoch)
    <a id="change">return </a>train_running_loss


def val_epoch(model, val_loader, epoch, criterion, tokenizer):</code></pre><h3>After Change</h3><pre><code class='java'>
        optimizer.zero_grad()

        tgt_out = tgt[:, 1:]  &#47&#47 N T-1
        loss<a id="change"> = </a><a id="change">loss_fn(</a>logits.reshape(-1, logits.shape[-1]), tgt_out.reshape(-1)<a id="change">)</a>
        loss.backward()

        optimizer.step()
        losses += loss.item()</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 4</div><BR><div id='size'>Non-data size: 3</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/kamino666/video-captioning-transformer/commit/6560c19b1b21061f61b9959ba32fbc20aa4d44a0#diff-ed183d67207df065a11e1289f19d34cc2abbc5448dea952683cfe9728c342b95L53' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 88143034</div><div id='project'> Project Name: kamino666/video-captioning-transformer</div><div id='commit'> Commit Name: 6560c19b1b21061f61b9959ba32fbc20aa4d44a0</div><div id='time'> Time: 2021-10-01</div><div id='author'> Author: 516015417@qq.com</div><div id='file'> File Name: train.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: train_epoch(3)</div><div id='n_method'> N Method Name: train_epoch(6)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: train.py</div><div id='n_file'> N File Name: train.py</div><div id='m_start'> M Start Line: 128</div><div id='m_end'> M End Line: 151</div><div id='n_start'> N Start Line: 53</div><div id='n_end'> N End Line: 79</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
    pred_model.train()

    mean_loss = sum(val_total_loss) / len(val_total_loss)
    <a id="change">return </a>mean_loss

def synpick_seg_train_augmentation():
    train_transform = [</code></pre><h3>After Change</h3><pre><code class='java'>
            for (name, use_full_input, _, loss_fn) in losses:
                pred = predictions_full if use_full_input else predictions
                real = targets_full if use_full_input else targets
                loss<a id="change"> = </a><a id="change">loss_fn(</a>pred, real<a id="change">)</a>.item()
                total_losses[name].append(loss)

    pred_model.train()</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/ais-bonn/vp-suite/commit/7b2115f43c7b9b0ecf644451be9befcb6de23f7b#diff-09d0cbaf891d623ac245ccf84485a687b554217349ca55557c60b33234b969aeL229' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 88143036</div><div id='project'> Project Name: ais-bonn/vp-suite</div><div id='commit'> Commit Name: 7b2115f43c7b9b0ecf644451be9befcb6de23f7b</div><div id='time'> Time: 2021-07-21</div><div id='author'> Author: boltres@ais.uni-bonn.de</div><div id='file'> File Name: utils.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: validate_video_model(6)</div><div id='n_method'> N Method Name: validate_video_model(7)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: utils.py</div><div id='n_file'> N File Name: utils.py</div><div id='m_start'> M Start Line: 229</div><div id='m_end'> M End Line: 246</div><div id='n_start'> N Start Line: 211</div><div id='n_end'> N End Line: 234</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        assert not (self.training and x.shape[0] == 1), &quotyou must have greater than 1 sample when training, due to the batchnorm in the projection layer&quot

        if return_embedding:
            <a id="change">return </a>self.online_encoder(x, return_projection = return_projection)

        image_one, image_two = self.augment1(x), self.augment2(x)
</code></pre><h3>After Change</h3><pre><code class='java'>
            target_proj_one.detach_()
            target_proj_two.detach_()

        loss_one<a id="change"> = </a><a id="change">loss_fn(</a>online_pred_one, target_proj_two<a id="change">)</a>
        loss_two = loss_fn(online_pred_two, target_proj_one)

        loss = loss_one + loss_two
        return loss.mean()</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/lucidrains/x-clip/commit/8cb8fed44fd862d43abaf1ddd94ffafe3b544968#diff-735e9b22ae386b402e2f3744d9efa9cf30cd889429cd1989bdff6bca97e288f1L219' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 88143038</div><div id='project'> Project Name: lucidrains/x-clip</div><div id='commit'> Commit Name: 8cb8fed44fd862d43abaf1ddd94ffafe3b544968</div><div id='time'> Time: 2021-12-24</div><div id='author'> Author: lucidrains@gmail.com</div><div id='file'> File Name: x_clip/visual_ssl.py</div><div id='m_class'> M Class Name: SimSiam</div><div id='n_method'> N Class Name: SimSiam</div><div id='m_method'> M Method Name: forward(2)</div><div id='n_method'> N Method Name: forward(4)</div><div id='m_parent_class'> M Parent Class: nn.Module</div><div id='n_parent_class'> N Parent Class: nn.Module</div><div id='m_file'> M File Name: x_clip/visual_ssl.py</div><div id='n_file'> N File Name: x_clip/visual_ssl.py</div><div id='m_start'> M Start Line: 220</div><div id='m_end'> M End Line: 246</div><div id='n_start'> N Start Line: 222</div><div id='n_end'> N End Line: 241</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
    &#47&#47 0.5 * sum(1 + log(sigma^2) - mu^2 - sigma^2)
    KLD = -0.5 * torch.sum(1 + logvar - mu.pow(2) - logvar.exp())

    <a id="change">return </a>BCE + KLD
</code></pre><h3>After Change</h3><pre><code class='java'>
lm = 1e-5
def vae_loss(recon_x, mu, logvar, x):
    loss_fn = MSELoss()
    loss_recon<a id="change"> = </a><a id="change">loss_fn(</a>recon_x, x<a id="change">)</a>
    kl_divergence = torch.mean(-0.5 * torch.sum(1 + logvar - mu.pow(2) - logvar.exp()))
    return loss_recon
</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/deeperlearner/pytorch-template/commit/576d9f329d45ddf4af2b320655eb909c48d5cb34#diff-5ea2db96a36360fc43da9b22eaf6dcb593b698b98e6bf32ebfdef3a7589dd912L11' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 88143039</div><div id='project'> Project Name: deeperlearner/pytorch-template</div><div id='commit'> Commit Name: 576d9f329d45ddf4af2b320655eb909c48d5cb34</div><div id='time'> Time: 2020-11-24</div><div id='author'> Author: b04202035@g.ntu.edu.tw</div><div id='file'> File Name: model/loss.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: vae_loss(4)</div><div id='n_method'> N Method Name: vae_loss(4)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: model/loss.py</div><div id='n_file'> N File Name: model/loss.py</div><div id='m_start'> M Start Line: 12</div><div id='m_end'> M End Line: 20</div><div id='n_start'> N Start Line: 13</div><div id='n_end'> N End Line: 16</div><BR>