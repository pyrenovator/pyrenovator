<html><h3>Pattern ID :4017
</h3><img src='15011494.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
    &#47&#47 symmetrize
    &#47&#47 TODO: should we add self-links
    &#47&#47 adj = (adj + adj.transpose() + scipy.sparse.eye(m=adj.shape[0], format="coo")).tocsr()
    adj<a id="change"> = </a>(adj + <a id="change">adj.transpose()</a>).tocsr()
    &#47&#47 degree for adjacency normalization
    degree_inv = numpy.reciprocal(numpy.asarray(adj.sum(axis=0), dtype=float))[0]
    n = degree_inv.shape[0]</code></pre><h3>After Change</h3><pre><code class='java'>
        x0 = numpy.full(shape=(n,), fill_value=1.0 / n)
    else:
        numpy.testing.assert_allclose(x0.sum(axis=0), 1.0)
        <a id="change">assert </a>(x0 &gt;= 0.0).all()
        assert (x0 &lt;= 1.0).all()

    &#47&#47 power iteration</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 5</div><BR><div id='size'>Non-data size: 3</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/pykeen/pykeen/commit/f47ee602573c87f6dace277ff656d2b12eeb5430#diff-c572e1b7b248efe1c0d5781076816c2275de196a24f158a964ebd0dd00b6ac88L21' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 15011494</div><div id='project'> Project Name: pykeen/pykeen</div><div id='commit'> Commit Name: f47ee602573c87f6dace277ff656d2b12eeb5430</div><div id='time'> Time: 2022-04-16</div><div id='author'> Author: berrendorf@dbs.ifi.lmu.de</div><div id='file'> File Name: src/pykeen/nn/node_piece/utils.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: page_rank(7)</div><div id='n_method'> N Method Name: page_rank(4)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: src/pykeen/nn/node_piece/utils.py</div><div id='n_file'> N File Name: src/pykeen/nn/node_piece/utils.py</div><div id='m_start'> M Start Line: 21</div><div id='m_end'> M End Line: 59</div><div id='n_start'> N Start Line: 22</div><div id='n_end'> N End Line: 83</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
    assert isinstance(image_raw, numpy.ndarray)

    image_raw = image_raw[:224, :224].astype(numpy.float32) / 255
    image_raw = numpy.expand_dims(<a id="change">numpy.transpose(</a>image_raw, (2, 0, 1)<a id="change">)</a>, 0)
    image_raw<a id="change"> = </a>numpy.ascontiguousarray(image_raw)
    assert image_raw.shape == (1, 3, 224, 224)
    assert image_raw.dtype == numpy.float32
</code></pre><h3>After Change</h3><pre><code class='java'>
    assert isinstance(pipeline, CustomTaskPipeline)

    assert pipeline.input_schema == object
    <a id="change">assert </a>pipeline.output_schema == object
    assert pipeline.process_inputs(1.2345) == 1.2345
    assert pipeline.process_engine_outputs([1.2345], asdf=True) == [1.2345]
</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/neuralmagic/deepsparse/commit/06c45eb10b3aa6932d8786f34ca3187f760d87ff#diff-e61011742e54887307b8eab6487d8011a74247dfdd61cbdf784a99513a534eb7L61' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 15011489</div><div id='project'> Project Name: neuralmagic/deepsparse</div><div id='commit'> Commit Name: 06c45eb10b3aa6932d8786f34ca3187f760d87ff</div><div id='time'> Time: 2022-08-05</div><div id='author'> Author: 109536191+corey-nm@users.noreply.github.com</div><div id='file'> File Name: tests/deepsparse/pipelines/test_custom_pipeline.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: test_no_input_call(1)</div><div id='n_method'> N Method Name: test_no_input_call(0)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: tests/deepsparse/pipelines/test_custom_pipeline.py</div><div id='n_file'> N File Name: tests/deepsparse/pipelines/test_custom_pipeline.py</div><div id='m_start'> M Start Line: 62</div><div id='m_end'> M End Line: 82</div><div id='n_start'> N Start Line: 58</div><div id='n_end'> N End Line: 67</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
    &#47&#47 Correct:
    M = np.zeros((m,m))
    M[np.tril_indices(m,k=-1)] = vec
    M<a id="change">= </a><a id="change">M.transpose()</a>
    M[np.tril_indices(m,k=-1)] = vec
    return M
</code></pre><h3>After Change</h3><pre><code class='java'>
    
    &#47&#47 Correct:

    <a id="change">assert </a>vec.shape[0] == m * (m - 1) / 2, "vec must be of length m*(m-1)/2 i.e. it does not contain the diagonal entries"
    
    M = np.zeros((m, m))
    M[np.tril_indices(m, k=-1)] = vec</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/basiralab/dgn/commit/6ef504ceee8b5fa89782660430adae78eabd564c#diff-38a8c5358d8bcad31aafbfd0c7db8c8edeb23a4b2162eb9e835438d204a20913L67' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 15011471</div><div id='project'> Project Name: basiralab/dgn</div><div id='commit'> Commit Name: 6ef504ceee8b5fa89782660430adae78eabd564c</div><div id='time'> Time: 2022-06-06</div><div id='author'> Author: furkan2pala@gmail.com</div><div id='file'> File Name: helper.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: antiVectorize(2)</div><div id='n_method'> N Method Name: antiVectorize(2)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: helper.py</div><div id='n_file'> N File Name: helper.py</div><div id='m_start'> M Start Line: 77</div><div id='m_end'> M End Line: 79</div><div id='n_start'> N Start Line: 80</div><div id='n_end'> N End Line: 84</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
            raise ValueError(f"PatchEmbed module. Input image width ({W}) doesn&quott match model ({self.img_size[1]}).")
        x = self.proj(x)
        if self.flatten:
            x<a id="change"> = </a><a id="change">x.flatten(2).transpose(</a>1, 2<a id="change">)</a>  &#47&#47 BCHW -&gt; BNC
        x = self.norm(x)
        return x</code></pre><h3>After Change</h3><pre><code class='java'>
    def forward(self, x):
        B, C, H, W = x.shape
        &#47&#47 FIXME look at relaxing size constraints
        <a id="change">assert </a>H == self.img_size[0] and W == self.img_size[1], \
            f"Input image size ({H}*{W}) doesn&quott match model ({self.img_size[0]}*{self.img_size[1]})."
        x = self.proj(x).flatten(2).transpose(1, 2)  &#47&#47 B Ph*Pw C
        if self.norm is not None:</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/eora-ai/torchok/commit/ab2534f05b48a529d03f8c28af2579245772f4e0#diff-8ea48274a2159a0abc4b0425f2fb246399f29a78d6a46d98cdbda118b48a4195L28' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 15011487</div><div id='project'> Project Name: eora-ai/torchok</div><div id='commit'> Commit Name: ab2534f05b48a529d03f8c28af2579245772f4e0</div><div id='time'> Time: 2022-07-11</div><div id='author'> Author: rashit.bayazitov.1995@gmail.com</div><div id='file'> File Name: src/models/modules/blocks/patch_embedding.py</div><div id='m_class'> M Class Name: PatchEmbed</div><div id='n_method'> N Class Name: PatchEmbed</div><div id='m_method'> M Method Name: forward(2)</div><div id='n_method'> N Method Name: forward(2)</div><div id='m_parent_class'> M Parent Class: nn.Module</div><div id='n_parent_class'> N Parent Class: nn.Module</div><div id='m_file'> M File Name: src/models/modules/blocks/patch_embedding.py</div><div id='n_file'> N File Name: src/models/modules/blocks/patch_embedding.py</div><div id='m_start'> M Start Line: 30</div><div id='m_end'> M End Line: 37</div><div id='n_start'> N Start Line: 50</div><div id='n_end'> N End Line: 55</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
    f = fun(p)
    j = jac_fun(p)
    g = torch.bmm(j.transpose(-2, -1), f[..., None])[..., 0]
    H<a id="change"> = </a>torch.bmm(<a id="change">j.transpose(</a>-2, -1<a id="change">)</a>, j)
    p_list = [p]
    while len(p_list) &lt; max_iter:
        h = -l*torch.linalg.lstsq(H, g, rcond=None, driver=None)[0]&#47&#47-l*torch.bmm(torch.pinverse(H), g)[..., 0]&#47&#47</code></pre><h3>After Change</h3><pre><code class='java'>
    assert len(f.shape) == 3, &quotresidual tensor is supposed to have 3 dims&quot

    j = jac_fun(p)
    <a id="change">assert </a>len(j.shape) == 4, &quotjacobian tensor is supposed to have 4 dims&quot

    &#47&#47 use weights of ones as default
    wvec = torch.ones(f.shape[1], dtype=p.dtype, device=p.device) if wvec is None else wvec</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/hahnec/torchimize/commit/71d4a553c258e912862f87311fc88cd5cadb49d1#diff-c05188355c6af07b8a965d6cc795d0ed247203d3ff12709891e7696864af4005L6' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 15011496</div><div id='project'> Project Name: hahnec/torchimize</div><div id='commit'> Commit Name: 71d4a553c258e912862f87311fc88cd5cadb49d1</div><div id='time'> Time: 2022-05-16</div><div id='author'> Author: christopher.hahne@unibe.ch</div><div id='file'> File Name: torchimize/functions/gna_fun_parallel.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: lsq_gna_parallel(10)</div><div id='n_method'> N Method Name: lsq_gna_parallel(9)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: torchimize/functions/gna_fun_parallel.py</div><div id='n_file'> N File Name: torchimize/functions/gna_fun_parallel.py</div><div id='m_start'> M Start Line: 43</div><div id='m_end'> M End Line: 56</div><div id='n_start'> N Start Line: 12</div><div id='n_end'> N End Line: 73</div><BR>