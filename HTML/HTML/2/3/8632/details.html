<html><h3>Pattern ID :8632
</h3><img src='29995249.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
                    tbr_h = cfmt.punc_rect(char)[0].height()
            elif char_idx - num_lspaces &lt; blk_text_len:
                cfmt = self.get_char_fontfmt(block_no, char_idx - num_lspaces)
                tbr_h = <a id="change">cfmt.tbr.height()</a>
                space_w = cfmt.space_width
            
            if num_lspaces == 0 and tbr_h != 0:
                ntw = line.naturalTextWidth()</code></pre><h3>After Change</h3><pre><code class='java'>
                        tbr_h = tbr.height() + cfmt.font_metrics.descent()
            elif char_idx - num_lspaces &lt; blk_text_len:
                cfmt = self.get_char_fontfmt(block_no, char_idx - num_lspaces)
                tbr_h = <a id="change">cfmt.tbr.height() + </a>cfmt.font_metrics.descent()
                space_w = cfmt.space_width
            
            if num_lspaces == 0 and tbr_h != 0:</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 4</div><BR><div id='size'>Non-data size: 3</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/dmmaze/ballonstranslator/commit/eab989632c95aef750234d6d12c634e58acccd8b#diff-2280c33c620559afa2066016e28328873ed99c20b268e5a461f2eb9fdc1fb67cL420' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 29995249</div><div id='project'> Project Name: dmmaze/ballonstranslator</div><div id='commit'> Commit Name: eab989632c95aef750234d6d12c634e58acccd8b</div><div id='time'> Time: 2022-08-29</div><div id='author'> Author: beneathlimbo@gmail.com</div><div id='file'> File Name: ballontranslator/ui/scene_textlayout.py</div><div id='m_class'> M Class Name: VerticalTextDocumentLayout</div><div id='n_method'> N Class Name: VerticalTextDocumentLayout</div><div id='m_method'> M Method Name: layoutBlock(2)</div><div id='n_method'> N Method Name: layoutBlock(2)</div><div id='m_parent_class'> M Parent Class: SceneTextLayout</div><div id='n_parent_class'> N Parent Class: SceneTextLayout</div><div id='m_file'> M File Name: ballontranslator/ui/scene_textlayout.py</div><div id='n_file'> N File Name: ballontranslator/ui/scene_textlayout.py</div><div id='m_start'> M Start Line: 420</div><div id='m_end'> M End Line: 476</div><div id='n_start'> N Start Line: 454</div><div id='n_end'> N End Line: 514</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
			y += spacing_y + y_offset
			if y + font_size &gt; y2 and j + 1 &lt; len(lines) :
				break
			if y &gt; <a id="change">cur_line_bbox.height()</a> + y1 + font_size * 2 and j + 1 &lt; len(lines) :
				break
		x -= spacing_x + font_size
		j += 1</code></pre><h3>After Change</h3><pre><code class='java'>
			y += spacing_y + y_offset
			if y + font_size &gt; y2 :
				break
			if y &gt; <a id="change">cur_line_bbox.height() * mag_ratio + </a>y1 + font_size * 2 and j + 1 &lt; len(lines) :
				break
		x -= spacing_x + font_size
		j += 1</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/zyddnys/manga-image-translator/commit/605e7ecd9cf3b0a00b67fab40020c269a7bea4a3#diff-a00d57a134f11bad95204dec4abd6df6ae878f21b5826d1211aa9e4570e77203L253' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 29995248</div><div id='project'> Project Name: zyddnys/manga-image-translator</div><div id='commit'> Commit Name: 605e7ecd9cf3b0a00b67fab40020c269a7bea4a3</div><div id='time'> Time: 2021-07-26</div><div id='author'> Author: zyddnys@outlook.com</div><div id='file'> File Name: text_render.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: put_text_vertical(13)</div><div id='n_method'> N Method Name: put_text_vertical(11)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: text_render.py</div><div id='n_file'> N File Name: text_render.py</div><div id='m_start'> M Start Line: 256</div><div id='m_end'> M End Line: 289</div><div id='n_start'> N Start Line: 264</div><div id='n_end'> N End Line: 304</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
                    else:
                        tbr, br = cfmt.punc_rect(char)
                        tbr_h = tbr.height() + cfmt.font_metrics.descent()
                    tbr_h += <a id="change">cfmt.tbr.height()</a> * (ls - 1)
            elif char_idx - num_lspaces &lt; blk_text_len:
                cfmt = self.get_char_fontfmt(block_no, char_idx - num_lspaces)
                tbr_h = cfmt.tbr.height() + cfmt.font_metrics.descent()</code></pre><h3>After Change</h3><pre><code class='java'>
            if char_idx &lt; blk_text_len:
                cfmt = self.get_char_fontfmt(block_no, char_idx)
                space_w = cfmt.space_width
                let_sp_offset = <a id="change">cfmt.tbr.height()</a> * (ls - 1)
                tbr_h = cfmt.tbr.height() + let_sp_offset
                char = blk_text[char_idx]
                if char in PUNSET_VERNEEDROTATE:
                    tbr, br = cfmt.punc_rect(char)
                    tbr_h = tbr.width()
                    if char.isalpha():
                        cw2 = cfmt.punc_rect(char+char)[1].width()
                        tbr_h = br.width() - (br.width() * 2 - cw2)
                    if char in {&quot…&quot, &quot⋯&quot}:
                        tbr_h = line.naturalTextWidth() - num_lspaces * space_w
                        next_char_idx = char_idx + 1
                        if next_char_idx &lt; blk_text_len and blk_text[next_char_idx] == char:
                            tbr_h -= let_sp_offset
                    tbr_h += let_sp_offset
                elif char in PUNSET_PAUSEORSTOP:
                    if char in {&quot⁇&quot, &quot⁉&quot, &quot⁈&quot, &quot‼&quot}:
                        tbr_h = cfmt.punc_actual_rect(line, char, cache=True)[3]
                    else:
                        tbr, br = cfmt.punc_rect(char)
                        tbr_h = tbr.height() + cfmt.font_metrics.descent()
                    tbr_h += let_sp_offset
            elif char_idx - num_lspaces &lt; blk_text_len:
                cfmt = self.get_char_fontfmt(block_no, char_idx - num_lspaces)
                tbr_h = cfmt.tbr.height() + cfmt.font_metrics.descent()
                space_w = cfmt.space_width
            
            if num_lspaces == 0 and tbr_h != 0:
                ntw = line.naturalTextWidth()
                shifted = ntw - cfmt.br.width()
                available_height = available_height - shifted
                if is_final_block:
                    self.draw_shifted = max(self.draw_shifted, shifted)

            char_yoffset_lst = [line_y_offset]
            for _ in range(num_lspaces):
                char_yoffset_lst.append(min(available_height - tbr_h, char_yoffset_lst[-1] + space_w))
            blk_line_spaces.append([num_rspaces, num_lspaces, char_yoffset_lst, char_idx - num_lspaces])
            
            char_bottom = char_yoffset_lst[-1] + tbr_h
            if char_bottom<a id="change"> - </a>max(let_sp_offset, 0) &gt; available_height:
                &#47&#47 switch to next line
                if char_idx == 0 and layout_first_block:
                    self.min_height = doc_margin + tbr_h</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/dmmaze/ballonstranslator/commit/5227f1ce7092b8b65db8d0cd833050d0e3dc4044#diff-2280c33c620559afa2066016e28328873ed99c20b268e5a461f2eb9fdc1fb67cL438' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 29995251</div><div id='project'> Project Name: dmmaze/ballonstranslator</div><div id='commit'> Commit Name: 5227f1ce7092b8b65db8d0cd833050d0e3dc4044</div><div id='time'> Time: 2022-08-31</div><div id='author'> Author: beneathlimbo@gmail.com</div><div id='file'> File Name: ballontranslator/ui/scene_textlayout.py</div><div id='m_class'> M Class Name: VerticalTextDocumentLayout</div><div id='n_method'> N Class Name: VerticalTextDocumentLayout</div><div id='m_method'> M Method Name: layoutBlock(2)</div><div id='n_method'> N Method Name: layoutBlock(2)</div><div id='m_parent_class'> M Parent Class: SceneTextLayout</div><div id='n_parent_class'> N Parent Class: SceneTextLayout</div><div id='m_file'> M File Name: ballontranslator/ui/scene_textlayout.py</div><div id='n_file'> N File Name: ballontranslator/ui/scene_textlayout.py</div><div id='m_start'> M Start Line: 440</div><div id='m_end'> M End Line: 536</div><div id='n_start'> N Start Line: 490</div><div id='n_end'> N End Line: 535</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
            if char_idx &lt; blk_text_len:
                cfmt = self.get_char_fontfmt(block_no, char_idx)
                space_w = cfmt.space_width
                tbr_h = <a id="change">cfmt.tbr.height()</a>
                char = blk_text[char_idx]
                if char in PUNSET_VERNEEDROTATE:
                    tbr, br = cfmt.punc_rect(char)
                    tbr_h = tbr.width()</code></pre><h3>After Change</h3><pre><code class='java'>
            if char_idx &lt; blk_text_len:
                cfmt = self.get_char_fontfmt(block_no, char_idx)
                space_w = cfmt.space_width
                tbr_h = <a id="change">cfmt.tbr.height() * </a>ls
                char = blk_text[char_idx]
                if char in PUNSET_VERNEEDROTATE:
                    tbr, br = cfmt.punc_rect(char)</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/dmmaze/ballonstranslator/commit/d5815d3063fd4ada9cd992e1777a1a1370673dd6#diff-2280c33c620559afa2066016e28328873ed99c20b268e5a461f2eb9fdc1fb67cL438' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 29995253</div><div id='project'> Project Name: dmmaze/ballonstranslator</div><div id='commit'> Commit Name: d5815d3063fd4ada9cd992e1777a1a1370673dd6</div><div id='time'> Time: 2022-08-29</div><div id='author'> Author: beneathlimbo@gmail.com</div><div id='file'> File Name: ballontranslator/ui/scene_textlayout.py</div><div id='m_class'> M Class Name: VerticalTextDocumentLayout</div><div id='n_method'> N Class Name: VerticalTextDocumentLayout</div><div id='m_method'> M Method Name: layoutBlock(2)</div><div id='n_method'> N Method Name: layoutBlock(2)</div><div id='m_parent_class'> M Parent Class: SceneTextLayout</div><div id='n_parent_class'> N Parent Class: SceneTextLayout</div><div id='m_file'> M File Name: ballontranslator/ui/scene_textlayout.py</div><div id='n_file'> N File Name: ballontranslator/ui/scene_textlayout.py</div><div id='m_start'> M Start Line: 497</div><div id='m_end'> M End Line: 552</div><div id='n_start'> N Start Line: 440</div><div id='n_end'> N End Line: 557</div><BR>