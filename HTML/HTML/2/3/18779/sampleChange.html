<link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
    total_loss = 0
    with experiment.record(name=&quotsynthetic&quot, comment=&quotAdam&quot if is_adam else &quotAMSGrad&quot):
        for i in monit.loop(10_000):
            loss = <a id="change">func(</a>i<a id="change">)</a> - (-1010 + 10 * 100) / 101.
            total_loss += loss.item()
            if (i + 1) % 1000 == 0:
                tracker.save(loss=loss, x=x, regret=total_loss / (i + 1))</code></pre><h3>After Change</h3><pre><code class='java'>
    &#47&#47 Define $x$ parameter
    x = nn.Parameter(torch.tensor([.0]))
    &#47&#47 Optimal, $x^* = -1$
    x_star<a id="change"> = </a>nn.Parameter(torch.tensor([-1]), requires_grad=False)

    def func(t: int, x_: nn.Parameter):
        
        &#47&#47&#47&#47&#47&#47 $f_t(x)$
        
        if t % 101 == 1:
            return (1010 * x_).sum()
        else:
            return (-10 * x_).sum()

    &#47&#47 Initialize the relevant optimizer
    if is_adam:
        optimizer = Adam([x], lr=1e-2, betas=(0.9, 0.99))
    else:
        optimizer = AMSGrad([x], lr=1e-2, betas=(0.9, 0.99))
    &#47&#47 $R(T)$
    total_regret = 0

    from labml import monit, tracker, experiment

    &#47&#47 Create experiment to record results
    with experiment.record(name=&quotsynthetic&quot, comment=&quotAdam&quot if is_adam else &quotAMSGrad&quot):
        &#47&#47 Run for $10^7$ steps
        for step in monit.loop(10_000_000):
            &#47&#47 $f_t(\theta_t) - f_t(\theta^*)$
            regret = func(step, x) - <a id="change">func(</a>step, x_star<a id="change">)</a>
            &#47&#47 $R(T) = \sum_{t=1}^T \big[ f_t(\theta_t) - f_t(\theta^*) \big]$
            total_regret += regret.item()
            &#47&#47 Track results every 1,000 steps
            if (step + 1) % 1000 == 0:</code></pre>