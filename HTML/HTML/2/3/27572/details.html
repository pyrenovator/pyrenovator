<html><h3>Pattern ID :27572
</h3><img src='81928875.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
    def configure_optimizers(self):
        lr = self.hparams.learning_rate
        opt = torch.optim.Adam(self.parameters(),lr=lr, betas=(0.5, 0.9))
        sched<a id="change"> = </a><a id="change">torch.optim.lr_scheduler.ExponentialLR(optimizer = opt, gamma = self.args.lr_decay_rate)</a>
        return [opt], [sched]

    def log_images(self, batch, **kwargs):
        log = dict()</code></pre><h3>After Change</h3><pre><code class='java'>
            )    
            return [opt], [sched]
        else:
            return [opt], <a id="change">[]</a>   

    def log_images(self, batch, **kwargs):
        log = dict()</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 4</div><BR><div id='size'>Non-data size: 3</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/tgisaturday/dalle-lightning/commit/2ecc02819f789cfd0678a253d595e4de76a3eea7#diff-b67cd188cd3cf1c52f61d59aed8f2b04c7f9e750598da4fff7ce728c3f8e3c30L138' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 81928875</div><div id='project'> Project Name: tgisaturday/dalle-lightning</div><div id='commit'> Commit Name: 2ecc02819f789cfd0678a253d595e4de76a3eea7</div><div id='time'> Time: 2021-07-20</div><div id='author'> Author: jamesk1228@gmail.com</div><div id='file'> File Name: pl_dalle/models/vqvae2.py</div><div id='m_class'> M Class Name: VQVAE2</div><div id='n_method'> N Class Name: VQVAE2</div><div id='m_method'> M Method Name: configure_optimizers(1)</div><div id='n_method'> N Method Name: configure_optimizers(1)</div><div id='m_parent_class'> M Parent Class: pl.LightningModule</div><div id='n_parent_class'> N Parent Class: pl.LightningModule</div><div id='m_file'> M File Name: pl_dalle/models/vqvae2.py</div><div id='n_file'> N File Name: pl_dalle/models/vqvae2.py</div><div id='m_start'> M Start Line: 139</div><div id='m_end'> M End Line: 140</div><div id='n_start'> N Start Line: 138</div><div id='n_end'> N End Line: 153</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
    def configure_optimizers(self):
        lr = self.hparams.learning_rate
        opt = torch.optim.Adam(self.parameters(),lr=lr, betas=(0.5, 0.9))
        sched<a id="change"> = </a><a id="change">torch.optim.lr_scheduler.ExponentialLR(optimizer = opt, gamma = self.args.lr_decay_rate)</a>
        return [opt], [sched]

    def get_last_layer(self):
        return self.decoder.conv_out.weight</code></pre><h3>After Change</h3><pre><code class='java'>
            )    
            return [opt], [sched]
        else:
            return [opt], <a id="change">[]</a>   

    def get_last_layer(self):
        return self.decoder.conv_out.weight</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/tgisaturday/dalle-lightning/commit/2ecc02819f789cfd0678a253d595e4de76a3eea7#diff-252827b55d4d2ad5e3244ede005cbd4121185c78f2d3e4ba40f37806b70141f2L99' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 81928872</div><div id='project'> Project Name: tgisaturday/dalle-lightning</div><div id='commit'> Commit Name: 2ecc02819f789cfd0678a253d595e4de76a3eea7</div><div id='time'> Time: 2021-07-20</div><div id='author'> Author: jamesk1228@gmail.com</div><div id='file'> File Name: pl_dalle/models/vqvae.py</div><div id='m_class'> M Class Name: VQVAE</div><div id='n_method'> N Class Name: VQVAE</div><div id='m_method'> M Method Name: configure_optimizers(1)</div><div id='n_method'> N Method Name: configure_optimizers(1)</div><div id='m_parent_class'> M Parent Class: pl.LightningModule</div><div id='n_parent_class'> N Parent Class: pl.LightningModule</div><div id='m_file'> M File Name: pl_dalle/models/vqvae.py</div><div id='n_file'> N File Name: pl_dalle/models/vqvae.py</div><div id='m_start'> M Start Line: 102</div><div id='m_end'> M End Line: 103</div><div id='n_start'> N Start Line: 101</div><div id='n_end'> N End Line: 116</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
            temporary_classifier = Classifier(backbone, num_classes).to(device)
            temporary_optimizer = SGD(temporary_classifier.get_parameters(args.lr), momentum=args.momentum, weight_decay=args.wd, nesterov=True)
            temporary_loader = DataLoader(train_dataset, batch_size=args.batch_size_channel_weight, shuffle=True, num_workers=args.workers, drop_last=False)
            temporary_scheduler<a id="change"> = </a><a id="change">torch.optim.lr_scheduler.ExponentialLR(</a>temporary_optimizer<a id="change">, gamma=math.exp(math.log(0.1) / args.lr_decay_epochs_channel_weight))</a>
            criterion = nn.CrossEntropyLoss()
            calculate_channel_weight(temporary_classifier, criterion, temporary_optimizer, temporary_loader, temporary_scheduler, return_layers, device, args.channel_weight, args)
        channel_weight = get_channel_weight(args.channel_weight, device)</code></pre><h3>After Change</h3><pre><code class='java'>
    else:
        raise NotImplementedError(args.regularization_type)

    head_regularization = L2Regularization(nn.ModuleList(<a id="change">[</a>classifier.head, classifier.bottleneck<a id="change"></a>]))

    &#47&#47 start training
    best_acc1 = 0.0</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/thuml/transfer-learning-library/commit/ce38964ed6fc09262ae95c971acef5a616e106f1#diff-7cdf67761ea39e5e8f0139f0f91c8961a882bb4f95be3331d5cb6f9893799071L33' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 81928873</div><div id='project'> Project Name: thuml/transfer-learning-library</div><div id='commit'> Commit Name: ce38964ed6fc09262ae95c971acef5a616e106f1</div><div id='time'> Time: 2021-03-18</div><div id='author'> Author: 13126830206@163.com</div><div id='file'> File Name: examples-ft/classification/delta.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: main(1)</div><div id='n_method'> N Method Name: main(1)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: examples-ft/classification/delta.py</div><div id='n_file'> N File Name: examples-ft/classification/delta.py</div><div id='m_start'> M Start Line: 34</div><div id='m_end'> M End Line: 147</div><div id='n_start'> N Start Line: 33</div><div id='n_end'> N End Line: 122</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
    self._init_transformation()

    optimizer = torch.optim.SGD([self.A], lr=lr, momentum=momentum)
    scheduler<a id="change"> = </a><a id="change">torch.optim.lr_scheduler.ExponentialLR(</a>optimizer, 0.9<a id="change">)</a>
    iters_per_epoch = int(np.ceil(self.num_train / batch_size))
    i_global = 0
    for epoch in range(self.max_iters):
      rand_idxs = torch.randperm(len(y))  &#47&#47 shuffle dataset</code></pre><h3>After Change</h3><pre><code class='java'>
        optimizer.zero_grad()
        loss = self.loss(X_batch, y_mask)
        loss.backward()
        torch.nn.utils.clip_grad_norm(<a id="change">[</a>self.A<a id="change"></a>], 5)
        optimizer.step()

        i_global += 1</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/kevinzakka/torchnca/commit/ff02f200342254c8f88e121dc8a499950912f0cb#diff-b46cf3cd1147942ab77db5d7e1161ff1d5125e4dab0e7aa13cb519ade667c4c6L108' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 81928877</div><div id='project'> Project Name: kevinzakka/torchnca</div><div id='commit'> Commit Name: ff02f200342254c8f88e121dc8a499950912f0cb</div><div id='time'> Time: 2020-01-28</div><div id='author'> Author: kevinarmandzakka@gmail.com</div><div id='file'> File Name: nca.py</div><div id='m_class'> M Class Name: NCA</div><div id='n_method'> N Class Name: NCA</div><div id='m_method'> M Method Name: train(6)</div><div id='n_method'> N Method Name: train(6)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: nca.py</div><div id='n_file'> N File Name: nca.py</div><div id='m_start'> M Start Line: 125</div><div id='m_end'> M End Line: 156</div><div id='n_start'> N Start Line: 125</div><div id='n_end'> N End Line: 150</div><BR>