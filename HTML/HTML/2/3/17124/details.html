<html><h3>Pattern ID :17124
</h3><img src='57270377.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
        dict_int2lab,
        task="encode",
    )
    lens = <a id="change">(encoded_seq_pieces * encoded_seq_ids.shape[1]).int()</a>
    &#47&#47 decode from torch tensors (batch, batch_lens)
    words_seq = spm(encoded_seq_ids, encoded_seq_pieces, task="decode")
    assert words_seq == gt, "output not the same"
    &#47&#47 decode from a list of bpe sequence (without padding)</code></pre><h3>After Change</h3><pre><code class='java'>
        dict_int2lab,
        task="encode",
    )
    lens = <a id="change">(encoded_seq_pieces * encoded_seq_ids.shape[1]).round().int()</a>
    &#47&#47 decode from torch tensors (batch, batch_lens)
    words_seq = spm(encoded_seq_ids, encoded_seq_pieces, task="decode")
    assert words_seq == gt, "output not the same"
    &#47&#47 decode from a list of bpe sequence (without padding)</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 4</div><BR><div id='size'>Non-data size: 3</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/speechbrain/speechbrain/commit/eb41f8ce9986b698c1c43108127165044455c4e2#diff-b5e01bee214079b521c383707861f0e1b5a6347b05a35d2d6c7fb17ee3bc87b8L31' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 57270377</div><div id='project'> Project Name: speechbrain/speechbrain</div><div id='commit'> Commit Name: eb41f8ce9986b698c1c43108127165044455c4e2</div><div id='time'> Time: 2021-11-19</div><div id='author'> Author: mirco.ravanelli@gmail.com</div><div id='file'> File Name: tests/unittests/test_tokenizer.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: test_tokenizer(0)</div><div id='n_method'> N Method Name: test_tokenizer(0)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: tests/unittests/test_tokenizer.py</div><div id='n_file'> N File Name: tests/unittests/test_tokenizer.py</div><div id='m_start'> M Start Line: 31</div><div id='m_end'> M End Line: 134</div><div id='n_start'> N Start Line: 31</div><div id='n_end'> N End Line: 134</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        See pytorch for &quotmean&quot, &quotsum&quot, &quotnone&quot. The &quotbatch&quot option returns
        one loss per item in the batch, &quotbatchmean&quot returns sum / batch size.
    
    input_lens = <a id="change">(input_lens * log_probs.shape[1]).int()</a>
    target_lens = (target_lens * targets.shape[1]).int()
    log_probs = log_probs.transpose(0, 1)

    if reduction == "batchmean":</code></pre><h3>After Change</h3><pre><code class='java'>
        See pytorch for &quotmean&quot, &quotsum&quot, &quotnone&quot. The &quotbatch&quot option returns
        one loss per item in the batch, &quotbatchmean&quot returns sum / batch size.
    
    input_lens = <a id="change">(input_lens * log_probs.shape[1]).round().int()</a>
    target_lens = (target_lens * targets.shape[1]).round().int()
    log_probs = log_probs.transpose(0, 1)

    if reduction == "batchmean":</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/speechbrain/speechbrain/commit/eb41f8ce9986b698c1c43108127165044455c4e2#diff-dacadc87130a104a9b34b5d369c53e34f52662470ff3e0d91783d3ede95fee82L213' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 57270376</div><div id='project'> Project Name: speechbrain/speechbrain</div><div id='commit'> Commit Name: eb41f8ce9986b698c1c43108127165044455c4e2</div><div id='time'> Time: 2021-11-19</div><div id='author'> Author: mirco.ravanelli@gmail.com</div><div id='file'> File Name: speechbrain/nnet/losses.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: ctc_loss(6)</div><div id='n_method'> N Method Name: ctc_loss(6)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: speechbrain/nnet/losses.py</div><div id='n_file'> N File Name: speechbrain/nnet/losses.py</div><div id='m_start'> M Start Line: 236</div><div id='m_end'> M End Line: 237</div><div id='n_start'> N Start Line: 236</div><div id='n_end'> N End Line: 237</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        &#47&#47 Getting current predictions
        current_pred = predictions[j]

        actual_size = <a id="change">(input_lens[j] * log_probs.shape[1]).int()</a>
        current_pred = current_pred[0:actual_size]
        current_pred = filter_ctc_output(
            list(current_pred.cpu().numpy()), blank_id=blank_index
        )</code></pre><h3>After Change</h3><pre><code class='java'>
        &#47&#47 Getting current predictions
        current_pred = predictions[j]

        actual_size = <a id="change">(input_lens[j] * log_probs.shape[1]).round().int()</a>
        current_pred = current_pred[0:actual_size]
        current_pred = filter_ctc_output(
            list(current_pred.cpu().numpy()), blank_id=blank_index
        )</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/speechbrain/speechbrain/commit/eb41f8ce9986b698c1c43108127165044455c4e2#diff-dacadc87130a104a9b34b5d369c53e34f52662470ff3e0d91783d3ede95fee82L969' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 57270379</div><div id='project'> Project Name: speechbrain/speechbrain</div><div id='commit'> Commit Name: eb41f8ce9986b698c1c43108127165044455c4e2</div><div id='time'> Time: 2021-11-19</div><div id='author'> Author: mirco.ravanelli@gmail.com</div><div id='file'> File Name: speechbrain/nnet/losses.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: ctc_loss_kd(5)</div><div id='n_method'> N Method Name: ctc_loss_kd(5)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: speechbrain/nnet/losses.py</div><div id='n_file'> N File Name: speechbrain/nnet/losses.py</div><div id='m_start'> M Start Line: 998</div><div id='m_end'> M End Line: 1020</div><div id='n_start'> N Start Line: 998</div><div id='n_end'> N End Line: 1020</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
    from speechbrain.nnet.loss.transducer_loss import Transducer

    input_lens = (input_lens * log_probs.shape[1]).int()
    target_lens = <a id="change">(target_lens * targets.shape[1]).int()</a>
    return Transducer.apply(
        log_probs, targets, input_lens, target_lens, blank_index, reduction
    )
</code></pre><h3>After Change</h3><pre><code class='java'>
    from speechbrain.nnet.loss.transducer_loss import Transducer

    input_lens = (input_lens * log_probs.shape[1]).round().int()
    target_lens = <a id="change">(target_lens * targets.shape[1]).round().int()</a>
    return Transducer.apply(
        log_probs, targets, input_lens, target_lens, blank_index, reduction
    )
</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/speechbrain/speechbrain/commit/eb41f8ce9986b698c1c43108127165044455c4e2#diff-dacadc87130a104a9b34b5d369c53e34f52662470ff3e0d91783d3ede95fee82L27' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 57270378</div><div id='project'> Project Name: speechbrain/speechbrain</div><div id='commit'> Commit Name: eb41f8ce9986b698c1c43108127165044455c4e2</div><div id='time'> Time: 2021-11-19</div><div id='author'> Author: mirco.ravanelli@gmail.com</div><div id='file'> File Name: speechbrain/nnet/losses.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: transducer_loss(6)</div><div id='n_method'> N Method Name: transducer_loss(6)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: speechbrain/nnet/losses.py</div><div id='n_file'> N File Name: speechbrain/nnet/losses.py</div><div id='m_start'> M Start Line: 49</div><div id='m_end'> M End Line: 50</div><div id='n_start'> N Start Line: 49</div><div id='n_end'> N End Line: 50</div><BR>