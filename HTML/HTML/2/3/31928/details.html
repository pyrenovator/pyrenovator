<html><h3>Pattern ID :31928
</h3><img src='93368464.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
    while elm is not None:
        &#47&#47 TODO: Quintuplet, tuplet, generalize to `plet`
        if hasattr(elm, &quotfullName&quot) and post in elm.fullName:
            <a id="change">ic(</a>number, &quotprocessing tuplets&quot<a id="change">)</a>
            pref = elm.fullName[:elm.fullName.find(post)].split()[-1]
            tup = f&quot{pref}{post}&quot
            ic(elm.fullName, pref, tup)
            if number == 134:</code></pre><h3>After Change</h3><pre><code class='java'>
            &#47&#47 All triple notes with the same `n_tup` are added
            assert sum(len(tup) for tup in lst[idx_tup_strt:]) == len(elms_tup)
            if not keep_chord:
                tups_new<a id="change"> = </a><a id="change">[]</a>
                has_chord = False
                for i in range(idx_tup_strt, len(lst)):  &#47&#47 Ensure all tuplet groups contain no Chord
                    tup = lst[i]
                    &#47&#47 Bad transcription quality =&gt; Keep all possible tuplet combinations</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 6</div><BR><div id='size'>Non-data size: 3</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/stefanheng/symbolic-music-generation/commit/7d2ebd5026f91738d46d1fc81d377d45420a5df8#diff-d695f4eee85e0c6394143835ebda0f848963d843fb77ab25aefdda75f0df044cL44' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 93368464</div><div id='project'> Project Name: stefanheng/symbolic-music-generation</div><div id='commit'> Commit Name: 7d2ebd5026f91738d46d1fc81d377d45420a5df8</div><div id='time'> Time: 2022-01-31</div><div id='author'> Author: 43276957+SpongeBobBang@users.noreply.github.com</div><div id='file'> File Name: musicnlp/preprocess/music_extractor.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: expand_bar(3)</div><div id='n_method'> N Method Name: expand_bar(3)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: musicnlp/preprocess/music_extractor.py</div><div id='n_file'> N File Name: musicnlp/preprocess/music_extractor.py</div><div id='m_start'> M Start Line: 44</div><div id='m_end'> M End Line: 116</div><div id='n_start'> N Start Line: 44</div><div id='n_end'> N End Line: 141</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
            sign_flip[sign_flip &gt;= 0.5] = 1.0
            sign_flip[sign_flip &lt; 0.5] = -1.0
            eig_vals = eig_vals.unsqueeze(0).repeat(eig_vecs.shape[0], 1)
            <a id="change">ic(</a>eig_vecs<a id="change">)</a>
            return torch.stack([eig_vals, eig_vecs], dim=-1)

    def get_graph(self, idx):
        if idx in self.dgl_graphs:</code></pre><h3>After Change</h3><pre><code class='java'>
            sign_flip[sign_flip &gt;= 0.5] = 1.0
            sign_flip[sign_flip &lt; 0.5] = -1.0
            eig_vals = eig_vals.unsqueeze(0).repeat(eig_vecs.shape[0], 1)
            g.ndata[&quotpos_enc&quot]<a id="change"> = </a>torch.stack(<a id="change">[</a>eig_vals, eig_vecs<a id="change"></a>], dim=-1)
            return g

    def get_san_graph(self, idx):</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/hannesstark/3dinfomax/commit/a165907548f15c7571758457fe0867a83ad049dc#diff-00c0b7d1372a036461dcac2adc1681c64211ebeb68bfa6e067ed803dafb1b4deL40' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 93368469</div><div id='project'> Project Name: hannesstark/3dinfomax</div><div id='commit'> Commit Name: a165907548f15c7571758457fe0867a83ad049dc</div><div id='time'> Time: 2021-07-03</div><div id='author'> Author: hannes.staerk@gmail.com</div><div id='file'> File Name: datasets/ogbg_dataset_extension.py</div><div id='m_class'> M Class Name: OGBGDatsetExtension</div><div id='n_method'> N Class Name: OGBGDatsetExtension</div><div id='m_method'> M Method Name: data_by_type(3)</div><div id='n_method'> N Method Name: data_by_type(3)</div><div id='m_parent_class'> M Parent Class: GraphPropPredDataset</div><div id='n_parent_class'> N Parent Class: GraphPropPredDataset</div><div id='m_file'> M File Name: datasets/ogbg_dataset_extension.py</div><div id='n_file'> N File Name: datasets/ogbg_dataset_extension.py</div><div id='m_start'> M Start Line: 50</div><div id='m_end'> M End Line: 55</div><div id='n_start'> N Start Line: 53</div><div id='n_end'> N End Line: 66</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        for i in range(self.num_conformers - 1):
            conformer_graph = copy.deepcopy(batched_graph)
            ic(conformer_graph.number_of_nodes())
            <a id="change">ic(</a>i<a id="change">)</a>
            ic(i + 3)
            conformer_graph.ndata[&quotx&quot] = conformers[i:i + 3]
            conformer_graphs.append(conformer_graph)
        batched_graph3d = dgl.batch(graphs3d)</code></pre><h3>After Change</h3><pre><code class='java'>
        graphs, graphs3d, conformers, *targets = map(list, zip(*batch))
        conformers = torch.cat(conformers, dim=0)
        batched_graph3d = dgl.batch(graphs3d)
        conformer_graphs<a id="change"> = </a><a id="change">[</a>batched_graph3d<a id="change"></a>]
        for i in range(1, self.num_conformers):
            conformer_graph = copy.deepcopy(batched_graph3d)
            conformer_graph.ndata[&quotx&quot] = conformers[:, i * 3:(i + 1) * 3]</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/hannesstark/3dinfomax/commit/d90f479e30d373c31eabebd699666ec3b9101c3a#diff-05aa1678959c1615a4d795dcd1309cd5caf14d534d725cbbff89efefc4a4587fL62' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 93368470</div><div id='project'> Project Name: hannesstark/3dinfomax</div><div id='commit'> Commit Name: d90f479e30d373c31eabebd699666ec3b9101c3a</div><div id='time'> Time: 2021-06-18</div><div id='author'> Author: hannes.staerk@gmail.com</div><div id='file'> File Name: datasets/custom_collate.py</div><div id='m_class'> M Class Name: ConformerCollate</div><div id='n_method'> N Class Name: ConformerCollate</div><div id='m_method'> M Method Name: __call__(2)</div><div id='n_method'> N Method Name: __call__(2)</div><div id='m_parent_class'> M Parent Class: object</div><div id='n_parent_class'> N Parent Class: object</div><div id='m_file'> M File Name: datasets/custom_collate.py</div><div id='n_file'> N File Name: datasets/custom_collate.py</div><div id='m_start'> M Start Line: 64</div><div id='m_end'> M End Line: 80</div><div id='n_start'> N Start Line: 65</div><div id='n_end'> N End Line: 77</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        elif exp == &quotsymbol&quot:
            &#47&#47 Per `music21`, duration is represented in terms of quarter notes
            slot_dur = int(2**-2 / 2**-self.prec)  &#47&#47 Duration of a time slot
            <a id="change">ic(</a>slot_dur<a id="change">)</a>

            &#47&#47 Get signature for each bar
            bars = iter(list(part[m21.stream.Measure]))
            bar0 = next(bars)</code></pre><h3>After Change</h3><pre><code class='java'>
                    ts = next(iter(ts_))
                lst_bar_n_ts.append((bar, ts))

            encs<a id="change"> = </a><a id="change">[]</a>
            for i, (bar, ts) in enumerate(lst_bar_n_ts):
                ic(bar.number)
                MxlMelodyExtractor.BarEnc(bar, ts, self.prec)
                &#47&#47 if i == 2:  &#47&#47 TODO: debug</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/stefanheng/symbolic-music-generation/commit/5b9b53154362b7919f6a530495251afd4ec735b3#diff-9bddc1ec410935c3b7e65a0e53b587a68e1dda58d8f63e4abcaf788573ad9f27L424' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 93368472</div><div id='project'> Project Name: stefanheng/symbolic-music-generation</div><div id='commit'> Commit Name: 5b9b53154362b7919f6a530495251afd4ec735b3</div><div id='time'> Time: 2021-12-18</div><div id='author'> Author: 43276957+SpongeBobBang@users.noreply.github.com</div><div id='file'> File Name: melody_extractor.py</div><div id='m_class'> M Class Name: MxlMelodyExtractor</div><div id='n_method'> N Class Name: MxlMelodyExtractor</div><div id='m_method'> M Method Name: bar_with_max_pitch(2)</div><div id='n_method'> N Method Name: bar_with_max_pitch(2)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: melody_extractor.py</div><div id='n_file'> N File Name: melody_extractor.py</div><div id='m_start'> M Start Line: 475</div><div id='m_end'> M End Line: 490</div><div id='n_start'> N Start Line: 486</div><div id='n_end'> N End Line: 498</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        pos_enc = self.pos_enc_mlp(pos_enc) &#47&#47 [batch_size, max_num_atoms, num_eigvec, pos_enc_dim]
        pos_enc = pos_enc.sum(dim=2) &#47&#47 [batch_size, max_num_atoms, pos_enc_dim]
        ic(h.shape)
        <a id="change">ic(</a>pos_enc.shape<a id="change">)</a>
        h = torch.cat([h,pos_enc], dim = -1 ) &#47&#47 [batch_size, max_num_atoms, hidden_dim]
        h_in = h

        for mp_layer in self.mp_layers:</code></pre><h3>After Change</h3><pre><code class='java'>
        h = torch.cat([h, pos_enc], dim=-1)  &#47&#47 [batch_size, max_num_atoms, hidden_dim]

        &#47&#47 add virtual node for readout
        h<a id="change"> = </a>torch.cat(<a id="change">[</a>self.v_node[None, None, :].expand(batch_size, -1, -1), h<a id="change"></a>], dim=1)&#47&#47 [batch_size, max_num_atoms + 1, hidden_dim]

        mask = torch.cat([torch.tensor(False, device=h.device).unsqueeze(0).expand(batch_size, -1), mask], dim=1)&#47&#47 [batch_size, max_num_atoms + 1]
</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/hannesstark/3dinfomax/commit/a165907548f15c7571758457fe0867a83ad049dc#diff-e34e919520ffcf961fbcbe6e33d514c3eebea9323c4324e1fecb6c407343d426L86' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 93368474</div><div id='project'> Project Name: hannesstark/3dinfomax</div><div id='commit'> Commit Name: a165907548f15c7571758457fe0867a83ad049dc</div><div id='time'> Time: 2021-07-03</div><div id='author'> Author: hannes.staerk@gmail.com</div><div id='file'> File Name: models/transformer.py</div><div id='m_class'> M Class Name: TransformerGNN</div><div id='n_method'> N Class Name: TransformerGNN</div><div id='m_method'> M Method Name: forward(4)</div><div id='n_method'> N Method Name: forward(4)</div><div id='m_parent_class'> M Parent Class: nn.Module</div><div id='n_parent_class'> N Parent Class: nn.Module</div><div id='m_file'> M File Name: models/transformer.py</div><div id='n_file'> N File Name: models/transformer.py</div><div id='m_start'> M Start Line: 88</div><div id='m_end'> M End Line: 94</div><div id='n_start'> N Start Line: 70</div><div id='n_end'> N End Line: 75</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
            &#47&#47 lst_toks = [ lst_id_n_ct]
            &#47&#47 ic(lst_idts)
            for ids_n_cnt, time_sig in zip(lst_ids_n_ct, time_sigs):
                <a id="change">ic(</a>time_sig<a id="change">)</a>
                n_slots_per_beat, n_slots = time_sig2n_slots(time_sig, self.prec)
                for (id_, count) in ids_n_cnt:
                    tok = self.tokenizer.decode(id_)
                    ic(id_, tok, type(tok))</code></pre><h3>After Change</h3><pre><code class='java'>
            lst_ids_n_cts = [list(zip(*compress(list(l)))) for l in lst_ids]
            &#47&#47 ic(lst_ids_n_cts[0])

            bars<a id="change"> = </a><a id="change">[]</a>
            for i, (ids_n_cnt, time_sig) in enumerate(zip(lst_ids_n_cts, time_sigs)):
                bar = m21.stream.Measure(number=i)
                &#47&#47 ic(time_sig, bar)
                n_slots_per_beat, n_slots = time_sig2n_slots(time_sig, self.prec)</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/stefanheng/symbolic-music-generation/commit/89513672d0d8e9bc6f6c96513ffaf42a3ec7e5f2#diff-9bddc1ec410935c3b7e65a0e53b587a68e1dda58d8f63e4abcaf788573ad9f27L527' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 93368475</div><div id='project'> Project Name: stefanheng/symbolic-music-generation</div><div id='commit'> Commit Name: 89513672d0d8e9bc6f6c96513ffaf42a3ec7e5f2</div><div id='time'> Time: 2021-12-23</div><div id='author'> Author: 43276957+SpongeBobBang@users.noreply.github.com</div><div id='file'> File Name: melody_extractor.py</div><div id='m_class'> M Class Name: Tokenizer</div><div id='n_method'> N Class Name: Tokenizer</div><div id='m_method'> M Method Name: decode(3)</div><div id='n_method'> N Method Name: decode(3)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: melody_extractor.py</div><div id='n_file'> N File Name: melody_extractor.py</div><div id='m_start'> M Start Line: 535</div><div id='m_end'> M End Line: 561</div><div id='n_start'> N Start Line: 548</div><div id='n_end'> N End Line: 592</div><BR>