<html><h3>Pattern ID :72
</h3><img src='1010335.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
        lon_cur, lat_cur = parse_coordinate(self.poi_profile.loc[self.poi_profile[&quotgeo_id&quot]
                                            == self.id2location[now_loc]].iloc[0][&quotcoordinates&quot])
        for central in history_loc_central:
            history_avg_distance.append(<a id="change">distance.distance(</a>central, (lat_cur<a id="change">, lon_cur</a>)<a id="change">)</a>.kilometers)
        return history_avg_distance
</code></pre><h3>After Change</h3><pre><code class='java'>
        lon_cur, lat_cur = parse_coordinate(self.poi_profile.loc[self.poi_profile[&quotgeo_id&quot]
                                            == self.id2location[now_loc]].iloc[0][&quotcoordinates&quot])
        for central in history_loc_central:
            dis = geodistance(central[0], <a id="change">central[1]</a>, lat_cur, lon_cur)
            if dis &lt; 1:
                dis = 1
            history_avg_distance.append(dis)</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 3</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/libcity/bigscity-libcity/commit/c92a3cb2bd0cd104cc466fd3ff62511189ffbe9f#diff-3100393d0536da5370bb43d48546d1aa661b2b3aed8224ee7c01fc02c933af54L172' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 1010335</div><div id='project'> Project Name: libcity/bigscity-libcity</div><div id='commit'> Commit Name: c92a3cb2bd0cd104cc466fd3ff62511189ffbe9f</div><div id='time'> Time: 2021-05-26</div><div id='author'> Author: 33283819+WenMellors@users.noreply.github.com</div><div id='file'> File Name: trafficdl/data/dataset/trajectory_encoder/lstpm_encoder.py</div><div id='m_class'> M Class Name: LstpmEncoder</div><div id='n_method'> N Class Name: LstpmEncoder</div><div id='m_method'> M Method Name: _gen_distance_matrix(3)</div><div id='n_method'> N Method Name: _gen_distance_matrix(3)</div><div id='m_parent_class'> M Parent Class: AbstractTrajectoryEncoder</div><div id='n_parent_class'> N Parent Class: AbstractTrajectoryEncoder</div><div id='m_file'> M File Name: trafficdl/data/dataset/trajectory_encoder/lstpm_encoder.py</div><div id='n_file'> N File Name: trafficdl/data/dataset/trajectory_encoder/lstpm_encoder.py</div><div id='m_start'> M Start Line: 172</div><div id='m_end'> M End Line: 173</div><div id='n_start'> N Start Line: 193</div><div id='n_end'> N End Line: 197</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
                lon_j, lat_j = parse_coordinate(
                    self.poi_profile.iloc[origin][&quotcoordinates&quot])
                &#47&#47 计算 target - origin 的距离，并写入 ld[i][j] 中
                ld[i][j] = <a id="change">distance.distance(
                    </a>(lat_i<a id="change">, lon_i</a>), (lat_j, lon_j)<a id="change">)</a>.kilometers

        td_upper = torch.LongTensor(
            [self.up_time] * batch_size).to(self.device).unsqueeze(1)</code></pre><h3>After Change</h3><pre><code class='java'>
        &#47&#47 计算 td ld
        batch_size = len(dst)
        td = dst_time.unsqueeze(1) - current_tim
        ld = <a id="change">batch[&quotcurrent_dis&quot]</a>
        loc_len = batch.get_origin_len(&quotcurrent_loc&quot)

        td_upper = torch.LongTensor(
            [self.up_time] * batch_size).to(self.device).unsqueeze(1)</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/libcity/bigscity-libcity/commit/f4f4bf0bf6f127625a07a0457e37b9df412e5b07#diff-218dc38a4c0e10bb45612c0f9ac86998d06a545700312b7e5619a6f9ee32bd2aL75' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 1010334</div><div id='project'> Project Name: libcity/bigscity-libcity</div><div id='commit'> Commit Name: f4f4bf0bf6f127625a07a0457e37b9df412e5b07</div><div id='time'> Time: 2021-08-23</div><div id='author'> Author: 842595644@qq.com</div><div id='file'> File Name: libtraffic/model/trajectory_loc_prediction/STRNN.py</div><div id='m_class'> M Class Name: STRNN</div><div id='n_method'> N Class Name: STRNN</div><div id='m_method'> M Method Name: calculate_loss(2)</div><div id='n_method'> N Method Name: calculate_loss(2)</div><div id='m_parent_class'> M Parent Class: AbstractModel</div><div id='n_parent_class'> N Parent Class: AbstractModel</div><div id='m_file'> M File Name: libtraffic/model/trajectory_loc_prediction/STRNN.py</div><div id='n_file'> N File Name: libtraffic/model/trajectory_loc_prediction/STRNN.py</div><div id='m_start'> M Start Line: 77</div><div id='m_end'> M End Line: 99</div><div id='n_start'> N Start Line: 80</div><div id='n_end'> N End Line: 80</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
                lon_j, lat_j = parse_coordinate(
                    self.poi_profile.iloc[origin][&quotcoordinates&quot])
                &#47&#47 计算 target - origin 的距离，并写入 ld[i][j] 中
                ld[i][j] = <a id="change">distance.distance(
                    </a>(lat_i, lon_i), (lat_j<a id="change">, lon_j</a>)<a id="change">)</a>.kilometers

        td_upper = torch.LongTensor(
            [self.up_time] * batch_size).to(self.device).unsqueeze(1)</code></pre><h3>After Change</h3><pre><code class='java'>
        &#47&#47 计算 td ld
        batch_size = len(dst)
        td = dst_time.unsqueeze(1) - current_tim
        ld = <a id="change">batch[&quotcurrent_dis&quot]</a>
        loc_len = batch.get_origin_len(&quotcurrent_loc&quot)

        td_upper = torch.LongTensor(
            [self.up_time] * batch_size).to(self.device).unsqueeze(1)</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/libcity/bigscity-libcity/commit/f4f4bf0bf6f127625a07a0457e37b9df412e5b07#diff-218dc38a4c0e10bb45612c0f9ac86998d06a545700312b7e5619a6f9ee32bd2aL120' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 1010337</div><div id='project'> Project Name: libcity/bigscity-libcity</div><div id='commit'> Commit Name: f4f4bf0bf6f127625a07a0457e37b9df412e5b07</div><div id='time'> Time: 2021-08-23</div><div id='author'> Author: 842595644@qq.com</div><div id='file'> File Name: libtraffic/model/trajectory_loc_prediction/STRNN.py</div><div id='m_class'> M Class Name: STRNN</div><div id='n_method'> N Class Name: STRNN</div><div id='m_method'> M Method Name: predict(2)</div><div id='n_method'> N Method Name: predict(2)</div><div id='m_parent_class'> M Parent Class: AbstractModel</div><div id='n_parent_class'> N Parent Class: AbstractModel</div><div id='m_file'> M File Name: libtraffic/model/trajectory_loc_prediction/STRNN.py</div><div id='n_file'> N File Name: libtraffic/model/trajectory_loc_prediction/STRNN.py</div><div id='m_start'> M Start Line: 122</div><div id='m_end'> M End Line: 144</div><div id='n_start'> N Start Line: 112</div><div id='n_end'> N End Line: 112</div><BR>