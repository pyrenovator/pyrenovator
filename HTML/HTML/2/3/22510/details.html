<html><h3>Pattern ID :22510
</h3><img src='71141416.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
                 replace_method=&quotauto&quot,
                 quantization_setting=None):

        <a id="change">super(</a>InferenceEngine, self<a id="change">)</a>.__init__()

        self.module = model
</code></pre><h3>After Change</h3><pre><code class='java'>
            self._apply_injection_policy()

        device = torch.cuda.current_device()
        <a id="change">logger.info(f"Place model to device: {device}"</a><a id="change">)</a>
        self.module.to(device)

        if self.mp_world_size &gt; 1:
            self.model_orig_fwd = self.module.forward</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 4</div><BR><div id='size'>Non-data size: 2</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/microsoft/deepspeed/commit/f0122007df11281262efcd1525378db54e0261fd#diff-fdbdbba9c01d8349399cfadeba4cce1c5a34fc15c38ec44a335e1340c11b13a4L33' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 71141416</div><div id='project'> Project Name: microsoft/deepspeed</div><div id='commit'> Commit Name: f0122007df11281262efcd1525378db54e0261fd</div><div id='time'> Time: 2021-11-08</div><div id='author'> Author: chunyang.wen@gmail.com</div><div id='file'> File Name: deepspeed/inference/engine.py</div><div id='m_class'> M Class Name: InferenceEngine</div><div id='n_method'> N Class Name: InferenceEngine</div><div id='m_method'> M Method Name: __init__(10)</div><div id='n_method'> N Method Name: __init__(10)</div><div id='m_parent_class'> M Parent Class: Module</div><div id='n_parent_class'> N Parent Class: Module</div><div id='m_file'> M File Name: deepspeed/inference/engine.py</div><div id='n_file'> N File Name: deepspeed/inference/engine.py</div><div id='m_start'> M Start Line: 33</div><div id='m_end'> M End Line: 73</div><div id='n_start'> N Start Line: 45</div><div id='n_end'> N End Line: 89</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>

class Model(nn.Module):
    def __init__(self, cfg=&quotyolov5s.yaml&quot, ch=3, nc=None, anchors=None):  &#47&#47 model, input channels, number of classes
        <a id="change">super(</a>Model, self<a id="change">)</a>.__init__()
        if isinstance(cfg, dict):
            self.yaml = cfg  &#47&#47 model dict
        else:  &#47&#47 is *.yaml</code></pre><h3>After Change</h3><pre><code class='java'>
        &#47&#47 Init weights, biases
        initialize_weights(self)
        self.info()
        <a id="change">LOGGER.info(&quot&quot</a><a id="change">)</a>

    def forward(self, x, augment=False, profile=False, visualize=False):
        if augment:</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/pooya-mohammadi/deep_utils/commit/7d442fe6eef7ccd63661e0463e87358ff795d709#diff-49eab6b0c60ac05fb492f015910f89eb7e7700e4f19ef20b92bf2a7483df7ec3L67' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 71141413</div><div id='project'> Project Name: pooya-mohammadi/deep_utils</div><div id='commit'> Commit Name: 7d442fe6eef7ccd63661e0463e87358ff795d709</div><div id='time'> Time: 2021-11-26</div><div id='author'> Author: practical.ai.programming@gmail.com</div><div id='file'> File Name: deep_utils/vision/object_detection/yolo/v5/torch/models/yolo.py</div><div id='m_class'> M Class Name: Model</div><div id='n_method'> N Class Name: Model</div><div id='m_method'> M Method Name: __init__(5)</div><div id='n_method'> N Method Name: __init__(5)</div><div id='m_parent_class'> M Parent Class: nn.Module</div><div id='n_parent_class'> N Parent Class: nn.Module</div><div id='m_file'> M File Name: deep_utils/vision/object_detection/yolo/v5/torch/models/yolo.py</div><div id='n_file'> N File Name: deep_utils/vision/object_detection/yolo/v5/torch/models/yolo.py</div><div id='m_start'> M Start Line: 68</div><div id='m_end'> M End Line: 103</div><div id='n_start'> N Start Line: 86</div><div id='n_end'> N End Line: 121</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>

    @classmethod
    def from_pretrained(cls, pretrained_model_name_or_path, *model_args, **kwargs):
        model = <a id="change">super()</a>.from_pretrained()
        model.numericalizer = BartNumericalizer(pretrained_model_name_or_path)
        return model, 0 &#47&#47TODO return best_decascore
</code></pre><h3>After Change</h3><pre><code class='java'>
        &#47&#47 vocab_sets = kwargs.pop("vocab_sets", None)

        full_checkpoint_path = os.path.join(save_directory, model_checkpoint_file)
        <a id="change">logger.info(f&quotLoading the model from {full_checkpoint_path}&quot</a><a id="change">)</a>
        model = Bart(args=args)
        save_dict = torch.load(full_checkpoint_path, map_location=device)
        model.load_state_dict(save_dict[&quotmodel_state_dict&quot])
</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/stanford-oval/genienlp/commit/446c42622083e0413e9437c8fdd4be61e7bb6b13#diff-bceffcc02e288dc2e7c5e76149fbb8822d24f0692d947a87423f72f40c70236bL285' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 71141415</div><div id='project'> Project Name: stanford-oval/genienlp</div><div id='commit'> Commit Name: 446c42622083e0413e9437c8fdd4be61e7bb6b13</div><div id='time'> Time: 2020-11-07</div><div id='author'> Author: s.j.semnani@gmail.com</div><div id='file'> File Name: genienlp/models/general_seq2seq.py</div><div id='m_class'> M Class Name: Bart</div><div id='n_method'> N Class Name: Bart</div><div id='m_method'> M Method Name: from_pretrained(2)</div><div id='n_method'> N Method Name: from_pretrained(2)</div><div id='m_parent_class'> M Parent Class: nn.Module</div><div id='n_parent_class'> N Parent Class: BartForConditionalGeneration</div><div id='m_file'> M File Name: genienlp/models/general_seq2seq.py</div><div id='n_file'> N File Name: genienlp/models/general_seq2seq.py</div><div id='m_start'> M Start Line: 286</div><div id='m_end'> M End Line: 288</div><div id='n_start'> N Start Line: 286</div><div id='n_end'> N End Line: 298</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        return super().activate_clients()

    def listen_clients(self):
        return <a id="change">super()</a>.listen_clients()


class ConnectServer(ClientCommunicationTopology):</code></pre><h3>After Change</h3><pre><code class='java'>

            if self._handler.update_flag:
                &#47&#47 server_handler will turn this flag to True when model parameters updated
                <a id="change">self._LOGGER.info("updated quit listen"</a><a id="change">)</a>
                break


class ConnectServer(ClientCommunicationTopology):</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/smilelab-fl/fedlab/commit/32b1644a007f4632fc195d0550d012bd2288dc4a#diff-846e3803606bd9e9a353f0a104d34ee2313532f2995f68e6fb0ead96e958f3ddL84' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 71141414</div><div id='project'> Project Name: smilelab-fl/fedlab</div><div id='commit'> Commit Name: 32b1644a007f4632fc195d0550d012bd2288dc4a</div><div id='time'> Time: 2021-04-03</div><div id='author'> Author: 928255708@qq.com</div><div id='file'> File Name: fedlab_core/server/topology.py</div><div id='m_class'> M Class Name: ConnectClient</div><div id='n_method'> N Class Name: ConnectClient</div><div id='m_method'> M Method Name: listen_clients(1)</div><div id='n_method'> N Method Name: listen_clients(1)</div><div id='m_parent_class'> M Parent Class: EndTop</div><div id='n_parent_class'> N Parent Class: EndTop</div><div id='m_file'> M File Name: fedlab_core/server/topology.py</div><div id='n_file'> N File Name: fedlab_core/server/topology.py</div><div id='m_start'> M Start Line: 85</div><div id='m_end'> M End Line: 85</div><div id='n_start'> N Start Line: 91</div><div id='n_end'> N End Line: 105</div><BR>