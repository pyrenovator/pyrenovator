<html><h3>Pattern ID :29428
</h3><img src='87133728.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
      key_name = "eval_accuracy"

    if tf.gfile.Exists(checkpoint_path + ".index"):
      result = <a id="change">estimator.evaluate(
          input_fn=eval_input_fn,
          steps=eval_steps,
          checkpoint_path=checkpoint_path)</a>
      best_perf<a id="change"> = </a>result[key_name]
      global_step = result["global_step"]
    else:
      global_step = -1</code></pre><h3>After Change</h3><pre><code class='java'>
            _remove_checkpoint(checkpoint_path)
          writer.write("=" * 50 + "\n")
          writer.flush()
          <a id="change">with </a>tf<a id="change">.gfile.GFile(best_trial_info_file, "w") as best_info:
            </a>best_info.write("{}:{}:{}".format(
                global_step, best_perf_global_step, best_perf))
    writer.close()
</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 3</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/ai4bharat/indic-bert/commit/50786be4f44b4f9242f40adbc2b9fd54abe43ce3#diff-51759dcea7f50f6314e4b971c159bf19846d38e5705567b36d09b42dfb61410dL244' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 87133728</div><div id='project'> Project Name: ai4bharat/indic-bert</div><div id='commit'> Commit Name: 50786be4f44b4f9242f40adbc2b9fd54abe43ce3</div><div id='time'> Time: 2019-12-21</div><div id='author'> Author: albert-copybara@google.com</div><div id='file'> File Name: run_classifier.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: main(1)</div><div id='n_method'> N Method Name: main(1)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: run_classifier.py</div><div id='n_file'> N File Name: run_classifier.py</div><div id='m_start'> M Start Line: 244</div><div id='m_end'> M End Line: 406</div><div id='n_start'> N Start Line: 320</div><div id='n_end'> N End Line: 423</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
    argmax = udf(lambda v: float(np.argmax(v)), returnType=T.DoubleType())
    pred_df = pred_df.withColumn(&quotlabel_pred&quot, argmax(pred_df.label_prob))
    evaluator = MulticlassClassificationEvaluator(predictionCol=&quotlabel_pred&quot, labelCol=&quotlabel&quot, metricName=&quotaccuracy&quot)
    accuracy<a id="change"> = </a><a id="change">evaluator.evaluate(</a>pred_df<a id="change">)</a>
    print(&quotTest accuracy:&quot, accuracy)

    with mlflow.start_run():
      mlflow.log_metric("learning_rate", learning_rate)</code></pre><h3>After Change</h3><pre><code class='java'>


def hyper_objective(learning_rate):
    <a id="change">with </a>mlflow<a id="change">.start_run():
        </a>model = train(learning_rate)

        &#47&#47 Write checkpoint
        meta = {</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/oap-project/cloudtik/commit/cf76222205e7c6ad94a12bddf54446f8c2ed5c77#diff-1d41f2949cd2b0ff42c31153d9782e6bafe63cfdddf35cd384f08d295a9d3e63L185' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 87133732</div><div id='project'> Project Name: oap-project/cloudtik</div><div id='commit'> Commit Name: cf76222205e7c6ad94a12bddf54446f8c2ed5c77</div><div id='time'> Time: 2022-12-06</div><div id='author'> Author: haifeng.chen@intel.com</div><div id='file'> File Name: example/ml/jobs/spark-mlflow-hyperopt-horovod-pytorch-mnist.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: hyper_objective(1)</div><div id='n_method'> N Method Name: hyper_objective(1)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: example/ml/jobs/spark-mlflow-hyperopt-horovod-pytorch-mnist.py</div><div id='n_file'> N File Name: example/ml/jobs/spark-mlflow-hyperopt-horovod-pytorch-mnist.py</div><div id='m_start'> M Start Line: 186</div><div id='m_end'> M End Line: 197</div><div id='n_start'> N Start Line: 252</div><div id='n_end'> N End Line: 265</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
    pred_df = pred_df.withColumn(&quotlabel_pred&quot, argmax(pred_df.label_prob))

    evaluator = MulticlassClassificationEvaluator(predictionCol=&quotlabel_pred&quot, labelCol=&quotlabel&quot, metricName=&quotaccuracy&quot)
    accuracy<a id="change"> = </a><a id="change">evaluator.evaluate(</a>pred_df<a id="change">)</a>
    print(&quotTest accuracy:&quot, accuracy)

    with mlflow.start_run():
      mlflow.log_metric("learning_rate", learning_rate)</code></pre><h3>After Change</h3><pre><code class='java'>


def hyper_objective(learning_rate):
    <a id="change">with </a>mlflow<a id="change">.start_run():
        </a>model = train(learning_rate)

        &#47&#47 Write checkpoint
        meta = {</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/oap-project/cloudtik/commit/1d4628d27213dc5dfa75fffa8ba02ec2be572e67#diff-f01c5196fd3daf2072fda5a47eb62ca7274d0f882e16ca1e8bfa096d0837ca9dL182' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 87133724</div><div id='project'> Project Name: oap-project/cloudtik</div><div id='commit'> Commit Name: 1d4628d27213dc5dfa75fffa8ba02ec2be572e67</div><div id='time'> Time: 2022-12-06</div><div id='author'> Author: haifeng.chen@intel.com</div><div id='file'> File Name: example/ml/jobs/spark-mlflow-hyperopt-horovod-tensorflow.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: hyper_objective(1)</div><div id='n_method'> N Method Name: hyper_objective(1)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: example/ml/jobs/spark-mlflow-hyperopt-horovod-tensorflow.py</div><div id='n_file'> N File Name: example/ml/jobs/spark-mlflow-hyperopt-horovod-tensorflow.py</div><div id='m_start'> M Start Line: 183</div><div id='m_end'> M End Line: 195</div><div id='n_start'> N Start Line: 284</div><div id='n_end'> N End Line: 299</div><BR>