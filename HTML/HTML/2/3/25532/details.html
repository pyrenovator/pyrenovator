<html><h3>Pattern ID :25532
</h3><img src='77726546.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
                                    self.node_dropout,
                            self.norm_adj_matrix._nnz()) if self.node_dropout != 0 else self.norm_adj_matrix
        features = self.get_feature_matrix()
        finalEmbd = [<a id="change">features.clone()</a>]
        for gnn in self.GNNlayers:
            features = gnn(A_hat, self.eye_matrix, features)
            features = nn.LeakyReLU(negative_slope=0.2)(features)
            features = nn.Dropout(self.message_dropout)(features)
            features = F.normalize(features, p=2, dim=1)
            finalEmbd += [features.clone()]
        finalEmbd = torch.cat(finalEmbd, dim=1)

        u_g_embeddings = finalEmbd[:self.n_users, :]
        i_g_embeddings<a id="change"> = </a>finalEmbd[self.n_users:, :]

        return u_g_embeddings, i_g_embeddings
</code></pre><h3>After Change</h3><pre><code class='java'>
            embeddings_list += [all_embeddings]
        ngcf_all_embeddings = torch.cat(embeddings_list, dim=1)

        user_all_embeddings, item_all_embeddings = <a id="change">torch.split(</a>ngcf_all_embeddings, [self.n_users, self.n_items]<a id="change">)</a>

        return user_all_embeddings, item_all_embeddings

    def calculate_loss(self, interaction):</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 3</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/rucaibox/recbole/commit/210deb20fdbedae80baa4e808ed08326a696027f#diff-4aa7e0b0167177bd6adc94840792a7f9e6f5e07d78119378cbe9094d6c0a1284L111' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 77726546</div><div id='project'> Project Name: rucaibox/recbole</div><div id='commit'> Commit Name: 210deb20fdbedae80baa4e808ed08326a696027f</div><div id='time'> Time: 2020-09-12</div><div id='author'> Author: 2015201909@ruc.edu.cn</div><div id='file'> File Name: recbox/model/general_recommender/ngcf.py</div><div id='m_class'> M Class Name: NGCF</div><div id='n_method'> N Class Name: NGCF</div><div id='m_method'> M Method Name: forward(1)</div><div id='n_method'> N Method Name: forward(1)</div><div id='m_parent_class'> M Parent Class: GeneralRecommender</div><div id='n_parent_class'> N Parent Class: GeneralRecommender</div><div id='m_file'> M File Name: recbox/model/general_recommender/ngcf.py</div><div id='n_file'> N File Name: recbox/model/general_recommender/ngcf.py</div><div id='m_start'> M Start Line: 115</div><div id='m_end'> M End Line: 131</div><div id='n_start'> N Start Line: 111</div><div id='n_end'> N End Line: 123</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        
        if p.size(1) &gt; 1:
            raise ValueError("Not Supported shape for propbabilty.")
        p = <a id="change">p.cpu().clone()</a>
        features = features.cpu().clone()

        with mp.Pool(processes=self.num_workers) as pool:
            &#47&#47 p to list
            p_list<a id="change"> = </a>torch.unbind(p.cpu(), 0)
            &#47&#47 f to list
            feat_list = torch.unbind(features.cpu(), 0)
</code></pre><h3>After Change</h3><pre><code class='java'>

        &#47&#47 split the tensors into smaller batches and multi-process them
        p_split = torch.split(p, math.ceil(batch_size / self.num_workers))
        feat_split = <a id="change">torch.split(</a>features, math.ceil(batch_size / self.num_workers)<a id="change">)</a>

        with mp.Pool(processes=self.num_workers) as pool:

            &#47&#47 itertools map p and f</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/turagalab/decode/commit/6dc5f8a1489142594a36e7e4f6865ea8f0e309d4#diff-63f00a6429878da59333cfbdc4bbe5321829eca14dc36376f4d5baca1c407be1L474' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 77726560</div><div id='project'> Project Name: turagalab/decode</div><div id='commit'> Commit Name: 6dc5f8a1489142594a36e7e4f6865ea8f0e309d4</div><div id='time'> Time: 2019-09-11</div><div id='author'> Author: gitdev@LRM.photo</div><div id='file'> File Name: deepsmlm/neuralfitter/post_processing.py</div><div id='m_class'> M Class Name: ConsistencyPostprocessing</div><div id='n_method'> N Class Name: ConsistencyPostprocessing</div><div id='m_method'> M Method Name: _cluster_mp(3)</div><div id='n_method'> N Method Name: _cluster_mp(3)</div><div id='m_parent_class'> M Parent Class: PostProcessing</div><div id='n_parent_class'> N Parent Class: PostProcessing</div><div id='m_file'> M File Name: deepsmlm/neuralfitter/post_processing.py</div><div id='n_file'> N File Name: deepsmlm/neuralfitter/post_processing.py</div><div id='m_start'> M Start Line: 481</div><div id='m_end'> M End Line: 506</div><div id='n_start'> N Start Line: 468</div><div id='n_end'> N End Line: 492</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
                if self.dynamic or self.grid[i].shape[2:4] != x[i].shape[2:4]:
                    self.grid[i], self.anchor_grid[i] = self._make_grid(nx, ny, i)

                y<a id="change"> = </a><a id="change">x[i].clone()</a>
                y[..., :5 + self.nc].sigmoid_()
                if self.inplace:
                    y[..., 0:2] = (y[..., 0:2] * 2 + self.grid[i]) * self.stride[i]  &#47&#47 xy
                    y[..., 2:4] = (y[..., 2:4] * 2) ** 2 * self.anchor_grid[i]  &#47&#47 wh</code></pre><h3>After Change</h3><pre><code class='java'>
                    wh = (wh.sigmoid() * 2) ** 2 * self.anchor_grid[i]  &#47&#47 wh
                    y = torch.cat((xy, wh, conf.sigmoid(), mask), 4)
                else:  &#47&#47 Detect (boxes only)
                    xy, wh, conf = <a id="change">x[i].sigmoid().split(</a>(2, 2, self.nc + 1), 4<a id="change">)</a>
                    xy = (xy * 2 + self.grid[i]) * self.stride[i]  &#47&#47 xy
                    wh = (wh * 2) ** 2 * self.anchor_grid[i]  &#47&#47 wh
                    y = torch.cat((xy, wh, conf), 4)
                z.append(y.view(bs, self.na * nx * ny, self.no))</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/ultralytics/yolov5/commit/060837406542c5c65301b8fde641f4d92a1f395e#diff-2cd118cbb69c9ca7b5544f4187b11335fc3addbaf2c3c5bb45435cac648c957bL56' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 77726552</div><div id='project'> Project Name: ultralytics/yolov5</div><div id='commit'> Commit Name: 060837406542c5c65301b8fde641f4d92a1f395e</div><div id='time'> Time: 2022-09-17</div><div id='author'> Author: glenn.jocher@ultralytics.com</div><div id='file'> File Name: models/yolo.py</div><div id='m_class'> M Class Name: Detect</div><div id='n_method'> N Class Name: Detect</div><div id='m_method'> M Method Name: forward(2)</div><div id='n_method'> N Method Name: forward(2)</div><div id='m_parent_class'> M Parent Class: nn.Module</div><div id='n_parent_class'> N Parent Class: nn.Module</div><div id='m_file'> M File Name: models/yolo.py</div><div id='n_file'> N File Name: models/yolo.py</div><div id='m_start'> M Start Line: 61</div><div id='m_end'> M End Line: 77</div><div id='n_start'> N Start Line: 58</div><div id='n_end'> N End Line: 77</div><BR>