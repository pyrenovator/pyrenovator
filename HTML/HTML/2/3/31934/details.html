<html><h3>Pattern ID :31934
</h3><img src='93383264.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
        &#47&#47 the following code takes ordered data and scatters it on to an image grid
        &#47&#47 profiling for a 2D problem showed drastic differences in performances
        &#47&#47 for these two implementations on cpu/gpu, but they do the same thing
        <a id="change">if </a>device == torch.device(&quotcpu&quot):
            tmp = complex_mult(coef.unsqueeze(0), kdat, dim=1)
            for bind in range(griddat.shape[0]):
                for riind in range(griddat.shape[1]):</code></pre><h3>After Change</h3><pre><code class='java'>

    &#47&#47 offset from k-space to first coef loc
    kofflist = 1 + \
        <a id="change">tf.cast(</a>tf.floor(tm<a id="change"> - </a>numpoints[:, None] / 2.0), int_type<a id="change">)</a>

    &#47&#47 initialize output array
    griddat = tf.zeros(
        shape=(kdat.shape[0], 2, tf.reduce_prod(dims)),</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 3</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/zaccharieramzi/tfkbnufft/commit/e1123a8893ee7aeee9593a67d2151f8d860f384a#diff-9f6c80acef016f710c93669e2f4412dd11f8b0b6df0906e13e939992168a3b6dL160' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 93383264</div><div id='project'> Project Name: zaccharieramzi/tfkbnufft</div><div id='commit'> Commit Name: e1123a8893ee7aeee9593a67d2151f8d860f384a</div><div id='time'> Time: 2020-03-01</div><div id='author'> Author: zaccharie.ramzi@gmail.com</div><div id='file'> File Name: tfkbnufft/nufft/interp_functions.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: run_interp_back(3)</div><div id='n_method'> N Method Name: run_interp_back(3)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: tfkbnufft/nufft/interp_functions.py</div><div id='n_file'> N File Name: tfkbnufft/nufft/interp_functions.py</div><div id='m_start'> M Start Line: 160</div><div id='m_end'> M End Line: 205</div><div id='n_start'> N Start Line: 161</div><div id='n_end'> N End Line: 190</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
    If string, get scorer from sklearn. If callable, do heuristic to see if valid.
    &#47&#47 Borrowed code from:
    &#47&#47 https://github.com/scikit-learn/scikit-learn/blob/844b4be24d20fc42cc13b957374c718956a0db39/sklearn/metrics/_scorer.py&#47&#47L421
    <a id="change">if </a>isinstance(scorer, str):
        return get_scorer(scorer)
    elif callable(scorer):
        &#47&#47 Check that scorer runs for given model and data</code></pre><h3>After Change</h3><pre><code class='java'>
        if not isinstance(result, np.ndarray):
            raise errors.DeepchecksValueError(f&quotExpected scorer {scorer_name} to return np.ndarray &quot
                                              f&quotbut got: {type(result).__name__}&quot)
        expected_types = <a id="change">t.cast(
            </a>str,
            np.typecodes[&quotAllInteger&quot]<a id="change"> + </a>np.typecodes[&quotAllFloat&quot]<a id="change"> &#47&#47 type: ignore
        )</a>
        kind = result.dtype.kind
        if kind not in expected_types:
            raise errors.DeepchecksValueError(f&quotExpected scorer {scorer_name} to return np.ndarray of number kind &quot
                                              f&quotbut got: {kind}&quot)</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/deepchecks/deepchecks/commit/ceba2ede21ffee18180dd683b9ac4dbe441c380e#diff-01d187d84397efda54abbf91671bf241d110259c86334554fcc4371824125cf9L174' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 93383249</div><div id='project'> Project Name: deepchecks/deepchecks</div><div id='commit'> Commit Name: ceba2ede21ffee18180dd683b9ac4dbe441c380e</div><div id='time'> Time: 2021-12-21</div><div id='author'> Author: matanper@gmail.com</div><div id='file'> File Name: deepchecks/utils/metrics.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: validate_scorer(5)</div><div id='n_method'> N Method Name: validate_scorer(3)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: deepchecks/utils/metrics.py</div><div id='n_file'> N File Name: deepchecks/utils/metrics.py</div><div id='m_start'> M Start Line: 174</div><div id='m_end'> M End Line: 191</div><div id='n_start'> N Start Line: 236</div><div id='n_end'> N End Line: 258</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
    batch_size = tf.shape(images)[0]
    _, hh, ww, _ = images.shape
    mix_weight = sample_beta_distribution(1, alpha, alpha)[0]  &#47&#47 same value in batch
    <a id="change">if </a>mix_weight &lt; min_mix_weight or 1 - mix_weight &lt; min_mix_weight:
        &#47&#47 For input_shape=224, min_mix_weight=0.01, min_height = 224 * 0.1 = 22.4
        return images, labels
</code></pre><h3>After Change</h3><pre><code class='java'>
    mix_weight = sample_beta_distribution((), alpha, alpha)

    offset_height, offset_width, target_height, target_width = get_box(mix_weight, hh, ww)
    mix_weight = 1.0 - tf.cast(target_height * target_width, "float32") / <a id="change">tf.cast(</a>hh<a id="change"> * </a>ww, "float32"<a id="change">)</a>
    crops = tf.image.crop_to_bounding_box(images, offset_height, offset_width, target_height, target_width)
    pad_crops = tf.image.pad_to_bounding_box(crops, offset_height, offset_width, hh, ww)

    images = images - pad_crops + pad_crops[::-1]</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/leondgarse/keras_cv_attention_models/commit/a05afc217c7710193105435e4240723aba7eef2b#diff-4c3c6690984340f126a2283fe3773e52f7537c7f532cdba8ddda7e5af5973517L263' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 93383257</div><div id='project'> Project Name: leondgarse/keras_cv_attention_models</div><div id='commit'> Commit Name: a05afc217c7710193105435e4240723aba7eef2b</div><div id='time'> Time: 2021-12-05</div><div id='author'> Author: leondgarse@gmail.com</div><div id='file'> File Name: keras_cv_attention_models/imagenet/data.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: cutmix(3)</div><div id='n_method'> N Method Name: cutmix(4)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: keras_cv_attention_models/imagenet/data.py</div><div id='n_file'> N File Name: keras_cv_attention_models/imagenet/data.py</div><div id='m_start'> M Start Line: 263</div><div id='m_end'> M End Line: 293</div><div id='n_start'> N Start Line: 313</div><div id='n_end'> N End Line: 323</div><BR>