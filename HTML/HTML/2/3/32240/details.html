<html><h3>Pattern ID :32240
</h3><img src='94355738.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
        rs_total_loss, kg_total_loss = 0., 0.

        &#47&#47 train rs
        <a id="change">print(&quotTrain RS&quot</a><a id="change">)</a>
        train_data.set_mode(KGDataLoaderState.RS)
        for batch_idx, interaction in enumerate(train_data):
            interaction = interaction.to(self.device)
            self.optimizer.zero_grad()</code></pre><h3>After Change</h3><pre><code class='java'>
        if epoch_idx % self.kge_interval == 0:
            self.logger.info(&quotTrain KG&quot)
            train_data.set_mode(KGDataLoaderState.KG)
            kg_total_loss = <a id="change">super()</a>._train_epoch(train_data, epoch_idx, self.model.calculate_kg_loss)

        return rs_total_loss, kg_total_loss
</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 8</div><BR><div id='size'>Non-data size: 2</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/rucaibox/recbole/commit/5ad0bdda3167b74b49aa5818892e838de8c4fda1#diff-e38b0c7af084318af2abfe6a4023b17aa4e190267c4467908362cacf3187f601L534' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 94355738</div><div id='project'> Project Name: rucaibox/recbole</div><div id='commit'> Commit Name: 5ad0bdda3167b74b49aa5818892e838de8c4fda1</div><div id='time'> Time: 2020-11-20</div><div id='author'> Author: 297086016@qq.com</div><div id='file'> File Name: recbole/trainer/trainer.py</div><div id='m_class'> M Class Name: MKRTrainer</div><div id='n_method'> N Class Name: MKRTrainer</div><div id='m_method'> M Method Name: _train_epoch(4)</div><div id='n_method'> N Method Name: _train_epoch(3)</div><div id='m_parent_class'> M Parent Class: Trainer</div><div id='n_parent_class'> N Parent Class: Trainer</div><div id='m_file'> M File Name: recbole/trainer/trainer.py</div><div id='n_file'> N File Name: recbole/trainer/trainer.py</div><div id='m_start'> M Start Line: 641</div><div id='m_end'> M End Line: 671</div><div id='n_start'> N Start Line: 534</div><div id='n_end'> N End Line: 546</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        model = self.batchnorm_modify(model)
        if env[&quotdevice&quot] is &quotcuda&quot:
            self.model = model.cuda()
        <a id="change">print(&quotBefore fine-pruning, the performance of model:&quot</a><a id="change">)</a>
        self.model._validate(loader=self.test_dataloader)
        self.model._train(  loader_train=self.clean_dataloader,**kwargs)
        &#47&#47 add the test on trigger dataset 
        </code></pre><h3>After Change</h3><pre><code class='java'>


    def detect(self, **kwargs):
        <a id="change">super()</a>.detect(**kwargs)
        
        for param in self.model.parameters():
            param.requires_grad = True</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/ain-soph/trojanzoo/commit/71fca2d125fa67ddc40216a4e123aa8cb97687ea#diff-c3fcaa1c628e6b9b55c23cd420580d65ec905c1e0e441e733d799b6093833046L285' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 94355737</div><div id='project'> Project Name: ain-soph/trojanzoo</div><div id='commit'> Commit Name: 71fca2d125fa67ddc40216a4e123aa8cb97687ea</div><div id='time'> Time: 2020-08-25</div><div id='author'> Author: corazju@zju.edu.cn</div><div id='file'> File Name: trojanzoo/defense/backdoor/fine_pruning.py</div><div id='m_class'> M Class Name: Fine_Pruning</div><div id='n_method'> N Class Name: Fine_Pruning</div><div id='m_method'> M Method Name: detect(1)</div><div id='n_method'> N Method Name: detect(1)</div><div id='m_parent_class'> M Parent Class: Defense_Backdoor</div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: trojanzoo/defense/backdoor/fine_pruning.py</div><div id='n_file'> N File Name: trojanzoo/defense/backdoor/fine_pruning.py</div><div id='m_start'> M Start Line: 314</div><div id='m_end'> M End Line: 317</div><div id='n_start'> N Start Line: 287</div><div id='n_end'> N End Line: 318</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        &#47&#47 use default data
        provider_uri = "~/.qlib/qlib_data/cn_data_simple_1"  &#47&#47 target_dir
        if not exists_qlib_data(provider_uri):
            <a id="change">print(f"Qlib data is not found in {provider_uri}"</a><a id="change">)</a>

            GetData().qlib_data(name="qlib_data_simple", region="cn", interval="1d", target_dir=provider_uri)
        qlib.init(provider_uri=provider_uri, custom_ops=[Diff, Distance], region=REG_CN)
</code></pre><h3>After Change</h3><pre><code class='java'>
    @classmethod
    def setUpClass(cls) -&gt; None:
        cls._setup_kwargs.update({"custom_ops":[Diff, Distance]})
        <a id="change">super()</a>.setUpClass()

    def test_regiter_custom_ops(self):
        instruments = ["SH600000"]</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/microsoft/qlib/commit/2016ebbbb2b3cb911b517dc842b7793d5cdad477#diff-9130a60173a7e214396311f4e747aa42a980a92018f9fcdb0409a2cc7964f867L64' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 94355736</div><div id='project'> Project Name: microsoft/qlib</div><div id='commit'> Commit Name: 2016ebbbb2b3cb911b517dc842b7793d5cdad477</div><div id='time'> Time: 2021-01-26</div><div id='author'> Author: bxd98@126.com</div><div id='file'> File Name: tests/test_register_ops.py</div><div id='m_class'> M Class Name: TestRegiterCustomOps</div><div id='n_method'> N Class Name: TestRegiterCustomOps</div><div id='m_method'> M Method Name: setUpClass(1)</div><div id='n_method'> N Method Name: setUpClass(1)</div><div id='m_parent_class'> M Parent Class: TestAutoData</div><div id='n_parent_class'> N Parent Class: TestAutoData</div><div id='m_file'> M File Name: tests/test_register_ops.py</div><div id='n_file'> N File Name: tests/test_register_ops.py</div><div id='m_start'> M Start Line: 66</div><div id='m_end'> M End Line: 71</div><div id='n_start'> N Start Line: 65</div><div id='n_end'> N End Line: 66</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        ex_labels = tuple(torch.tensor([label]).to(self.device) for label in labels)

        &#47&#47 Calculate mask
        <a id="change">print(&quot&#47&#47D&#47&#47Masks calculate...&quot</a><a id="change">)</a>
        edge_masks = []
        for ex_label in ex_labels:
            self.__clear_masks__()</code></pre><h3>After Change</h3><pre><code class='java'>

        :rtype: (:class:`Tensor`, :class:`Tensor`)
        
        <a id="change">super()</a>.forward(x=x, edge_index=edge_index, **kwargs)
        self.model.eval()

        self_loop_edge_index, _ = add_self_loops(edge_index, num_nodes=self.num_nodes)</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/divelab/dig/commit/d162bbd32ca3bf8fae90914595f0fd06beb54355#diff-d3d9447c09d70bfb5f023bed9a76a221588406aa2832795a93d16820af257a19L99' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 94355735</div><div id='project'> Project Name: divelab/dig</div><div id='commit'> Commit Name: d162bbd32ca3bf8fae90914595f0fd06beb54355</div><div id='time'> Time: 2021-04-24</div><div id='author'> Author: 707720968@qq.com</div><div id='file'> File Name: dig/xgraph/method/gnnexplainer.py</div><div id='m_class'> M Class Name: GNNExplainer</div><div id='n_method'> N Class Name: GNNExplainer</div><div id='m_method'> M Method Name: forward(5)</div><div id='n_method'> N Method Name: forward(5)</div><div id='m_parent_class'> M Parent Class: ExplainerBase</div><div id='n_parent_class'> N Parent Class: ExplainerBase</div><div id='m_file'> M File Name: dig/xgraph/method/gnnexplainer.py</div><div id='n_file'> N File Name: dig/xgraph/method/gnnexplainer.py</div><div id='m_start'> M Start Line: 132</div><div id='m_end'> M End Line: 141</div><div id='n_start'> N Start Line: 114</div><div id='n_end'> N End Line: 114</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>

    def get_official_weights(self, **kwargs) -&gt; OrderedDict[str, torch.Tensor]:
        url = model_urls[self.parse_name(&quotmnasnet&quot, self.mnas_alpha)[0]]
        <a id="change">print(&quotget official model weights from: &quot</a>, url<a id="change">)</a>
        _dict: OrderedDict[str, torch.Tensor] = model_zoo.load_url(url, **kwargs)
        new_dict = OrderedDict()
        for key, value in _dict.items():
            if key.startswith(&quotlayers.&quot):</code></pre><h3>After Change</h3><pre><code class='java'>

    def get_official_weights(self, **kwargs) -&gt; OrderedDict[str, torch.Tensor]:
        url = self.model_urls[self.parse_name(&quotmnasnet&quot, self.mnas_alpha)[0]]
        _dict = <a id="change">super()</a>.get_official_weights(url=url)
        new_dict = OrderedDict()
        for key, value in _dict.items():
            if key.startswith(&quotlayers.&quot):</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/ain-soph/trojanzoo/commit/1a4099188696ea8990cc4f58d09a72808a77d89b#diff-7f53538e488310b9287bcf2136bf60eeabba86c46299f7b7b17ea26d72e27d45L45' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 94355733</div><div id='project'> Project Name: ain-soph/trojanzoo</div><div id='commit'> Commit Name: 1a4099188696ea8990cc4f58d09a72808a77d89b</div><div id='time'> Time: 2021-04-06</div><div id='author'> Author: ain-soph@live.com</div><div id='file'> File Name: trojanvision/models/nas/mnasnet.py</div><div id='m_class'> M Class Name: MNASNet</div><div id='n_method'> N Class Name: MNASNet</div><div id='m_method'> M Method Name: get_official_weights(1)</div><div id='n_method'> N Method Name: get_official_weights(1)</div><div id='m_parent_class'> M Parent Class: ImageModel</div><div id='n_parent_class'> N Parent Class: ImageModel</div><div id='m_file'> M File Name: trojanvision/models/nas/mnasnet.py</div><div id='n_file'> N File Name: trojanvision/models/nas/mnasnet.py</div><div id='m_start'> M Start Line: 46</div><div id='m_end'> M End Line: 48</div><div id='n_start'> N Start Line: 45</div><div id='n_end'> N End Line: 46</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
    def attack(self, **kwargs):
        print(&quotSample Data&quot)
        data = self.sample_data()
        <a id="change">print(&quotCalculate Average Target Features&quot</a><a id="change">)</a>
        self.avg_target_feats = self.get_avg_target_feats(data)
        print(&quotRetrain&quot)
        return super().attack(epoch_func=self.epoch_func, **kwargs)
</code></pre><h3>After Change</h3><pre><code class='java'>
        &#47&#47 print(&quotCalculate Average Target Features&quot)
        &#47&#47 self.avg_target_feats = self.get_avg_target_feats(self.data)
        print(&quotRetrain&quot)
        return <a id="change">super(</a>Latent_Backdoor, self<a id="change">)</a>.attack(epoch_func=self.epoch_func, **kwargs)

    def epoch_func(self, **kwargs):
        self.avg_target_feats = self.get_avg_target_feats(self.data)</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/ain-soph/trojanzoo/commit/e282320d7a5247b06cffc56a5f883e6bdc2ce038#diff-a46ca9c58158ac9667375743469654efd00126253ef544a07516f1dd2de96f96L28' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 94355731</div><div id='project'> Project Name: ain-soph/trojanzoo</div><div id='commit'> Commit Name: e282320d7a5247b06cffc56a5f883e6bdc2ce038</div><div id='time'> Time: 2020-09-24</div><div id='author'> Author: ain-soph@live.com</div><div id='file'> File Name: trojanzoo/attack/backdoor/imc_latent.py</div><div id='m_class'> M Class Name: IMC_Latent</div><div id='n_method'> N Class Name: IMC_Latent</div><div id='m_method'> M Method Name: attack(1)</div><div id='n_method'> N Method Name: attack(1)</div><div id='m_parent_class'> M Parent Class: Latent_Backdoor</div><div id='n_parent_class'> N Parent Class: Latent_Backdoor</div><div id='m_file'> M File Name: trojanzoo/attack/backdoor/imc_latent.py</div><div id='n_file'> N File Name: trojanzoo/attack/backdoor/imc_latent.py</div><div id='m_start'> M Start Line: 30</div><div id='m_end'> M End Line: 34</div><div id='n_start'> N Start Line: 30</div><div id='n_end'> N End Line: 34</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>

    def get_official_weights(self, **kwargs) -&gt; OrderedDict[str, torch.Tensor]:
        url = model_urls[f&quotresnet{self.layer:d}&quot]
        <a id="change">print(&quotget official model weights from: &quot</a>, url<a id="change">)</a>
        _dict: OrderedDict[str, torch.Tensor] = model_zoo.load_url(url, **kwargs)
        new_dict = OrderedDict()
        for i, (key, value) in enumerate(_dict.items()):
            prefix = &quotfeatures.&quot if i &lt; len(_dict) - 2 else &quotclassifier.&quot</code></pre><h3>After Change</h3><pre><code class='java'>
        super().__init__(name=name, layer=layer, model=model, sub_type=sub_type, **kwargs)

    def get_official_weights(self, **kwargs) -&gt; OrderedDict[str, torch.Tensor]:
        _dict = <a id="change">super()</a>.get_official_weights(**kwargs)
        new_dict = OrderedDict()
        for i, (key, value) in enumerate(_dict.items()):
            prefix = &quotfeatures.&quot if i &lt; len(_dict) - 2 else &quotclassifier.&quot</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/ain-soph/trojanzoo/commit/1a4099188696ea8990cc4f58d09a72808a77d89b#diff-a771bed1318d4464e1713165b088f0abfc68b89962ca33e8ef4f099119c61f1aL68' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 94355730</div><div id='project'> Project Name: ain-soph/trojanzoo</div><div id='commit'> Commit Name: 1a4099188696ea8990cc4f58d09a72808a77d89b</div><div id='time'> Time: 2021-04-06</div><div id='author'> Author: ain-soph@live.com</div><div id='file'> File Name: trojanvision/models/resnet.py</div><div id='m_class'> M Class Name: ResNet</div><div id='n_method'> N Class Name: ResNet</div><div id='m_method'> M Method Name: get_official_weights(1)</div><div id='n_method'> N Method Name: get_official_weights(1)</div><div id='m_parent_class'> M Parent Class: ImageModel</div><div id='n_parent_class'> N Parent Class: ImageModel</div><div id='m_file'> M File Name: trojanvision/models/resnet.py</div><div id='n_file'> N File Name: trojanvision/models/resnet.py</div><div id='m_start'> M Start Line: 69</div><div id='m_end'> M End Line: 71</div><div id='n_start'> N Start Line: 69</div><div id='n_end'> N End Line: 69</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>

    def get_official_weights(self, **kwargs) -&gt; OrderedDict[str, torch.Tensor]:
        url = model_urls[self.name]
        <a id="change">print(&quotget official model weights from: &quot</a>, url<a id="change">)</a>
        _dict: OrderedDict[str, torch.Tensor] = model_zoo.load_url(url, **kwargs)
        pattern = re.compile(
            r&quot^(.*denselayer\d+\.(?:norm|relu|conv))\.((?:[12])\.(?:weight|bias|running_mean|running_var))$&quot)
        for key in list(_dict.keys()):</code></pre><h3>After Change</h3><pre><code class='java'>
        super().__init__(name=name, layer=layer, model=model, comp=comp, **kwargs)

    def get_official_weights(self, **kwargs) -&gt; OrderedDict[str, torch.Tensor]:
        _dict = <a id="change">super()</a>.get_official_weights(**kwargs)
        pattern = re.compile(
            r&quot^(.*denselayer\d+\.(?:norm|relu|conv))\.((?:[12])\.(?:weight|bias|running_mean|running_var))$&quot)
        for key in list(_dict.keys()):</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/ain-soph/trojanzoo/commit/1a4099188696ea8990cc4f58d09a72808a77d89b#diff-8c29ef12e75fad2595d77855689f8642322296054124e7abd3bbbaa993c1326fL40' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 94355729</div><div id='project'> Project Name: ain-soph/trojanzoo</div><div id='commit'> Commit Name: 1a4099188696ea8990cc4f58d09a72808a77d89b</div><div id='time'> Time: 2021-04-06</div><div id='author'> Author: ain-soph@live.com</div><div id='file'> File Name: trojanvision/models/densenet.py</div><div id='m_class'> M Class Name: DenseNet</div><div id='n_method'> N Class Name: DenseNet</div><div id='m_method'> M Method Name: get_official_weights(1)</div><div id='n_method'> N Method Name: get_official_weights(1)</div><div id='m_parent_class'> M Parent Class: ImageModel</div><div id='n_parent_class'> N Parent Class: ImageModel</div><div id='m_file'> M File Name: trojanvision/models/densenet.py</div><div id='n_file'> N File Name: trojanvision/models/densenet.py</div><div id='m_start'> M Start Line: 41</div><div id='m_end'> M End Line: 43</div><div id='n_start'> N Start Line: 41</div><div id='n_end'> N End Line: 41</div><BR>