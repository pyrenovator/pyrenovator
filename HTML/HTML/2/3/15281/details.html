<html><h3>Pattern ID :15281
</h3><img src='51944635.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
                        ranks_dict_items = reversed(ranks_dict_items)
                    for tensor, (tensor_name, send_ranks) in zip(x, ranks_dict_items):
                        if is_grad:
                            send_ranks<a id="change"> = </a><a id="change">reversed(</a>send_ranks<a id="change">)</a>
                        if isinstance(tensor, torch.nn.Parameter):
                            for send_rank in send_ranks:
                                if tensor_name not in self.send_shared_parameters or send_rank not in \
                                        self.send_shared_parameters[</code></pre><h3>After Change</h3><pre><code class='java'>

                with torch.no_grad():
                    if is_grad:
                        <a id="change">pass</a>
                        &#47&#47 x = reversed(x)
                        &#47&#47 ranks_dict_items = reversed(ranks_dict_items)
                    for tensor, (tensor_name, send_ranks) in zip(x, ranks_dict_items):
                        if is_grad:</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 5</div><BR><div id='size'>Non-data size: 3</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/saareliad/ftpipe/commit/e541f087ab9910e349c8399c9180f3b5cd371e6b#diff-e8a3a19b1943afe92b627d303a564e72a2ad183b89af477fbd5c65031cec3416L244' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 51944635</div><div id='project'> Project Name: saareliad/ftpipe</div><div id='commit'> Commit Name: e541f087ab9910e349c8399c9180f3b5cd371e6b</div><div id='time'> Time: 2020-08-25</div><div id='author'> Author: saareliad@campus.technion.ac.il</div><div id='file'> File Name: pipeline/communication/multiprocessing.py</div><div id='m_class'> M Class Name: MultiprocessingCommunicationHandler</div><div id='n_method'> N Class Name: MultiprocessingCommunicationHandler</div><div id='m_method'> M Method Name: _send_tensors_p2p(5)</div><div id='n_method'> N Method Name: _send_tensors_p2p(5)</div><div id='m_parent_class'> M Parent Class: SimpleCommBase</div><div id='n_parent_class'> N Parent Class: SimpleCommBase</div><div id='m_file'> M File Name: pipeline/communication/multiprocessing.py</div><div id='n_file'> N File Name: pipeline/communication/multiprocessing.py</div><div id='m_start'> M Start Line: 244</div><div id='m_end'> M End Line: 292</div><div id='n_start'> N Start Line: 246</div><div id='n_end'> N End Line: 297</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
    &#47&#47 Due to limitations of the GraphQL API, which mimics SQL, requesting a tail means we have to
    &#47&#47 get the results in descending ID order and reverse them afterward.
    if args.tail is not None:
        logs = <a id="change">reversed(</a>logs<a id="change">)</a>
    latest_log_id<a id="change">, _ = </a>process_response(logs, -1)

    &#47&#47 "Follow" mode is implemented as a loop in the CLI. We assume that
    &#47&#47 newer log messages have a numerically larger ID than older log</code></pre><h3>After Change</h3><pre><code class='java'>
                break
            time.sleep(0.2)
    except KeyboardInterrupt:
        <a id="change">pass</a>
    finally:
        print(
            colored(
                "Trial is in the {} state. To reopen log stream, run: "</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/determined-ai/determined/commit/3da2ccbfa9a48a61c87488858d89fe84f1997978#diff-b549d9d2981432c1a4e328824134439d732b4d601165d2eb7c26da1d582bda4aL99' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 51944648</div><div id='project'> Project Name: determined-ai/determined</div><div id='commit'> Commit Name: 3da2ccbfa9a48a61c87488858d89fe84f1997978</div><div id='time'> Time: 2020-04-30</div><div id='author'> Author: yoni@determined.ai</div><div id='file'> File Name: cli/determined_cli/trial.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: logs(1)</div><div id='n_method'> N Method Name: logs(1)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: cli/determined_cli/trial.py</div><div id='n_file'> N File Name: cli/determined_cli/trial.py</div><div id='m_start'> M Start Line: 128</div><div id='m_end'> M End Line: 168</div><div id='n_start'> N Start Line: 99</div><div id='n_end'> N End Line: 131</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
                &#47&#47 it is possible that we received multiple gradients for the same tensor.
                &#47&#47 accumulated in fix_after_recv
                if is_grad:
                    receive_ranks<a id="change"> = </a><a id="change">reversed(</a>receive_ranks<a id="change">)</a>
                for receive_rank in receive_ranks:
                    tensor = next(ix)
                    tensor_tag = self.tensor_tags[tensor_name] + (self.TOTAL_TAGS * batch_idx)
                    if self.verbose:</code></pre><h3>After Change</h3><pre><code class='java'>
                &#47&#47 it is possible that we received multiple gradients for the same tensor.
                &#47&#47 accumulated in fix_after_recv
                if is_grad:
                    <a id="change">pass</a>
                    &#47&#47 receive_ranks = reversed(receive_ranks)
                for receive_rank in receive_ranks:
                    tensor = next(ix)
                    tensor_tag = self.tensor_tags[tensor_name] + (self.TOTAL_TAGS * batch_idx)</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/saareliad/ftpipe/commit/92dc9edeb24826d4b0915d8718933d6eff2fe3ab#diff-c7cf508b6f989487de52bc9e2f593e5ffb70bdcaa144e95c6e5c78146a2e9179L31' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 51944649</div><div id='project'> Project Name: saareliad/ftpipe</div><div id='commit'> Commit Name: 92dc9edeb24826d4b0915d8718933d6eff2fe3ab</div><div id='time'> Time: 2020-08-27</div><div id='author'> Author: saareliad@campus.technion.ac.il</div><div id='file'> File Name: pipeline/communication/p2p.py</div><div id='m_class'> M Class Name: P2PCommunicationHandler</div><div id='n_method'> N Class Name: P2PCommunicationHandler</div><div id='m_method'> M Method Name: _recv_tensors_p2p(5)</div><div id='n_method'> N Method Name: _recv_tensors_p2p(5)</div><div id='m_parent_class'> M Parent Class: SimpleCommBase</div><div id='n_parent_class'> N Parent Class: SimpleCommBase</div><div id='m_file'> M File Name: pipeline/communication/p2p.py</div><div id='n_file'> N File Name: pipeline/communication/p2p.py</div><div id='m_start'> M Start Line: 35</div><div id='m_end'> M End Line: 39</div><div id='n_start'> N Start Line: 43</div><div id='n_end'> N End Line: 43</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
                tensor = tensor.detach()
                tensor_tag = self.tensor_tags[tensor_name] + (self.TOTAL_TAGS * batch_idx)
                if is_grad:
                    send_ranks<a id="change"> = </a><a id="change">reversed(</a>send_ranks<a id="change">)</a>

                for send_rank in send_ranks:
                    if self.verbose:
                        self.logger.info(</code></pre><h3>After Change</h3><pre><code class='java'>
                tensor = tensor.detach()
                tensor_tag = self.tensor_tags[tensor_name] + (self.TOTAL_TAGS * batch_idx)
                if is_grad:
                    <a id="change">pass</a>
                    &#47&#47 send_ranks = reversed(send_ranks)

                for send_rank in send_ranks:
</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/saareliad/ftpipe/commit/92dc9edeb24826d4b0915d8718933d6eff2fe3ab#diff-c7cf508b6f989487de52bc9e2f593e5ffb70bdcaa144e95c6e5c78146a2e9179L59' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 51944650</div><div id='project'> Project Name: saareliad/ftpipe</div><div id='commit'> Commit Name: 92dc9edeb24826d4b0915d8718933d6eff2fe3ab</div><div id='time'> Time: 2020-08-27</div><div id='author'> Author: saareliad@campus.technion.ac.il</div><div id='file'> File Name: pipeline/communication/p2p.py</div><div id='m_class'> M Class Name: P2PCommunicationHandler</div><div id='n_method'> N Class Name: P2PCommunicationHandler</div><div id='m_method'> M Method Name: _send_tensors_p2p(5)</div><div id='n_method'> N Method Name: _send_tensors_p2p(5)</div><div id='m_parent_class'> M Parent Class: SimpleCommBase</div><div id='n_parent_class'> N Parent Class: SimpleCommBase</div><div id='m_file'> M File Name: pipeline/communication/p2p.py</div><div id='n_file'> N File Name: pipeline/communication/p2p.py</div><div id='m_start'> M Start Line: 67</div><div id='m_end'> M End Line: 85</div><div id='n_start'> N Start Line: 72</div><div id='n_end'> N End Line: 92</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
            with torch.cuda.stream(stream):
                request_objects = []
                if not is_activations:
                    ranks_dict_items<a id="change"> = </a><a id="change">reversed(</a>ranks_dict_items<a id="change">)</a>
                for (tensor_name, receive_ranks) in ranks_dict_items:
                    if not is_activations:
                        receive_ranks = reversed(receive_ranks)
                    for receive_rank in receive_ranks:</code></pre><h3>After Change</h3><pre><code class='java'>
            with torch.cuda.stream(stream):
                request_objects = []
                if not is_activations:
                    <a id="change">pass</a>
                    &#47&#47 ranks_dict_items = reversed(ranks_dict_items)
                for (tensor_name, receive_ranks) in ranks_dict_items:
                    if not is_activations:
                        pass</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/saareliad/ftpipe/commit/e541f087ab9910e349c8399c9180f3b5cd371e6b#diff-e8a3a19b1943afe92b627d303a564e72a2ad183b89af477fbd5c65031cec3416L159' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 51944638</div><div id='project'> Project Name: saareliad/ftpipe</div><div id='commit'> Commit Name: e541f087ab9910e349c8399c9180f3b5cd371e6b</div><div id='time'> Time: 2020-08-25</div><div id='author'> Author: saareliad@campus.technion.ac.il</div><div id='file'> File Name: pipeline/communication/multiprocessing.py</div><div id='m_class'> M Class Name: MultiprocessingCommunicationHandler</div><div id='n_method'> N Class Name: MultiprocessingCommunicationHandler</div><div id='m_method'> M Method Name: _recv_tensors_p2p(4)</div><div id='n_method'> N Method Name: _recv_tensors_p2p(4)</div><div id='m_parent_class'> M Parent Class: SimpleCommBase</div><div id='n_parent_class'> N Parent Class: SimpleCommBase</div><div id='m_file'> M File Name: pipeline/communication/multiprocessing.py</div><div id='n_file'> N File Name: pipeline/communication/multiprocessing.py</div><div id='m_start'> M Start Line: 166</div><div id='m_end'> M End Line: 169</div><div id='n_start'> N Start Line: 166</div><div id='n_end'> N End Line: 170</div><BR>