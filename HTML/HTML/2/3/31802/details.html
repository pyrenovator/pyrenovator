<html><h3>Pattern ID :31802
</h3><img src='92838728.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>

        action = action.tanh()

        <a id="change">return </a>action, std


if __name__ == &quot__main__&quot:</code></pre><h3>After Change</h3><pre><code class='java'>
            m = MultivariateNormal(mean, covariance)
            action_base = m.sample()
            log_prob = m.log_prob(action_base)
            <a id="change">log_prob.unsqueeze_(-1</a><a id="change">)</a>

            action = action_base.tanh()

            &#47&#47 According to "Soft Actor-Critic" (Haarnoja et. al) Appendix C</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 4</div><BR><div id='size'>Non-data size: 2</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/tmdt-buw/karolos/commit/e8ce439013ace3e3e9647de55ed22ddf38f35396#diff-29037086e0dfbb6a2262a556dce65661316ec86ddf4f52bf9de230586208ab9dL103' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 92838728</div><div id='project'> Project Name: tmdt-buw/karolos</div><div id='commit'> Commit Name: e8ce439013ace3e3e9647de55ed22ddf38f35396</div><div id='time'> Time: 2020-04-23</div><div id='author'> Author: scheiderer@uni-wuppertal.de</div><div id='file'> File Name: agents/nnfactory/sac.py</div><div id='m_class'> M Class Name: Policy</div><div id='n_method'> N Class Name: Policy</div><div id='m_method'> M Method Name: forward(3)</div><div id='n_method'> N Method Name: forward(3)</div><div id='m_parent_class'> M Parent Class: nn.Module</div><div id='n_parent_class'> N Parent Class: nn.Module</div><div id='m_file'> M File Name: agents/nnfactory/sac.py</div><div id='n_file'> N File Name: agents/nnfactory/sac.py</div><div id='m_start'> M Start Line: 103</div><div id='m_end'> M End Line: 115</div><div id='n_start'> N Start Line: 104</div><div id='n_end'> N End Line: 123</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        if not fix_mirror:
            return preds[0]
        else:
            <a id="change">return </a>fix_mirrors_numpy(preds, N_mask, CA_mask)


def Kabsch(A, B, backend="auto"):</code></pre><h3>After Change</h3><pre><code class='java'>
            backend = "numpy"
    &#47&#47 run calcs     
    if backend == "torch":
        <a id="change">pre_dist_mat.unsqueeze_(0</a><a id="change">)</a>
        pre_dist_mat = torch.repeat_interleave(pre_dist_mat, max(1,fix_mirror), dim=0)
        &#47&#47Â batched mds for full parallel 
        preds, stresses = mds_torch(pre_dist_mat, weights=weights,iters=iters, 
                                                  tol=tol, verbose=verbose)</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/lucidrains/alphafold2/commit/98e16ad2931a27f90e05df940cff72c00074028d#diff-09d0cbaf891d623ac245ccf84485a687b554217349ca55557c60b33234b969aeL440' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 92838729</div><div id='project'> Project Name: lucidrains/alphafold2</div><div id='commit'> Commit Name: 98e16ad2931a27f90e05df940cff72c00074028d</div><div id='time'> Time: 2021-01-17</div><div id='author'> Author: ericalcaide1@gmail.com</div><div id='file'> File Name: utils.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: MDScaling(9)</div><div id='n_method'> N Method Name: MDScaling(9)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: utils.py</div><div id='n_file'> N File Name: utils.py</div><div id='m_start'> M Start Line: 469</div><div id='m_end'> M End Line: 483</div><div id='n_start'> N Start Line: 482</div><div id='n_end'> N End Line: 500</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
                                                                   stress))
            break

    <a id="change">return </a>best_3d_coords, torch.tensor(his)

def mds_numpy(pre_dist_mat, weights=None, iters=10, tol=1e-5, verbose=2):
     Gets distance matrix. Outputs 3d. See below for wrapper. </code></pre><h3>After Change</h3><pre><code class='java'>
        weights = torch.ones_like(pre_dist_mat)
    &#47&#47 batched MDS
    if len(pre_dist_mat.shape) &lt; 3:
        <a id="change">pre_dist_mat.unsqueeze_(0</a><a id="change">)</a>
    &#47&#47 start
    batch, N, _ = pre_dist_mat.shape
    his = []
    &#47&#47 init random coords</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/lucidrains/alphafold2/commit/98e16ad2931a27f90e05df940cff72c00074028d#diff-09d0cbaf891d623ac245ccf84485a687b554217349ca55557c60b33234b969aeL168' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 92838730</div><div id='project'> Project Name: lucidrains/alphafold2</div><div id='commit'> Commit Name: 98e16ad2931a27f90e05df940cff72c00074028d</div><div id='time'> Time: 2021-01-17</div><div id='author'> Author: ericalcaide1@gmail.com</div><div id='file'> File Name: utils.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: mds_torch(5)</div><div id='n_method'> N Method Name: mds_torch(5)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: utils.py</div><div id='n_file'> N File Name: utils.py</div><div id='m_start'> M Start Line: 174</div><div id='m_end'> M End Line: 205</div><div id='n_start'> N Start Line: 181</div><div id='n_end'> N End Line: 215</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        return bond_params,bonds

    def make_masses(self,atom_types):
        <a id="change">return </a>torch.tensor([self.ff["masses"][at] for at in atom_types]).to(self.device)


def calculateAB(sigma, epsilon):</code></pre><h3>After Change</h3><pre><code class='java'>

    def make_masses(self,atom_types):
        masses = torch.tensor([self.ff["masses"][at] for at in atom_types])
        <a id="change">masses.unsqueeze_(1</a><a id="change">)</a> &#47&#47natoms,1
        masses.to(self.device)
        return masses
</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/torchmd/torchmd/commit/372dc61bcb389f4c391cbba1b0f87bb60e83880f#diff-4a4255cb92eff287dee018f37d6bc8a42005b2e7ab9036991f1ffe88bfde352bL68' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 92838731</div><div id='project'> Project Name: torchmd/torchmd</div><div id='commit'> Commit Name: 372dc61bcb389f4c391cbba1b0f87bb60e83880f</div><div id='time'> Time: 2020-02-19</div><div id='author'> Author: g.defabritiis@gmail.com</div><div id='file'> File Name: torchmd/forcefield.py</div><div id='m_class'> M Class Name: Forcefield</div><div id='n_method'> N Class Name: Forcefield</div><div id='m_method'> M Method Name: make_masses(2)</div><div id='n_method'> N Method Name: make_masses(2)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: torchmd/forcefield.py</div><div id='n_file'> N File Name: torchmd/forcefield.py</div><div id='m_start'> M Start Line: 69</div><div id='m_end'> M End Line: 69</div><div id='n_start'> N Start Line: 70</div><div id='n_end'> N End Line: 73</div><BR>