<html><h3>Pattern ID :15617
</h3><img src='52853494.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
        ]
        &#47&#47 The new key is the concatenation of the keys of each example in the batch
        expected_keys_per_batch = [
            [<a id="change">"_".join(</a>key<a id="change"> for key, _ in all_examples[i : i + batch_size])</a>] * len(examples)
            for i, examples in zip(range(0, len(all_examples), batch_size), expected_examples_per_batch)
        ]
        &#47&#47 Combine keys and examples</code></pre><h3>After Change</h3><pre><code class='java'>
            transformed_batch = func(batch)
            all_transformed_examples.extend(_batch_to_examples(transformed_batch))
        expected = _examples_to_batch(all_examples)
        <a id="change">expected.update(</a>_examples_to_batch(all_transformed_examples)<a id="change">)</a>
        expected = list(_batch_to_examples(expected))
    assert next(iter(ex_iterable))[1] == expected[0]
    assert list(x for _, x in ex_iterable) == expected
</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 2</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/huggingface/datasets/commit/4b9334007e069ad71630ba36283d3abafba42174#diff-17766e93a3448f2734ed819adaf8c1d84dacece94f0f8c19687002c62071700dL184' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 52853494</div><div id='project'> Project Name: huggingface/datasets</div><div id='commit'> Commit Name: 4b9334007e069ad71630ba36283d3abafba42174</div><div id='time'> Time: 2022-03-07</div><div id='author'> Author: 42851186+lhoestq@users.noreply.github.com</div><div id='file'> File Name: tests/test_iterable_dataset.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: test_mapped_examples_iterable(4)</div><div id='n_method'> N Method Name: test_mapped_examples_iterable(4)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: tests/test_iterable_dataset.py</div><div id='n_file'> N File Name: tests/test_iterable_dataset.py</div><div id='m_start'> M Start Line: 189</div><div id='m_end'> M End Line: 208</div><div id='n_start'> N Start Line: 184</div><div id='n_end'> N End Line: 197</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>

def get_state_dict(obj, arg:Optional[List[str]]=None, _params:Optional[Dict[str, Tensor]]=None) -&gt; Dict[str, Tensor]:
  if arg is None or _params is None: arg, _params = [], {}
  if isinstance(obj, Tensor): _params[<a id="change">&quot.&quot.join(</a>arg<a id="change">)</a>] = obj
  elif hasattr(obj, &quot__dict__&quot): get_state_dict(obj.__dict__, arg, _params)
  elif isinstance(obj, (list, tuple)):
    for i,x in enumerate(obj): get_state_dict(x, arg+[str(i)], _params)</code></pre><h3>After Change</h3><pre><code class='java'>
  if isinstance(obj, (list, tuple)):
    for i,x in enumerate(obj): state_dict.update(get_state_dict(x, f"{prefix}{str(i)}."))
  elif isinstance(obj, dict):
    for k,v in obj.items(): <a id="change">state_dict.update(</a>get_state_dict(v, f"{prefix}{str(k)}.")<a id="change">)</a>
  return state_dict
def get_parameters(obj) -&gt; List[Tensor]: return list(get_state_dict(obj).values())
</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/geohot/tinygrad/commit/58d3824cbe93fb50ca350f6f40fcd2646a487c59#diff-d87886334b3ad7661b9ca112b13d58ab4c4d38806afb3e02f4bb2aaee17d874dL82' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 52853495</div><div id='project'> Project Name: geohot/tinygrad</div><div id='commit'> Commit Name: 58d3824cbe93fb50ca350f6f40fcd2646a487c59</div><div id='time'> Time: 2023-03-12</div><div id='author'> Author: geohot@gmail.com</div><div id='file'> File Name: tinygrad/nn/optim.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: get_state_dict(2)</div><div id='n_method'> N Method Name: get_state_dict(3)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: tinygrad/nn/optim.py</div><div id='n_file'> N File Name: tinygrad/nn/optim.py</div><div id='m_start'> M Start Line: 82</div><div id='m_end'> M End Line: 90</div><div id='n_start'> N Start Line: 82</div><div id='n_end'> N End Line: 90</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        for line in tqdm(f, total=count_file_lines(srcfile)):
            ex = json.loads(line)
            code = encoder._encode(ex[&quotfunc&quot])
            dataset[ex[&quotidx&quot]] = <a id="change">" ".join(</a>code<a id="change">)</a>
            fn_lengths.append(len(code))

    print(&quotMax/Avg. function length  - {} / {}&quot.format(max(fn_lengths), 1.0 * sum(fn_lengths) / len(fn_lengths)))
    with open(tgtfile, &quotw&quot, encoding=&quotutf8&quot) as fw:</code></pre><h3>After Change</h3><pre><code class='java'>
    processed_dataset = {}
    with tqdm(total=len(dataset), desc=&quotProcessing&quot) as pbar:
        for i, ex in enumerate(pool.imap(encoder.encode, dataset, 100)):
            <a id="change">pbar.update()</a>
            processed_dataset[ex[&quotidx&quot]] = ex[&quotcode&quot]

    with open(tgtfile, &quotw&quot, encoding=&quotutf8&quot) as fw:
        for item in sorted(processed_dataset.items()):</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/wasiahmad/plbart/commit/40d61db8a56a9874dcf52dfb88ed9776a978f094#diff-3d2770977225695da79fe2fd3b33365cbaa41e4d6727c2a273b7b96e724e3481L36' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 52853496</div><div id='project'> Project Name: wasiahmad/plbart</div><div id='commit'> Commit Name: 40d61db8a56a9874dcf52dfb88ed9776a978f094</div><div id='time'> Time: 2021-06-09</div><div id='author'> Author: wasiahmad@ucla.edu</div><div id='file'> File Name: scripts/code_to_code/clone_detection/encode.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: preprocess(4)</div><div id='n_method'> N Method Name: preprocess(3)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: scripts/code_to_code/clone_detection/encode.py</div><div id='n_file'> N File Name: scripts/code_to_code/clone_detection/encode.py</div><div id='m_start'> M Start Line: 37</div><div id='m_end'> M End Line: 47</div><div id='n_start'> N Start Line: 45</div><div id='n_end'> N End Line: 61</div><BR>