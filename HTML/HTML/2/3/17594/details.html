<html><h3>Pattern ID :17594
</h3><img src='58211033.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
			&#47&#47print(preds.size())

			y = y.long()
			loss = self.Loss(preds_, <a id="change">torch.squeeze(</a>y<a id="change">)</a>)
			return preds, loss
		return preds
</code></pre><h3>After Change</h3><pre><code class='java'>
		&#47&#47xs = [torch.squeeze(k) for k in xs]
		preds_ = []
		loss = 0
		for i,k in <a id="change">enumerate(</a>xs<a id="change">)</a>:
			hs, cs = self.rim_model(row_index, ind, k, hs, cs)
			
			preds = self.Linear(hs.contiguous().view(x.size(0), -1))
			preds_.append(preds)
			if y is not None:
				loss<a id="change">+=</a>self.Loss(preds, y[:,i].squeeze().long())
		preds_ = torch.stack(preds_, dim = 1)
		if y is not None:
			loss/=len(xs)</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 3</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/dido1998/recurrent-independent-mechanisms/commit/d87a800096eaa36730cbabac535eea24973f3799#diff-e5165d0379320c04b38a0f79666ae179299255ae3019498345e3dd6fc2ef1521L255' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 58211033</div><div id='project'> Project Name: dido1998/recurrent-independent-mechanisms</div><div id='commit'> Commit Name: d87a800096eaa36730cbabac535eea24973f3799</div><div id='time'> Time: 2020-02-11</div><div id='author'> Author: adidolkar123@gmail.com</div><div id='file'> File Name: networks.py</div><div id='m_class'> M Class Name: CopyingModel</div><div id='n_method'> N Class Name: CopyingModel</div><div id='m_method'> M Method Name: forward(5)</div><div id='n_method'> N Method Name: forward(5)</div><div id='m_parent_class'> M Parent Class: nn.Module</div><div id='n_parent_class'> N Parent Class: nn.Module</div><div id='m_file'> M File Name: networks.py</div><div id='n_file'> N File Name: networks.py</div><div id='m_start'> M Start Line: 255</div><div id='m_end'> M End Line: 276</div><div id='n_start'> N Start Line: 291</div><div id='n_end'> N End Line: 313</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
                out = _stateless.functional_call(self._model, {n: p for n, p in zip(keys, params)}, x)
                return out
            self._j_list: tuple[torch.Tensor] = torch.autograd.functional.jacobian(func, values, create_graph=True)
            self._j_list = [<a id="change">j.squeeze(</a>1<a id="change">)</a>.flatten(start_dim=1) for j in self._j_list] &#47&#47 remove hidden and predict bias dimensions

            &#47&#47 vectorized hessian (https://github.com/pytorch/pytorch/issues/49171)
            def loss(*params):</code></pre><h3>After Change</h3><pre><code class='java'>
                    return out
                self._j_list: tuple[torch.Tensor] = torch.autograd.functional.jacobian(func, values, create_graph=False)    &#47&#47 NxCxBxCxHxW
                &#47&#47 create hessian approximation
                for i, j in <a id="change">enumerate(</a>self._j_list<a id="change">)</a>:
                    j = j.flatten(end_dim=len(self._j_list[i].shape)-len(d_p_list[i].shape)-1).flatten(start_dim=1)  &#47&#47 (NC)x(BCHW)
                    h<a id="change"> = </a>j.T.matmul(j)
                    self._h_list.append(h)
                
            else:</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/hahnec/torchimize/commit/d65b33c9e39df589093da6cf91b8998beb6aead2#diff-cf9a1e9bfb69bdf33a7cd99ce087c7d7f64730b5db5485b7d221927020235390L51' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 58211023</div><div id='project'> Project Name: hahnec/torchimize</div><div id='commit'> Commit Name: d65b33c9e39df589093da6cf91b8998beb6aead2</div><div id='time'> Time: 2022-07-23</div><div id='author'> Author: christopher.hahne@unibe.ch</div><div id='file'> File Name: torchimize/optimizer/gna_opt.py</div><div id='m_class'> M Class Name: GNA</div><div id='n_method'> N Class Name: GNA</div><div id='m_method'> M Method Name: step(3)</div><div id='n_method'> N Method Name: step(3)</div><div id='m_parent_class'> M Parent Class: Optimizer</div><div id='n_parent_class'> N Parent Class: Optimizer</div><div id='m_file'> M File Name: torchimize/optimizer/gna_opt.py</div><div id='n_file'> N File Name: torchimize/optimizer/gna_opt.py</div><div id='m_start'> M Start Line: 58</div><div id='m_end'> M End Line: 87</div><div id='n_start'> N Start Line: 62</div><div id='n_end'> N End Line: 84</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>

                d[key] = np.stack(modalities)
                if d[key].shape[0] == 1:
                    d[key] = <a id="change">np.squeeze(</a>d[key]<a id="change">, axis=0)</a>

                d[f"{key}_meta_dict"] = d["modality_meta_dict"]
                del d["modality"], d["modality_meta_dict"]
</code></pre><h3>After Change</h3><pre><code class='java'>
                d = load_image(d)
            else:
                modalities = {}
                for j, modality in <a id="change">enumerate(</a>d[key]<a id="change">)</a>:
                    modalities[f"modality_{j}"]<a id="change"> = </a>modality

                d = {**d, **modalities}
                load_image = Compose(</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/pashtari/factorizer/commit/51cecfcd602912078b77a9ab4849bd0f9aff7fab#diff-4b73a0e36c4bc4071d912f28c31b8e1275b8f593b03fd0f643c8b0c7a083b73cL56' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 58211025</div><div id='project'> Project Name: pashtari/factorizer</div><div id='commit'> Commit Name: 51cecfcd602912078b77a9ab4849bd0f9aff7fab</div><div id='time'> Time: 2022-09-13</div><div id='author'> Author: pooya.ash@gmail.com</div><div id='file'> File Name: factorizer/data/transforms.py</div><div id='m_class'> M Class Name: ReadImaged</div><div id='n_method'> N Class Name: ReadImaged</div><div id='m_method'> M Method Name: __call__(2)</div><div id='n_method'> N Method Name: __call__(2)</div><div id='m_parent_class'> M Parent Class: MapTransform</div><div id='n_parent_class'> N Parent Class: MapTransform</div><div id='m_file'> M File Name: factorizer/data/transforms.py</div><div id='n_file'> N File Name: factorizer/data/transforms.py</div><div id='m_start'> M Start Line: 57</div><div id='m_end'> M End Line: 80</div><div id='n_start'> N Start Line: 61</div><div id='n_end'> N End Line: 81</div><BR>