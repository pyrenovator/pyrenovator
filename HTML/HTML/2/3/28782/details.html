<html><h3>Pattern ID :28782
</h3><img src='84676612.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
  def expr_idxs(self, idxs, div=1, mod=None):
    idx_pieces = [str(self.offset)] + [(f"{idxs[i]}*{st}" if st != 1 else idxs[i]) for i,(sh,st) in enumerate(zip(self.shape, self.strides)) if sh != 1 and st != 0]
    &#47&#47 TODO: do the div and mod in a smarter way
    <a id="change">return </a>&quot((&quot+&quot + &quot.join(idx_pieces)+f&quot)/{div})&quot + (f&quot%{mod};\n&quot if mod is not None else &quot;\n&quot)

class ZeroView:
  def __init__(self, old_shape, arg):</code></pre><h3>After Change</h3><pre><code class='java'>

  &#47&#47 generate an expression if you have a variable or expression for each index
  def expr_idxs(self, idxs):
    <a id="change">return </a>Variable.sum([Variable.num(self.offset)] + [<a id="change">Variable(</a>idxs[i], 0, sh-1<a id="change">)</a>*st for i,(sh,st) in enumerate(zip(self.shape, self.strides)) if sh != 1 and st != 0])

class ZeroView:
  def __init__(self, old_shape, arg):</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 4</div><BR><div id='size'>Non-data size: 3</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/geohot/tinygrad/commit/2b47ee401f8e5e187b2ce048a59b0d70fc93de49#diff-11e06225c072e5ae917d1e5883dec7c8de89c310442a8960607eb591f7168d96L48' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 84676612</div><div id='project'> Project Name: geohot/tinygrad</div><div id='commit'> Commit Name: 2b47ee401f8e5e187b2ce048a59b0d70fc93de49</div><div id='time'> Time: 2023-01-19</div><div id='author'> Author: 72895+geohot@users.noreply.github.com</div><div id='file'> File Name: tinygrad/shapetracker.py</div><div id='m_class'> M Class Name: View</div><div id='n_method'> N Class Name: View</div><div id='m_method'> M Method Name: expr_idxs(2)</div><div id='n_method'> N Method Name: expr_idxs(4)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: tinygrad/shapetracker.py</div><div id='n_file'> N File Name: tinygrad/shapetracker.py</div><div id='m_start'> M Start Line: 50</div><div id='m_end'> M End Line: 53</div><div id='n_start'> N Start Line: 48</div><div id='n_end'> N End Line: 49</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
		pos = pos.T

		if self.method == &quotvariance&quot:
			<a id="change">return </a>self.wf.variance(param,pos)
		elif self.method == &quotenergy&quot:
			return self.wf.energy(param,pos)
</code></pre><h3>After Change</h3><pre><code class='java'>
			l = self.wf.variance(param,pos)
		elif self.method == &quotenergy&quot:
			l = self.wf.energy(param,pos)
		<a id="change">return </a><a id="change">Variable(</a>l<a id="change">)</a>
			

class NN(SOLVER_BASE):
</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/nlesc-jcer/qmctorch/commit/99ee9b8562f2f047dcddea957e04facb676509e5#diff-8565e26995619934aa09191934dd98b8c65029eec1c2a9fcaac905cdf31b5a0fL30' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 84676608</div><div id='project'> Project Name: nlesc-jcer/qmctorch</div><div id='commit'> Commit Name: 99ee9b8562f2f047dcddea957e04facb676509e5</div><div id='time'> Time: 2019-05-03</div><div id='author'> Author: nicolas.gm.renaud@gmail.com</div><div id='file'> File Name: pyCHAMP/solver/neural_net.py</div><div id='m_class'> M Class Name: QMCLoss</div><div id='n_method'> N Class Name: QMCLoss</div><div id='m_method'> M Method Name: forward(3)</div><div id='n_method'> N Method Name: forward(3)</div><div id='m_parent_class'> M Parent Class: nn.Module</div><div id='n_parent_class'> N Parent Class: nn.Module</div><div id='m_file'> M File Name: pyCHAMP/solver/neural_net.py</div><div id='n_file'> N File Name: pyCHAMP/solver/neural_net.py</div><div id='m_start'> M Start Line: 34</div><div id='m_end'> M End Line: 39</div><div id='n_start'> N Start Line: 34</div><div id='n_end'> N End Line: 40</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
&#47&#47                lengths = lengths.cuda(device)
        if self.include_lengths:
            return Variable(arr, volatile=not train), lengths, Variable(lim_arr, volatile=not train)
        <a id="change">return </a>Variable(arr, volatile=not train)


class ReversibleField(Field):</code></pre><h3>After Change</h3><pre><code class='java'>
        with torch.no_grad():
            if self.include_lengths:
                return Variable(arr), lengths, Variable(lim_arr)
            <a id="change">return </a><a id="change">Variable(</a>arr<a id="change">)</a>


class ReversibleField(Field):
</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/stanford-oval/genienlp/commit/457809f608a8dbb3942e5694cd3278d1b3b6a2e6#diff-4b2fc54836c4038976695188af0c6e5ebf4b65862cf5b23a25d9232d4c6bb6a7L291' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 84676610</div><div id='project'> Project Name: stanford-oval/genienlp</div><div id='commit'> Commit Name: 457809f608a8dbb3942e5694cd3278d1b3b6a2e6</div><div id='time'> Time: 2018-08-01</div><div id='author'> Author: mehrad@stanford.edu</div><div id='file'> File Name: text/torchtext/data/field.py</div><div id='m_class'> M Class Name: Field</div><div id='n_method'> N Class Name: Field</div><div id='m_method'> M Method Name: numericalize(7)</div><div id='n_method'> N Method Name: numericalize(7)</div><div id='m_parent_class'> M Parent Class: RawField</div><div id='n_parent_class'> N Parent Class: RawField</div><div id='m_file'> M File Name: text/torchtext/data/field.py</div><div id='n_file'> N File Name: text/torchtext/data/field.py</div><div id='m_start'> M Start Line: 358</div><div id='m_end'> M End Line: 374</div><div id='n_start'> N Start Line: 358</div><div id='n_end'> N End Line: 377</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
    inMask = F.interpolate(inMask, (inMask.size(2)//ntimes, inMask.size(3)//ntimes), mode=&quotnearest&quot)
    inMask = inMask.detach().byte()

    <a id="change">return </a>inMask

def cal_mask_given_mask_thred(img, mask, patch_size, stride, mask_thred):
    assert img.dim() == 3, &quotimg has to be 3 dimenison!&quot</code></pre><h3>After Change</h3><pre><code class='java'>
    assert inMask.size(0) == 1, "the first dimension must be 1 for mask"
    inMask = inMask.float()
    convs = []
    inMask = <a id="change">Variable(</a>inMask<a id="change">, requires_grad = False)</a>
    for id_net in range(conv_layers):
        conv = nn.Conv2d(1,1,4,2,1, bias=False)
        conv.weight.data.fill_(1/16)
        convs.append(conv)
    lnet = nn.Sequential(*convs)
    if inMask.is_cuda:

        lnet = lnet.cuda()
    output = lnet(inMask)
    output = (output &gt; threshold).float().mul_(1)

    <a id="change">return </a>output

def cal_mask_given_mask_thred(img, mask, patch_size, stride, mask_thred):
    assert img.dim() == 3, &quotimg has to be 3 dimenison!&quot</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/kumapowerliu/rethinking-inpainting-medfe/commit/17d04d208950c9c4e2e8bc5251cf06205ec15285#diff-d6757ab1e3ffa225bc5e10234856fffd764bbefcce478fc1c4baee1f4c7ef308L76' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 84676611</div><div id='project'> Project Name: kumapowerliu/rethinking-inpainting-medfe</div><div id='commit'> Commit Name: 17d04d208950c9c4e2e8bc5251cf06205ec15285</div><div id='time'> Time: 2020-11-07</div><div id='author'> Author: 33801357+KumapowerLIU@users.noreply.github.com</div><div id='file'> File Name: util/util.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: cal_feat_mask(3)</div><div id='n_method'> N Method Name: cal_feat_mask(2)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: util/util.py</div><div id='n_file'> N File Name: util/util.py</div><div id='m_start'> M Start Line: 78</div><div id='m_end'> M End Line: 83</div><div id='n_start'> N Start Line: 76</div><div id='n_end'> N End Line: 93</div><BR>