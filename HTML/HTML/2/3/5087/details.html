<html><h3>Pattern ID :5087
</h3><img src='17919763.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
      metrics_list = [result[i][&quotmetrics&quot] for result in results]
      costs = [self.get_cost(metrics_for_threshold, config)
               for metrics_for_threshold in metrics_list]
      best_idx<a id="change"> = </a><a id="change">np.argmin(</a>costs<a id="change">)</a>
      &#47&#47 Divide best index by 100 to get threshold value between 0 and 1.
      single_threshold = best_idx / 100
      faceted_thresholds = {}
      for facet_key in config.facets:</code></pre><h3>After Change</h3><pre><code class='java'>
            indexed_outputs[ex[&quotid&quot]]
            for ex in config.facets[facet_key][&quotdata&quot]]
        faceted_results[facet_key].append(self.metrics_gen.run_with_metadata(
            <a id="change">config.facets[facet_key][&quotdata&quot]</a>, model, dataset,
            faceted_model_outputs, metrics_config))

    pred_keys = [result[&quotpred_key&quot] for result in dataset_results[0]]</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 4</div><BR><div id='size'>Non-data size: 3</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/pair-code/lit/commit/c5289c07a1ba31719eb4b4ddaf1aa8a3793f6e73#diff-6cae70c3c1981641d1f1ddee87470ae8ef95a8d0d94a9ef6af454f4569c2557fL87' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 17919763</div><div id='project'> Project Name: pair-code/lit</div><div id='commit'> Commit Name: c5289c07a1ba31719eb4b4ddaf1aa8a3793f6e73</div><div id='time'> Time: 2021-08-19</div><div id='author'> Author: jwexler@google.com</div><div id='file'> File Name: lit_nlp/components/thresholder.py</div><div id='m_class'> M Class Name: Thresholder</div><div id='n_method'> N Class Name: Thresholder</div><div id='m_method'> M Method Name: run_with_metadata(6)</div><div id='n_method'> N Method Name: run_with_metadata(6)</div><div id='m_parent_class'> M Parent Class: lit_components.Interpreter</div><div id='n_parent_class'> N Parent Class: lit_components.Interpreter</div><div id='m_file'> M File Name: lit_nlp/components/thresholder.py</div><div id='n_file'> N File Name: lit_nlp/components/thresholder.py</div><div id='m_start'> M Start Line: 87</div><div id='m_end'> M End Line: 125</div><div id='n_start'> N Start Line: 186</div><div id='n_end'> N End Line: 238</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        else:
            diffs = rearrange(samples, &quotn d -&gt; n () d&quot) - rearrange(means, &quotc d -&gt; () c d&quot)
            dists = (diffs ** 2).sum(dim = -1)
            buckets<a id="change"> = </a><a id="change">dists.argmin(dim = -1)</a>

        bins = torch.bincount(buckets, minlength = num_clusters)
        zero_mask = bins == 0
        bins = bins.masked_fill(zero_mask, 1)</code></pre><h3>After Change</h3><pre><code class='java'>
    return samples[indices]

def kmeans(samples, num_clusters, num_iters = 10, use_cosine_sim = False):
    dim, dtype, device = <a id="change">samples.shape[-1]</a>, samples.dtype, samples.device

    means = sample_vectors(samples, num_clusters)
</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/lucidrains/vector-quantize-pytorch/commit/b1f5d8edb7be48ff1fa9ec8959b6097dcb7aa99a#diff-8bcd9c958b614ce130dc4091c094d4cfcc2023716823c181e3a9edaddbcd433dL21' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 17919707</div><div id='project'> Project Name: lucidrains/vector-quantize-pytorch</div><div id='commit'> Commit Name: b1f5d8edb7be48ff1fa9ec8959b6097dcb7aa99a</div><div id='time'> Time: 2021-10-18</div><div id='author'> Author: lucidrains@gmail.com</div><div id='file'> File Name: vector_quantize_pytorch/vector_quantize_pytorch.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: kmeans(4)</div><div id='n_method'> N Method Name: kmeans(4)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: vector_quantize_pytorch/vector_quantize_pytorch.py</div><div id='n_file'> N File Name: vector_quantize_pytorch/vector_quantize_pytorch.py</div><div id='m_start'> M Start Line: 22</div><div id='m_end'> M End Line: 39</div><div id='n_start'> N Start Line: 32</div><div id='n_end'> N End Line: 43</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
                match = [-1] * gt_len

                for _ in range(gt_len):  &#47&#47 this many pair to arrange
                    to_match_idx = <a id="change">dist_matrix.argmin()</a>  &#47&#47 current global min is also a best match for the pair it&quots calculated for!
                    row = to_match_idx // dist_matrix.shape[0]
                    col<a id="change"> = </a>to_match_idx % dist_matrix.shape[0]
                    match[row] = col

                    &#47&#47 exlude distances with matched edges from further consideration</code></pre><h3>After Change</h3><pre><code class='java'>
                &#47&#47 Gather the GT in requested order
                match = [-1] * gt_len
                for left, right in indexes:
                    <a id="change">match[left]</a> = right

                rearranged_pattern = torch.stack([gt_patterns[pattern_idx][i] for i in match]).to(predicted_patterns.device)
</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/maria-korosteleva/garment-pattern-estimation/commit/99ab8d47fced9d447b88c94f6d20c0ffcef9da30#diff-66aae7ec57f079963bb4847ebb79bfda4004ba832ee23e11911a14908193967cL789' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 17919739</div><div id='project'> Project Name: maria-korosteleva/garment-pattern-estimation</div><div id='commit'> Commit Name: 99ab8d47fced9d447b88c94f6d20c0ffcef9da30</div><div id='time'> Time: 2021-04-28</div><div id='author'> Author: mariako@kaist.ac.kr</div><div id='file'> File Name: nn/metrics.py</div><div id='m_class'> M Class Name: ComposedPatternLoss</div><div id='n_method'> N Class Name: ComposedPatternLoss</div><div id='m_method'> M Method Name: _panel_order_match(3)</div><div id='n_method'> N Method Name: _panel_order_match(3)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: nn/metrics.py</div><div id='n_file'> N File Name: nn/metrics.py</div><div id='m_start'> M Start Line: 798</div><div id='m_end'> M End Line: 828</div><div id='n_start'> N Start Line: 822</div><div id='n_end'> N End Line: 845</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        self.add_state("cumulative_squared_distance", torch.zeros(1), dist_reduce_fx="cat")

    def update(self, data: torch.Tensor, distances: torch.Tensor) -&gt; None:
        shortest_distances = distances.gather(1, <a id="change">distances.argmin(</a>1<a id="change">, keepdim=True)</a>).squeeze(1)
        squared_distances = shortest_distances.square()
        weights = torch.cat([self.cumulative_squared_distance, squared_distances])
        choice<a id="change"> = </a>weights.multinomial(1)
        if choice.item() != 0:
            &#47&#47 If the choice is not 0, one of the new datapoints is chosen
            self.choice.copy_(data[choice - 1])</code></pre><h3>After Change</h3><pre><code class='java'>
        &#47&#47 Then, we sample from the data `num_choices` times and replace if needed
        choices = (squared_distances + eps).multinomial(self.num_choices, replacement=True)
        self.choices.masked_scatter_(
            use_choice_from_data.unsqueeze(1), <a id="change">data[choices[use_choice_from_data]]</a>
        )

        &#47&#47 In any case, the cumulative distances are updated
        self.cumulative_squared_distance.add_(data_dist)</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/borchero/pycave/commit/6d08623932e425385192f37f888e2fab68338fa0#diff-bd42cdf2cd175e5c83a601b48a3c1cd04a5ecc3d1460c9c8352ec0d80005ebb4L106' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 17919710</div><div id='project'> Project Name: borchero/pycave</div><div id='commit'> Commit Name: 6d08623932e425385192f37f888e2fab68338fa0</div><div id='time'> Time: 2021-10-19</div><div id='author'> Author: oliver@taskfleet.io</div><div id='file'> File Name: pycave/clustering/kmeans/metrics.py</div><div id='m_class'> M Class Name: DistanceSampler</div><div id='n_method'> N Class Name: DistanceSampler</div><div id='m_method'> M Method Name: update(3)</div><div id='n_method'> N Method Name: update(3)</div><div id='m_parent_class'> M Parent Class: Metric</div><div id='n_parent_class'> N Parent Class: Metric</div><div id='m_file'> M File Name: pycave/clustering/kmeans/metrics.py</div><div id='n_file'> N File Name: pycave/clustering/kmeans/metrics.py</div><div id='m_start'> M Start Line: 107</div><div id='m_end'> M End Line: 116</div><div id='n_start'> N Start Line: 125</div><div id='n_end'> N End Line: 143</div><BR>