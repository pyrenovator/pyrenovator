<link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>


def _fast_rcnn_loc_loss(pred_loc, gt_loc, gt_label, sigma):
    in_weight = <a id="change">torch.zeros(</a>gt_loc.shape<a id="change">)</a>
    in_weight[(gt_label &gt; 0).view(-1, 1).expand_as(in_weight)] = 1

    if pred_loc.is_cuda:
        gt_loc = gt_loc.cuda()
        in_weight<a id="change"> = </a>in_weight.cuda()
    &#47&#47 smooth_l1损失函数
    loc_loss = _smooth_l1_loss(pred_loc, gt_loc, in_weight.detach(), sigma)
    &#47&#47 进行标准化</code></pre><h3>After Change</h3><pre><code class='java'>

    loc_loss = _smooth_l1_loss(pred_loc, gt_loc, sigma)
    num_pos = (gt_label &gt; 0).sum().float()
    loc_loss /= <a id="change">torch.max(</a>num_pos, torch.ones_like(num_pos)<a id="change">)</a>
    return loc_loss
</code></pre>