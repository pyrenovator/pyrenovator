<html><h3>Pattern ID :19062
</h3><img src='62167860.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
        config_path = &quotconfigs/detection/fcos/fcos_r50_torch_1x_coco.py&quot
        img = &quothttps://pai-vision-data-hz.oss-cn-zhangjiakou.aliyuncs.com/data/demo/demo.jpg&quot
        fcos = DetrPredictor(model_path, config_path)
        <a id="change">output</a> = <a id="change">fcos.predict(img</a><a id="change">)</a>
        <a id="change">fcos.visualize(</a>img, output<a id="change">, out_file=None)</a>

        self.assertIn(&quotdetection_boxes&quot, output)
        self.assertIn(&quotdetection_scores&quot, output)
        self.assertIn(&quotdetection_classes&quot, output)
        self.assertIn(&quotimg_metas&quot, output)
        self.assertEqual(len(<a id="change">output[&quotdetection_boxes&quot][0]</a>), 100)
        self.assertEqual(len(<a id="change">output[&quotdetection_scores&quot][0]</a>), 100)
        self.assertEqual(len(<a id="change">output[&quotdetection_classes&quot][0]</a>), 100)

        self.assertListEqual(
            <a id="change">output[&quotdetection_classes&quot][0][:10]</a>.tolist(),
            np.array([0, 0, 0, 0, 0, 0, 0, 2, 2, 2], dtype=np.int32).tolist())

        assert_array_almost_equal(
            <a id="change">output[&quotdetection_scores&quot][0][:10]</a>,
            np.array([
                0.16172607243061066, 0.13118137419223785, 0.12351018935441971,
                0.11615370959043503, 0.09833250194787979, 0.0773085504770279,
                0.07507805526256561, 0.7142091989517212, 0.6164696216583252,
                0.5857587456703186
            ],
                     dtype=np.float32),
            decimal=2)

        assert_array_almost_equal(
            <a id="change">output[&quotdetection_boxes&quot][0][:10]</a>,
            np.array([[
                255.08067321777344, 102.54728698730469, 261.5584411621094,
                112.76062774658203</code></pre><h3>After Change</h3><pre><code class='java'>
        config_path = &quotconfigs/detection/fcos/fcos_r50_torch_1x_coco.py&quot
        img = &quothttps://pai-vision-data-hz.oss-cn-zhangjiakou.aliyuncs.com/data/demo/demo.jpg&quot
        model = DetectionPredictor(model_path, config_path)
        <a id="change">output</a> = <a id="change">model(img)[0]</a>
        <a id="change">with tempfile.NamedTemporaryFile(suffix=&quot.jpg&quot)</a><a id="change"> as tmp_file:
            </a>tmp_save_path<a id="change"> = </a>tmp_file.name
            <a id="change">model.visualize(</a>img, output<a id="change">, out_file=tmp_save_path)</a>

        self.assertIn(&quotdetection_boxes&quot, output)
        self.assertIn(&quotdetection_scores&quot, output)
        self.assertIn(&quotdetection_classes&quot, output)
        self.assertIn(&quotimg_metas&quot, output)
        self.assertEqual(len(<a id="change">output[&quotdetection_boxes&quot]</a>), 7)
        self.assertEqual(len(<a id="change">output[&quotdetection_scores&quot]</a>), 7)
        self.assertEqual(len(<a id="change">output[&quotdetection_classes&quot]</a>), 7)

        assert_array_almost_equal(
            <a id="change">output[&quotdetection_classes&quot]</a>.tolist(),
            np.array([2, 2, 2, 2, 2, 2, 2], dtype=np.int32).tolist())

        assert_array_almost_equal(
            <a id="change">output[&quotdetection_scores&quot]</a>,
            np.array([
                0.7142099, 0.61647004, 0.5857586, 0.5839255, 0.5378273,
                0.5127002, 0.5077106
            ],
                     dtype=np.float32),
            decimal=2)

        assert_array_almost_equal(
            <a id="change">output[&quotdetection_boxes&quot]</a>,
            np.array([[294.96497, 116.47906, 378.7294, 149.90738],
                      [480.34415, 110.31671, 523.0271, 130.33409],
                      [398.22247, 110.64816, 433.01566, 133.1527],</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 39</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/alibaba/easycv/commit/5583101471a0f2f06afcf911291f20eec270a8d9#diff-72c5f86f7405c4b97a241ea72304e5d1f83776619ee292105c486eb2af747e2aL18' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 62167860</div><div id='project'> Project Name: alibaba/easycv</div><div id='commit'> Commit Name: 5583101471a0f2f06afcf911291f20eec270a8d9</div><div id='time'> Time: 2022-12-08</div><div id='author'> Author: 38110862+tuofeilunhifi@users.noreply.github.com</div><div id='file'> File Name: tests/models/detection/fcos/test_fcos.py</div><div id='m_class'> M Class Name: FCOSTest</div><div id='n_method'> N Class Name: FCOSTest</div><div id='m_method'> M Method Name: test_fcos(1)</div><div id='n_method'> N Method Name: test_fcos(1)</div><div id='m_parent_class'> M Parent Class: unittest.TestCase</div><div id='n_parent_class'> N Parent Class: unittest.TestCase</div><div id='m_file'> M File Name: tests/models/detection/fcos/test_fcos.py</div><div id='n_file'> N File Name: tests/models/detection/fcos/test_fcos.py</div><div id='m_start'> M Start Line: 18</div><div id='m_end'> M End Line: 87</div><div id='n_start'> N Start Line: 19</div><div id='n_end'> N End Line: 48</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
    def test_fcos(self):
        model_path = &quothttps://pai-vision-data-hz.oss-cn-zhangjiakou.aliyuncs.com/EasyCV/modelzoo/detection/fcos/fcos_epoch_12.pth&quot
        config_path = &quotconfigs/detection/fcos/fcos_r50_torch_1x_coco.py&quot
        <a id="change">img</a> = &quothttps://pai-vision-data-hz.oss-cn-zhangjiakou.aliyuncs.com/data/demo/demo.jpg&quot
        <a id="change">fcos</a> = DetrPredictor(model_path, config_path)
        <a id="change">output</a> = <a id="change">fcos.predict(</a>img<a id="change">)</a>
        <a id="change">fcos.visualize(</a>img, output<a id="change">, out_file=None)</a>

        self.assertIn(&quotdetection_boxes&quot, output)
        self.assertIn(&quotdetection_scores&quot, output)
        self.assertIn(&quotdetection_classes&quot, output)
        self.assertIn(&quotimg_metas&quot, output)
        self.assertEqual(len(<a id="change">output[&quotdetection_boxes&quot][0]</a>), 100)
        self.assertEqual(len(<a id="change">output[&quotdetection_scores&quot][0]</a>), 100)
        self.assertEqual(len(<a id="change">output[&quotdetection_classes&quot][0]</a>), 100)

        self.assertListEqual(
            <a id="change">output[&quotdetection_classes&quot][0][:10]</a>.tolist(),
            np.array([0, 0, 0, 0, 0, 0, 0, 2, 2, 2], dtype=np.int32).tolist())

        assert_array_almost_equal(
            <a id="change">output[&quotdetection_scores&quot][0][:10]</a>,
            np.array([
                0.16172607243061066, 0.13118137419223785, 0.12351018935441971,
                0.11615370959043503, 0.09833250194787979, 0.0773085504770279,
                0.07507805526256561, 0.7142091989517212, 0.6164696216583252,
                0.5857587456703186
            ],
                     dtype=np.float32),
            decimal=2)

        assert_array_almost_equal(
            <a id="change">output[&quotdetection_boxes&quot][0][:10]</a>,
            np.array([[
                255.08067321777344, 102.54728698730469, 261.5584411621094,
                112.76062774658203</code></pre><h3>After Change</h3><pre><code class='java'>
    def test_fcos(self):
        model_path = &quothttps://pai-vision-data-hz.oss-cn-zhangjiakou.aliyuncs.com/EasyCV/modelzoo/detection/fcos/fcos_epoch_12.pth&quot
        config_path = &quotconfigs/detection/fcos/fcos_r50_torch_1x_coco.py&quot
        <a id="change">img</a> = &quothttps://pai-vision-data-hz.oss-cn-zhangjiakou.aliyuncs.com/data/demo/demo.jpg&quot
        model = DetectionPredictor(model_path, config_path)
        <a id="change">output</a> = <a id="change">model(img)[0]</a>
        <a id="change">with tempfile.NamedTemporaryFile(suffix=&quot.jpg&quot)</a><a id="change"> as tmp_file:
            </a>tmp_save_path<a id="change"> = </a>tmp_file.name
            <a id="change">model.visualize(</a>img, output<a id="change">, out_file=tmp_save_path)</a>

        self.assertIn(&quotdetection_boxes&quot, output)
        self.assertIn(&quotdetection_scores&quot, output)
        self.assertIn(&quotdetection_classes&quot, output)
        self.assertIn(&quotimg_metas&quot, output)
        self.assertEqual(len(<a id="change">output[&quotdetection_boxes&quot]</a>), 7)
        self.assertEqual(len(<a id="change">output[&quotdetection_scores&quot]</a>), 7)
        self.assertEqual(len(<a id="change">output[&quotdetection_classes&quot]</a>), 7)

        assert_array_almost_equal(
            <a id="change">output[&quotdetection_classes&quot]</a>.tolist(),
            np.array([2, 2, 2, 2, 2, 2, 2], dtype=np.int32).tolist())

        assert_array_almost_equal(
            <a id="change">output[&quotdetection_scores&quot]</a>,
            np.array([
                0.7142099, 0.61647004, 0.5857586, 0.5839255, 0.5378273,
                0.5127002, 0.5077106
            ],
                     dtype=np.float32),
            decimal=2)

        assert_array_almost_equal(
            <a id="change">output[&quotdetection_boxes&quot]</a>,
            np.array([[294.96497, 116.47906, 378.7294, 149.90738],
                      [480.34415, 110.31671, 523.0271, 130.33409],
                      [398.22247, 110.64816, 433.01566, 133.1527],</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/alibaba/easycv/commit/5583101471a0f2f06afcf911291f20eec270a8d9#diff-72c5f86f7405c4b97a241ea72304e5d1f83776619ee292105c486eb2af747e2aL15' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 62167861</div><div id='project'> Project Name: alibaba/easycv</div><div id='commit'> Commit Name: 5583101471a0f2f06afcf911291f20eec270a8d9</div><div id='time'> Time: 2022-12-08</div><div id='author'> Author: 38110862+tuofeilunhifi@users.noreply.github.com</div><div id='file'> File Name: tests/models/detection/fcos/test_fcos.py</div><div id='m_class'> M Class Name: FCOSTest</div><div id='n_method'> N Class Name: FCOSTest</div><div id='m_method'> M Method Name: test_fcos(1)</div><div id='n_method'> N Method Name: test_fcos(1)</div><div id='m_parent_class'> M Parent Class: unittest.TestCase</div><div id='n_parent_class'> N Parent Class: unittest.TestCase</div><div id='m_file'> M File Name: tests/models/detection/fcos/test_fcos.py</div><div id='n_file'> N File Name: tests/models/detection/fcos/test_fcos.py</div><div id='m_start'> M Start Line: 18</div><div id='m_end'> M End Line: 87</div><div id='n_start'> N Start Line: 19</div><div id='n_end'> N End Line: 48</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
    def test_dab_detr(self):
        model_path = &quothttps://pai-vision-data-hz.oss-cn-zhangjiakou.aliyuncs.com/EasyCV/modelzoo/detection/dab_detr/dab_detr_epoch_50.pth&quot
        config_path = &quotconfigs/detection/dab_detr/dab_detr_r50_8x2_50e_coco.py&quot
        <a id="change">img</a> = &quothttps://pai-vision-data-hz.oss-cn-zhangjiakou.aliyuncs.com/data/demo/demo.jpg&quot
        <a id="change">dab_detr</a> = DetrPredictor(model_path, config_path)
        <a id="change">output</a> = <a id="change">dab_detr.predict(</a>img<a id="change">)</a>
        <a id="change">dab_detr.visualize(</a>img, output<a id="change">, out_file=None)</a>

        self.assertIn(&quotdetection_boxes&quot, output)
        self.assertIn(&quotdetection_scores&quot, output)
        self.assertIn(&quotdetection_classes&quot, output)
        self.assertIn(&quotimg_metas&quot, output)
        self.assertEqual(len(<a id="change">output[&quotdetection_boxes&quot][0]</a>), 300)
        self.assertEqual(len(<a id="change">output[&quotdetection_scores&quot][0]</a>), 300)
        self.assertEqual(len(<a id="change">output[&quotdetection_classes&quot][0]</a>), 300)

        self.assertListEqual(
            <a id="change">output[&quotdetection_classes&quot][0][:10]</a>.tolist(),
            np.array([2, 2, 13, 2, 2, 2, 2, 2, 2, 2], dtype=np.int32).tolist())

        assert_array_almost_equal(
            <a id="change">output[&quotdetection_scores&quot][0][:10]</a>,
            np.array([
                0.7688284516334534, 0.7646799683570862, 0.7159939408302307,
                0.6902833580970764, 0.6633996367454529, 0.6523147821426392,
                0.633848249912262, 0.6229104995727539, 0.611840009689331,
                0.5631589293479919
            ],
                     dtype=np.float32),
            decimal=2)

        assert_array_almost_equal(
            <a id="change">output[&quotdetection_boxes&quot][0][:10]</a>,
            np.array([[
                294.2984313964844, 116.07160949707031, 380.4406433105469,
                149.6365509033203</code></pre><h3>After Change</h3><pre><code class='java'>
    def test_dab_detr(self):
        model_path = &quothttps://pai-vision-data-hz.oss-cn-zhangjiakou.aliyuncs.com/EasyCV/modelzoo/detection/dab_detr/dab_detr_epoch_50.pth&quot
        config_path = &quotconfigs/detection/dab_detr/dab_detr_r50_8x2_50e_coco.py&quot
        <a id="change">img</a> = &quothttps://pai-vision-data-hz.oss-cn-zhangjiakou.aliyuncs.com/data/demo/demo.jpg&quot
        model = DetectionPredictor(model_path, config_path)
        <a id="change">output</a> = <a id="change">model(img)[0]</a>
        <a id="change">with tempfile.NamedTemporaryFile(suffix=&quot.jpg&quot)</a><a id="change"> as tmp_file:
            </a>tmp_save_path<a id="change"> = </a>tmp_file.name
            <a id="change">model.visualize(</a>img, output<a id="change">, out_file=tmp_save_path)</a>

        self.assertIn(&quotdetection_boxes&quot, output)
        self.assertIn(&quotdetection_scores&quot, output)
        self.assertIn(&quotdetection_classes&quot, output)
        self.assertIn(&quotimg_metas&quot, output)
        self.assertEqual(len(<a id="change">output[&quotdetection_boxes&quot]</a>), 14)
        self.assertEqual(len(<a id="change">output[&quotdetection_scores&quot]</a>), 14)
        self.assertEqual(len(<a id="change">output[&quotdetection_classes&quot]</a>), 14)

        assert_array_almost_equal(
            <a id="change">output[&quotdetection_classes&quot]</a>.tolist(),
            np.array([2, 2, 13, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2],
                     dtype=np.int32).tolist())

        assert_array_almost_equal(
            <a id="change">output[&quotdetection_scores&quot]</a>,
            np.array([
                0.76882976, 0.7646885, 0.7161126, 0.690265, 0.66343737,
                0.6523155, 0.6338446, 0.6229081, 0.61183584, 0.56314564,
                0.5553375, 0.52696437, 0.5121799, 0.50143206
            ],
                     dtype=np.float32),
            decimal=2)

        assert_array_almost_equal(
            <a id="change">output[&quotdetection_boxes&quot]</a>,
            np.array([[
                2.94298431e+02, 1.16071609e+02, 3.80441406e+02, 1.49636551e+02
            ], [</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/alibaba/easycv/commit/5583101471a0f2f06afcf911291f20eec270a8d9#diff-f91529a3bcf285f8069cadd3556173412f5d1a9a7d71f020dd6d5047a6cf0f14L90' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 62167862</div><div id='project'> Project Name: alibaba/easycv</div><div id='commit'> Commit Name: 5583101471a0f2f06afcf911291f20eec270a8d9</div><div id='time'> Time: 2022-12-08</div><div id='author'> Author: 38110862+tuofeilunhifi@users.noreply.github.com</div><div id='file'> File Name: tests/models/detection/detr/test_detr.py</div><div id='m_class'> M Class Name: DETRTest</div><div id='n_method'> N Class Name: DETRTest</div><div id='m_method'> M Method Name: test_dab_detr(1)</div><div id='n_method'> N Method Name: test_dab_detr(1)</div><div id='m_parent_class'> M Parent Class: unittest.TestCase</div><div id='n_parent_class'> N Parent Class: unittest.TestCase</div><div id='m_file'> M File Name: tests/models/detection/detr/test_detr.py</div><div id='n_file'> N File Name: tests/models/detection/detr/test_detr.py</div><div id='m_start'> M Start Line: 93</div><div id='m_end'> M End Line: 122</div><div id='n_start'> N Start Line: 115</div><div id='n_end'> N End Line: 146</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
    def test_dn_detr(self):
        model_path = &quothttps://pai-vision-data-hz.oss-cn-zhangjiakou.aliyuncs.com/EasyCV/modelzoo/detection/dn_detr/dn_detr_epoch_50.pth&quot
        config_path = &quotconfigs/detection/dab_detr/dn_detr_r50_8x2_50e_coco.py&quot
        <a id="change">img</a> = &quothttps://pai-vision-data-hz.oss-cn-zhangjiakou.aliyuncs.com/data/demo/demo.jpg&quot
        <a id="change">dn_detr</a> = DetrPredictor(model_path, config_path)
        <a id="change">output</a> = <a id="change">dn_detr.predict(</a>img<a id="change">)</a>
        <a id="change">dn_detr.visualize(</a>img, output<a id="change">, out_file=None)</a>

        self.assertIn(&quotdetection_boxes&quot, output)
        self.assertIn(&quotdetection_scores&quot, output)
        self.assertIn(&quotdetection_classes&quot, output)
        self.assertIn(&quotimg_metas&quot, output)
        self.assertEqual(len(<a id="change">output[&quotdetection_boxes&quot][0]</a>), 300)
        self.assertEqual(len(<a id="change">output[&quotdetection_scores&quot][0]</a>), 300)
        self.assertEqual(len(<a id="change">output[&quotdetection_classes&quot][0]</a>), 300)

        self.assertListEqual(
            <a id="change">output[&quotdetection_classes&quot][0][:10]</a>.tolist(),
            np.array([2, 13, 2, 2, 2, 2, 2, 2, 2, 2], dtype=np.int32).tolist())

        assert_array_almost_equal(
            <a id="change">output[&quotdetection_scores&quot][0][:10]</a>,
            np.array([
                0.8800525665283203, 0.866659939289093, 0.8665854930877686,
                0.8030595183372498, 0.7642921209335327, 0.7375038862228394,
                0.7270554304122925, 0.6710091233253479, 0.6316548585891724,
                0.6164721846580505
            ],
                     dtype=np.float32),
            decimal=2)

        assert_array_almost_equal(
            <a id="change">output[&quotdetection_boxes&quot][0][:10]</a>,
            np.array([[
                294.9338073730469, 115.7542495727539, 377.5517578125,
                150.59274291992188</code></pre><h3>After Change</h3><pre><code class='java'>
    def test_dn_detr(self):
        model_path = &quothttps://pai-vision-data-hz.oss-cn-zhangjiakou.aliyuncs.com/EasyCV/modelzoo/detection/dn_detr/dn_detr_epoch_50.pth&quot
        config_path = &quotconfigs/detection/dab_detr/dn_detr_r50_8x2_50e_coco.py&quot
        <a id="change">img</a> = &quothttps://pai-vision-data-hz.oss-cn-zhangjiakou.aliyuncs.com/data/demo/demo.jpg&quot
        model = DetectionPredictor(model_path, config_path)
        <a id="change">output</a> = <a id="change">model(img)[0]</a>
        <a id="change">with tempfile.NamedTemporaryFile(suffix=&quot.jpg&quot)</a><a id="change"> as tmp_file:
            </a>tmp_save_path<a id="change"> = </a>tmp_file.name
            <a id="change">model.visualize(</a>img, output<a id="change">, out_file=tmp_save_path)</a>

        self.assertIn(&quotdetection_boxes&quot, output)
        self.assertIn(&quotdetection_scores&quot, output)
        self.assertIn(&quotdetection_classes&quot, output)
        self.assertIn(&quotimg_metas&quot, output)
        self.assertEqual(len(<a id="change">output[&quotdetection_boxes&quot]</a>), 16)
        self.assertEqual(len(<a id="change">output[&quotdetection_scores&quot]</a>), 16)
        self.assertEqual(len(<a id="change">output[&quotdetection_classes&quot]</a>), 16)

        assert_array_almost_equal(
            <a id="change">output[&quotdetection_classes&quot]</a>.tolist(),
            np.array([2, 13, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 56],
                     dtype=np.int32).tolist())

        assert_array_almost_equal(
            <a id="change">output[&quotdetection_scores&quot]</a>,
            np.array([
                0.8800604, 0.8667884, 0.86659354, 0.80306965, 0.7643116,
                0.73749566, 0.72706455, 0.67101157, 0.63163954, 0.61646515,
                0.5724492, 0.55362254, 0.5403437, 0.515215, 0.5129325,
                0.5115242
            ],
                     dtype=np.float32),
            decimal=2)

        assert_array_almost_equal(
            <a id="change">output[&quotdetection_boxes&quot]</a>,
            np.array([[
                2.94934113e+02, 1.15754349e+02, 3.77551117e+02, 1.50592712e+02
            ], [</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/alibaba/easycv/commit/5583101471a0f2f06afcf911291f20eec270a8d9#diff-f91529a3bcf285f8069cadd3556173412f5d1a9a7d71f020dd6d5047a6cf0f14L165' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 62167868</div><div id='project'> Project Name: alibaba/easycv</div><div id='commit'> Commit Name: 5583101471a0f2f06afcf911291f20eec270a8d9</div><div id='time'> Time: 2022-12-08</div><div id='author'> Author: 38110862+tuofeilunhifi@users.noreply.github.com</div><div id='file'> File Name: tests/models/detection/detr/test_detr.py</div><div id='m_class'> M Class Name: DETRTest</div><div id='n_method'> N Class Name: DETRTest</div><div id='m_method'> M Method Name: test_dn_detr(1)</div><div id='n_method'> N Method Name: test_dn_detr(1)</div><div id='m_parent_class'> M Parent Class: unittest.TestCase</div><div id='n_parent_class'> N Parent Class: unittest.TestCase</div><div id='m_file'> M File Name: tests/models/detection/detr/test_detr.py</div><div id='n_file'> N File Name: tests/models/detection/detr/test_detr.py</div><div id='m_start'> M Start Line: 168</div><div id='m_end'> M End Line: 197</div><div id='n_start'> N Start Line: 181</div><div id='n_end'> N End Line: 213</div><BR>