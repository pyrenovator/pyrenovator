<html><h3>Pattern ID :10740
</h3><img src='36996420.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
    if type(poses)==dict: poses = list(poses.values())
    for p in poses:
        center = (p.eye[0:2] - np.array((min_x, min_y)))*scale
        end= center+15<a id="change">*scale*</a>np.array((<a id="change">-np.cos(p.phi)</a>, <a id="change">-np.sin(p.phi)</a>))
        cv2.circle(img, (int(center[0]), int(center[1])), 6, (0,0,255), 4)
        if draw_arrows:
            cv2.arrowedLine(img, (int(center[0]), int(center[1])), (int(end[0]), int(end[1])), (0,0,255), 4)</code></pre><h3>After Change</h3><pre><code class='java'>
        if pose_descriptions is not None:
            for do in pose_descriptions[i_p]:
                object3d = objects_dict[do.id]
                end = np.int0(( 0.5*(np.max(<a id="change">object3d.points_w[:, 0:2]</a>, axis=0) + np.min(object3d.points_w[:, 0:2], axis=0)) - np.array((min_x, min_y))) * scale)
                cv2.arrowedLine(img, (center[0], center[1]), (end[0], end[1]), (255,255,255), thickness=2)            
    return img
</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 7</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/mako443/text2pos-cvpr2022/commit/6d0e8e215c9a853543189a6d3f8f7a7239743626#diff-a88cbc512a551412b8b7771523116dfb348396a62b3adc383646e9024269e844L18' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 36996420</div><div id='project'> Project Name: mako443/text2pos-cvpr2022</div><div id='commit'> Commit Name: 6d0e8e215c9a853543189a6d3f8f7a7239743626</div><div id='time'> Time: 2021-03-16</div><div id='author'> Author: manuel.kolmet@gmail.com</div><div id='file'> File Name: datapreparation/drawing.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: draw_objects_poses(4)</div><div id='n_method'> N Method Name: draw_objects_poses(3)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: datapreparation/drawing.py</div><div id='n_file'> N File Name: datapreparation/drawing.py</div><div id='m_start'> M Start Line: 29</div><div id='m_end'> M End Line: 35</div><div id='n_start'> N Start Line: 18</div><div id='n_end'> N End Line: 44</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
    &#47&#47 Explanation forthcoming
    seq_len = t.shape[-2]
    freqs = freqs[:, :, -seq_len:]
    return (t<a id="change"> * </a><a id="change">freqs.cos()</a>)<a id="change"> + </a>(rotate_half(t)<a id="change"> * </a><a id="change">freqs.sin()</a>)


</code></pre><h3>After Change</h3><pre><code class='java'>
        -&gt; TensorType["batch", "num_heads", "length", "dim"]:

    num_features = frequencies.shape[-1]  &#47&#47 The number of features we wish to rotate
    x_rotate = <a id="change">x[..., :num_features]</a>  &#47&#47 Features to rotate
    x_orig = x[..., num_features:]  &#47&#47 Features to keep, as is

    seq_len = x_rotate.shape[-2]  &#47&#47 Length of the input</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/antofuller/configaformers/commit/c3a00a8d424ad3ee1b05dd8cf0dc58b4c3e2252e#diff-1b4e36e7be46e019f362e70e0808345eeb3cdc2454df8c8a31ad9aeb1e830c96L114' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 36996416</div><div id='project'> Project Name: antofuller/configaformers</div><div id='commit'> Commit Name: c3a00a8d424ad3ee1b05dd8cf0dc58b4c3e2252e</div><div id='time'> Time: 2021-09-10</div><div id='author'> Author: afuller187187@gmail.com</div><div id='file'> File Name: positional_and_masking_utils.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: apply_rotary_pos_emb(2)</div><div id='n_method'> N Method Name: apply_rotary_pos_emb(2)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: positional_and_masking_utils.py</div><div id='n_file'> N File Name: positional_and_masking_utils.py</div><div id='m_start'> M Start Line: 114</div><div id='m_end'> M End Line: 119</div><div id='n_start'> N Start Line: 123</div><div id='n_end'> N End Line: 136</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        &#47&#47 \end{align}
        &#47&#47
        &#47&#47 for $i \in {1, 2, ..., \frac{d}{2}}$
        rx = (x<a id="change"> * </a><a id="change">idx_theta2.cos()</a>[:, None, None, :])<a id="change"> + </a>(neg_half_x<a id="change"> * </a><a id="change">idx_theta2.sin()</a>[:, None, None, :])

        &#47&#47
        return rx</code></pre><h3>After Change</h3><pre><code class='java'>
        self._build_cache(x)

        &#47&#47 Split the features, we can choose to apply rotary embeddings only to a partial set of features.
        x_rope, x_pass = x[..., :self.d], <a id="change">x[..., self.d:]</a>

        &#47&#47 Calculate
        &#47&#47 $[-x^{(\frac{d}{2} + 1)}, -x^{(\frac{d}{2} + 2)}, ..., -x^{(d)}, x^{(1)}, x^{(2)}, ..., x^{(\frac{d}{2})}]$
        neg_half_x = self._neg_half(x_rope)</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/lab-ml/nn/commit/0ce65adf9e602321109528b05cf99fccb16cd2de#diff-637497eb531dcbf4c4fff534c48c9dc4ec23ef7b14699edc95d8b280b04de206L127' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 36996428</div><div id='project'> Project Name: lab-ml/nn</div><div id='commit'> Commit Name: 0ce65adf9e602321109528b05cf99fccb16cd2de</div><div id='time'> Time: 2022-06-03</div><div id='author'> Author: vpjayasiri@gmail.com</div><div id='file'> File Name: labml_nn/transformers/rope/__init__.py</div><div id='m_class'> M Class Name: RotaryPositionalEmbeddings</div><div id='n_method'> N Class Name: RotaryPositionalEmbeddings</div><div id='m_method'> M Method Name: forward(2)</div><div id='n_method'> N Method Name: forward(2)</div><div id='m_parent_class'> M Parent Class: nn.Module</div><div id='n_parent_class'> N Parent Class: nn.Module</div><div id='m_file'> M File Name: labml_nn/transformers/rope/__init__.py</div><div id='n_file'> N File Name: labml_nn/transformers/rope/__init__.py</div><div id='m_start'> M Start Line: 132</div><div id='m_end'> M End Line: 163</div><div id='n_start'> N Start Line: 171</div><div id='n_end'> N End Line: 193</div><BR>