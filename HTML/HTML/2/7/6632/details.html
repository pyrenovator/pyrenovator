<html><h3>Pattern ID :6632
</h3><img src='22965368.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
      np.testing.assert_allclose(x, y, atol=1e-5)

  def test_rmsprop(self):
    <a id="change">for </a>x,<a id="change">y</a> in <a id="change">zip(</a><a id="change">step_tinygrad(</a>RMSprop<a id="change">, kwargs={&quotlr&quot: 0.001, &quotdecay&quot: 0.99})</a>,
                   <a id="change">step_pytorch(</a>torch.optim.RMSprop<a id="change">,
                                kwargs={&quotlr&quot: 0.001, &quotalpha&quot: 0.99})):
      </a><a id="change">np.testing.assert_allclose(</a>x, <a id="change">y</a><a id="change">, atol=1e-5)</a>

if __name__ == &quot__main__&quot:
  unittest.main()
</code></pre><h3>After Change</h3><pre><code class='java'>
  def test_multistep_sgd_nesterov_momentum(self): self._test_sgd(10, {&quotlr&quot: 0.001, &quotmomentum&quot: 0.9, &quotnesterov&quot: True}, 1e-5, 0)
  def test_multistep_sgd_high_lr_nesterov_momentum(self): self._test_sgd(10, {&quotlr&quot: 10, &quotmomentum&quot: 0.9, &quotnesterov&quot: True}, 1e-5, 3e-4)

  def test_rmsprop(self): self._test_rmsprop(1, <a id="change">{</a>&quotlr&quot: 0.001, &quotalpha&quot: 0.99<a id="change">}</a>, 1e-5, 0)
  def test_rmsprop_high_lr(self): self._test_rmsprop(1, {&quotlr&quot: 10, &quotalpha&quot: 0.99}, 1e-5, 1e-5)
  def test_adam(self): self._test_adam(1, {&quotlr&quot: 0.001}, 1e-5, 0)
  def test_adam_high_lr(self): self._test_adam(1, {&quotlr&quot: 10}, 1e-5, 1e-5)</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 6</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/geohot/tinygrad/commit/305b9f2d216674f5e565c49152fcdd369615df02#diff-f2b37d0b5812153acf9ff1e337d375c5cad0076c4ddc30535ec2d55c8ac9b770L57' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 22965368</div><div id='project'> Project Name: geohot/tinygrad</div><div id='commit'> Commit Name: 305b9f2d216674f5e565c49152fcdd369615df02</div><div id='time'> Time: 2023-03-11</div><div id='author'> Author: geohot@gmail.com</div><div id='file'> File Name: test/test_optim.py</div><div id='m_class'> M Class Name: TestOptim</div><div id='n_method'> N Class Name: TestOptim</div><div id='m_method'> M Method Name: test_rmsprop(1)</div><div id='n_method'> N Method Name: test_rmsprop(1)</div><div id='m_parent_class'> M Parent Class: unittest.TestCase</div><div id='n_parent_class'> N Parent Class: unittest.TestCase</div><div id='m_file'> M File Name: test/test_optim.py</div><div id='n_file'> N File Name: test/test_optim.py</div><div id='m_start'> M Start Line: 67</div><div id='m_end'> M End Line: 71</div><div id='n_start'> N Start Line: 57</div><div id='n_end'> N End Line: 57</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
      np.testing.assert_allclose(x, y, atol=1e-4)

  def test_sgd(self):
    <a id="change">for </a>x,<a id="change">y</a> in <a id="change">zip(</a><a id="change">step_tinygrad(</a>SGD<a id="change">, kwargs={&quotlr&quot: 0.001})</a>,
                   <a id="change">step_pytorch(</a>torch.optim.SGD<a id="change">, kwargs={&quotlr&quot: 0.001})):
      </a><a id="change">np.testing.assert_allclose(</a>x, y<a id="change">, atol=1e-5)</a>

  def test_rmsprop(self):
    for x,y in zip(step_tinygrad(RMSprop, kwargs={&quotlr&quot: 0.001, &quotdecay&quot: 0.99}),
                   step_pytorch(torch.optim.RMSprop,</code></pre><h3>After Change</h3><pre><code class='java'>
  def _test_rmsprop(self, steps, opts, atol, rtol): self._test_optim(RMSprop, torch.optim.RMSprop, steps, opts, atol, rtol)
  def _test_adam(self, steps, opts, atol, rtol): self._test_optim(Adam, torch.optim.Adam, steps, opts, atol, rtol)

  def test_sgd(self): self._test_sgd(1, <a id="change">{</a>&quotlr&quot: 0.001<a id="change">}</a>, 1e-6, 0)
  def test_sgd_high_lr(self): self._test_sgd(1, {&quotlr&quot: 10}, 1e-6, 1e-5)

  def test_multistep_sgd(self): self._test_sgd(10, {&quotlr&quot: 0.001}, 1e-6, 0)</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/geohot/tinygrad/commit/305b9f2d216674f5e565c49152fcdd369615df02#diff-f2b37d0b5812153acf9ff1e337d375c5cad0076c4ddc30535ec2d55c8ac9b770L61' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 22965369</div><div id='project'> Project Name: geohot/tinygrad</div><div id='commit'> Commit Name: 305b9f2d216674f5e565c49152fcdd369615df02</div><div id='time'> Time: 2023-03-11</div><div id='author'> Author: geohot@gmail.com</div><div id='file'> File Name: test/test_optim.py</div><div id='m_class'> M Class Name: TestOptim</div><div id='n_method'> N Class Name: TestOptim</div><div id='m_method'> M Method Name: test_sgd(1)</div><div id='n_method'> N Method Name: test_sgd(1)</div><div id='m_parent_class'> M Parent Class: unittest.TestCase</div><div id='n_parent_class'> N Parent Class: unittest.TestCase</div><div id='m_file'> M File Name: test/test_optim.py</div><div id='n_file'> N File Name: test/test_optim.py</div><div id='m_start'> M Start Line: 62</div><div id='m_end'> M End Line: 66</div><div id='n_start'> N Start Line: 45</div><div id='n_end'> N End Line: 45</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
class TestOptim(unittest.TestCase):

  def test_adam(self):
    <a id="change">for </a>x,<a id="change">y</a> in <a id="change">zip(</a><a id="change">step_tinygrad(</a>Adam<a id="change">)</a>,
                   <a id="change">step_pytorch(</a>torch.optim.Adam<a id="change">)):
      </a><a id="change">np.testing.assert_allclose(</a>x, y<a id="change">, atol=1e-4)</a>

  def test_sgd(self):
    for x,y in zip(step_tinygrad(SGD, kwargs={&quotlr&quot: 0.001}),
                   step_pytorch(torch.optim.SGD, kwargs={&quotlr&quot: 0.001})):</code></pre><h3>After Change</h3><pre><code class='java'>

  def test_rmsprop(self): self._test_rmsprop(1, {&quotlr&quot: 0.001, &quotalpha&quot: 0.99}, 1e-5, 0)
  def test_rmsprop_high_lr(self): self._test_rmsprop(1, {&quotlr&quot: 10, &quotalpha&quot: 0.99}, 1e-5, 1e-5)
  def test_adam(self): self._test_adam(1, <a id="change">{</a>&quotlr&quot: 0.001<a id="change">}</a>, 1e-5, 0)
  def test_adam_high_lr(self): self._test_adam(1, {&quotlr&quot: 10}, 1e-5, 1e-5)

  def test_multistep_rmsprop(self): self._test_rmsprop(10, {&quotlr&quot: 0.001}, 1e-5, 0)</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/geohot/tinygrad/commit/305b9f2d216674f5e565c49152fcdd369615df02#diff-f2b37d0b5812153acf9ff1e337d375c5cad0076c4ddc30535ec2d55c8ac9b770L56' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 22965367</div><div id='project'> Project Name: geohot/tinygrad</div><div id='commit'> Commit Name: 305b9f2d216674f5e565c49152fcdd369615df02</div><div id='time'> Time: 2023-03-11</div><div id='author'> Author: geohot@gmail.com</div><div id='file'> File Name: test/test_optim.py</div><div id='m_class'> M Class Name: TestOptim</div><div id='n_method'> N Class Name: TestOptim</div><div id='m_method'> M Method Name: test_adam(1)</div><div id='n_method'> N Method Name: test_adam(1)</div><div id='m_parent_class'> M Parent Class: unittest.TestCase</div><div id='n_parent_class'> N Parent Class: unittest.TestCase</div><div id='m_file'> M File Name: test/test_optim.py</div><div id='n_file'> N File Name: test/test_optim.py</div><div id='m_start'> M Start Line: 57</div><div id='m_end'> M End Line: 61</div><div id='n_start'> N Start Line: 59</div><div id='n_end'> N End Line: 59</div><BR>