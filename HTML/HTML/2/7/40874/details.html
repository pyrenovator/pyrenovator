<html><h3>Pattern ID :40874
</h3><img src='115276494.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
                raise ValueError(f&quot{metric_with_utils.log_name} must compute number value, &quot
                                 f&quotnot numpy array with shape {metric_value.shape}.&quot)
            &#47&#47 If it numpy array with one element but wrong dtype
            <a id="change">if </a>isinstance(metric_value, np.ndarray) and <a id="change">len(metric_value.shape) == 0</a> and\
                    np.issubdtype(metric_value.dtype, np.number):
                raise ValueError(f&quot{metric_with_utils.log_name} must compute number value, &quot
                                 f&quotnot numpy array element with dtype {metric_value.dtype}.&quot)

            is_number = isinstance(metric_value, numbers.Number)
            &#47&#47 If not numeric type.
            if not (is_number or isinstance(metric_value, Tensor) or isinstance(metric_value, np.ndarray)):
                <a id="change">raise </a><a id="change">ValueError(f&quot{metric_with_utils.log_name} must compute number value, &quot
                                 f&quotnot numpy array element with dtype {metric_value.dtype}.&quot</a><a id="change">)</a>

            metric_key = f&quot{phase.value}/{metric_with_utils.log_name}&quot
            log[metric_key] = metric_value
</code></pre><h3>After Change</h3><pre><code class='java'>
        for metric_with_utils in self.phase2metrics[phase.name]:
            metric_value = metric_with_utils.compute()
            if isinstance(metric_value, dict):
                metric_keys<a id="change"> = </a>list(<a id="change">metric_value.keys()</a>)
                for metric_name_d in metric_keys:
                    metric_value_d = metric_value.pop(metric_name_d)
                    if self.is_number(metric_value_d):</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 6</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/eora-ai/torchok/commit/c2fc24fbea4374c237f2164b01b38d617ba7b685#diff-1e414ece74f1d86149bd7914491e9ee38f9de42b30af9d90d2014826477d3087L125' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 115276494</div><div id='project'> Project Name: eora-ai/torchok</div><div id='commit'> Commit Name: c2fc24fbea4374c237f2164b01b38d617ba7b685</div><div id='time'> Time: 2022-09-01</div><div id='author'> Author: Sitcebelly</div><div id='file'> File Name: torchok/metrics/metrics_manager.py</div><div id='m_class'> M Class Name: MetricsManager</div><div id='n_method'> N Class Name: MetricsManager</div><div id='m_method'> M Method Name: on_epoch_end(2)</div><div id='n_method'> N Method Name: on_epoch_end(2)</div><div id='m_parent_class'> M Parent Class: nn.Module</div><div id='n_parent_class'> N Parent Class: nn.Module</div><div id='m_file'> M File Name: torchok/metrics/metrics_manager.py</div><div id='n_file'> N File Name: torchok/metrics/metrics_manager.py</div><div id='m_start'> M Start Line: 125</div><div id='m_end'> M End Line: 147</div><div id='n_start'> N Start Line: 132</div><div id='n_end'> N End Line: 151</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        ordering_args = eval_setting.ordering_args
        if ordering_args[&quotstrategy&quot] == &quotshuffle&quot:
            raise ValueError(&quotOrdering strategy `shuffle` is not supported in sequential models.&quot)
        elif <a id="change">ordering_args[&quotstrategy&quot] == &quotby&quot</a>:
            if ordering_args[&quotfield&quot] != self.time_field:
                raise ValueError(&quotSequential models require `TO` (time ordering) strategy.&quot)
            if ordering_args[&quotascending&quot] is not True:
                <a id="change">raise </a><a id="change">ValueError(&quotSequential models require `time_field` to sort in ascending order.&quot</a><a id="change">)</a>

        group_field = eval_setting.group_field

        split_args = eval_setting.split_args</code></pre><h3>After Change</h3><pre><code class='java'>
        if isinstance(split_args, dict) != True:
            raise ValueError(f&quotThe split_args [{split_args}] should be a dict.&quot)

        split_mode<a id="change"> = </a>list(<a id="change">split_args.keys()</a>)[0] 
        if split_mode == &quotLS&quot:
            return self.leave_one_out(group_by=self.config[&quotUSER_ID_FIELD&quot], leave_one_num=split_args[&quotLS&quot])
        else:</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/rucaibox/recbole/commit/7f4bc575a83db4d2bc392d953a8db7c326f33678#diff-0b8aef0855273fe091bfea49dbd0e94d710431e8a556f056d70b3eda00a4a7baL137' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 115276490</div><div id='project'> Project Name: rucaibox/recbole</div><div id='commit'> Commit Name: 7f4bc575a83db4d2bc392d953a8db7c326f33678</div><div id='time'> Time: 2021-07-01</div><div id='author'> Author: 2017202006@ruc.edu.cn</div><div id='file'> File Name: recbole/data/dataset/sequential_dataset.py</div><div id='m_class'> M Class Name: SequentialDataset</div><div id='n_method'> N Class Name: SequentialDataset</div><div id='m_method'> M Method Name: build(1)</div><div id='n_method'> N Method Name: build(2)</div><div id='m_parent_class'> M Parent Class: Dataset</div><div id='n_parent_class'> N Parent Class: Dataset</div><div id='m_file'> M File Name: recbole/data/dataset/sequential_dataset.py</div><div id='n_file'> N File Name: recbole/data/dataset/sequential_dataset.py</div><div id='m_start'> M Start Line: 137</div><div id='m_end'> M End Line: 152</div><div id='n_start'> N Start Line: 142</div><div id='n_end'> N End Line: 157</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        return cls.check(instance)
        
    def __getitem__(cls, item: Any) -&gt; _TensorTypeMeta:
        <a id="change">if item is None</a>:
            &#47&#47 Corresponding to how None is allow in TensorType.getitem: it has a
            &#47&#47 special value there, so we disallow it here.
            <a id="change">raise </a><a id="change">ValueError(f"{item} not a valid type argument."</a><a id="change">)</a>

        if cls._is_getitem_subclass:
            assert len(cls.__bases__) == 1
            base_cls = cls.__bases__[0]</code></pre><h3>After Change</h3><pre><code class='java'>
            base_cls = cls
        name = base_cls.__name__
        dict = cls.getitem(item)
        intersection<a id="change"> = </a>cls._torchtyping_fields.intersection(<a id="change">dict.keys()</a>)
        if intersection:
            raise TypeError(f"Overwriting {intersection} fields.")
        fields = cls._torchtyping_fields | dict.keys()</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/patrick-kidger/torchtyping/commit/c25e3e0e6394ee8a973623173aa24eafec0bec7c#diff-75eb220c62646c2c9a5d41e5d890f7e38200af8b7cf7424554f47e4e23239c51L17' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 115276475</div><div id='project'> Project Name: patrick-kidger/torchtyping</div><div id='commit'> Commit Name: c25e3e0e6394ee8a973623173aa24eafec0bec7c</div><div id='time'> Time: 2021-03-28</div><div id='author'> Author: 33688385+patrick-kidger@users.noreply.github.com</div><div id='file'> File Name: torchtyping/tensor.py</div><div id='m_class'> M Class Name: _TensorTypeMeta</div><div id='n_method'> N Class Name: _TensorTypeMeta</div><div id='m_method'> M Method Name: __getitem__(2)</div><div id='n_method'> N Method Name: __getitem__(2)</div><div id='m_parent_class'> M Parent Class: type</div><div id='n_parent_class'> N Parent Class: type</div><div id='m_file'> M File Name: torchtyping/tensor.py</div><div id='n_file'> N File Name: torchtyping/tensor.py</div><div id='m_start'> M Start Line: 18</div><div id='m_end'> M End Line: 39</div><div id='n_start'> N Start Line: 36</div><div id='n_end'> N End Line: 54</div><BR>