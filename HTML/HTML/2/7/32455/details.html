<html><h3>Pattern ID :32455
</h3><img src='94614571.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
                    if len(words):
                        items.append({"pos": [start, i], "entity": words, "label": tag})
                    if label_name.startswith("B-"):
                        tag = <a id="change">label_name.split(</a>"-"<a id="change">)</a>[1]
                    else:
                        tag = label_name
                    start = i</code></pre><h3>After Change</h3><pre><code class='java'>
        tokens_label = tokens_label.tolist()
        value = []
        for batch, token_label in enumerate(tokens_label):
            <a id="change">start</a><a id="change"> = -1</a>
            label_name = ""
            items = []
            input_data = input_datas[batch]
            for i, label in enumerate(token_label):
                if (label_list[label] == "O" or "B-" in label_list[label]) and start &gt;= 0:
                    entity = input_data[<a id="change">start : i - 1</a>]
                    if isinstance(entity, list):
                        entity = "".join(entity)
                    items.append(
                        {
                            "pos": [start, i - 2],
                            "entity": entity,
                            "label": label_name,
                        }
                    )
                    start = -1
                if "B-" in label_list[label]:
                    start = i - 1
                    label_name = label_list[label][2:]
            if start &gt;= 0:
                items.append(
                    {
                        "pos": [start, len(token_label) - 1],
                        "entity": <a id="change">input_data[start : len(token_label) - 1]</a>,
                        "label": "",
                    }
                )</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 5</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/paddlepaddle/paddlenlp/commit/47fe71d98378e46e691d4fde7b1ba8ecb144afa4#diff-21c8dd460dff45096ebcb9e97d773c12b0d0aa6c1c99319dd6b701d92c2c9a38L26' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 94614571</div><div id='project'> Project Name: paddlepaddle/paddlenlp</div><div id='commit'> Commit Name: 47fe71d98378e46e691d4fde7b1ba8ecb144afa4</div><div id='time'> Time: 2023-01-05</div><div id='author'> Author: fangzeyang0904@hotmail.com</div><div id='file'> File Name: model_zoo/ernie-3.0/deploy/simple_serving/server_token_cls.py</div><div id='m_class'> M Class Name: NERPostHandler</div><div id='n_method'> N Class Name: NERPostHandler</div><div id='m_method'> M Method Name: process(3)</div><div id='n_method'> N Method Name: process(3)</div><div id='m_parent_class'> M Parent Class: BasePostHandler</div><div id='n_parent_class'> N Parent Class: BasePostHandler</div><div id='m_file'> M File Name: model_zoo/ernie-3.0/deploy/simple_serving/server_token_cls.py</div><div id='n_file'> N File Name: model_zoo/ernie-3.0/deploy/simple_serving/server_token_cls.py</div><div id='m_start'> M Start Line: 26</div><div id='m_end'> M End Line: 54</div><div id='n_start'> N Start Line: 26</div><div id='n_end'> N End Line: 58</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
                    if len(words):
                        items.append({"pos": [start, i], "entity": words, "label": tag})
                    if label_name.startswith("B-"):
                        tag = <a id="change">label_name.split(</a>"-"<a id="change">)</a>[1]
                    else:
                        tag = label_name
                    start = i</code></pre><h3>After Change</h3><pre><code class='java'>
        tokens_label = tokens_label.tolist()
        value = []
        for batch, token_label in enumerate(tokens_label):
            <a id="change">start</a><a id="change"> = -1</a>
            label_name = ""
            items = []
            input_data = input_datas[batch]
            for i, label in enumerate(token_label):
                if (label_list[label] == "O" or "B-" in label_list[label]) and start &gt;= 0:
                    entity = input_data[<a id="change">start : i - 1</a>]
                    if isinstance(entity, list):
                        entity = "".join(entity)
                    items.append(
                        {
                            "pos": [start, i - 2],
                            "entity": entity,
                            "label": label_name,
                        }
                    )
                    start = -1
                if "B-" in label_list[label]:
                    start = i - 1
                    label_name = label_list[label][2:]
            if start &gt;= 0:
                items.append(
                    {
                        "pos": [start, len(token_label) - 1],
                        "entity": <a id="change">input_data[start : len(token_label) - 1]</a>,
                        "label": "",
                    }
                )</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/paddlepaddle/paddlenlp/commit/47fe71d98378e46e691d4fde7b1ba8ecb144afa4#diff-21c8dd460dff45096ebcb9e97d773c12b0d0aa6c1c99319dd6b701d92c2c9a38L25' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 94614578</div><div id='project'> Project Name: paddlepaddle/paddlenlp</div><div id='commit'> Commit Name: 47fe71d98378e46e691d4fde7b1ba8ecb144afa4</div><div id='time'> Time: 2023-01-05</div><div id='author'> Author: fangzeyang0904@hotmail.com</div><div id='file'> File Name: model_zoo/ernie-3.0/deploy/simple_serving/server_token_cls.py</div><div id='m_class'> M Class Name: NERPostHandler</div><div id='n_method'> N Class Name: NERPostHandler</div><div id='m_method'> M Method Name: process(3)</div><div id='n_method'> N Method Name: process(3)</div><div id='m_parent_class'> M Parent Class: BasePostHandler</div><div id='n_parent_class'> N Parent Class: BasePostHandler</div><div id='m_file'> M File Name: model_zoo/ernie-3.0/deploy/simple_serving/server_token_cls.py</div><div id='n_file'> N File Name: model_zoo/ernie-3.0/deploy/simple_serving/server_token_cls.py</div><div id='m_start'> M Start Line: 26</div><div id='m_end'> M End Line: 54</div><div id='n_start'> N Start Line: 26</div><div id='n_end'> N End Line: 58</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
            if args.wandb:
                wandb.log({&quottrain/loss&quot: loss.item()})
            if (i+1) % args.sample_freq == 0:
                pred = &quot&quot.join(<a id="change">dataloader.tokenizer.decode(decoder.generate(torch.LongTensor([args.bos_token]).to(
                    device), args.max_seq_len, eos_token=args.eos_token, context=encoded[:1].detach())[:-1]).split(</a>&quot &quot<a id="change">)</a>).replace(&quotĠ&quot, &quot &quot).strip()
                s = seq[&quotinput_ids&quot][0]
                truth = &quot&quot.join(dataloader.tokenizer.decode(s[1:list(s).index(args.eos_token)]).split(&quot &quot)).replace(&quotĠ&quot, &quot &quot).strip()
                if args.wandb:</code></pre><h3>After Change</h3><pre><code class='java'>
            if args.wandb:
                wandb.log({&quottrain/loss&quot: loss.item()})
            if (i+1) % args.sample_freq == 0:
                <a id="change">num_samples</a><a id="change"> = 4</a>
                dec = decoder.generate(torch.LongTensor([args.bos_token]*len(encoded[<a id="change">:num_samples</a>]))[:, None].to(device), args.max_seq_len,
                                       eos_token=args.pad_token, context=encoded.detach()[:num_samples])
                pred = token2str(<a id="change">dec[:num_samples]</a>, dataloader.tokenizer)
                truth = token2str(seq[&quotinput_ids&quot], dataloader.tokenizer)
                if args.wandb:
                    table = wandb.Table(columns=["Truth", "Prediction"])</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/lukas-blecher/latex-ocr/commit/ba220245e394aea309e5e158ba8d6958522a1f07#diff-ed183d67207df065a11e1289f19d34cc2abbc5448dea952683cfe9728c342b95L20' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 94614575</div><div id='project'> Project Name: lukas-blecher/latex-ocr</div><div id='commit'> Commit Name: ba220245e394aea309e5e158ba8d6958522a1f07</div><div id='time'> Time: 2021-02-02</div><div id='author'> Author: luk.blecher@gmx.de</div><div id='file'> File Name: train.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: train(1)</div><div id='n_method'> N Method Name: train(1)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: train.py</div><div id='n_file'> N File Name: train.py</div><div id='m_start'> M Start Line: 21</div><div id='m_end'> M End Line: 54</div><div id='n_start'> N Start Line: 21</div><div id='n_end'> N End Line: 56</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        _sorted_m = np.sort(match_idx, order=col_name)
        _, _doc_counts = np.unique(_sorted_m[col_name], return_counts=True)
        &#47&#47 group by ``col``
        return <a id="change">np.split(</a>_sorted_m, np.cumsum(_doc_counts)<a id="change">)</a>[:-1]

    @staticmethod
    def _sort_doc_by_score(r):</code></pre><h3>After Change</h3><pre><code class='java'>
        n_elements = len(_sorted_m[col_name])
        list_numpy_arrays = []
        prev_val = _sorted_m[col_name][0]
        <a id="change">prev_index</a><a id="change"> = 0</a>
        for i, current_val in enumerate(_sorted_m[col_name]):
            if current_val != prev_val:
                list_numpy_arrays.append(<a id="change">_sorted_m[prev_index:i]</a>)
                prev_index = i
                prev_val = current_val
        if current_val == prev_val:
            list_numpy_arrays.append(_sorted_m[<a id="change">prev_index:</a>])

        return list_numpy_arrays
</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/jina-ai/jina/commit/fc0888e0cea3abd4babfb68c0d003b7b59d5fa4b#diff-30f4f5f24cb0e08e122a5e704ff612265c1f37e4c5f9296feed3dd2bb8001ea3L71' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 94614573</div><div id='project'> Project Name: jina-ai/jina</div><div id='commit'> Commit Name: fc0888e0cea3abd4babfb68c0d003b7b59d5fa4b</div><div id='time'> Time: 2021-03-16</div><div id='author'> Author: davidbuchaca@gmail.com</div><div id='file'> File Name: jina/drivers/rank/aggregate/__init__.py</div><div id='m_class'> M Class Name: BaseAggregateMatchesRankerDriver</div><div id='n_method'> N Class Name: BaseAggregateMatchesRankerDriver</div><div id='m_method'> M Method Name: _group_by(2)</div><div id='n_method'> N Method Name: _group_by(2)</div><div id='m_parent_class'> M Parent Class: BaseRankDriver</div><div id='n_parent_class'> N Parent Class: BaseRankDriver</div><div id='m_file'> M File Name: jina/drivers/rank/aggregate/__init__.py</div><div id='n_file'> N File Name: jina/drivers/rank/aggregate/__init__.py</div><div id='m_start'> M Start Line: 73</div><div id='m_end'> M End Line: 76</div><div id='n_start'> N Start Line: 81</div><div id='n_end'> N End Line: 94</div><BR>