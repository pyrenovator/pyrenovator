<html><h3>Pattern ID :20359
</h3><img src='66030693.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
        
        Return the median of the latest `window_size` values in the buffer.
        
        return np.median([x[0] for x in <a id="change">self._data[-window_size:]</a>])

    def avg(self, window_size):
        </code></pre><h3>After Change</h3><pre><code class='java'>
        Returns:
            median (number): the median of the latest `window_size` values
        
        <a id="change">if window_size is None</a>:
            window_size<a id="change"> = </a>len(self._data[key])

        return torch.Tensor(<a id="change">self._data[key][-window_size:]</a>).median().item()

    def avg(self, key, window_size=None):
        </code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 7</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/yeliudev/nncore/commit/37679e2ae736e55218a505c486bea6ae404031f8#diff-63a32a03b794fd58a03879d950ccd200e613f06dee5595404eede40037c8afdaL49' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 66030693</div><div id='project'> Project Name: yeliudev/nncore</div><div id='commit'> Commit Name: 37679e2ae736e55218a505c486bea6ae404031f8</div><div id='time'> Time: 2020-03-18</div><div id='author'> Author: goolhanrry@gmail.com</div><div id='file'> File Name: nncore/engine/buffer.py</div><div id='m_class'> M Class Name: Buffer</div><div id='n_method'> N Class Name: Buffer</div><div id='m_method'> M Method Name: median(3)</div><div id='n_method'> N Method Name: median(2)</div><div id='m_parent_class'> M Parent Class: object</div><div id='n_parent_class'> N Parent Class: object</div><div id='m_file'> M File Name: nncore/engine/buffer.py</div><div id='n_file'> N File Name: nncore/engine/buffer.py</div><div id='m_start'> M Start Line: 49</div><div id='m_end'> M End Line: 49</div><div id='n_start'> N Start Line: 89</div><div id='n_end'> N End Line: 104</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        scores = torch.ones(batch_size, 1 + self.n_neg, device=y.device)  &#47&#47positive sample in the first position.
        y_expand = torch.cat((y, y))
        for i in range(batch_size):
            scores[i, :] = torch.cat((y_expand[i].view(-1), <a id="change">y_expand[i + 1:i + 1 + self.n_neg]</a>))
        scores = scores / self.temperature
        return scores  &#47&#47(batch_size, 4)
</code></pre><h3>After Change</h3><pre><code class='java'>
        sample_weight = self.embedding(x, self.sample_weight_feature, squeeze_dim=True).squeeze(1)  &#47&#47 (batch_size)

        scores = pred - torch.log(sample_weight)  &#47&#47Sampling Bias Corrected, using broadcast
        <a id="change">if user_embedding.shape[0] * (self.n_neg + 1) != self.index0.shape[0]</a>:  &#47&#47 last batch
            batch_size<a id="change"> = </a>user_embedding.shape[0]
            index0 = <a id="change">self.index0[:batch_size * (self.n_neg + 1)]</a>
            index1 = self.index1[:batch_size * (self.n_neg + 1)]
            index0[np.where(index0 &gt;= batch_size)] -= batch_size
            index1[np.where(index1 &gt;= batch_size)] -= batch_size
</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/datawhalechina/torch-rechub/commit/d0461152ddffad7a6bf7c7532b7b540094623e95#diff-16cab9e6b17798cf716613c6493b3a5a50aea041bdf0c65f5c89b59a4d0c686aL54' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 66030690</div><div id='project'> Project Name: datawhalechina/torch-rechub</div><div id='commit'> Commit Name: d0461152ddffad7a6bf7c7532b7b540094623e95</div><div id='time'> Time: 2022-06-07</div><div id='author'> Author: icewwl@163.com</div><div id='file'> File Name: torch_rechub/models/matching/youtube_sbc.py</div><div id='m_class'> M Class Name: YoutubeSBC</div><div id='n_method'> N Class Name: YoutubeSBC</div><div id='m_method'> M Method Name: forward(2)</div><div id='n_method'> N Method Name: forward(2)</div><div id='m_parent_class'> M Parent Class: torch.nn.Module</div><div id='n_parent_class'> N Parent Class: torch.nn.Module</div><div id='m_file'> M File Name: torch_rechub/models/matching/youtube_sbc.py</div><div id='n_file'> N File Name: torch_rechub/models/matching/youtube_sbc.py</div><div id='m_start'> M Start Line: 55</div><div id='m_end'> M End Line: 80</div><div id='n_start'> N Start Line: 60</div><div id='n_end'> N End Line: 87</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        
        Return the mean of the latest `window_size` values in the buffer.
        
        return np.mean([x[0] for x in <a id="change">self._data[-window_size:]</a>])

    def global_avg(self):
        </code></pre><h3>After Change</h3><pre><code class='java'>
        Returns:
            avg (number): the average of the latest `window_size` values
        
        <a id="change">if window_size is None</a>:
            window_size<a id="change"> = </a>len(self._data[key])

        return torch.Tensor(<a id="change">self._data[key][-window_size:]</a>).mean().item()
</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/yeliudev/nncore/commit/37679e2ae736e55218a505c486bea6ae404031f8#diff-63a32a03b794fd58a03879d950ccd200e613f06dee5595404eede40037c8afdaL51' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 66030689</div><div id='project'> Project Name: yeliudev/nncore</div><div id='commit'> Commit Name: 37679e2ae736e55218a505c486bea6ae404031f8</div><div id='time'> Time: 2020-03-18</div><div id='author'> Author: goolhanrry@gmail.com</div><div id='file'> File Name: nncore/engine/buffer.py</div><div id='m_class'> M Class Name: Buffer</div><div id='n_method'> N Class Name: Buffer</div><div id='m_method'> M Method Name: avg(3)</div><div id='n_method'> N Method Name: avg(2)</div><div id='m_parent_class'> M Parent Class: object</div><div id='n_parent_class'> N Parent Class: object</div><div id='m_file'> M File Name: nncore/engine/buffer.py</div><div id='n_file'> N File Name: nncore/engine/buffer.py</div><div id='m_start'> M Start Line: 55</div><div id='m_end'> M End Line: 55</div><div id='n_start'> N Start Line: 106</div><div id='n_end'> N End Line: 121</div><BR>