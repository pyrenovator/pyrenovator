<html><h3>Pattern ID :36515
</h3><img src='103634730.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
        rows_to_calc_neighbors_for = \
            np.argwhere([x in indices_to_calc_neighbors_for for x in data.index]).flatten()
    else:
        rows_to_calc_neighbors_for<a id="change"> = </a><a id="change">list(</a>range(num_samples)<a id="change">)</a>

    num_indices_to_calc = len(rows_to_calc_neighbors_for)

    distances, indexes = np.zeros((num_indices_to_calc, num_neighbors)), np.zeros((num_indices_to_calc, num_neighbors))</code></pre><h3>After Change</h3><pre><code class='java'>
        representing the indexes of the nearest neighbors.
    
    num_samples = data.shape[0]
    <a id="change">if </a>samples_to_calc_neighbors_for is not None:
        data<a id="change"> = </a>pd.concat(<a id="change">[</a>data, samples_to_calc_neighbors_for<a id="change"></a>])
        num_indices_to_calc<a id="change"> = </a>samples_to_calc_neighbors_for.shape[0]
    else:
        num_indices_to_calc<a id="change"> = </a>data.shape[0]

    cat_data = data[cat_cols]
    numeric_data = data[numeric_cols]</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 4</div><BR><div id='size'>Non-data size: 7</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/deepchecks/deepchecks/commit/e9b85cbcf3518ab440a10f9198953b75108a97fb#diff-49b0cf2cf5a14991b4a0b1fb960a553a9de313186e5f5ee9ef01c2f7da74f371L59' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 103634730</div><div id='project'> Project Name: deepchecks/deepchecks</div><div id='commit'> Commit Name: e9b85cbcf3518ab440a10f9198953b75108a97fb</div><div id='time'> Time: 2022-08-31</div><div id='author'> Author: 92314933+nirhutnik@users.noreply.github.com</div><div id='file'> File Name: deepchecks/utils/gower_distance.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: calculate_nearest_neighbors_distances(5)</div><div id='n_method'> N Method Name: calculate_nearest_neighbors_distances(5)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: deepchecks/utils/gower_distance.py</div><div id='n_file'> N File Name: deepchecks/utils/gower_distance.py</div><div id='m_start'> M Start Line: 59</div><div id='m_end'> M End Line: 117</div><div id='n_start'> N Start Line: 59</div><div id='n_end'> N End Line: 130</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
    df_list = create_df_list(df)
    if local_modeling:
        df_train_list = list()
        df_val_list<a id="change"> = </a><a id="change">list()</a>
        for df in df_list:
            df_train, df_val = _split_df(df, n_lags, n_forecasts, valid_p, inputs_overbleed)
            df_train_list.append(df_train)
            df_val_list.append(df_val)</code></pre><h3>After Change</h3><pre><code class='java'>
        df_train (pd.DataFrame,dict):training data
        df_val (pd.DataFrame,dict): validation data
    
    <a id="change">if </a>isinstance(df, pd.DataFrame):
        df_is_dict = False
        df_dict<a id="change"> = </a><a id="change">{</a>"__df__": df<a id="change">}</a>
    elif isinstance(df, dict):
        df_is_dict<a id="change"> = </a>True
        df_dict<a id="change"> = </a>df
    else:
        raise ValueError("Please insert valid df type (i.e. pd.DataFrame, dict)")
    df_train = {}</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/ourownstory/neural_prophet/commit/6619741f934957dff2a7fa4ff66620772d41471f#diff-cb8ae2d50e5d5d245ed6fcc8cadf2baf7294fa9ac5c63e819fbfe34f0e4c2552L514' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 103634796</div><div id='project'> Project Name: ourownstory/neural_prophet</div><div id='commit'> Commit Name: 6619741f934957dff2a7fa4ff66620772d41471f</div><div id='time'> Time: 2022-02-14</div><div id='author'> Author: ourownstory@users.noreply.github.com</div><div id='file'> File Name: neuralprophet/df_utils.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: split_df(6)</div><div id='n_method'> N Method Name: split_df(6)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: neuralprophet/df_utils.py</div><div id='n_file'> N File Name: neuralprophet/df_utils.py</div><div id='m_start'> M Start Line: 532</div><div id='m_end'> M End Line: 548</div><div id='n_start'> N Start Line: 573</div><div id='n_end'> N End Line: 598</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>

    compressed_st = {&quotstate_dict&quot: {}}

    layers<a id="change"> = </a><a id="change">list(</a>st[&quotstate_dict&quot].keys()<a id="change">)</a>
    print("getting compression")

    for name in layers:
        &#47&#47 print(each)</code></pre><h3>After Change</h3><pre><code class='java'>
def compress(delta_ckpt, ckpt, diffuser=False, compression_ratio=0.6, device=&quotcuda&quot):
    st = torch.load(f&quot{delta_ckpt}&quot)

    <a id="change">if </a>not diffuser:
        compressed_key<a id="change"> = </a>&quotstate_dict&quot
        compressed_st = {compressed_key: {}}
        pretrained_st = torch.load(ckpt)[&quotstate_dict&quot]
        if &quotembed&quot in st[&quotstate_dict&quot]:
            compressed_st[&quotstate_dict&quot][&quotembed&quot] = st[&quotstate_dict&quot][&quotembed&quot]
            del st[&quotstate_dict&quot][&quotembed&quot]

        st = st[&quotstate_dict&quot]
    else:
        from diffusers import StableDiffusionPipeline
        compressed_key = &quotunet&quot
        compressed_st<a id="change"> = </a><a id="change">{</a>compressed_key: {}<a id="change">}</a>
        pretrained_st<a id="change"> = </a>StableDiffusionPipeline.from_pretrained(ckpt, torch_dtype=torch.float16).to("cuda")
        pretrained_st = pretrained_st.unet.state_dict()
        if &quotmodifier_token&quot in st:
            compressed_st[&quotmodifier_token&quot] = st[&quotmodifier_token&quot]</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/adobe-research/custom-diffusion/commit/5cd1e9c869b793d88573533a6a2adccd10aadcd0#diff-0f4293c247a4f4e8eab25c82da6ce7037c91175297d9dae021e3b167f28c1121L9' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 103634721</div><div id='project'> Project Name: adobe-research/custom-diffusion</div><div id='commit'> Commit Name: 5cd1e9c869b793d88573533a6a2adccd10aadcd0</div><div id='time'> Time: 2023-01-05</div><div id='author'> Author: nupurkumari@Nupurs-MacBook-Pro.local</div><div id='file'> File Name: src/compress.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: compress(5)</div><div id='n_method'> N Method Name: compress(4)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: src/compress.py</div><div id='n_file'> N File Name: src/compress.py</div><div id='m_start'> M Start Line: 10</div><div id='m_end'> M End Line: 48</div><div id='n_start'> N Start Line: 8</div><div id='n_end'> N End Line: 48</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
    ids1 = [labels2[i].id for i in inds1]

    inds2 = ious.argmax(axis=0)
    max2<a id="change"> = </a><a id="change">list(</a>ious[inds2, range(labels2)]<a id="change">)</a>
    ids2 = [labels1[i].id for i in inds2]

    return max1, max2, ids1, ids2
</code></pre><h3>After Change</h3><pre><code class='java'>
        max1 = [None] * m
        ids1 = [None] * m

    <a id="change">if </a>labels1:
        inds2 = ious.argmax(axis=0)
        max2<a id="change"> = </a>list(ious[inds2, range(n)])
        ids2 = [labels1[i].id for i in inds2]
    else:
        max2<a id="change"> = </a>[None] * n
        ids2<a id="change"> = </a><a id="change">[</a>None<a id="change"></a>] * n

    return max1, max2, ids1, ids2
</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/voxel51/fiftyone/commit/a928cee5d666d054f409449cfbde86043eb3cbb5#diff-111305bcd6f706201a5769b01af66314f91dd8423f9a2104c5d1a3ad3d575310L336' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 103634737</div><div id='project'> Project Name: voxel51/fiftyone</div><div id='commit'> Commit Name: a928cee5d666d054f409449cfbde86043eb3cbb5</div><div id='time'> Time: 2022-04-25</div><div id='author'> Author: brimoor@umich.edu</div><div id='file'> File Name: fiftyone/utils/iou.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: _extract_max_ious(3)</div><div id='n_method'> N Method Name: _extract_max_ious(3)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: fiftyone/utils/iou.py</div><div id='n_file'> N File Name: fiftyone/utils/iou.py</div><div id='m_start'> M Start Line: 337</div><div id='m_end'> M End Line: 343</div><div id='n_start'> N Start Line: 333</div><div id='n_end'> N End Line: 354</div><BR>