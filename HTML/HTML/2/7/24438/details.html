<html><h3>Pattern ID :24438
</h3><img src='75906278.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
    err = np.mean(
        np.abs(np.concatenate(coeffs) - torch.cat(coeffs2, -1).squeeze().numpy())
    )
    <a id="change">print("haar coefficient error scale 2"</a>, err, ["ok" if err &lt; 1e-4 else "failed!"]<a id="change">)</a>
    assert err &lt; 1e-4


def test_conv_fwt_haar_lvl2_odd():</code></pre><h3>After Change</h3><pre><code class='java'>
    coeffs2 = wavedec(ptdata, wavelet, level=2)
    assert len(coeffs) == len(coeffs2)

    pywt_coeffs<a id="change"> = </a>np.concatenate(coeffs)
    ptwt_coeffs = torch.cat(coeffs2, -1).squeeze().numpy() 
    err<a id="change"> = </a>np.mean(np.abs(pywt_coeffs - ptwt_coeffs))
    print("haar coefficient error scale 2", err, ["ok"<a id="change"> if err &lt; 1e-6</a><a id="change"> else </a>"failed!"])
    assert np.allclose(pywt_coeffs, ptwt_coeffs)
    rec = waverec(coeffs2, wavelet).squeeze().numpy()
    err = np.mean(np.abs((data - rec)))</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 5</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/v0lta/pytorch-wavelet-toolbox/commit/c52a0038ca7ceb817da834840a1655d55ff6f1a3#diff-499aa4727e73e6303fe60bf9cdec38d37980e9804f8f1d9d678da5ee867366b3L22' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 75906278</div><div id='project'> Project Name: v0lta/pytorch-wavelet-toolbox</div><div id='commit'> Commit Name: c52a0038ca7ceb817da834840a1655d55ff6f1a3</div><div id='time'> Time: 2021-07-02</div><div id='author'> Author: moritz@wolter.tech</div><div id='file'> File Name: tests/test_convolution_fwt.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: test_conv_fwt_haar_lvl2(0)</div><div id='n_method'> N Method Name: test_conv_fwt_haar_lvl2(0)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: tests/test_convolution_fwt.py</div><div id='n_file'> N File Name: tests/test_convolution_fwt.py</div><div id='m_start'> M Start Line: 42</div><div id='m_end'> M End Line: 49</div><div id='n_start'> N Start Line: 22</div><div id='n_end'> N End Line: 56</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
    Displays all the tables and figures given a csv file with segmentation metrics
    Columns expected: Patient,Structure,Dice,HausdorffDistance_mm,MeanDistance_mm
    
    <a id="change">print(f"Reading raw metrics data from: {path_csv}"</a><a id="change">)</a>
    df = pd.read_csv(path_csv)
    with pd.option_context(&quotdisplay.max_rows&quot, None, &quotdisplay.max_columns&quot, None, &quotdisplay.width&quot, 150):
        display_metric(df, MetricsFileColumns.Dice.value, outlier_range, max_row_count, high_values_are_good=True)
        display_metric(df, MetricsFileColumns.HausdorffDistanceMM.value, outlier_range, max_row_count,</code></pre><h3>After Change</h3><pre><code class='java'>
    &#47&#47 those paths contain the run ID, meaning that the output is different for each run, and hence can&quott have
    &#47&#47 HTML files in regression tests. Try to be smart and print as much information as possible up to the "outputs"
    &#47&#47 folder
    path<a id="change"> = </a>Path(path_csv)
    outputs_folder<a id="change"> = </a>[p for p in path.parents if p.name == DEFAULT_AML_UPLOAD_DIR]
    path_to_print = path.relative_to(outputs_folder[0])<a id="change"> if len(outputs_folder) == 1</a><a id="change"> else </a>path
    print(f"Reading raw metrics data from: {path_to_print}")
    df = pd.read_csv(path_csv)
    with pd.option_context(&quotdisplay.max_rows&quot, None, &quotdisplay.max_columns&quot, None, &quotdisplay.width&quot, 150):</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/microsoft/innereye-deeplearning/commit/01c31ed0e50e7836120cf25b4b30cd10c86c236c#diff-ccd212ba4927e6231f8dc6461c3fcb07ac8bfd84e8a31f6c5bed19e254859f9eL16' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 75906279</div><div id='project'> Project Name: microsoft/innereye-deeplearning</div><div id='commit'> Commit Name: 01c31ed0e50e7836120cf25b4b30cd10c86c236c</div><div id='time'> Time: 2021-06-17</div><div id='author'> Author: antonsc@microsoft.com</div><div id='file'> File Name: InnerEye/ML/reports/segmentation_report.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: plot_scores_for_csv(3)</div><div id='n_method'> N Method Name: plot_scores_for_csv(3)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: InnerEye/ML/reports/segmentation_report.py</div><div id='n_file'> N File Name: InnerEye/ML/reports/segmentation_report.py</div><div id='m_start'> M Start Line: 21</div><div id='m_end'> M End Line: 21</div><div id='n_start'> N Start Line: 27</div><div id='n_end'> N End Line: 30</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
    decoder = config.decoder.create().to(device = device)
    num_parameters = sum(p.numel() for p in decoder.parameters())
    print(print_ribbon("Loaded Config", repeat=40))
    <a id="change">print(f"Number of parameters: {num_parameters}"</a><a id="change">)</a>

    tracker = create_tracker(config, **config.tracker.dict())

    train(dataloaders, decoder, </code></pre><h3>After Change</h3><pre><code class='java'>

    &#47&#47 Set up accelerator for configurable distributed training
    ddp_kwargs = DistributedDataParallelKwargs(find_unused_parameters=True)
    accelerator<a id="change"> = </a>Accelerator(kwargs_handlers=[ddp_kwargs])
    
    &#47&#47 Set up data
    all_shards = list(range(config.data.start_shard, config.data.end_shard + 1))
    world_size = accelerator.num_processes
    rank<a id="change"> = </a>accelerator.process_index
    shards_per_process = len(all_shards) // world_size
    assert shards_per_process &gt; 0, "Not enough shards to split evenly"
    my_shards = all_shards[rank * shards_per_process: (rank + 1) * shards_per_process]
    dataloaders = create_dataloaders (
        available_shards=my_shards,
        img_preproc = config.data.img_preproc,
        train_prop = config.data.splits.train,
        val_prop = config.data.splits.val,
        test_prop = config.data.splits.test,
        n_sample_images=config.train.n_sample_images,
        **config.data.dict(),
        rank = rank,
        seed = config.seed,
    )

    &#47&#47 Create the decoder model and print basic info
    decoder = config.decoder.create()
    num_parameters = sum(p.numel() for p in decoder.parameters())

    &#47&#47 Create and initialize the tracker if we are the master
    tracker = create_tracker(accelerator, config, config_path)<a id="change"> if rank == 0</a><a id="change"> else </a>create_tracker(accelerator, config, config_path, tracker_type="dummy")

    accelerator.print(print_ribbon("Loaded Config", repeat=40))
    accelerator.print(f"Running training with {accelerator.num_processes} processes and {accelerator.distributed_type} distributed training")</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/lucidrains/dalle2-pytorch/commit/58892135d9bcf117921c885dda161c0b67452096#diff-1960fa4032117c7620576aea3bf67f017dd87a2077278af4c2f17abf549114b0L408' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 75906274</div><div id='project'> Project Name: lucidrains/dalle2-pytorch</div><div id='commit'> Commit Name: 58892135d9bcf117921c885dda161c0b67452096</div><div id='time'> Time: 2022-06-19</div><div id='author'> Author: aidan.dempster@gmail.com</div><div id='file'> File Name: train_decoder.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: initialize_training(2)</div><div id='n_method'> N Method Name: initialize_training(1)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: train_decoder.py</div><div id='n_file'> N File Name: train_decoder.py</div><div id='m_start'> M Start Line: 410</div><div id='m_end'> M End Line: 431</div><div id='n_start'> N Start Line: 486</div><div id='n_end'> N End Line: 523</div><BR>