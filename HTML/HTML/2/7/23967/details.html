<html><h3>Pattern ID :23967
</h3><img src='74529235.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>

    def _get_dirs(self):
        if self.dir_cache is None:
            self.dir_cache = <a id="change">{
                hf_file.rfilename: {"name": hf_file.rfilename, "size": 0 or None, "type": "file"}  &#47&#47 TODO(QL): add size
                for hf_file in self.repo_info.siblings
            }</a>

    def _open(
        self,
        path: str,</code></pre><h3>After Change</h3><pre><code class='java'>

    def _get_dirs(self):
        if self.dir_cache is None:
            self.dir_cache<a id="change"> = </a><a id="change">{}</a>
            <a id="change">for </a>hf_file in self.repo_info.siblings<a id="change">:
                &#47&#47 TODO(QL): add sizes
                </a>self.dir_cache[hf_file.rfilename] = {
                    "name": hf_file.rfilename,
                    "size": None,
                    "type": "file",
                }
                <a id="change">self.dir_cache.update(
                    </a>{
                        str(d): {"name": str(d), "size": None, "type": "directory"}
                        for d in list(PurePosixPath(hf_file.rfilename).parents)[:-1]
                    }<a id="change">
                )</a>

    def _open(
        self,
        path: str,</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 6</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/huggingface/datasets/commit/bf2ba9923d9133bd6e0be2c4ec20e422fc32f08a#diff-dbf265c0a64b4bcbd01172a8b423d8e8b0c69ebba2634881cbb326b1d08694c1L40' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 74529235</div><div id='project'> Project Name: huggingface/datasets</div><div id='commit'> Commit Name: bf2ba9923d9133bd6e0be2c4ec20e422fc32f08a</div><div id='time'> Time: 2022-03-01</div><div id='author'> Author: mariosasko777@gmail.com</div><div id='file'> File Name: src/datasets/filesystems/hffilesystem.py</div><div id='m_class'> M Class Name: HfFileSystem</div><div id='n_method'> N Class Name: HfFileSystem</div><div id='m_method'> M Method Name: _get_dirs(1)</div><div id='n_method'> N Method Name: _get_dirs(1)</div><div id='m_parent_class'> M Parent Class: AbstractFileSystem</div><div id='n_parent_class'> N Parent Class: AbstractFileSystem</div><div id='m_file'> M File Name: src/datasets/filesystems/hffilesystem.py</div><div id='n_file'> N File Name: src/datasets/filesystems/hffilesystem.py</div><div id='m_start'> M Start Line: 40</div><div id='m_end'> M End Line: 43</div><div id='n_start'> N Start Line: 40</div><div id='n_end'> N End Line: 55</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        macro = f1_score(y_true=y_true, y_pred=y_pred, average="macro")

        reverse_labels_mapping = {v: k for k, v in labels_mapping.items()}
        per_label = <a id="change">{
            reverse_labels_mapping[i]: f1score
            for i, f1score in enumerate(
                f1_score(
                    y_true=y_true,
                    y_pred=y_pred,
                    labels=list(labels_mapping.values()),
                    average=None,
                )
            )
        }</a>

        return {"micro": micro, "macro": macro, "per_label": per_label}

</code></pre><h3>After Change</h3><pre><code class='java'>
            y_true=y_true, y_pred=y_pred, average="macro"
        )

        per_label<a id="change"> = </a><a id="change">{}</a>
        <a id="change">for </a>label, p, r, f, <a id="change">_</a> in zip(
            labels_mapping.values(),
            *precision_recall_fscore_support(
                y_true=y_true,
                y_pred=y_pred,
                labels=list(labels_mapping.values()),
                average=None,
            ),
        )<a id="change">:
            </a><a id="change">per_label.update(
                </a>{f"{label}_precision": p, f"{label}_recall": r, f"{label}_f1": f}<a id="change">
            )</a>

        return {
            "precision_macro": macro_p,
            "recall_macro": macro_r,</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/recognai/rubrix/commit/d28941e3c2a7e69e34358b2e3a2494f7b5c1e78b#diff-4239f6cb60f593e1b65ca7cfbb8a03d147f83f6d6030956f4600a6edf03214d2L29' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 74529234</div><div id='project'> Project Name: recognai/rubrix</div><div id='commit'> Commit Name: d28941e3c2a7e69e34358b2e3a2494f7b5c1e78b</div><div id='time'> Time: 2021-11-24</div><div id='author'> Author: david@recogn.ai</div><div id='file'> File Name: src/rubrix/server/tasks/text_classification/metrics.py</div><div id='m_class'> M Class Name: F1Metric</div><div id='n_method'> N Class Name: F1Metric</div><div id='m_method'> M Method Name: apply(2)</div><div id='n_method'> N Method Name: apply(2)</div><div id='m_parent_class'> M Parent Class: PythonMetric</div><div id='n_parent_class'> N Parent Class: PythonMetric</div><div id='m_file'> M File Name: src/rubrix/server/tasks/text_classification/metrics.py</div><div id='n_file'> N File Name: src/rubrix/server/tasks/text_classification/metrics.py</div><div id='m_start'> M Start Line: 30</div><div id='m_end'> M End Line: 76</div><div id='n_start'> N Start Line: 30</div><div id='n_end'> N End Line: 87</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>


def get_user_flags(flags, flags_def):
    return <a id="change">{key: getattr(flags, key) for key in flags_def}</a>


def prefix_metrics(metrics, prefix):
    return {</code></pre><h3>After Change</h3><pre><code class='java'>
        )
    )
def get_user_flags(flags, flags_def):
    output<a id="change"> = </a><a id="change">{}</a>
    <a id="change">for key</a> in flags_def<a id="change">:
        </a>val = getattr(flags, key)
        if isinstance(val, ConfigDict):
            <a id="change">output.update(</a>flatten_config_dict(val, prefix=key)<a id="change">)</a>
        else:
            output[key] = val
            
    return output</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/young-geng/cql/commit/cd9beb2b0654e98a105c4a69358237c958cc35f9#diff-735c9acab4d22d458807145c9bc073ff20f4e74f0a6e20b28a65b8015dd4acafL62' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 74529229</div><div id='project'> Project Name: young-geng/cql</div><div id='commit'> Commit Name: cd9beb2b0654e98a105c4a69358237c958cc35f9</div><div id='time'> Time: 2021-09-20</div><div id='author'> Author: young.gengxy@gmail.com</div><div id='file'> File Name: SimpleSAC/utils.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: get_user_flags(2)</div><div id='n_method'> N Method Name: get_user_flags(2)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: SimpleSAC/utils.py</div><div id='n_file'> N File Name: SimpleSAC/utils.py</div><div id='m_start'> M Start Line: 63</div><div id='m_end'> M End Line: 63</div><div id='n_start'> N Start Line: 65</div><div id='n_end'> N End Line: 73</div><BR>