<html><h3>Pattern ID :8304
</h3><img src='29077808.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>


    def loss_unknown_structure(self, seq, pairs, score_paired, score_unpaired, pred_bp):
        pred_unpaired<a id="change"> = </a><a id="change">torch.ones_like(</a>score_unpaired<a id="change">, dtype=torch.bool)</a>
        print(torch.max(score_paired[1:, 1:]))
        for i, j in enumerate(pred_bp):
            if i &lt; j:
                pred_unpaired[i] = pred_unpaired[j] = False
        score_unpaired = score_unpaired[1:]
        score_paired = 1 - score_unpaired
        pred_unpaired<a id="change"> = </a>pred_unpaired[1:]

        &#47&#47print(pred_bp)
        &#47&#47print(score_paired)</code></pre><h3>After Change</h3><pre><code class='java'>
        &#47&#47 print(score_unpaired)
        score_paired = 1 - score_unpaired
        &#47&#47print(pred_bp)
        <a id="change">pairs_not_nan</a><a id="change"> = </a>torch.logical_not(torch.isnan(pairs))
        loss  = torch.sum(pairs[<a id="change">pairs_not_nan[:, 0]</a><a id="change">, 0</a>] * score_unpaired[pairs_not_nan[:, 0]])
        loss += torch.sum(pairs[<a id="change">pairs_not_nan[:, 1]</a><a id="change">, 1</a>] * score_paired[pairs_not_nan[:, 1]])

        return loss
</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 8</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/keio-bioinformatics/mxfold2/commit/307eec16f1b4f6b77b0950411d034a4289fb83b0#diff-40c7dafe6bf4ae19d9896b17c5ef72d560791abfcb151c955d1f5348a9df295cL126' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 29077808</div><div id='project'> Project Name: keio-bioinformatics/mxfold2</div><div id='commit'> Commit Name: 307eec16f1b4f6b77b0950411d034a4289fb83b0</div><div id='time'> Time: 2020-01-06</div><div id='author'> Author: satoken@bio.keio.ac.jp</div><div id='file'> File Name: dnnfold/train.py</div><div id='m_class'> M Class Name: PiecewiseLoss</div><div id='n_method'> N Class Name: PiecewiseLoss</div><div id='m_method'> M Method Name: loss_unknown_structure(6)</div><div id='n_method'> N Method Name: loss_unknown_structure(6)</div><div id='m_parent_class'> M Parent Class: nn.Module</div><div id='n_parent_class'> N Parent Class: nn.Module</div><div id='m_file'> M File Name: dnnfold/train.py</div><div id='n_file'> N File Name: dnnfold/train.py</div><div id='m_start'> M Start Line: 126</div><div id='m_end'> M End Line: 140</div><div id='n_start'> N Start Line: 133</div><div id='n_end'> N End Line: 135</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>


    def loss_unknown_structure(self, seq, pairs, score_paired, score_unpaired, pred_bp):
        pred_unpaired<a id="change"> = </a><a id="change">torch.ones_like(</a>score_unpaired<a id="change">, dtype=torch.bool)</a>
        print(torch.max(score_paired[1:, 1:]))
        for i, j in enumerate(pred_bp):
            if i &lt; j:
                pred_unpaired[i] = pred_unpaired[j] = False
        score_unpaired = score_unpaired[1:]
        score_paired = 1 - score_unpaired
        pred_unpaired<a id="change"> = </a>pred_unpaired[1:]

        &#47&#47print(pred_bp)
        &#47&#47print(score_paired)</code></pre><h3>After Change</h3><pre><code class='java'>
        &#47&#47 print(score_unpaired)
        score_paired = 1 - score_unpaired
        &#47&#47print(pred_bp)
        <a id="change">pairs_not_nan</a><a id="change"> = </a>torch.logical_not(torch.isnan(pairs))
        loss  = torch.sum(pairs[pairs_not_nan[:, 0]<a id="change">, 0</a>] * score_unpaired[pairs_not_nan[:, 0]])
        loss += torch.sum(pairs[pairs_not_nan[:, 1]<a id="change">, 1</a>] * score_paired[pairs_not_nan[:, 1]])

        return loss
</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/mxfold/mxfold2/commit/307eec16f1b4f6b77b0950411d034a4289fb83b0#diff-40c7dafe6bf4ae19d9896b17c5ef72d560791abfcb151c955d1f5348a9df295cL125' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 29077803</div><div id='project'> Project Name: mxfold/mxfold2</div><div id='commit'> Commit Name: 307eec16f1b4f6b77b0950411d034a4289fb83b0</div><div id='time'> Time: 2020-01-06</div><div id='author'> Author: satoken@bio.keio.ac.jp</div><div id='file'> File Name: dnnfold/train.py</div><div id='m_class'> M Class Name: PiecewiseLoss</div><div id='n_method'> N Class Name: PiecewiseLoss</div><div id='m_method'> M Method Name: loss_unknown_structure(6)</div><div id='n_method'> N Method Name: loss_unknown_structure(6)</div><div id='m_parent_class'> M Parent Class: nn.Module</div><div id='n_parent_class'> N Parent Class: nn.Module</div><div id='m_file'> M File Name: dnnfold/train.py</div><div id='n_file'> N File Name: dnnfold/train.py</div><div id='m_start'> M Start Line: 126</div><div id='m_end'> M End Line: 140</div><div id='n_start'> N Start Line: 133</div><div id='n_end'> N End Line: 135</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
    Vector y(t).
    
    &#47&#47 Get cumulative slope and intercept at each t
    k_t<a id="change"> = </a>k * <a id="change">np.ones_like(</a>t<a id="change">)</a>
    m_t = m * np.ones_like(t)
    &#47&#47 Intercept changes

    if deltas is not None and changepoints_t is not None:
        gammas = -changepoints_t * deltas
        for s, t_s in enumerate(changepoints_t):
            indx = t &gt;= t_s
            k_t[indx]<a id="change"> += </a>deltas[s]
            m_t[indx] += gammas[s]
    return k_t * t + m_t
</code></pre><h3>After Change</h3><pre><code class='java'>
    print("WARNING: deprecated, might contain bug.")
    t = np.squeeze(t)
    past_changepoint = np.expand_dims(t, 1) &gt;= np.expand_dims(changepoints_t, 0)
    <a id="change">segment_id</a><a id="change"> = </a>np.sum(past_changepoint, axis=1) - 1

    k_t = np.ones((len(t), 1)) * np.expand_dims(k, 0)
    m_t = np.ones((len(t), 1)) * np.expand_dims(m, 0)
    k_t = np.squeeze(k_t[np.arange(len(t))<a id="change">, segment_id</a>])
    m_t = np.squeeze(m_t[np.arange(len(t))<a id="change">, segment_id</a>])

    trend = k_t * t + m_t
    return trend</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/ourownstory/neural_prophet/commit/8dcdd6a5e564ef4412c327d2550025a5647b63a6#diff-db4a8b618706896edff44e14aab2b54e151fb6c58d2c3664bf6a9f10b814c9d8L21' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 29077800</div><div id='project'> Project Name: ourownstory/neural_prophet</div><div id='commit'> Commit Name: 8dcdd6a5e564ef4412c327d2550025a5647b63a6</div><div id='time'> Time: 2020-05-22</div><div id='author'> Author: oskar.triebe@merantix.com</div><div id='file'> File Name: code/utils.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: piecewise_linear(4)</div><div id='n_method'> N Method Name: piecewise_linear(5)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: code/utils.py</div><div id='n_file'> N File Name: code/utils.py</div><div id='m_start'> M Start Line: 21</div><div id='m_end'> M End Line: 47</div><div id='n_start'> N Start Line: 51</div><div id='n_end'> N End Line: 62</div><BR>