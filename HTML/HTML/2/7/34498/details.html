<html><h3>Pattern ID :34498
</h3><img src='99252266.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
        ])

        &#47&#47 Compute heatmaps as preprocessing step
        <a id="change">label_heatmaps = </a><a id="change">[]</a>
        for idx, y in enumerate(tqdm(self.labels)):
            x = Image.open(os.path.join(root_directory, self.image_names[idx])).convert(
                "RGB" &#47&#47didn&quott do this for DLC
            )  &#47&#47 Rick&quots images have 1 color channel; change to 3.
            if transform:
                x, y = transform(images = np.expand_dims(x, axis = 0), keypoints = np.expand_dims(y, axis = 0)) &#47&#47check transform and normalization
            x = x.squeeze(0)
            y = y.squeeze(0)
            x = self.torch_transform(x)
            y_heatmap = draw_keypoints(y, x.shape[-2], x.shape[-1], self.output_shape, sigma = 5)
            <a id="change">label_heatmaps.append(</a>y_heatmap<a id="change">)</a>
        self.label_heatmaps = torch.from_numpy(<a id="change">np.asarray(label_heatmaps</a><a id="change">)</a>).float()
        self.label_heatmaps<a id="change"> = </a>self.label_heatmaps.permute(0, 3, 1, 2)
        &#47&#47check that nan keypoints are producing heatmaps of zeros
        &#47&#47check that max of heatmaps look good
        self.transform = transform</code></pre><h3>After Change</h3><pre><code class='java'>
        &#47&#47Checks for images with set of keypoints that include any nan, so that they can be excluded from the data entirely, like DeepPoseKit does
        &#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47
        self.fully_labeled_idxs = self.get_fully_labeled_idxs()
        <a id="change">print(</a>self.fully_labeled_idxs<a id="change">)</a>
        self.image_names = [self.image_names[idx] for idx in self.fully_labeled_idxs]
        self.labels = [self.labels[idx] for idx in self.fully_labeled_idxs]
        print(len(self.image_names), len(self.labels))
        &#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 4</div><BR><div id='size'>Non-data size: 6</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/danbider/lightning-pose/commit/545a2f0293f923aca78924357ba161baf71f2982#diff-0779795c0a8a233449cfa9c0bd55d45453213457b10fa40da3e5a32966494943L80' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 99252266</div><div id='project'> Project Name: danbider/lightning-pose</div><div id='commit'> Commit Name: 545a2f0293f923aca78924357ba161baf71f2982</div><div id='time'> Time: 2021-07-15</div><div id='author'> Author: ubuntu@ip-172-31-72-121.ec2.internal</div><div id='file'> File Name: pose_est_nets/datasets/datasets.py</div><div id='m_class'> M Class Name: DLCHeatmapDataset</div><div id='n_method'> N Class Name: DLCHeatmapDataset</div><div id='m_method'> M Method Name: __init__(5)</div><div id='n_method'> N Method Name: __init__(5)</div><div id='m_parent_class'> M Parent Class: torch.utils.data.Dataset</div><div id='n_parent_class'> N Parent Class: torch.utils.data.Dataset</div><div id='m_file'> M File Name: pose_est_nets/datasets/datasets.py</div><div id='n_file'> N File Name: pose_est_nets/datasets/datasets.py</div><div id='m_start'> M Start Line: 80</div><div id='m_end'> M End Line: 137</div><div id='n_start'> N Start Line: 80</div><div id='n_end'> N End Line: 114</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        ])

        &#47&#47 Compute heatmaps as preprocessing step
        <a id="change">label_heatmaps = </a><a id="change">[]</a>
        for idx, y in enumerate(tqdm(self.labels)):
            x = Image.open(os.path.join(root_directory, self.image_names[idx])).convert(
                "RGB" &#47&#47didn&quott do this for DLC
            )  &#47&#47 Rick&quots images have 1 color channel; change to 3.
            if transform:
                x, y = transform(images = np.expand_dims(x, axis = 0), keypoints = np.expand_dims(y, axis = 0)) &#47&#47check transform and normalization
            x = x.squeeze(0)
            y = y.squeeze(0)
            x = self.torch_transform(x)
            y_heatmap = draw_keypoints(y, x.shape[-2], x.shape[-1], self.output_shape, sigma = 5)
            <a id="change">label_heatmaps.append(</a>y_heatmap<a id="change">)</a>
        self.label_heatmaps<a id="change"> = </a>torch.from_numpy(<a id="change">np.asarray(</a>label_heatmaps<a id="change">)</a>).float()
        self.label_heatmaps = self.label_heatmaps.permute(0, 3, 1, 2)
        &#47&#47check that nan keypoints are producing heatmaps of zeros
        &#47&#47check that max of heatmaps look good</code></pre><h3>After Change</h3><pre><code class='java'>
        &#47&#47Checks for images with set of keypoints that include any nan, so that they can be excluded from the data entirely, like DeepPoseKit does
        &#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47
        self.fully_labeled_idxs = self.get_fully_labeled_idxs()
        <a id="change">print(</a>self.fully_labeled_idxs<a id="change">)</a>
        self.image_names = [self.image_names[idx] for idx in self.fully_labeled_idxs]
        self.labels = [self.labels[idx] for idx in self.fully_labeled_idxs]
        print(len(self.image_names), len(self.labels))
        &#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/danbider/lightning-pose/commit/545a2f0293f923aca78924357ba161baf71f2982#diff-0779795c0a8a233449cfa9c0bd55d45453213457b10fa40da3e5a32966494943L58' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 99252235</div><div id='project'> Project Name: danbider/lightning-pose</div><div id='commit'> Commit Name: 545a2f0293f923aca78924357ba161baf71f2982</div><div id='time'> Time: 2021-07-15</div><div id='author'> Author: ubuntu@ip-172-31-72-121.ec2.internal</div><div id='file'> File Name: pose_est_nets/datasets/datasets.py</div><div id='m_class'> M Class Name: DLCHeatmapDataset</div><div id='n_method'> N Class Name: DLCHeatmapDataset</div><div id='m_method'> M Method Name: __init__(5)</div><div id='n_method'> N Method Name: __init__(5)</div><div id='m_parent_class'> M Parent Class: torch.utils.data.Dataset</div><div id='n_parent_class'> N Parent Class: torch.utils.data.Dataset</div><div id='m_file'> M File Name: pose_est_nets/datasets/datasets.py</div><div id='n_file'> N File Name: pose_est_nets/datasets/datasets.py</div><div id='m_start'> M Start Line: 80</div><div id='m_end'> M End Line: 137</div><div id='n_start'> N Start Line: 80</div><div id='n_end'> N End Line: 114</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
            photo = np.array(image,dtype = np.float32)/255
            photo = np.transpose(photo, (2, 0, 1))

            <a id="change">images = </a><a id="change">[]</a>
            <a id="change">images.append(</a>photo<a id="change">)</a>
            images<a id="change"> = </a><a id="change">np.asarray(</a>images<a id="change">)</a>
            images = torch.from_numpy(images)
            if self.cuda:
                images = images.cuda()</code></pre><h3>After Change</h3><pre><code class='java'>
            draw = ImageDraw.Draw(image)
            label_size = draw.textsize(label, font)
            label = label.encode(&quotutf-8&quot)
            <a id="change">print(</a>label, top, left, bottom, right<a id="change">)</a>
            
            if top - label_size[1] &gt;= 0:
                text_origin = np.array([left, top - label_size[1]])</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/bubbliiiing/faster-rcnn-pytorch/commit/d456f02a402fd8cf8db1d991aa612439b3c0ffb2#diff-5fc0691d21e4b9e83bbefcaa9a7d6fdf3f26ae49fd9e02ddd9b2710faa5cba84L98' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 99252226</div><div id='project'> Project Name: bubbliiiing/faster-rcnn-pytorch</div><div id='commit'> Commit Name: d456f02a402fd8cf8db1d991aa612439b3c0ffb2</div><div id='time'> Time: 2021-01-30</div><div id='author'> Author: 47347516+bubbliiiing@users.noreply.github.com</div><div id='file'> File Name: frcnn.py</div><div id='m_class'> M Class Name: FRCNN</div><div id='n_method'> N Class Name: FRCNN</div><div id='m_method'> M Method Name: detect_image(2)</div><div id='n_method'> N Method Name: detect_image(2)</div><div id='m_parent_class'> M Parent Class: object</div><div id='n_parent_class'> N Parent Class: object</div><div id='m_file'> M File Name: frcnn.py</div><div id='n_file'> N File Name: frcnn.py</div><div id='m_start'> M Start Line: 99</div><div id='m_end'> M End Line: 172</div><div id='n_start'> N Start Line: 106</div><div id='n_end'> N End Line: 169</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        crop_img = np.array(letterbox_image(image, (image_sizes[self.phi],image_sizes[self.phi])))
        photo = np.array(crop_img,dtype = np.float32)
        photo = np.transpose(preprocess_input(photo), (2, 0, 1))
        <a id="change">images = </a><a id="change">[]</a>
        <a id="change">images.append(</a>photo<a id="change">)</a>
        images<a id="change"> = </a><a id="change">np.asarray(</a>images<a id="change">)</a>

        with torch.no_grad():
            images = torch.from_numpy(images)</code></pre><h3>After Change</h3><pre><code class='java'>
            draw = ImageDraw.Draw(image)
            label_size = draw.textsize(label, font)
            label = label.encode(&quotutf-8&quot)
            <a id="change">print(</a>label, top, left, bottom, right<a id="change">)</a>
            
            if top - label_size[1] &gt;= 0:
                text_origin = np.array([left, top - label_size[1]])</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/bubbliiiing/efficientdet-pytorch/commit/dcf23456863be9f58dd6fdd33a34d777e9dd2b46#diff-567ef7e5070869e637aeba7471621b907fce9ecd180f20e4e2cda565f99f703eL93' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 99252225</div><div id='project'> Project Name: bubbliiiing/efficientdet-pytorch</div><div id='commit'> Commit Name: dcf23456863be9f58dd6fdd33a34d777e9dd2b46</div><div id='time'> Time: 2021-01-18</div><div id='author'> Author: 47347516+bubbliiiing@users.noreply.github.com</div><div id='file'> File Name: efficientdet.py</div><div id='m_class'> M Class Name: EfficientDet</div><div id='n_method'> N Class Name: EfficientDet</div><div id='m_method'> M Method Name: detect_image(2)</div><div id='n_method'> N Method Name: detect_image(2)</div><div id='m_parent_class'> M Parent Class: object</div><div id='n_parent_class'> N Parent Class: object</div><div id='m_file'> M File Name: efficientdet.py</div><div id='n_file'> N File Name: efficientdet.py</div><div id='m_start'> M Start Line: 98</div><div id='m_end'> M End Line: 152</div><div id='n_start'> N Start Line: 107</div><div id='n_end'> N End Line: 173</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        crop_img = np.array(letterbox_image(image, self.image_size))
        photo = np.array(crop_img,dtype = np.float32)
        photo = np.transpose(preprocess_input(photo), (2, 0, 1))
        <a id="change">images = </a><a id="change">[]</a>
        <a id="change">images.append(</a>photo<a id="change">)</a>
        images<a id="change"> = </a><a id="change">np.asarray(</a>images<a id="change">)</a>

        with torch.no_grad():
            images = torch.from_numpy(images)</code></pre><h3>After Change</h3><pre><code class='java'>
            draw = ImageDraw.Draw(image)
            label_size = draw.textsize(label, font)
            label = label.encode(&quotutf-8&quot)
            <a id="change">print(</a>label, top, left, bottom, right<a id="change">)</a>
            
            if top - label_size[1] &gt;= 0:
                text_origin = np.array([left, top - label_size[1]])</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/bubbliiiing/retinanet-pytorch/commit/b891c38c3b4260fd7958c83ab9cc473c0f5dbb8f#diff-be24762c194cbd637f6d4ac2d7d7dd057ed69fd3777c63feddb563d10d634078L97' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 99252228</div><div id='project'> Project Name: bubbliiiing/retinanet-pytorch</div><div id='commit'> Commit Name: b891c38c3b4260fd7958c83ab9cc473c0f5dbb8f</div><div id='time'> Time: 2021-01-19</div><div id='author'> Author: 47347516+bubbliiiing@users.noreply.github.com</div><div id='file'> File Name: retinanet.py</div><div id='m_class'> M Class Name: RetinaNet</div><div id='n_method'> N Class Name: RetinaNet</div><div id='m_method'> M Method Name: detect_image(2)</div><div id='n_method'> N Method Name: detect_image(2)</div><div id='m_parent_class'> M Parent Class: object</div><div id='n_parent_class'> N Parent Class: object</div><div id='m_file'> M File Name: retinanet.py</div><div id='n_file'> N File Name: retinanet.py</div><div id='m_start'> M Start Line: 100</div><div id='m_end'> M End Line: 134</div><div id='n_start'> N Start Line: 112</div><div id='n_end'> N End Line: 180</div><BR>