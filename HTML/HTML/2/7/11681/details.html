<html><h3>Pattern ID :11681
</h3><img src='39514202.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
            total_greedy_list = list(np.array(total_greedy_list)[rand_indices])
            gammas = list(np.array(gammas)[rand_indices])
        elif self.selection_type == &quotSupervised&quot:
            <a id="change">for </a>i in range(self.num_classes)<a id="change">:
                </a>if i == 0:
                    idxs<a id="change"> = </a>torch.where(labels == i)[0]
                    N = len(idxs)
                    self.compute_score(model_params, idxs)
                    row = idxs.repeat_interleave(N)
                    col = idxs.repeat(N)
                    data = self.dist_mat.flatten()
                else:
                    idxs = torch.where(labels == i)[0]
                    N = len(idxs)
                    self.compute_score(model_params, idxs)
                    row<a id="change"> = </a>torch.cat((row, idxs.repeat_interleave(N)), dim=0)
                    col = torch.cat((col<a id="change">, idxs.repeat(N)</a>), dim=0)
                    data<a id="change"> = </a>np.concatenate([data, self.dist_mat.flatten()], axis=0)
            sparse_simmat = csr_matrix((data, (row.numpy(), col.numpy())), shape=(self.N_trn, self.N_trn))
            self.dist_mat = sparse_simmat
            fl = apricot.functions.facilityLocation.FacilityLocationSelection(random_state=0, metric=&quotprecomputed&quot,</code></pre><h3>After Change</h3><pre><code class='java'>
            total_greedy_list = list(np.array(total_greedy_list)[rand_indices])
            gammas = list(np.array(gammas)[rand_indices])
        elif self.selection_type == &quotSupervised&quot:
            idxs = <a id="change">torch.arange(0, self.N_trn).long()</a>
            N = len(idxs)
            self.compute_score(model_params, idxs)
            row = idxs.repeat_interleave(N)
            col = idxs.repeat(N)</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 6</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/decile-team/cords/commit/0b9fa0d7a62b59ab3d740399460db130d1d933ad#diff-0b6a4e0f5ac4dd2ad3ba5c0cfbb2abf9a1cd7ab33baafe7927010fa81fb37d17L276' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 39514202</div><div id='project'> Project Name: decile-team/cords</div><div id='commit'> Commit Name: 0b9fa0d7a62b59ab3d740399460db130d1d933ad</div><div id='time'> Time: 2021-11-10</div><div id='author'> Author: krishnateja.killamsetty@utdallas.edu</div><div id='file'> File Name: cords/selectionstrategies/SL/craigstrategy.py</div><div id='m_class'> M Class Name: CRAIGStrategy</div><div id='n_method'> N Class Name: CRAIGStrategy</div><div id='m_method'> M Method Name: select(3)</div><div id='n_method'> N Method Name: select(3)</div><div id='m_parent_class'> M Parent Class: DataSelectionStrategy</div><div id='n_parent_class'> N Parent Class: DataSelectionStrategy</div><div id='m_file'> M File Name: cords/selectionstrategies/SL/craigstrategy.py</div><div id='n_file'> N File Name: cords/selectionstrategies/SL/craigstrategy.py</div><div id='m_start'> M Start Line: 276</div><div id='m_end'> M End Line: 291</div><div id='n_start'> N Start Line: 276</div><div id='n_end'> N End Line: 281</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
            total_greedy_list = list(np.array(total_greedy_list)[rand_indices])
            gammas = list(np.array(gammas)[rand_indices])
        elif self.selection_type == &quotSupervised&quot:
            <a id="change">for i</a> in range(self.num_classes)<a id="change">:
                </a>if i == 0:
                    idxs<a id="change"> = </a>torch.where(labels == i)[0]
                    N = len(idxs)
                    self.compute_score(model_params, idxs)
                    row = idxs.repeat_interleave(N)
                    col = idxs.repeat(N)
                    data = self.dist_mat.flatten()
                else:
                    idxs = torch.where(labels == i)[0]
                    N = len(idxs)
                    self.compute_score(model_params, idxs)
                    row = torch.cat((row<a id="change">, idxs.repeat_interleave(N)</a>), dim=0)
                    col<a id="change"> = </a>torch.cat((col, idxs.repeat(N)), dim=0)
                    data<a id="change"> = </a>np.concatenate([data, self.dist_mat.flatten()], axis=0)
            sparse_simmat = csr_matrix((data, (row.numpy(), col.numpy())), shape=(self.N_trn, self.N_trn))
            self.dist_mat = sparse_simmat
            fl = apricot.functions.facilityLocation.FacilityLocationSelection(random_state=0, metric=&quotprecomputed&quot,</code></pre><h3>After Change</h3><pre><code class='java'>
            total_greedy_list = list(np.array(total_greedy_list)[rand_indices])
            gammas = list(np.array(gammas)[rand_indices])
        elif self.selection_type == &quotSupervised&quot:
            idxs = <a id="change">torch.arange(0, self.N_trn).long()</a>
            N = len(idxs)
            self.compute_score(model_params, idxs)
            row = idxs.repeat_interleave(N)
            col = idxs.repeat(N)</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/decile-team/cords/commit/0b9fa0d7a62b59ab3d740399460db130d1d933ad#diff-0b6a4e0f5ac4dd2ad3ba5c0cfbb2abf9a1cd7ab33baafe7927010fa81fb37d17L226' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 39514234</div><div id='project'> Project Name: decile-team/cords</div><div id='commit'> Commit Name: 0b9fa0d7a62b59ab3d740399460db130d1d933ad</div><div id='time'> Time: 2021-11-10</div><div id='author'> Author: krishnateja.killamsetty@utdallas.edu</div><div id='file'> File Name: cords/selectionstrategies/SL/craigstrategy.py</div><div id='m_class'> M Class Name: CRAIGStrategy</div><div id='n_method'> N Class Name: CRAIGStrategy</div><div id='m_method'> M Method Name: select(3)</div><div id='n_method'> N Method Name: select(3)</div><div id='m_parent_class'> M Parent Class: DataSelectionStrategy</div><div id='n_parent_class'> N Parent Class: DataSelectionStrategy</div><div id='m_file'> M File Name: cords/selectionstrategies/SL/craigstrategy.py</div><div id='n_file'> N File Name: cords/selectionstrategies/SL/craigstrategy.py</div><div id='m_start'> M Start Line: 276</div><div id='m_end'> M End Line: 291</div><div id='n_start'> N Start Line: 276</div><div id='n_end'> N End Line: 281</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        with record_function("(zhg) categorize indices"):
            chunk_id_set = set()
            chunk_counter = dict()
            <a id="change">for id</a> in ids<a id="change">:
                </a>chunk_id<a id="change">, offset_in_chunk = </a>self.index_mapping_table[id]
                chunk_id_set.add(chunk_id)
                if chunk_id not in chunk_counter:
                    chunk_counter[chunk_id]<a id="change"> = </a>1
                else:
                    chunk_counter[chunk_id]<a id="change"> += </a>1

            assert len(chunk_id_set) &lt;= self.cuda_chunk_num, \
                f"the input indices pull {len(chunk_id_set)} chunks, " \</code></pre><h3>After Change</h3><pre><code class='java'>
        self.evict_backlist.clear()
        &#47&#47 new ids chunk_offset + offset_in_chunk
        with record_function("(zhg) embed idx -&gt; cache chunk id"):
            mapped_ids = <a id="change">self._id_to_cached_cuda_id(ids).long()</a>.view(ids.shape)
        return mapped_ids

    def _prepare_chunks_on_cuda(self, chunk_ids: List[int]) -&gt; None:</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/hpcaitech/cachedembedding/commit/5062f1cff105e81702e90439e652d412e4950718#diff-aab5f7e7e049810d29a74e3eab12af668892a81357998cc464ab0f8cd2272767L116' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 39514239</div><div id='project'> Project Name: hpcaitech/cachedembedding</div><div id='commit'> Commit Name: 5062f1cff105e81702e90439e652d412e4950718</div><div id='time'> Time: 2022-07-25</div><div id='author'> Author: fangjiarui123@gmail.com</div><div id='file'> File Name: recsys/modules/embeddings/chunk_param_mgr.py</div><div id='m_class'> M Class Name: ChunkParamMgr</div><div id='n_method'> N Class Name: ChunkParamMgr</div><div id='m_method'> M Method Name: prepare_ids(2)</div><div id='n_method'> N Method Name: prepare_ids(2)</div><div id='m_parent_class'> M Parent Class: object</div><div id='n_parent_class'> N Parent Class: object</div><div id='m_file'> M File Name: recsys/modules/embeddings/chunk_param_mgr.py</div><div id='n_file'> N File Name: recsys/modules/embeddings/chunk_param_mgr.py</div><div id='m_start'> M Start Line: 126</div><div id='m_end'> M End Line: 165</div><div id='n_start'> N Start Line: 152</div><div id='n_end'> N End Line: 189</div><BR>