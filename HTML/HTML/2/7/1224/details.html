<html><h3>Pattern ID :1224
</h3><img src='6243550.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>

    def __call__(self, *args, **kwargs) -&gt; Union[BaseModel, Future]:
        _default_key_val = ("_DEFAULT",)
        executor = <a id="change">kwargs.get("executor"</a>, _default_key_val<a id="change">)</a>

        if executor is _default_key_val:  &#47&#47 do not use ==
            &#47&#47 use executor created during initialization
            executor = self.executor</code></pre><h3>After Change</h3><pre><code class='java'>
            postprocess_kwargs = {}

        &#47&#47 split inputs into batches of size `self._batch_size`
        batches<a id="change"> = </a>self.split_engine_inputs(engine_inputs, self._batch_size)

        &#47&#47 submit to engine
        futures<a id="change"> = </a>[
            self.executor.submit(self.engine_forward, batch) for batch in batches
        ]
        wait(futures)

        &#47&#47 join together the batches of size `self._batch_size`
        engine_outputs<a id="change"> = </a>self.join_engine_outputs(
            <a id="change">[future.result() for future in futures]</a>
        )

        pipeline_outputs = self.process_engine_outputs(
            engine_outputs, **postprocess_kwargs</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 6</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/neuralmagic/deepsparse/commit/51a99e18329a82cfff93b9cda06eb4f6983c64e2#diff-bab8a867c64069e2efe49cfb9a3ada579e3058fa48bdafcc743f1cca24bcd147L180' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 6243550</div><div id='project'> Project Name: neuralmagic/deepsparse</div><div id='commit'> Commit Name: 51a99e18329a82cfff93b9cda06eb4f6983c64e2</div><div id='time'> Time: 2022-08-30</div><div id='author'> Author: 109536191+corey-nm@users.noreply.github.com</div><div id='file'> File Name: src/deepsparse/pipeline.py</div><div id='m_class'> M Class Name: Pipeline</div><div id='n_method'> N Class Name: Pipeline</div><div id='m_method'> M Method Name: __call__(1)</div><div id='n_method'> N Method Name: __call__(1)</div><div id='m_parent_class'> M Parent Class: ABC</div><div id='n_parent_class'> N Parent Class: ABC</div><div id='m_file'> M File Name: src/deepsparse/pipeline.py</div><div id='n_file'> N File Name: src/deepsparse/pipeline.py</div><div id='m_start'> M Start Line: 180</div><div id='m_end'> M End Line: 194</div><div id='n_start'> N Start Line: 180</div><div id='n_end'> N End Line: 224</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>

        &#47&#47 If they exist, plot all our loose input constraints (i.e., our one-step backprojection set estimates)
        &#47&#47 TODO: Make plotting these optional via a flag
        for info in <a id="change">kwargs.get(&quotper_timestep&quot</a>, []<a id="change">)</a>:
            ic = info.get(&quotone_step_backprojection_overapprox&quot, None)
            if ic is None: continue
            rect = ic.plot(self.partitioner.animate_axes, self.partitioner.input_dims, self.estimated_one_step_backprojection_set_color, zorder=self.estimated_one_step_backprojection_set_zorder, linewidth=self.partitioner.linewidth, plot_2d=self.partitioner.plot_2d)</code></pre><h3>After Change</h3><pre><code class='java'>
        &#47&#47         zorder=1,
        &#47&#47     )
        from colour import Color
        orange<a id="change"> = </a>Color("orange")
        colors<a id="change"> = </a>list(orange.range_to(Color("purple"),len(input_constraints)))
        import matplotlib as mpl
        from mpl_toolkits.axes_grid1 import make_axes_locatable
        divider = make_axes_locatable(plt.gca())
        ax_cb = divider.new_horizontal(size="5%", pad=0.05)
        cmap<a id="change"> = </a>mpl.colors.LinearSegmentedColormap.from_list("", <a id="change">[color.hex for color in colors]</a>)
        cb1 = mpl.colorbar.ColorbarBase(ax_cb, cmap=cmap, orientation=&quotvertical&quot, label=&quott (s)&quot, values=range(len(input_constraints)))
        
        plt.gcf().add_axes(ax_cb)</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/mit-acl/nn_robustness_analysis/commit/aed9f9b4eef5ac9826f2323736ec43eddc8ef5df#diff-d0698ee66895448c091d380c6631fa12fa68dc9aef7eaa12f1ed79ebf7a5445cL133' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 6243469</div><div id='project'> Project Name: mit-acl/nn_robustness_analysis</div><div id='commit'> Commit Name: aed9f9b4eef5ac9826f2323736ec43eddc8ef5df</div><div id='time'> Time: 2022-04-01</div><div id='author'> Author: nrober1122@gmail.com</div><div id='file'> File Name: nn_closed_loop/nn_closed_loop/analyzers/ClosedLoopBackwardAnalyzer.py</div><div id='m_class'> M Class Name: ClosedLoopBackwardAnalyzer</div><div id='n_method'> N Class Name: ClosedLoopBackwardAnalyzer</div><div id='m_method'> M Method Name: visualize_single_set(10)</div><div id='n_method'> N Method Name: visualize_single_set(10)</div><div id='m_parent_class'> M Parent Class: analyzers.Analyzer</div><div id='n_parent_class'> N Parent Class: analyzers.Analyzer</div><div id='m_file'> M File Name: nn_closed_loop/nn_closed_loop/analyzers/ClosedLoopBackwardAnalyzer.py</div><div id='n_file'> N File Name: nn_closed_loop/nn_closed_loop/analyzers/ClosedLoopBackwardAnalyzer.py</div><div id='m_start'> M Start Line: 218</div><div id='m_end'> M End Line: 280</div><div id='n_start'> N Start Line: 200</div><div id='n_end'> N End Line: 326</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
    res["eid"] = entry["eid"]
    res["size"] = int(entry["size"])
    res["lex"] = {
        "comment": [ex.get("comment", "") for ex in <a id="change">entry.get("lex"</a>, []<a id="change">)</a>],
        "lid": [ex.get("lid", "") for ex in entry.get("lex", [])],
        &#47&#47 all of the sequence are within their own 1-element sublist, else the [0]
        "text": [ex.get("text", "")[0] for ex in entry.get("lex", [])],</code></pre><h3>After Change</h3><pre><code class='java'>
    res["category"] = entry["category"]
    res["eid"] = entry["eid"]
    res["size"] = int(entry["size"])
    lex<a id="change"> = </a>entry["lex"]
    &#47&#47 Some entries are misformed, with None instead of the sorted triplet information.
    entry_triples<a id="change"> = </a>[
        ex["sortedtripleset"][0] if ex["sortedtripleset"][0] is not None else {"sentence": []} for ex in lex
    ]
    &#47&#47 the xml structure is inconsistent; sorted triplets are often separated in several dictionaries, so we sum them.
    sorted_triples<a id="change"> = </a><a id="change">[
        list(itertools.chain.from_iterable(item.get("striple", []) for item in entry["sentence"]))
        for entry in entry_triples
    ]</a>
    res["lex"] = {
        "comment": [ex.get("comment", "") for ex in lex],
        "lid": [ex.get("lid", "") for ex in lex],
        &#47&#47 all of the sequence are within their own 1-element sublist, thus the [0]</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/huggingface/datasets/commit/919cadb6a8d0763121259a178ec19c90d0d5de14#diff-bea9568cbae32922000987443505e0a644fbbe2e0c2bc2a0254f7050c36b0007L87' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 6243546</div><div id='project'> Project Name: huggingface/datasets</div><div id='commit'> Commit Name: 919cadb6a8d0763121259a178ec19c90d0d5de14</div><div id='time'> Time: 2020-12-17</div><div id='author'> Author: teven.lescao@gmail.com</div><div id='file'> File Name: datasets/enriched_web_nlg/enriched_web_nlg.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: parse_entry(2)</div><div id='n_method'> N Method Name: parse_entry(1)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: datasets/enriched_web_nlg/enriched_web_nlg.py</div><div id='n_file'> N File Name: datasets/enriched_web_nlg/enriched_web_nlg.py</div><div id='m_start'> M Start Line: 101</div><div id='m_end'> M End Line: 104</div><div id='n_start'> N Start Line: 88</div><div id='n_end'> N End Line: 122</div><BR>