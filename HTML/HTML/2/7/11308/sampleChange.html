<link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
            self.hparams.ind2lab,
            task="encode",
        )
        target_tokens<a id="change"> = </a><a id="change">target_tokens.to(</a>self.device<a id="change">)</a>
        target_token_lens = target_token_lens.to(self.device)
        if hasattr(self.hparams, "env_corrupt") and stage == sb.Stage.TRAIN:
            target_tokens = torch.cat([target_tokens, target_tokens], dim=0)
            target_token_lens = torch.cat(
                [target_token_lens, target_token_lens], dim=0
            )

        &#47&#47 Add char_lens by one for eos token
        abs_length = torch.round(target_token_lens * target_tokens.shape[1])

        &#47&#47 Append eos token at the end of the label sequences
        target_tokens_with_eos = sb.data_io.data_io.append_eos_token(
            target_tokens, length=abs_length, eos_index=self.hparams.eos_index
        )

        &#47&#47 Convert to speechbrain-style relative length
        rel_length = (abs_length + 1) / <a id="change">target_tokens_with_eos.shape[1]</a>
        loss_seq = self.hparams.seq_cost(
            p_seq, target_tokens_with_eos, length=rel_length
        )
</code></pre><h3>After Change</h3><pre><code class='java'>
                for utt_seq in predicted_tokens
            ]

            target_semantics = <a id="change">[wrd.split(" ") for wrd in batch.semantics]</a>

            for i in range(len(target_semantics)):
                print(" ".join(predicted_semantics[i]).replace("|", ","))
                print(" ".join(target_semantics[i]).replace("|", ","))</code></pre>