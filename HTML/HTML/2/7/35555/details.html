<html><h3>Pattern ID :35555
</h3><img src='101427073.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
            mix_filepath = glob.glob(os.path.join(mix_dir, "*.wav"))[0]

            &#47&#47 now check the length of the mix
            <a id="change">try:
                </a>y, sr = torchaudio.load(mix_filepath)
            <a id="change">except</a>:
                print(f"Skipping {mix_filepath}")
                continue
</code></pre><h3>After Change</h3><pre><code class='java'>
                mix_id = os.path.basename(mix_dir)
                mix_filepath = glob.glob(os.path.join(mix_dir, "*.wav"))[0]

                <a id="change">if "AimeeNorwich_Child" in mix_filepath</a>:
                    <a id="change">continue</a>

                &#47&#47 save only a random subset of this song so we can load more songs
                silent = True
                counter = 0
                while silent:

                    num_frames = torchaudio.info(mix_filepath).num_frames

                    offset<a id="change"> = </a>np.random.randint(
                        0,
                        num_frames - self.buffer_audio_length - 1,
                    )

                    &#47&#47 now check the length of the mix
                    y, sr = torchaudio.load(
                        mix_filepath,
                        frame_offset=offset,
                        num_frames=self.buffer_audio_length,
                    )

                    energy = (y**2).mean()
                    print(energy)
                    if energy &gt; 1e-3:
                        silent<a id="change"> = </a>False

                    counter += 1
                    if counter &gt; 10:</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 7</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/csteinmetz1/automix-toolkit/commit/0fcdce4c33e652710e5c0682499c65bab52b991b#diff-3b5493e29457d0c2fa425a9c7a85b846becf17818150651f5682153839469d49L58' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 101427073</div><div id='project'> Project Name: csteinmetz1/automix-toolkit</div><div id='commit'> Commit Name: 0fcdce4c33e652710e5c0682499c65bab52b991b</div><div id='time'> Time: 2022-11-28</div><div id='author'> Author: csteinmetz1@gmail.com</div><div id='file'> File Name: automix/data/medleydb.py</div><div id='m_class'> M Class Name: MedleyDBDataset</div><div id='n_method'> N Class Name: MedleyDBDataset</div><div id='m_method'> M Method Name: reload_buffer(1)</div><div id='n_method'> N Method Name: reload_buffer(1)</div><div id='m_parent_class'> M Parent Class: torch.utils.data.Dataset</div><div id='n_parent_class'> N Parent Class: torch.utils.data.Dataset</div><div id='m_file'> M File Name: automix/data/medleydb.py</div><div id='n_file'> N File Name: automix/data/medleydb.py</div><div id='m_start'> M Start Line: 58</div><div id='m_end'> M End Line: 108</div><div id='n_start'> N Start Line: 62</div><div id='n_end'> N End Line: 148</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
            break
        if event[0] == 1024:
            continue
        <a id="change">try:
            </a>assert event[0] &lt; 256,\
                "Failed at step {}, event 0: {} is not between 0 and 256".format(step, event[i])
            for i in range(1, 7):
                assert (i + 1) * 128 &lt;= event[i] and event[i] &lt; (i + 2) * 128,\
                    "Failed at step {}, event {}: {} is not between {} and {}".format(
                        step, i, event[i], (i + 1) * 128, (i + 2) * 128
                    )
        <a id="change">except </a>AssertionError:
            if step &gt; 10:
                print(&quotGeneration stopped at step {}&quot.format(step))
                break</code></pre><h3>After Change</h3><pre><code class='java'>
            break
        if event[0] == 129 or 128 in event[1:]:
            continue
        <a id="change">if event[0] == 131</a> or 130 in event[1:]:
            <a id="change">continue</a>
        instrument = event[0]
        pitch<a id="change"> = </a>event[1]
        velocity<a id="change"> = </a>event[2]
        dur = event[3] * 128 + event[4]
        delta = event[5] * 128 + event[6]
        instruments[instrument].notes.append(</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/rick-mccoy/reformer-pytorch/commit/3411114d22e0bfcae2e106f5c82a3211da83f409#diff-0c7aefb52977622e5d22f9dcd058f39df9769e3be03c444b9fc6905780235bbfL38' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 101426970</div><div id='project'> Project Name: rick-mccoy/reformer-pytorch</div><div id='commit'> Commit Name: 3411114d22e0bfcae2e106f5c82a3211da83f409</div><div id='time'> Time: 2020-02-29</div><div id='author'> Author: rickmccoy3141@gmail.com</div><div id='file'> File Name: datasets/music.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: roll_to_midi(1)</div><div id='n_method'> N Method Name: roll_to_midi(1)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: datasets/music.py</div><div id='n_file'> N File Name: datasets/music.py</div><div id='m_start'> M Start Line: 38</div><div id='m_end'> M End Line: 66</div><div id='n_start'> N Start Line: 44</div><div id='n_end'> N End Line: 60</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
    def auroc(self):
        y_true = np.concatenate(self.targets)
        y_score = np.concatenate(self.scores)
        <a id="change">try:
            </a>return roc_auc_score(y_true=y_true, y_score=y_score, average=&quotmicro&quot)
        <a id="change">except </a>ValueError:
            return float("nan")
    
    @property</code></pre><h3>After Change</h3><pre><code class='java'>
    def auroc(self):
        y_true = np.concatenate(self.targets)
        y_score = np.concatenate(self.scores)
        <a id="change">if len(self.classes) &gt; 0</a>:
            y_class = np.concatenate(self.classes)
            classes = np.unique(y_class)
            y_true_per_class = {c: [] for c in classes}
            y_score_per_class = {c: [] for c in classes}
            for i, cls in enumerate(y_class):
                y_true_per_class[cls].append(y_true[i])
                y_score_per_class[cls].append(y_score[i])
            res<a id="change"> = </a>[]
            for c in classes:
                if len(np.unique(y_true_per_class[c])) == 1:
                    <a id="change">continue</a>
                res.append(roc_auc_score(y_true=y_true_per_class[c], y_score=y_score_per_class[c]))
            
            res = np.mean(res)

        else:
            res<a id="change"> =  </a>roc_auc_score(y_true=y_true, y_score=y_score, average=&quotmicro&quot)
        
        return res
    </code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/jwoo5/fairseq-signals/commit/241c202d291cc51779e6351428ebf1a156102d7c#diff-af252615dcca77f52481367dbc96f4a4cf283663cd6e8346d15c7e1b92915109L157' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 101426991</div><div id='project'> Project Name: jwoo5/fairseq-signals</div><div id='commit'> Commit Name: 241c202d291cc51779e6351428ebf1a156102d7c</div><div id='time'> Time: 2022-12-11</div><div id='author'> Author: ojw0123@korea.ac.kr</div><div id='file'> File Name: fairseq_signals/logging/meters.py</div><div id='m_class'> M Class Name: AUCMeter</div><div id='n_method'> N Class Name: AUCMeter</div><div id='m_method'> M Method Name: auroc(1)</div><div id='n_method'> N Method Name: auroc(1)</div><div id='m_parent_class'> M Parent Class: Meter</div><div id='n_parent_class'> N Parent Class: Meter</div><div id='m_file'> M File Name: fairseq_signals/logging/meters.py</div><div id='n_file'> N File Name: fairseq_signals/logging/meters.py</div><div id='m_start'> M Start Line: 160</div><div id='m_end'> M End Line: 165</div><div id='n_start'> N Start Line: 164</div><div id='n_end'> N End Line: 185</div><BR>