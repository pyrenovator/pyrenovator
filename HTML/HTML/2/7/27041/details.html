<html><h3>Pattern ID :27041
</h3><img src='80474060.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
    log_dir = il_train_ex.observers[0].dir
    imitation_logger.configure(log_dir, ["stdout", "tensorboard"])

    <a id="change">if </a>benchmark[&quotbenchmark_name&quot] == &quotmagical&quot:
        gym_env_name_chans_first, dataset_dict = load_dataset_magical()
        venv_chans_first<a id="change"> = </a>make_vec_env(gym_env_name_chans_first,
                                        n_envs=1,
                                        parallel=False)
    elif benchmark[&quotbenchmark_name&quot] == &quotdm_control&quot:
        gym_env_name_chans_first<a id="change">, dataset_dict = </a>load_dataset_dm_control()
        venv_chans_first<a id="change"> = </a>make_vec_env(gym_env_name_chans_first,
                                        n_envs=1,
                                        parallel=False)
    elif <a id="change">benchmark[&quotbenchmark_name&quot] == &quotatari&quot</a>:
        dataset_dict = load_dataset_atari()
        gym_env_name_chans_last = benchmark[&quotatari_env_id&quot]
        venv_nhwc = VecFrameStack(make_atari_env(gym_env_name_chans_last), 4)
        venv_chans_first = VecTransposeImage(venv_nhwc)
    else:
        <a id="change">raise </a>NotImplementedError(
            f"this code does not yet support "
            f"benchmark_name={benchmark[&quotbenchmark_name&quot]!r}")
</code></pre><h3>After Change</h3><pre><code class='java'>

    &#47&#47 FIXME(sam): make sure this always closes correctly, even when there&quots an
    &#47&#47 exception after creating it (could use try/catch or a context manager)
    <a id="change">venv.close()</a>

    return log_dir

</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 7</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/humancompatibleai/eirli/commit/4f43a9030853ed574d23f2e86f5253fc4ccd11de#diff-b8a30b79d4b477ae4ff3f89cb23e1e0d8475a5ef44d82945f1ab0d152531016cL158' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 80474060</div><div id='project'> Project Name: humancompatibleai/eirli</div><div id='commit'> Commit Name: 4f43a9030853ed574d23f2e86f5253fc4ccd11de</div><div id='time'> Time: 2020-08-13</div><div id='author'> Author: sam@qxcv.net</div><div id='file'> File Name: src/il_representations/scripts/il_train.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: train(5)</div><div id='n_method'> N Method Name: train(5)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: src/il_representations/scripts/il_train.py</div><div id='n_file'> N File Name: src/il_representations/scripts/il_train.py</div><div id='m_start'> M Start Line: 164</div><div id='m_end'> M End Line: 211</div><div id='n_start'> N Start Line: 158</div><div id='n_end'> N End Line: 187</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
    log_dir = il_train_ex.observers[0].dir
    imitation_logger.configure(log_dir, ["stdout", "tensorboard"])

    <a id="change">if </a>benchmark[&quotbenchmark_name&quot] == &quotmagical&quot:
        gym_env_name_chans_first, dataset_dict = load_dataset_magical()
        venv_chans_first<a id="change"> = </a>make_vec_env(gym_env_name_chans_first,
                                        n_envs=1,
                                        parallel=False)
    elif benchmark[&quotbenchmark_name&quot] == &quotdm_control&quot:
        gym_env_name_chans_first<a id="change">, dataset_dict = </a>load_dataset_dm_control()
        venv_chans_first<a id="change"> = </a>make_vec_env(gym_env_name_chans_first,
                                        n_envs=1,
                                        parallel=False)
    elif <a id="change">benchmark[&quotbenchmark_name&quot] == &quotatari&quot</a>:
        dataset_dict = load_dataset_atari()
        gym_env_name_chans_last = benchmark[&quotatari_env_id&quot]
        venv_nhwc = VecFrameStack(make_atari_env(gym_env_name_chans_last), 4)
        venv_chans_first = VecTransposeImage(venv_nhwc)
    else:
        <a id="change">raise </a>NotImplementedError(
            f"this code does not yet support "
            f"benchmark_name={benchmark[&quotbenchmark_name&quot]!r}")
</code></pre><h3>After Change</h3><pre><code class='java'>

    &#47&#47 FIXME(sam): make sure this always closes correctly, even when there&quots an
    &#47&#47 exception after creating it (could use try/catch or a context manager)
    <a id="change">venv.close()</a>

    return log_dir

</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/humancompatibleai/eirli/commit/e27cbb99e7f7a03a80d5ff8063b3071bf534edda#diff-b8a30b79d4b477ae4ff3f89cb23e1e0d8475a5ef44d82945f1ab0d152531016cL155' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 80474075</div><div id='project'> Project Name: humancompatibleai/eirli</div><div id='commit'> Commit Name: e27cbb99e7f7a03a80d5ff8063b3071bf534edda</div><div id='time'> Time: 2020-08-13</div><div id='author'> Author: sam@qxcv.net</div><div id='file'> File Name: src/il_representations/scripts/il_train.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: train(5)</div><div id='n_method'> N Method Name: train(5)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: src/il_representations/scripts/il_train.py</div><div id='n_file'> N File Name: src/il_representations/scripts/il_train.py</div><div id='m_start'> M Start Line: 164</div><div id='m_end'> M End Line: 211</div><div id='n_start'> N Start Line: 158</div><div id='n_end'> N End Line: 187</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        return jobs

    def execute(self, job):
        <a id="change">if </a>not isinstance(job, Job):
            raise ValueError(f&quot{self.__class__.__name__}.execute() argument must be of type Job&quot)
        logging.basicConfig(level=logging.INFO, format=&quot%(asctime)s - %(message)s&quot)
        logging.info(f&quot{self.__class__.__name__} - {job.jobIndex:3}/{job.jobCount:3} - execute - START&quot)
        for k, v in self.__dict__.items():
            if isinstance(v, Delayed):
                setattr(self, k, v.make())
        inputChunks<a id="change"> = </a>[inputChunk.open() for inputChunk in job.inputChunks]
        outputChunk = job.outputChunk.open()
        loadedData = []
        for loadInputChunk in job.loadedInputChunks:
            loadInputChunkIterator<a id="change"> = </a>loadInputChunk.open()
            loadedData.append(list(loadInputChunkIterator))
            loadInputChunk.close()
        self.init()
        for inputData in zip(*inputChunks):
            if <a id="change">len({value.get_hash_id() for value in inputData}) &gt; 1</a> and not job.force:
                <a id="change">raise </a>ValueError(&quotdifferent hashIds in the input of a single run() call, set force=True in the task to continue&quot)
            outputChunk.append(self.run(*inputData, *loadedData))
        for inputChunk in inputChunks:
            inputChunk.close()
        outputChecksum<a id="change"> = </a>outputChunk.close()
        logging.info(f&quot{self.__class__.__name__} - {job.jobIndex:3}/{job.jobCount:3} - execute - END&quot)
        return JobReport(outputChecksum=outputChecksum)
</code></pre><h3>After Change</h3><pre><code class='java'>
                self._check_same_hash(inputData)
            self.outputChunk.append(self.run(*inputData, *self.loadedData))
        self._close_input_chunks()
        outputChecksum = <a id="change">self.outputChunk.close()</a>
        self.log(f&quot{job.jobIndex:3}/{job.jobCount:3} - execute - END&quot)
        return JobReport(outputChecksum=outputChecksum)

    def run(self, *args, **kwargs):</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/hypergol/hypergol/commit/1027b728bc186f44c8931184662a9e3d920ceb73#diff-3991e4d7336f63978e12073e7737d0a9cb80ace3a2bb20147b45d7d17b91b064L64' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 80474433</div><div id='project'> Project Name: hypergol/hypergol</div><div id='commit'> Commit Name: 1027b728bc186f44c8931184662a9e3d920ceb73</div><div id='time'> Time: 2020-07-02</div><div id='author'> Author: rhyspatten@googlemail.com</div><div id='file'> File Name: src/hypergol/simple_task.py</div><div id='m_class'> M Class Name: SimpleTask</div><div id='n_method'> N Class Name: SimpleTask</div><div id='m_method'> M Method Name: execute(2)</div><div id='n_method'> N Method Name: execute(2)</div><div id='m_parent_class'> M Parent Class: BaseTask</div><div id='n_parent_class'> N Parent Class: Repr</div><div id='m_file'> M File Name: src/hypergol/simple_task.py</div><div id='n_file'> N File Name: src/hypergol/simple_task.py</div><div id='m_start'> M Start Line: 64</div><div id='m_end'> M End Line: 87</div><div id='n_start'> N Start Line: 8</div><div id='n_end'> N End Line: 19</div><BR>