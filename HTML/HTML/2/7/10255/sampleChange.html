<link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
    if len(derivative) == 1:
        return output[0]
    else:
        <a id="change">return </a>output


def SphericalHarmonics(xyz, l, m, derivative=0, jacobian=True):</code></pre><h3>After Change</h3><pre><code class='java'>
        else:
            return torch.stack((dx, dy, dz), dim=-1)

    elif <a id="change">derivative == 2</a>:

        &#47&#47 prepare the exponets
        km2 = k - 2
        km2[km2 &lt; 0] = 0

        xyz_km2 = fast_power(xyz, km2)
        xyz_k = <a id="change">fast_power(</a>xyz, k, mask0, mask2<a id="change">)</a>

        kx<a id="change">, ky, kz = </a>k.transpose(0, 1)

        d2x<a id="change"> = </a>kx*(kx-1) * xyz_km2[..., 0] * \
            xyz_k[..., 1] * xyz_k[..., 2]
        d2y = ky*(ky-1) * xyz_k[..., 0] * \
            xyz_km2[..., 1] * xyz_k[..., 2]</code></pre>