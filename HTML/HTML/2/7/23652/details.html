<html><h3>Pattern ID :23652
</h3><img src='73885959.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
        clean = resample(torch.as_tensor(clean), sr, 16000, method=__resample_method).numpy()
        degraded = resample(torch.as_tensor(degraded), sr, 16000, method=__resample_method).numpy()
        sr = 16000
    cf<a id="change"> = </a>tempfile.NamedTemporaryFile(suffix=".wav")
    save_audio(cf.name, clean, sr)
    nf = tempfile.NamedTemporaryFile(suffix=".wav")
    save_audio(nf.name, degraded, sr)
    c<a id="change"> = </a>semetrics.composite(cf.name, nf.name)
    <a id="change">cf.close()</a>
    nf.close()
    return np.asarray(c)

</code></pre><h3>After Change</h3><pre><code class='java'>
        clean = resample(torch.as_tensor(clean), sr, 16000, method=__resample_method).numpy()
        degraded = resample(torch.as_tensor(degraded), sr, 16000, method=__resample_method).numpy()
        sr = 16000
    <a id="change">if </a>HAS_OCTAVE:
        cf<a id="change"> = </a>tempfile.NamedTemporaryFile(suffix=".wav")
        save_audio(cf.name, clean, sr)
        nf = tempfile.NamedTemporaryFile(suffix=".wav")
        save_audio(nf.name, degraded, sr)
        c<a id="change"> = </a>semetrics.composite(cf.name, nf.name)
        <a id="change">cf.close()</a>
        nf.close()
    else:
        c = [pesq(sr, clean, degraded, "wb"), 0, 0, 0, 0]
    return np.asarray(c)</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 5</div><BR><div id='size'>Non-data size: 7</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/rikorose/deepfilternet/commit/81b8e86f9cf86974a910ddcf3a430816b5ab902f#diff-9d0fe3d0e5e25f12d4767a035b11c96bfa948425696f36ae0623a83385ef1201L135' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 73885959</div><div id='project'> Project Name: rikorose/deepfilternet</div><div id='commit'> Commit Name: 81b8e86f9cf86974a910ddcf3a430816b5ab902f</div><div id='time'> Time: 2022-04-12</div><div id='author'> Author: h.schroeter@pm.me</div><div id='file'> File Name: DeepFilterNet/df/scripts/test_voicebank_demand.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: composite(3)</div><div id='n_method'> N Method Name: composite(3)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: DeepFilterNet/df/scripts/test_voicebank_demand.py</div><div id='n_file'> N File Name: DeepFilterNet/df/scripts/test_voicebank_demand.py</div><div id='m_start'> M Start Line: 135</div><div id='m_end'> M End Line: 147</div><div id='n_start'> N Start Line: 142</div><div id='n_end'> N End Line: 155</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
    def __init__(self):
        Implementation of initialization
        &#47&#47 load json and create model
        json_file<a id="change"> = </a>open(&quotModels/BiLSTM_Glove_de_identification_model.json&quot, &quotr&quot)
        loaded_model_json = json_file.read()
        <a id="change">json_file.close()</a>
        self.model<a id="change"> = </a>model_from_json(loaded_model_json)
        self.GLOVE_DIR = "Resources/"
        if os.path.isdir(self.GLOVE_DIR) == False or os.path.isfile(self.GLOVE_DIR+"glove.840B.300d.txt")==False:
            if os.path.exists(self.GLOVE_DIR)==False:</code></pre><h3>After Change</h3><pre><code class='java'>
        Implementation of initialization
        &#47&#47 load json and create model
        self.model = None
        <a id="change">if </a>os.path.exists(&quotModels/BiLSTM_Glove_de_identification_model.json&quot):
            json_file<a id="change"> = </a>open(&quotModels/BiLSTM_Glove_de_identification_model.json&quot, &quotr&quot)
            loaded_model_json = json_file.read()
            <a id="change">json_file.close()</a>
            self.model<a id="change"> = </a>model_from_json(loaded_model_json)
        self.GLOVE_DIR = "Resources/"
        if os.path.isdir(self.GLOVE_DIR) == False or os.path.isfile(self.GLOVE_DIR+"glove.840B.300d.txt")==False:
            if os.path.exists(self.GLOVE_DIR)==False:</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/icescentral/mask_public/commit/9554a44aa97892ef3f87fc9730b6e716f8ddf7a9#diff-6b3370609ad5bc2e90807cd1bc6677ddced049b4f797ad5fa876d8be967a5169L19' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 73885971</div><div id='project'> Project Name: icescentral/mask_public</div><div id='commit'> Commit Name: 9554a44aa97892ef3f87fc9730b6e716f8ddf7a9</div><div id='time'> Time: 2019-11-28</div><div id='author'> Author: nikola.milosevic86@gmail.com</div><div id='file'> File Name: ner_plugins/NER_BiLSTM_Glove_i2b2.py</div><div id='m_class'> M Class Name: NER_BiLSTM_Glove_i2b2</div><div id='n_method'> N Class Name: NER_BiLSTM_Glove_i2b2</div><div id='m_method'> M Method Name: __init__(1)</div><div id='n_method'> N Method Name: __init__(1)</div><div id='m_parent_class'> M Parent Class: object</div><div id='n_parent_class'> N Parent Class: object</div><div id='m_file'> M File Name: ner_plugins/NER_BiLSTM_Glove_i2b2.py</div><div id='n_file'> N File Name: ner_plugins/NER_BiLSTM_Glove_i2b2.py</div><div id='m_start'> M Start Line: 22</div><div id='m_end'> M End Line: 25</div><div id='n_start'> N Start Line: 22</div><div id='n_end'> N End Line: 28</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
    def __init__(self):
        Implementation of initialization
        &#47&#47 load json and create model
        json_file<a id="change"> = </a>open(&quotModels/BiLSTM_Glove_de_identification_model.json&quot, &quotr&quot)
        loaded_model_json<a id="change"> = </a>json_file.read()
        <a id="change">json_file.close()</a>
        self.model = model_from_json(loaded_model_json)
        self.GLOVE_DIR = "Resources/"
        if os.path.isdir(self.GLOVE_DIR) == False or os.path.isfile(self.GLOVE_DIR+"glove.840B.300d.txt")==False:
            if os.path.exists(self.GLOVE_DIR)==False:</code></pre><h3>After Change</h3><pre><code class='java'>
    def __init__(self):
        Implementation of initialization
        &#47&#47 load json and create model
        <a id="change">if </a>os.path.exists("Models/BiLSTM_Glove_de_identification_model.json"):
            json_file<a id="change"> = </a>open(&quotModels/BiLSTM_Glove_de_identification_model.json&quot, &quotr&quot)
            loaded_model_json<a id="change"> = </a>json_file.read()
            <a id="change">json_file.close()</a>
            self.model = model_from_json(loaded_model_json)
        self.GLOVE_DIR = "Resources/"
        if os.path.isdir(self.GLOVE_DIR) == False or os.path.isfile(self.GLOVE_DIR+"glove.840B.300d.txt")==False:
            if os.path.exists(self.GLOVE_DIR)==False:</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/icescentral/mask_public/commit/71735d676198a9bb5e13c08be0e8cca2584e53c8#diff-6b3370609ad5bc2e90807cd1bc6677ddced049b4f797ad5fa876d8be967a5169L19' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 73885965</div><div id='project'> Project Name: icescentral/mask_public</div><div id='commit'> Commit Name: 71735d676198a9bb5e13c08be0e8cca2584e53c8</div><div id='time'> Time: 2019-11-28</div><div id='author'> Author: nikola.milosevic86@gmail.com</div><div id='file'> File Name: ner_plugins/NER_BiLSTM_Glove_i2b2.py</div><div id='m_class'> M Class Name: NER_BiLSTM_Glove_i2b2</div><div id='n_method'> N Class Name: NER_BiLSTM_Glove_i2b2</div><div id='m_method'> M Method Name: __init__(1)</div><div id='n_method'> N Method Name: __init__(1)</div><div id='m_parent_class'> M Parent Class: object</div><div id='n_parent_class'> N Parent Class: object</div><div id='m_file'> M File Name: ner_plugins/NER_BiLSTM_Glove_i2b2.py</div><div id='n_file'> N File Name: ner_plugins/NER_BiLSTM_Glove_i2b2.py</div><div id='m_start'> M Start Line: 22</div><div id='m_end'> M End Line: 25</div><div id='n_start'> N Start Line: 22</div><div id='n_end'> N End Line: 27</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
            if isinstance(task, Source):
                task.execute()
            elif isinstance(task, (SimpleTask, Task)):
                pool<a id="change"> = </a>Pool(task.threads or threads)
                jobReports<a id="change"> = </a>pool.map(task.execute, task.get_jobs())
                task.finalise(jobReports=jobReports, threads=task.threads or threads)
                <a id="change">pool.close()</a>
                pool.join()
                pool.terminate()
            else:
                raise ValueError(&quotTask must be of type Task, SimpleTask or Source&quot)</code></pre><h3>After Change</h3><pre><code class='java'>
            if task.outputDataset.exists():
                raise DatasetAlreadyExistsException(f"Dataset {task.outputDataset.defFilename} already exist, delete the dataset first with Dataset.delete()")
        for task in self.tasks:
            <a id="change">if </a>not isinstance(task, Task):
                raise ValueError(&quotTask must be of type Task&quot)
            pool<a id="change"> = </a>Pool(task.threads or threads)
            jobReports<a id="change"> = </a>pool.map(task.execute, task.get_jobs())
            task.finalise(jobReports=jobReports, threads=task.threads or threads)
            <a id="change">pool.close()</a>
            pool.join()
            pool.terminate()
        self.logger.log(f&quot{self.__class__.__name__} - Pipeline - END&quot)
</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/hypergol/hypergol/commit/c0c7c423bca8b7ed3835acde03d054dccba936f3#diff-d3b3497042fc42146258c9b9d93e7de99250af30722bf419c249319acfafc42bL21' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 73885962</div><div id='project'> Project Name: hypergol/hypergol</div><div id='commit'> Commit Name: c0c7c423bca8b7ed3835acde03d054dccba936f3</div><div id='time'> Time: 2020-12-01</div><div id='author'> Author: sragner@gmail.com</div><div id='file'> File Name: src/hypergol/pipeline.py</div><div id='m_class'> M Class Name: Pipeline</div><div id='n_method'> N Class Name: Pipeline</div><div id='m_method'> M Method Name: run(2)</div><div id='n_method'> N Method Name: run(2)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: src/hypergol/pipeline.py</div><div id='n_file'> N File Name: src/hypergol/pipeline.py</div><div id='m_start'> M Start Line: 33</div><div id='m_end'> M End Line: 44</div><div id='n_start'> N Start Line: 34</div><div id='n_end'> N End Line: 47</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        import h5py

        print("&gt;&gt;&gt;&gt; Reload mismatched weights.")
        ff<a id="change"> = </a>h5py.File(weight_file, mode="r")
        weights<a id="change"> = </a>ff["model_weights"]
        for ii in model.layers:
            if isinstance(ii, mismatch_class) and ii.name in weights:
                print("&gt;&gt;&gt;&gt; Reload layer:", ii.name)
                ss = weights[ii.name]
                &#47&#47 ss = {ww.decode().split("/")[-1] : tf.convert_to_tensor(ss[ww]) for ww in ss.attrs[&quotweight_names&quot]}
                ss = {ww.decode("utf8") if hasattr(ww, "decode") else ww: tf.convert_to_tensor(ss[ww]) for ww in ss.attrs["weight_names"]}
                ss = {kk.split("/")[-1]: vv for kk, vv in ss.items()}
                model.get_layer(ii.name).load_resized_pos_emb(ss, method=method)
        <a id="change">ff.close()</a>


def state_dict_stack_by_layer(state_dict, skip_weights=["num_batches_tracked"], unstack_weights=[]):
    stacked_state_dict = {}</code></pre><h3>After Change</h3><pre><code class='java'>
def load_weights_with_mismatch(model, weight_file, mismatch_class=None, request_resolution=-1, method="nearest"):
    model.load_weights(weight_file, by_name=True, skip_mismatch=True)
    input_height = model.input_shape[1]
    <a id="change">if </a>mismatch_class is not None and request_resolution != input_height:
        try:
            import h5py

            print("&gt;&gt;&gt;&gt; Reload mismatched weights: {} -&gt; {}".format(request_resolution, input_height))
            ff<a id="change"> = </a>h5py.File(weight_file, mode="r")
            weights<a id="change"> = </a>ff["model_weights"]
            for ii in model.layers:
                if isinstance(ii, mismatch_class) and ii.name in weights:
                    print("&gt;&gt;&gt;&gt; Reload layer:", ii.name)
                    ss = weights[ii.name]
                    &#47&#47 ss = {ww.decode().split("/")[-1] : tf.convert_to_tensor(ss[ww]) for ww in ss.attrs[&quotweight_names&quot]}
                    ss = {ww.decode("utf8") if hasattr(ww, "decode") else ww: tf.convert_to_tensor(ss[ww]) for ww in ss.attrs["weight_names"]}
                    ss = {kk.split("/")[-1]: vv for kk, vv in ss.items()}
                    model.get_layer(ii.name).load_resized_pos_emb(ss, method=method)
            <a id="change">ff.close()</a>

        &#47&#47 print("&gt;&gt;&gt;&gt; Reload mismatched PositionalEmbedding weights: {} -&gt; {}".format(request_resolution, input_shape[0]))
        &#47&#47 bb = keras.models.load_model(pretrained_model)
        &#47&#47 for ii in model.layers:</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/leondgarse/keras_cv_attention_models/commit/4b65cfd64524c57ba09b422c673158752b0fa346#diff-37028f58f90dc39d0ed1f23dec40bd7e001ad2d587c2dd6ddd16655aaec34d38L74' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 73885976</div><div id='project'> Project Name: leondgarse/keras_cv_attention_models</div><div id='commit'> Commit Name: 4b65cfd64524c57ba09b422c673158752b0fa346</div><div id='time'> Time: 2022-01-12</div><div id='author'> Author: leondgarse@gmail.com</div><div id='file'> File Name: keras_cv_attention_models/download_and_load.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: load_weights_with_mismatch(5)</div><div id='n_method'> N Method Name: load_weights_with_mismatch(5)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: keras_cv_attention_models/download_and_load.py</div><div id='n_file'> N File Name: keras_cv_attention_models/download_and_load.py</div><div id='m_start'> M Start Line: 74</div><div id='m_end'> M End Line: 92</div><div id='n_start'> N Start Line: 47</div><div id='n_end'> N End Line: 77</div><BR>