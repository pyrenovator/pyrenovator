<html><h3>Pattern ID :14353
</h3><img src='47431153.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
    def get(self, request):    
        r = redis.Redis(connection_pool=settings.REDIS_FEED_UPDATE_POOL)

        <a id="change">return </a><a id="change">JsonResponse({
            </a>&quotupdate_queue&quot: r.scard("queued_feeds"),
            &quotfeeds_fetched&quot: r.zcard("fetched_feeds_last_hour"),
            &quottasked_feeds&quot: r.zcard("tasked_feeds"),
            &quoterror_feeds&quot: r.zcard("error_feeds"),
            &quotcelery_update_feeds&quot: r.llen("update_feeds"),
            &quotcelery_new_feeds&quot: r.llen("new_feeds"),
            &quotcelery_push_feeds&quot: r.llen("push_feeds"),
            &quotcelery_work_queue&quot: r.llen("work_queue"),
            &quotcelery_search_queue&quot: r.llen("search_indexer")<a id="change">,
        }</a><a id="change">)</a>
</code></pre><h3>After Change</h3><pre><code class='java'>
            &quotcelery_work_queue&quot: r.llen("work_queue"),
            &quotcelery_search_queue&quot: r.llen("search_indexer"),
        }
        <a id="change">return </a><a id="change">render(</a>request, <a id="change">&quotmonitor/prometheus_data.html&quot</a>, <a id="change">{</a>"data": data<a id="change">})</a>

</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 6</div><BR><div id='size'>Non-data size: 6</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/samuelclay/NewsBlur/commit/b29532952f4996699a16b4a0b2bdc68c250bed3b#diff-cb0e46235f5a12a90fd92ab066148c99263366ae3cf8c9d65649a8e797d920fcL12' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 47431153</div><div id='project'> Project Name: samuelclay/NewsBlur</div><div id='commit'> Commit Name: b29532952f4996699a16b4a0b2bdc68c250bed3b</div><div id='time'> Time: 2021-04-27</div><div id='author'> Author: jonathanamath@gmail.com</div><div id='file'> File Name: apps/monitor/views/newsblur_updates.py</div><div id='m_class'> M Class Name: Updates</div><div id='n_method'> N Class Name: Updates</div><div id='m_method'> M Method Name: get(2)</div><div id='n_method'> N Method Name: get(2)</div><div id='m_parent_class'> M Parent Class: View</div><div id='n_parent_class'> N Parent Class: View</div><div id='m_file'> M File Name: apps/monitor/views/newsblur_updates.py</div><div id='n_file'> N File Name: apps/monitor/views/newsblur_updates.py</div><div id='m_start'> M Start Line: 12</div><div id='m_end'> M End Line: 22</div><div id='n_start'> N Start Line: 12</div><div id='n_end'> N End Line: 23</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>

        r = redis.Redis(connection_pool=settings.REDIS_FEED_UPDATE_POOL)
        
        <a id="change">return </a><a id="change">JsonResponse({
            </a>&quotscheduled_feeds&quot: r.zcard(&quotscheduled_updates&quot),
            &quotexception_feeds&quot: exception_feeds,
            &quotexception_pages&quot: exception_pages,
            &quotduplicate_feeds&quot: duplicate_feeds,
            &quotactive_feeds&quot: active_feeds,
            &quotpush_feeds&quot: push_feeds<a id="change">,
        }</a><a id="change">)</a>

</code></pre><h3>After Change</h3><pre><code class='java'>
            &quotactive_feeds&quot: active_feeds,
            &quotpush_feeds&quot: push_feeds,
        }
        <a id="change">return </a><a id="change">render(</a>request, <a id="change">&quotmonitor/prometheus_data.html&quot</a>, <a id="change">{</a>"data": data<a id="change">})</a>


</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/samuelclay/NewsBlur/commit/b29532952f4996699a16b4a0b2bdc68c250bed3b#diff-bb41b38b970261f35297abd985ead894a0ffeded50770749107e4baaadd6776eL11' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 47431152</div><div id='project'> Project Name: samuelclay/NewsBlur</div><div id='commit'> Commit Name: b29532952f4996699a16b4a0b2bdc68c250bed3b</div><div id='time'> Time: 2021-04-27</div><div id='author'> Author: jonathanamath@gmail.com</div><div id='file'> File Name: apps/monitor/views/newsblur_feed_counts.py</div><div id='m_class'> M Class Name: FeedCounts</div><div id='n_method'> N Class Name: FeedCounts</div><div id='m_method'> M Method Name: get(2)</div><div id='n_method'> N Method Name: get(2)</div><div id='m_parent_class'> M Parent Class: View</div><div id='n_parent_class'> N Parent Class: View</div><div id='m_file'> M File Name: apps/monitor/views/newsblur_feed_counts.py</div><div id='n_file'> N File Name: apps/monitor/views/newsblur_feed_counts.py</div><div id='m_start'> M Start Line: 13</div><div id='m_end'> M End Line: 47</div><div id='n_start'> N Start Line: 13</div><div id='n_end'> N End Line: 48</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>

    def get(self, request):
        
        <a id="change">return </a><a id="change">JsonResponse({
            </a>&quotsql_avg&quot: MStatistics.get(&quotlatest_sql_avg&quot),
            &quotmongo_avg&quot: MStatistics.get(&quotlatest_mongo_avg&quot),
            &quotredis_avg&quot: MStatistics.get(&quotlatest_redis_avg&quot),
            &quottask_sql_avg&quot: MStatistics.get(&quotlatest_task_sql_avg&quot),
            &quottask_mongo_avg&quot: MStatistics.get(&quotlatest_task_mongo_avg&quot),
            &quottask_redis_avg&quot: MStatistics.get(&quotlatest_task_redis_avg&quot)<a id="change">,
        }</a><a id="change">)</a>
</code></pre><h3>After Change</h3><pre><code class='java'>
            &quottask_redis_avg&quot: MStatistics.get(&quotlatest_task_redis_avg&quot),
        }

        <a id="change">return </a><a id="change">render(</a>request, <a id="change">&quotmonitor/prometheus_data.html&quot</a>, <a id="change">{</a>"data": data<a id="change">})</a>
</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/samuelclay/NewsBlur/commit/b29532952f4996699a16b4a0b2bdc68c250bed3b#diff-a0974e7e38b7bded433de4e032f56664890c912e85037bf3baeed94c0c201255L9' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 47431151</div><div id='project'> Project Name: samuelclay/NewsBlur</div><div id='commit'> Commit Name: b29532952f4996699a16b4a0b2bdc68c250bed3b</div><div id='time'> Time: 2021-04-27</div><div id='author'> Author: jonathanamath@gmail.com</div><div id='file'> File Name: apps/monitor/views/newsblur_dbtimes.py</div><div id='m_class'> M Class Name: DbTimes</div><div id='n_method'> N Class Name: DbTimes</div><div id='m_method'> M Method Name: get(2)</div><div id='n_method'> N Method Name: get(2)</div><div id='m_parent_class'> M Parent Class: View</div><div id='n_parent_class'> N Parent Class: View</div><div id='m_file'> M File Name: apps/monitor/views/newsblur_dbtimes.py</div><div id='n_file'> N File Name: apps/monitor/views/newsblur_dbtimes.py</div><div id='m_start'> M Start Line: 11</div><div id='m_end'> M End Line: 18</div><div id='n_start'> N Start Line: 11</div><div id='n_end'> N End Line: 20</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
    def get(self, request):
        from apps.statistics.models import MStatistics
        
        <a id="change">return </a><a id="change">JsonResponse({
            </a>&quotfeed_loadtimes_avg_hour&quot: MStatistics.get(&quotlatest_avg_time_taken&quot),
            &quotfeeds_loaded_hour&quot: MStatistics.get(&quotlatest_sites_loaded&quot)<a id="change">,
        }</a><a id="change">)</a>
</code></pre><h3>After Change</h3><pre><code class='java'>
            &quotfeed_loadtimes_avg_hour&quot: MStatistics.get(&quotlatest_avg_time_taken&quot),
            &quotfeeds_loaded_hour&quot: MStatistics.get(&quotlatest_sites_loaded&quot),
        }
        <a id="change">return </a><a id="change">render(</a>request, <a id="change">&quotmonitor/prometheus_data.html&quot</a>, <a id="change">{</a>"data": data<a id="change">})</a>

</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/samuelclay/NewsBlur/commit/b29532952f4996699a16b4a0b2bdc68c250bed3b#diff-928ad0f28df8a1718e75533b9215c90f1b3cfdb9e2b12a2c3756de3f87b8835eL6' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 47431150</div><div id='project'> Project Name: samuelclay/NewsBlur</div><div id='commit'> Commit Name: b29532952f4996699a16b4a0b2bdc68c250bed3b</div><div id='time'> Time: 2021-04-27</div><div id='author'> Author: jonathanamath@gmail.com</div><div id='file'> File Name: apps/monitor/views/newsblur_loadtimes.py</div><div id='m_class'> M Class Name: LoadTimes</div><div id='n_method'> N Class Name: LoadTimes</div><div id='m_method'> M Method Name: get(2)</div><div id='n_method'> N Method Name: get(2)</div><div id='m_parent_class'> M Parent Class: View</div><div id='n_parent_class'> N Parent Class: View</div><div id='m_file'> M File Name: apps/monitor/views/newsblur_loadtimes.py</div><div id='n_file'> N File Name: apps/monitor/views/newsblur_loadtimes.py</div><div id='m_start'> M Start Line: 9</div><div id='m_end'> M End Line: 12</div><div id='n_start'> N Start Line: 9</div><div id='n_end'> N End Line: 13</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
            subscriptions_count = UserSubscription.objects.all().count()
            MStatistics.set(&quotmunin:subscriptions_count&quot, subscriptions_count, 60*60*12)

        <a id="change">return </a><a id="change">JsonResponse({
            </a>&quotfeeds&quot: feeds_count,
            &quotsubscriptions&quot: subscriptions_count,
            &quotprofiles&quot: MSocialProfile.objects.count(),
            &quotsocial_subscriptions&quot: MSocialSubscription.objects.count()<a id="change">,
        }</a><a id="change">)</a>

</code></pre><h3>After Change</h3><pre><code class='java'>
            &quotsocial_subscriptions&quot: MSocialSubscription.objects.count(),
        }

        <a id="change">return </a><a id="change">render(</a>request, <a id="change">&quotmonitor/prometheus_data.html&quot</a>, <a id="change">{</a>"data": data<a id="change">})</a>

</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/samuelclay/NewsBlur/commit/b29532952f4996699a16b4a0b2bdc68c250bed3b#diff-c57c36bbc37ce5dc9656868bbd817f63af993dd367e92df5d756c5a9d85a2743L11' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 47431149</div><div id='project'> Project Name: samuelclay/NewsBlur</div><div id='commit'> Commit Name: b29532952f4996699a16b4a0b2bdc68c250bed3b</div><div id='time'> Time: 2021-04-27</div><div id='author'> Author: jonathanamath@gmail.com</div><div id='file'> File Name: apps/monitor/views/newsblur_feeds.py</div><div id='m_class'> M Class Name: Feeds</div><div id='n_method'> N Class Name: Feeds</div><div id='m_method'> M Method Name: get(2)</div><div id='n_method'> N Method Name: get(2)</div><div id='m_parent_class'> M Parent Class: View</div><div id='n_parent_class'> N Parent Class: View</div><div id='m_file'> M File Name: apps/monitor/views/newsblur_feeds.py</div><div id='n_file'> N File Name: apps/monitor/views/newsblur_feeds.py</div><div id='m_start'> M Start Line: 13</div><div id='m_end'> M End Line: 28</div><div id='n_start'> N Start Line: 13</div><div id='n_end'> N End Line: 30</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        last_month = datetime.datetime.utcnow() - datetime.timedelta(days=30)
        last_day = datetime.datetime.utcnow() - datetime.timedelta(minutes=60*24)

        <a id="change">return </a><a id="change">JsonResponse({
            </a>&quotall&quot: User.objects.count(),
            &quotmonthly&quot: Profile.objects.filter(last_seen_on__gte=last_month).count(),
            &quotdaily&quot: Profile.objects.filter(last_seen_on__gte=last_day).count(),
            &quotpremium&quot: Profile.objects.filter(is_premium=True).count(),
            &quotqueued&quot: RNewUserQueue.user_count()<a id="change">,
        }</a><a id="change">)</a>
</code></pre><h3>After Change</h3><pre><code class='java'>
            &quotpremium&quot: Profile.objects.filter(is_premium=True).count(),
            &quotqueued&quot: RNewUserQueue.user_count(),
        }
        <a id="change">return </a><a id="change">render(</a>request, <a id="change">&quotmonitor/prometheus_data.html&quot</a>, <a id="change">{</a>"data": data<a id="change">})</a>

</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/samuelclay/NewsBlur/commit/b29532952f4996699a16b4a0b2bdc68c250bed3b#diff-59c88dcb6a3e5928261345cbb8dc61dcd547e1d6242062b5b9c39232ac05ce1cL11' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 47431148</div><div id='project'> Project Name: samuelclay/NewsBlur</div><div id='commit'> Commit Name: b29532952f4996699a16b4a0b2bdc68c250bed3b</div><div id='time'> Time: 2021-04-27</div><div id='author'> Author: jonathanamath@gmail.com</div><div id='file'> File Name: apps/monitor/views/newsblur_users.py</div><div id='m_class'> M Class Name: Users</div><div id='n_method'> N Class Name: Users</div><div id='m_method'> M Method Name: get(2)</div><div id='n_method'> N Method Name: get(2)</div><div id='m_parent_class'> M Parent Class: View</div><div id='n_parent_class'> N Parent Class: View</div><div id='m_file'> M File Name: apps/monitor/views/newsblur_users.py</div><div id='n_file'> N File Name: apps/monitor/views/newsblur_users.py</div><div id='m_start'> M Start Line: 15</div><div id='m_end'> M End Line: 21</div><div id='n_start'> N Start Line: 15</div><div id='n_end'> N End Line: 22</div><BR>