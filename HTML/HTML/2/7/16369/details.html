<html><h3>Pattern ID :16369
</h3><img src='55188558.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
) -&gt; Tensor:
    xformers flash-attention computation.

    <a id="change">raise </a>NotImplementedError

    assert memory_efficient_attention is not None
</code></pre><h3>After Change</h3><pre><code class='java'>

    join = lambda x: x.contiguous()

    <a id="change">q</a><a id="change">, k, v = </a><a id="change">map(</a>lambda x: x.contiguous(), (<a id="change">q</a><a id="change">, k, v</a>)<a id="change">)</a>

    q = q.contiguous()
    k = k.contiguous()
    v = v.contiguous()</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 5</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/tfernd/sd-fused/commit/7f386f3d8259972ecd2e2dfeabc7b3469762b353#diff-ae835bdb7ff7ae313826b95d84c2c847e7cb7a9e1cfe7725bd67a31ab56dae61L20' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 55188558</div><div id='project'> Project Name: tfernd/sd-fused</div><div id='commit'> Commit Name: 7f386f3d8259972ecd2e2dfeabc7b3469762b353</div><div id='time'> Time: 2022-11-23</div><div id='author'> Author: ThalesFDFernandes@gmai.com</div><div id='file'> File Name: sd_fused/layers/blocks/attention/compute/flash_attention.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: flash_attention(4)</div><div id='n_method'> N Method Name: flash_attention(4)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: sd_fused/layers/blocks/attention/compute/flash_attention.py</div><div id='n_file'> N File Name: sd_fused/layers/blocks/attention/compute/flash_attention.py</div><div id='m_start'> M Start Line: 20</div><div id='m_end'> M End Line: 20</div><div id='n_start'> N Start Line: 22</div><div id='n_end'> N End Line: 29</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
) -&gt; Tensor:
    xformers flash-attention computation.

    <a id="change">raise </a>NotImplementedError

    assert memory_efficient_attention is not None
</code></pre><h3>After Change</h3><pre><code class='java'>

    join = lambda x: x.contiguous()

    q<a id="change">, k, v = </a><a id="change">map(</a>lambda x: x.contiguous(), (q<a id="change">, k, v</a>)<a id="change">)</a>

    q = q.contiguous()
    k = k.contiguous()
    v = v.contiguous()</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/tfernd/sd-fused/commit/7f386f3d8259972ecd2e2dfeabc7b3469762b353#diff-ae835bdb7ff7ae313826b95d84c2c847e7cb7a9e1cfe7725bd67a31ab56dae61L12' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 55188559</div><div id='project'> Project Name: tfernd/sd-fused</div><div id='commit'> Commit Name: 7f386f3d8259972ecd2e2dfeabc7b3469762b353</div><div id='time'> Time: 2022-11-23</div><div id='author'> Author: ThalesFDFernandes@gmai.com</div><div id='file'> File Name: sd_fused/layers/blocks/attention/compute/flash_attention.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: flash_attention(4)</div><div id='n_method'> N Method Name: flash_attention(4)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: sd_fused/layers/blocks/attention/compute/flash_attention.py</div><div id='n_file'> N File Name: sd_fused/layers/blocks/attention/compute/flash_attention.py</div><div id='m_start'> M Start Line: 20</div><div id='m_end'> M End Line: 20</div><div id='n_start'> N Start Line: 22</div><div id='n_end'> N End Line: 29</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        raise NotImplementedError

    def q_posterior(self, x_start, x_t, t):
        <a id="change">raise </a>NotImplementedError

    def q_sample(self, x_start, t, noise = None):
        noise = default(noise, lambda: torch.randn_like(x_start))</code></pre><h3>After Change</h3><pre><code class='java'>
    def q_posterior(self, x_start, x_t, t, t_next):
         https://openreview.net/attachment?id=2LdBqxc1Yv&name=supplementary_material 
         Âµ still has to be done (eq. 32)
        <a id="change">log_snr</a> = self.log_snr(t)
        <a id="change">log_snr_next</a> = self.log_snr(t_next)
        log_snr<a id="change">, log_snr_next = </a><a id="change">map(</a>pad_dim_right, (log_snr<a id="change">, log_snr_next</a>)<a id="change">)</a>

        alpha, sigma = log_snr_to_alpha_sigma(log_snr)
        alpha_next, sigma_next = log_snr_to_alpha_sigma(log_snr_next)
</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/lucidrains/imagen-pytorch/commit/42a8152aef33f27df7fb33d910139d702a814206#diff-edef3c5fe92797a22c0b8fc6cca1d57b4b84ef03dfdfe802ed9147e21fc88109L305' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 55188556</div><div id='project'> Project Name: lucidrains/imagen-pytorch</div><div id='commit'> Commit Name: 42a8152aef33f27df7fb33d910139d702a814206</div><div id='time'> Time: 2022-05-28</div><div id='author'> Author: lucidrains@gmail.com</div><div id='file'> File Name: imagen_pytorch/imagen_pytorch.py</div><div id='m_class'> M Class Name: GaussianDiffusionContinuousTimes</div><div id='n_method'> N Class Name: GaussianDiffusionContinuousTimes</div><div id='m_method'> M Method Name: q_posterior(5)</div><div id='n_method'> N Method Name: q_posterior(4)</div><div id='m_parent_class'> M Parent Class: GaussianDiffusion</div><div id='n_parent_class'> N Parent Class: GaussianDiffusion</div><div id='m_file'> M File Name: imagen_pytorch/imagen_pytorch.py</div><div id='n_file'> N File Name: imagen_pytorch/imagen_pytorch.py</div><div id='m_start'> M Start Line: 306</div><div id='m_end'> M End Line: 306</div><div id='n_start'> N Start Line: 306</div><div id='n_end'> N End Line: 321</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        coarse_token_ids,
        fine_token_ids
    ):
        <a id="change">raise </a>NotImplemented

&#47&#47 audio LM
</code></pre><h3>After Change</h3><pre><code class='java'>
        coarse_token_ids,
        fine_token_ids
    ):
        coarse_token_ids<a id="change">, fine_token_ids = </a><a id="change">map(</a>lambda t: rearrange(t, &quotb ... -&gt; b (...)&quot), (coarse_token_ids<a id="change">, fine_token_ids</a>)<a id="change">)</a>

        b, n = coarse_token_ids.shape

        coarse_tokens = self.coarse_embedding(coarse_token_ids)</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/lucidrains/audiolm-pytorch/commit/9c6785b8998ef733d751bf99a47b8daa39795fda#diff-96a5ee045c1df07f3125d9b4189130620f229785b36cebb86c95b0646f0d744dL575' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 55188562</div><div id='project'> Project Name: lucidrains/audiolm-pytorch</div><div id='commit'> Commit Name: 9c6785b8998ef733d751bf99a47b8daa39795fda</div><div id='time'> Time: 2022-11-03</div><div id='author'> Author: lucidrains@gmail.com</div><div id='file'> File Name: audiolm_pytorch/audiolm_pytorch.py</div><div id='m_class'> M Class Name: FineTransformer</div><div id='n_method'> N Class Name: FineTransformer</div><div id='m_method'> M Method Name: forward(3)</div><div id='n_method'> N Method Name: forward(3)</div><div id='m_parent_class'> M Parent Class: nn.Module</div><div id='n_parent_class'> N Parent Class: nn.Module</div><div id='m_file'> M File Name: audiolm_pytorch/audiolm_pytorch.py</div><div id='n_file'> N File Name: audiolm_pytorch/audiolm_pytorch.py</div><div id='m_start'> M Start Line: 580</div><div id='m_end'> M End Line: 580</div><div id='n_start'> N Start Line: 599</div><div id='n_end'> N End Line: 617</div><BR>