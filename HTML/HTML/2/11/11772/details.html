<html><h3>Pattern ID :11772
</h3><img src='39611085.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>

    def get_train_examples(self, data_dir):
        See base class.
        lines<a id="change"> = </a>self._read_tsv(os.path.join(data_dir, "train.tsv"))
        <a id="change">examples</a><a id="change"> = </a><a id="change">[]</a>
        <a id="change">for </a>(i, <a id="change">line</a>) in enumerate(lines)<a id="change">:
            </a>if i == 0:
                continue
            input = line[0]
            guid<a id="change"> = </a>"%s-%s" % (input, "train")
            text_a = input.split("&lt;sep&gt;")[0]
            text_b = input.split("&lt;sep&gt;")[1]
            if len(text_a) &lt; 5 or len(text_b) &lt; 5:
                continue
            label = line[1]
            if label not in self.labels:
                continue

            assert isinstance(text_a, str), f"Training input {text_a} is not a string"
            assert isinstance(text_b, str), f"Training input {text_b} is not a string"
            assert isinstance(label, str), f"Training label {label} is not a string"
            example<a id="change"> = </a>InputExample(guid=guid, text_a=text_a, text_b=text_b, label=label)
            if i &lt; 10:
                print(example)
            <a id="change">examples.append(</a>example<a id="change">)</a>
        <a id="change">return examples</a>

    def get_test_examples(self, data_dir):
        See base class.
        lines = self._read_tsv(os.path.join(data_dir, "dev.tsv")) &#47&#47&#47&#47 TODO: update this to "test.tsv"</code></pre><h3>After Change</h3><pre><code class='java'>
        return examples

    def get_train_examples(self, data_dir):
        <a id="change">return </a>self.read_examples(data_dir, "train.tsv")

    def get_test_examples(self, data_dir):
        return self.read_examples(data_dir, "test.tsv")</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 9</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/persiannlp/parsinlu/commit/7f61dfd077587ac8344e8683d1e0e4ef0b94f8ef#diff-b54d2dd7878ddc4516dec262cc48c4242b248dc86cb708916302c2dcf198cb8eL15' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 39611085</div><div id='project'> Project Name: persiannlp/parsinlu</div><div id='commit'> Commit Name: 7f61dfd077587ac8344e8683d1e0e4ef0b94f8ef</div><div id='time'> Time: 2020-11-25</div><div id='author'> Author: danielk@allenai.org</div><div id='file'> File Name: src/processors/entailment.py</div><div id='m_class'> M Class Name: TEProcessor</div><div id='n_method'> N Class Name: TEProcessor</div><div id='m_method'> M Method Name: get_train_examples(2)</div><div id='n_method'> N Method Name: get_train_examples(2)</div><div id='m_parent_class'> M Parent Class: DataProcessor</div><div id='n_parent_class'> N Parent Class: DataProcessor</div><div id='m_file'> M File Name: src/processors/entailment.py</div><div id='n_file'> N File Name: src/processors/entailment.py</div><div id='m_start'> M Start Line: 15</div><div id='m_end'> M End Line: 37</div><div id='n_start'> N Start Line: 40</div><div id='n_end'> N End Line: 40</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>

    def get_test_examples(self, data_dir):
        See base class.
        lines<a id="change"> = </a>self._read_tsv(os.path.join(data_dir, "dev.tsv")) &#47&#47&#47&#47 TODO: update this to "test.tsv"
        <a id="change">examples</a><a id="change"> = </a><a id="change">[]</a>
        <a id="change">for </a>(i, <a id="change">line</a>) in enumerate(lines)<a id="change">:
            </a>if i == 0:
                continue
            input = line[0]
            guid<a id="change"> = </a>"%s-%s" % (input, "train")
            text_a = input.split("&lt;sep&gt;")[0]
            text_b = input.split("&lt;sep&gt;")[1]
            if len(text_a) &lt; 5 or len(text_b) &lt; 5:
                continue
            label = line[1]
            if label not in self.labels:
                continue
            assert isinstance(text_a, str), f"Training input {text_a} is not a string"
            assert isinstance(text_b, str), f"Training input {text_b} is not a string"
            assert isinstance(label, str), f"Training label {label} is not a string"
            example<a id="change"> = </a>InputExample(guid=guid, text_a=text_a, text_b=text_b, label=label)
            if i &lt; 10:
                print(example)
            <a id="change">examples.append(</a>example<a id="change">)</a>
        <a id="change">return </a>examples

    def get_labels(self):
        See base class.</code></pre><h3>After Change</h3><pre><code class='java'>
        return self.read_examples(data_dir, "train.tsv")

    def get_test_examples(self, data_dir):
        <a id="change">return </a>self.read_examples(data_dir, "test.tsv")

    def get_dev_examples(self, data_dir):
        return self.read_examples(data_dir, "dev.tsv")</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/persiannlp/parsinlu/commit/7f61dfd077587ac8344e8683d1e0e4ef0b94f8ef#diff-b54d2dd7878ddc4516dec262cc48c4242b248dc86cb708916302c2dcf198cb8eL39' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 39611117</div><div id='project'> Project Name: persiannlp/parsinlu</div><div id='commit'> Commit Name: 7f61dfd077587ac8344e8683d1e0e4ef0b94f8ef</div><div id='time'> Time: 2020-11-25</div><div id='author'> Author: danielk@allenai.org</div><div id='file'> File Name: src/processors/entailment.py</div><div id='m_class'> M Class Name: TEProcessor</div><div id='n_method'> N Class Name: TEProcessor</div><div id='m_method'> M Method Name: get_test_examples(2)</div><div id='n_method'> N Method Name: get_test_examples(2)</div><div id='m_parent_class'> M Parent Class: DataProcessor</div><div id='n_parent_class'> N Parent Class: DataProcessor</div><div id='m_file'> M File Name: src/processors/entailment.py</div><div id='n_file'> N File Name: src/processors/entailment.py</div><div id='m_start'> M Start Line: 41</div><div id='m_end'> M End Line: 62</div><div id='n_start'> N Start Line: 43</div><div id='n_end'> N End Line: 43</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        tasks = self._get_tasks()

        &#47&#47 group by first part of doc ID to get sections of multi part docs
        by_doc_id<a id="change"> = </a>sort_then_group(tasks, key_func=lambda x: x["data"]["id"].split("_")[0])
        <a id="change">docs</a><a id="change"> = </a><a id="change">[]</a>
        <a id="change">for </a>doc_id, <a id="change">tasks_iter</a> in by_doc_id<a id="change">:
            </a>doc<a id="change"> = </a>Document(idx=doc_id)
            by_section<a id="change"> = </a>sort_then_group(
                tasks_iter, key_func=lambda x: tuple(x["data"]["id"].split("_")[1:])
            )
            for (section_name, section_part_id), section_tasks_iter in by_section:
                for section_task in section_tasks_iter:
                    text = section_task["data"]["text"]
                    section = Section(text=text, name=f"{section_name}_{section_part_id}")
                    section.metadata["gold_entities"] = []
                    (
                        id_to_charspan,
                        id_to_labels,
                        id_to_tax,
                        non_contig,
                        contig_ents,
                    ) = self._populate_task_id_lookups(section_task)

                    self._resolve_non_contigs(
                        id_to_charspan, id_to_labels, id_to_tax, non_contig, section, text
                    )

                    self._resolve_contigs(
                        id_to_charspan, id_to_labels, id_to_tax, contig_ents, section, text
                    )
                    doc.sections.append(section)
            <a id="change">docs.append(</a>doc<a id="change">)</a>

        <a id="change">return </a>docs

    def _resolve_contigs(self, id_to_charspan, id_to_labels, id_to_tax, contig_ents, section, text):
        for span_idx, (start, end) in id_to_charspan.items():</code></pre><h3>After Change</h3><pre><code class='java'>

    def get_docs(self):
        tasks = self.get_all_tasks()
        <a id="change">return </a>self.ls_json_to_doc(tasks)

    @staticmethod
    def _resolve_contigs(</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/astrazeneca/kazu/commit/a0400edd69546deb6f0e2899a30b4e854a9a8d0d#diff-01fce6e72ff30d060715fa8c8a05f6e95a0222669fb503988ae3ddc87e380481L167' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 39611093</div><div id='project'> Project Name: astrazeneca/kazu</div><div id='commit'> Commit Name: a0400edd69546deb6f0e2899a30b4e854a9a8d0d</div><div id='time'> Time: 2022-11-30</div><div id='author'> Author: richard.jackson4@astrazeneca.com</div><div id='file'> File Name: kazu/modelling/annotation/label_studio.py</div><div id='m_class'> M Class Name: LabelStudioJsonToKazuDocumentEncoder</div><div id='n_method'> N Class Name: LabelStudioJsonToKazuDocumentEncoder</div><div id='m_method'> M Method Name: get_docs(1)</div><div id='n_method'> N Method Name: get_docs(1)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: kazu/modelling/annotation/label_studio.py</div><div id='n_file'> N File Name: kazu/modelling/annotation/label_studio.py</div><div id='m_start'> M Start Line: 168</div><div id='m_end'> M End Line: 201</div><div id='n_start'> N Start Line: 222</div><div id='n_end'> N End Line: 223</div><BR>