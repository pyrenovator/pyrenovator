<html><h3>Pattern ID :13316
</h3><img src='45088604.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>

    &#47&#47 Detect single-slot trials and skip distributed launch
    if single_slot:
        <a id="change">return </a><a id="change">subprocess.Popen(script).wait()</a>

    os.environ["USE_TORCH_DISTRIBUTED"] = "True"

    chief_ip = info.container_addrs[0]</code></pre><h3>After Change</h3><pre><code class='java'>

    &#47&#47 Detect single-slot trials and skip distributed launch
    if single_slot:
        <a id="change">p</a><a id="change"> = </a><a id="change">subprocess.Popen(</a>script<a id="change">)</a>
        <a id="change">with det.util.forward_signals(p</a><a id="change">):
            return p.wait()</a>

    os.environ["USE_TORCH_DISTRIBUTED"] = "True"

    chief_ip = info.container_addrs[0]</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 10</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/determined-ai/determined/commit/118a850da8f266651c46cb932a06e5a683cbddbd#diff-08a2ceada358eb51fac93137138c543f8a8bbace97e087c9b1e6d98279a6a94eL82' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 45088604</div><div id='project'> Project Name: determined-ai/determined</div><div id='commit'> Commit Name: 118a850da8f266651c46cb932a06e5a683cbddbd</div><div id='time'> Time: 2022-06-09</div><div id='author'> Author: rb@hpe.com</div><div id='file'> File Name: harness/determined/launch/torch_distributed.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: main(2)</div><div id='n_method'> N Method Name: main(2)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: harness/determined/launch/torch_distributed.py</div><div id='n_file'> N File Name: harness/determined/launch/torch_distributed.py</div><div id='m_start'> M Start Line: 82</div><div id='m_end'> M End Line: 108</div><div id='n_start'> N Start Line: 82</div><div id='n_end'> N End Line: 114</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>

    logging.info(f"Launching: {entrypoint}")

    <a id="change">return </a><a id="change">subprocess.Popen(entrypoint).wait()</a>


def mask_config_dict(d: Dict) -&gt; Dict:
    mask = "********"</code></pre><h3>After Change</h3><pre><code class='java'>

    logging.info(f"Launching: {entrypoint}")

    <a id="change">p</a><a id="change"> = </a><a id="change">subprocess.Popen(</a>entrypoint<a id="change">)</a>
    <a id="change">with det.util.forward_signals(</a><a id="change">p):
        return p.wait()</a>


def mask_config_dict(d: Dict) -&gt; Dict:
    mask = "********"</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/determined-ai/determined/commit/118a850da8f266651c46cb932a06e5a683cbddbd#diff-e15b139cc03598c5134fe02bbc40586a5768580d8709211544373d79fdddf03bL29' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 45088603</div><div id='project'> Project Name: determined-ai/determined</div><div id='commit'> Commit Name: 118a850da8f266651c46cb932a06e5a683cbddbd</div><div id='time'> Time: 2022-06-09</div><div id='author'> Author: rb@hpe.com</div><div id='file'> File Name: harness/determined/exec/launch.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: launch(1)</div><div id='n_method'> N Method Name: launch(1)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: harness/determined/exec/launch.py</div><div id='n_file'> N File Name: harness/determined/exec/launch.py</div><div id='m_start'> M Start Line: 30</div><div id='m_end'> M End Line: 52</div><div id='n_start'> N Start Line: 30</div><div id='n_end'> N End Line: 56</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>

    logging.debug(f"Torch distributed launching with: {launch_cmd}")

    <a id="change">return </a><a id="change">subprocess.Popen(launch_cmd).wait()</a>


def parse_args(args: List[str]) -&gt; Tuple[List[str], List[str]]:
    if "--" in args:</code></pre><h3>After Change</h3><pre><code class='java'>

    logging.debug(f"Torch distributed launching with: {launch_cmd}")

    <a id="change">p</a><a id="change"> = </a><a id="change">subprocess.Popen(</a>launch_cmd<a id="change">)</a>
    <a id="change">with det.util.forward_signals(</a><a id="change">p):
        return p.wait()</a>


def parse_args(args: List[str]) -&gt; Tuple[List[str], List[str]]:
    if "--" in args:</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/determined-ai/determined/commit/118a850da8f266651c46cb932a06e5a683cbddbd#diff-08a2ceada358eb51fac93137138c543f8a8bbace97e087c9b1e6d98279a6a94eL72' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 45088602</div><div id='project'> Project Name: determined-ai/determined</div><div id='commit'> Commit Name: 118a850da8f266651c46cb932a06e5a683cbddbd</div><div id='time'> Time: 2022-06-09</div><div id='author'> Author: rb@hpe.com</div><div id='file'> File Name: harness/determined/launch/torch_distributed.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: main(2)</div><div id='n_method'> N Method Name: main(2)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: harness/determined/launch/torch_distributed.py</div><div id='n_file'> N File Name: harness/determined/launch/torch_distributed.py</div><div id='m_start'> M Start Line: 82</div><div id='m_end'> M End Line: 108</div><div id='n_start'> N Start Line: 82</div><div id='n_end'> N End Line: 114</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
            f"Non-chief [{info.container_rank}] training process launch "
            f"command: {run_sshd_command}."
        )
        <a id="change">return </a><a id="change">subprocess.Popen(pid_server_cmd + run_sshd_command).wait()</a>

    &#47&#47 Chief machine waits for every worker&quots sshd to be available.  All machines should be pretty
    &#47&#47 close to in-step by now because all machines just finished synchronizing rendezvous info.
    deadline = time.time() + 20</code></pre><h3>After Change</h3><pre><code class='java'>
            f"Non-chief [{info.container_rank}] training process launch "
            f"command: {run_sshd_command}."
        )
        <a id="change">p</a><a id="change"> = </a><a id="change">subprocess.Popen(</a>pid_server_cmd + run_sshd_command<a id="change">)</a>
        <a id="change">with det.util.forward_signals(</a><a id="change">p):
            return p.wait()</a>

    &#47&#47 Chief machine waits for every worker&quots sshd to be available.  All machines should be pretty
    &#47&#47 close to in-step by now because all machines just finished synchronizing rendezvous info.
    deadline = time.time() + 20</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/determined-ai/determined/commit/118a850da8f266651c46cb932a06e5a683cbddbd#diff-978ff4c00eaffd69970db62bbf04420e85a9dcaaaa93208c8ed05e51dfd5d873L87' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 45088601</div><div id='project'> Project Name: determined-ai/determined</div><div id='commit'> Commit Name: 118a850da8f266651c46cb932a06e5a683cbddbd</div><div id='time'> Time: 2022-06-09</div><div id='author'> Author: rb@hpe.com</div><div id='file'> File Name: harness/determined/launch/horovod.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: main(3)</div><div id='n_method'> N Method Name: main(3)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: harness/determined/launch/horovod.py</div><div id='n_file'> N File Name: harness/determined/launch/horovod.py</div><div id='m_start'> M Start Line: 96</div><div id='m_end'> M End Line: 178</div><div id='n_start'> N Start Line: 96</div><div id='n_end'> N End Line: 186</div><BR>