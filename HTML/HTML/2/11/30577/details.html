<html><h3>Pattern ID :30577
</h3><img src='90394979.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
            1 + bf.sum(-1), dim1=-1, dim2=-2)

        &#47&#47 eye 3x3 in 1x3x3x1x1
        I33 = <a id="change">torch.eye(3, 3).view(</a>1, <a id="change">1</a>, 3, <a id="change">3</a>, <a id="change">1</a>, <a id="change">1</a><a id="change">)</a>

        &#47&#47 compute the delta_ab * delta_ij * (1 + sum k \neq i eta(rik))
        &#47&#47 Nbatch x Ndim x Ndim x Nelec x Nelec (diagonal matrix)
        delta_ab_delta_ij_bf = I33 * \</code></pre><h3>After Change</h3><pre><code class='java'>
            1 + bf.sum(-1), dim1=-1, dim2=-2)

        &#47&#47 eye 3x3 in 1x3x3x1x1
        eye_mat = <a id="change">torch.eye(3, 3).view(
            1, 1, 3, 3, 1, 1).to(</a>self.device<a id="change">)</a>

        &#47&#47 compute the delta_ab * delta_ij * (1 + sum k \neq i eta(rik))
        &#47&#47 Nbatch x Ndim x Ndim x Nelec x Nelec (diagonal matrix)
        delta_ab_delta_ij_bf = eye_mat * \</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 5</div><BR><div id='size'>Non-data size: 3</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/nlesc-jcer/qmctorch/commit/0985081a58533ad868a6a87e6efce599f95d4142#diff-3c869ed78ad82b3c85f9fd23e57d7c79a2497deb4666c28c7e5e9f16d179b5a5L128' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 90394979</div><div id='project'> Project Name: nlesc-jcer/qmctorch</div><div id='commit'> Commit Name: 0985081a58533ad868a6a87e6efce599f95d4142</div><div id='time'> Time: 2021-05-18</div><div id='author'> Author: nicolas.gm.renaud@gmail.com</div><div id='file'> File Name: qmctorch/wavefunction/orbitals/backflow/orbital_dependent_backflow_transformation.py</div><div id='m_class'> M Class Name: OrbitalDependentBackFlowTransformation</div><div id='n_method'> N Class Name: OrbitalDependentBackFlowTransformation</div><div id='m_method'> M Method Name: _backflow_derivative(2)</div><div id='n_method'> N Method Name: _backflow_derivative(2)</div><div id='m_parent_class'> M Parent Class: nn.Module</div><div id='n_parent_class'> N Parent Class: nn.Module</div><div id='m_file'> M File Name: qmctorch/wavefunction/orbitals/backflow/orbital_dependent_backflow_transformation.py</div><div id='n_file'> N File Name: qmctorch/wavefunction/orbitals/backflow/orbital_dependent_backflow_transformation.py</div><div id='m_start'> M Start Line: 128</div><div id='m_end'> M End Line: 128</div><div id='n_start'> N Start Line: 133</div><div id='n_end'> N End Line: 134</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        if &quotdenormalize&quot in self.test_cfg:
            mean = torch.tensor(self.test_cfg[&quotdenormalize&quot][&quotmean&quot]).view(
                1, -1, 1, 1)
            std = <a id="change">torch.tensor(self.test_cfg[&quotdenormalize&quot][&quotstd&quot]).view(
                1</a>, <a id="change">-1</a>, <a id="change">1</a>, <a id="change">1</a><a id="change">)</a>
            lq = lq * std + mean
            if gt.dim() == 3:
                mean = torch.tensor(self.test_cfg[&quotdenormalize&quot][&quotmean&quot]).view(
                    -1, 1, 1)</code></pre><h3>After Change</h3><pre><code class='java'>
            device = output.device
            mean = torch.tensor(self.test_cfg[&quotdenormalize&quot][&quotmean&quot]).view(
                1, -1, 1, 1).to(device)
            std = <a id="change">torch.tensor(self.test_cfg[&quotdenormalize&quot][&quotstd&quot]).view(
                1, -1, 1, 1).to(</a>device<a id="change">)</a>
            lq = lq * std + mean
            if gt.dim() == 3:
                mean = torch.tensor(self.test_cfg[&quotdenormalize&quot][&quotmean&quot]).view(
                    -1, 1, 1).to(device)</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/ryanxingql/powerqe/commit/2aab2aaabc9493b7499c0270af1947e1c6fbbe85#diff-ada4b421458195b5f5f0c1a6131ec626f2b0f585841da85cf187cad3f0a5bb61L336' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 90394993</div><div id='project'> Project Name: ryanxingql/powerqe</div><div id='commit'> Commit Name: 2aab2aaabc9493b7499c0270af1947e1c6fbbe85</div><div id='time'> Time: 2023-05-25</div><div id='author'> Author: ryanxingql@gmail.com</div><div id='file'> File Name: powerqe/models/restorers/basic_restorer.py</div><div id='m_class'> M Class Name: BasicVQERestorer</div><div id='n_method'> N Class Name: BasicVQERestorer</div><div id='m_method'> M Method Name: forward_test(7)</div><div id='n_method'> N Method Name: forward_test(7)</div><div id='m_parent_class'> M Parent Class: BasicRestorer</div><div id='n_parent_class'> N Parent Class: BasicRestorer</div><div id='m_file'> M File Name: powerqe/models/restorers/basic_restorer.py</div><div id='n_file'> N File Name: powerqe/models/restorers/basic_restorer.py</div><div id='m_start'> M Start Line: 395</div><div id='m_end'> M End Line: 404</div><div id='n_start'> N Start Line: 392</div><div id='n_end'> N End Line: 406</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>

    
    if not isinstance(rnd_scale, torch.Tensor):
        rnd_scale = <a id="change">torch.Tensor([rnd_scale]).view(1</a>, <a id="change">1</a>, <a id="change">1</a>, <a id="change">1</a><a id="change">)</a>
        rnd_scale = rnd_scale.expand([output_size[0] * output_size[1], 1, 1, 1])
    else:
        rnd_scale = rnd_scale.view(-1, 1, 1, 1)
        rnd_scale = rnd_scale.expand([output_size[0],  output_size[1], 1, 1])</code></pre><h3>After Change</h3><pre><code class='java'>

    
    if not isinstance(rnd_scale, torch.Tensor):
        rnd_scale = <a id="change">torch.Tensor([rnd_scale]).view(1, 1, 1, 1).to(</a>device<a id="change">)</a>
        rnd_scale = rnd_scale.expand([output_size[0] * output_size[1], 1, 1, 1])
    else:
        rnd_scale = rnd_scale.view(-1, 1, 1, 1)
        rnd_scale = rnd_scale.expand([output_size[0],  output_size[1], 1, 1])</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/anguelos/tormentor/commit/553c2e031b46a5fb0d8597cce7394ae810ba4959#diff-96399bb13b72d842017164514f95a9651fed6845bd454d131043b17860c93188L135' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 90394918</div><div id='project'> Project Name: anguelos/tormentor</div><div id='commit'> Commit Name: 553c2e031b46a5fb0d8597cce7394ae810ba4959</div><div id='time'> Time: 2020-06-15</div><div id='author'> Author: anguelos.nicolaou@gmail.com</div><div id='file'> File Name: diamond_square/diamond_square.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: functional_diamond_square(6)</div><div id='n_method'> N Method Name: functional_diamond_square(6)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: diamond_square/diamond_square.py</div><div id='n_file'> N File Name: diamond_square/diamond_square.py</div><div id='m_start'> M Start Line: 155</div><div id='m_end'> M End Line: 155</div><div id='n_start'> N Start Line: 155</div><div id='n_end'> N End Line: 155</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
            1 + bf.sum(-1), dim1=-1, dim2=-2)

        &#47&#47 eye 3x3 in 1x3x3x1x1
        I33 = <a id="change">torch.eye(3, 3).view(</a>1, <a id="change">3</a>, <a id="change">3</a>, <a id="change">1</a>, <a id="change">1</a><a id="change">)</a>

        &#47&#47 compute the delta_ab * delta_ij * (1 + sum k \neq i eta(rik))
        &#47&#47 Nbatch x Ndim x Ndim x Nelec x Nelec (diagonal matrix)
        delta_ab_delta_ij_bf = I33 * \</code></pre><h3>After Change</h3><pre><code class='java'>
            1 + bf.sum(-1), dim1=-1, dim2=-2)

        &#47&#47 eye 3x3 in 1x3x3x1x1
        I33 = <a id="change">torch.eye(3, 3).view(1, 3, 3, 1, 1).to(</a>self.device<a id="change">)</a>

        &#47&#47 compute the delta_ab * delta_ij * (1 + sum k \neq i eta(rik))
        &#47&#47 Nbatch x Ndim x Ndim x Nelec x Nelec (diagonal matrix)
        delta_ab_delta_ij_bf = I33 * \</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/nlesc-jcer/qmctorch/commit/c3e5a537f995cf273fe966fdb6d927fe31835290#diff-a67b471a131ba99bd4fa47da0605ed8a1dff02cd7839c420e1aea0d952e7a5bdL66' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 90394985</div><div id='project'> Project Name: nlesc-jcer/qmctorch</div><div id='commit'> Commit Name: c3e5a537f995cf273fe966fdb6d927fe31835290</div><div id='time'> Time: 2021-05-17</div><div id='author'> Author: nicolas.gm.renaud@gmail.com</div><div id='file'> File Name: qmctorch/wavefunction/orbitals/backflow/backflow_transformation.py</div><div id='m_class'> M Class Name: BackFlowTransformation</div><div id='n_method'> N Class Name: BackFlowTransformation</div><div id='m_method'> M Method Name: _backflow_derivative(2)</div><div id='n_method'> N Method Name: _backflow_derivative(2)</div><div id='m_parent_class'> M Parent Class: nn.Module</div><div id='n_parent_class'> N Parent Class: nn.Module</div><div id='m_file'> M File Name: qmctorch/wavefunction/orbitals/backflow/backflow_transformation.py</div><div id='n_file'> N File Name: qmctorch/wavefunction/orbitals/backflow/backflow_transformation.py</div><div id='m_start'> M Start Line: 118</div><div id='m_end'> M End Line: 118</div><div id='n_start'> N Start Line: 123</div><div id='n_end'> N End Line: 123</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>

        &#47&#47 denormalize before image saving and evaluation
        if &quotdenormalize&quot in self.test_cfg:
            mean = <a id="change">torch.tensor(self.test_cfg[&quotdenormalize&quot][&quotmean&quot]).view(
                1</a>, <a id="change">-1</a>, <a id="change">1</a>, <a id="change">1</a><a id="change">)</a>
            std = torch.tensor(self.test_cfg[&quotdenormalize&quot][&quotstd&quot]).view(
                1, -1, 1, 1)
            output = output * std + mean
            lq = lq * std + mean</code></pre><h3>After Change</h3><pre><code class='java'>
        &#47&#47 denormalize before image saving and evaluation
        if &quotdenormalize&quot in self.test_cfg:
            device = output.device
            mean = <a id="change">torch.tensor(self.test_cfg[&quotdenormalize&quot][&quotmean&quot]).view(
                1, -1, 1, 1).to(</a>device<a id="change">)</a>
            std = torch.tensor(self.test_cfg[&quotdenormalize&quot][&quotstd&quot]).view(
                1, -1, 1, 1).to(device)
            output = output * std + mean
            lq = lq * std + mean</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/ryanxingql/powerqe/commit/2aab2aaabc9493b7499c0270af1947e1c6fbbe85#diff-ada4b421458195b5f5f0c1a6131ec626f2b0f585841da85cf187cad3f0a5bb61L81' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 90394895</div><div id='project'> Project Name: ryanxingql/powerqe</div><div id='commit'> Commit Name: 2aab2aaabc9493b7499c0270af1947e1c6fbbe85</div><div id='time'> Time: 2023-05-25</div><div id='author'> Author: ryanxingql@gmail.com</div><div id='file'> File Name: powerqe/models/restorers/basic_restorer.py</div><div id='m_class'> M Class Name: BasicQERestorer</div><div id='n_method'> N Class Name: BasicQERestorer</div><div id='m_method'> M Method Name: forward_test(7)</div><div id='n_method'> N Method Name: forward_test(7)</div><div id='m_parent_class'> M Parent Class: BasicRestorer</div><div id='n_parent_class'> N Parent Class: BasicRestorer</div><div id='m_file'> M File Name: powerqe/models/restorers/basic_restorer.py</div><div id='n_file'> N File Name: powerqe/models/restorers/basic_restorer.py</div><div id='m_start'> M Start Line: 155</div><div id='m_end'> M End Line: 158</div><div id='n_start'> N Start Line: 155</div><div id='n_end'> N End Line: 159</div><BR>