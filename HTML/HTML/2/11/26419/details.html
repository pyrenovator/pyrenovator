<html><h3>Pattern ID :26419
</h3><img src='79250873.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
    print(f"Sharded dataset length: {dataset.num_rows}")
    fdataset = dataset.map(featurize, batched=True, batch_size=42, num_proc=1)

    <a id="change">print(&quotdone&quot</a><a id="change">)</a>

if __name__ == &quot__main__&quot:
    main()</code></pre><h3>After Change</h3><pre><code class='java'>

def main():
    &#47&#47 parse args
    <a id="change">parser</a> = <a id="change">argparse.ArgumentParser()</a>
    <a id="change">parser.add_argument("--checkpoint"</a><a id="change">, default= "facebook/opt-350m", 
                        help="Name of HF checkpoint to use as featurizer", 
                        type=str)</a>
    parser.add_argument("--max_length", default=512,
                        help="Max length of input sequence to process.",
                        type=int)
    parser.add_argument("--savedir", default="/home/dedey/smraiz/input/",
                        help="Save directory for storing features",
                        type=str)
    <a id="change">parser.add_argument("--num-shards"</a><a id="change">, default=2100,
                        help="Number of shards to create. WARNING: Don&quott change across runs on the same dataset.",
                        type=int)</a>
    parser.add_argument("--shard-index", default=0,
                        help="Particular shard to process. Must be less than num_shards",
                        type=int)
    parser.add_argument("--batch-size", default=42,
                        help="Batch size for feature extraction.",
                        type=int)
    parser.add_argument("--gpuid", default=0,
                        help="GPU id to use. -1 will use cpu.",
                        type=int)
    args<a id="change"> = parser</a><a id="change">.parse_args()</a>

    &#47&#47 set device
    <a id="change">if </a>torch.cuda.is_available() and args.gpuid &gt;= 0:
        device = f"cuda:{args.gpuid}"
    else:
        device = "cpu"</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 7</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/microsoft/archai/commit/1f0a38e723b2db5c6bc6d461c0e1193ac22306bb#diff-b14430ca4603b5d26889ab14d1b19460688ad86c9c4d0aa195e6e89123d99150L17' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 79250873</div><div id='project'> Project Name: microsoft/archai</div><div id='commit'> Commit Name: 1f0a38e723b2db5c6bc6d461c0e1193ac22306bb</div><div id='time'> Time: 2022-12-16</div><div id='author'> Author: dedey@microsoft.com</div><div id='file'> File Name: scripts/misc/hf_featurize.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: main(0)</div><div id='n_method'> N Method Name: main(0)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: scripts/misc/hf_featurize.py</div><div id='n_file'> N File Name: scripts/misc/hf_featurize.py</div><div id='m_start'> M Start Line: 17</div><div id='m_end'> M End Line: 56</div><div id='n_start'> N Start Line: 18</div><div id='n_end'> N End Line: 87</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
            step=-1, observation=obs, deterministic=False, env=env
        )
        transition = env.step(act_result)
        <a id="change">print(
            f"action={act_result.action}, reward={transition.reward}, "
            f"terminal={transition.terminal}"</a><a id="change">,
        )</a>
        if transition.terminal:
            obs = env.reset()
        else:
            obs = transition.observation</code></pre><h3>After Change</h3><pre><code class='java'>


def main():
    <a id="change">parser</a> = <a id="change">argparse.ArgumentParser(
        formatter_class=argparse.ArgumentDefaultsHelpFormatter,
    )</a>
    <a id="change">parser.add_argument("--nogui"</a><a id="change">, action="store_true", help="no gui")</a>
    <a id="change">parser.add_argument("--print-obs"</a><a id="change">, action="store_true", help="print obs")</a>
    args<a id="change"> = </a><a id="change">parser.parse_args()</a>

    env = PickFromPileEnv(gui=not args.nogui, retime=10)
    t_start = time.time()
    obs = env.reset()
    logger.info(f"{time.time() - t_start:.2f} [s]")
    <a id="change">if </a>args.print_obs:
        pprint.pprint(obs)

    agent = DqnAgent(env=env)</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/wkentaro/reorientbot/commit/7288c4ac7c6f55faa88907d8dad3fd9ef6ff8370#diff-6299cb1ac345e82c13bd71910b55cf515d01b5ffb544262be2a8000c840304a7L9' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 79250872</div><div id='project'> Project Name: wkentaro/reorientbot</div><div id='commit'> Commit Name: 7288c4ac7c6f55faa88907d8dad3fd9ef6ff8370</div><div id='time'> Time: 2021-04-27</div><div id='author'> Author: www.kentaro.wada@gmail.com</div><div id='file'> File Name: examples/target_pick/check_exploration.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: main(0)</div><div id='n_method'> N Method Name: main(0)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: examples/target_pick/check_exploration.py</div><div id='n_file'> N File Name: examples/target_pick/check_exploration.py</div><div id='m_start'> M Start Line: 12</div><div id='m_end'> M End Line: 27</div><div id='n_start'> N Start Line: 14</div><div id='n_end'> N End Line: 47</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
    print(f"Sharded dataset length: {dataset.num_rows}")
    fdataset = dataset.map(featurize, batched=True, batch_size=42, num_proc=1)

    <a id="change">print(&quotdone&quot</a><a id="change">)</a>

if __name__ == &quot__main__&quot:
    main()</code></pre><h3>After Change</h3><pre><code class='java'>

def main():
    &#47&#47 parse args
    <a id="change">parser</a> = <a id="change">argparse.ArgumentParser()</a>
    parser.add_argument("--checkpoint", default= "facebook/opt-350m", 
                        help="Name of HF checkpoint to use as featurizer", 
                        type=str)
    parser.add_argument("--max_length", default=512,
                        help="Max length of input sequence to process.",
                        type=int)
    parser.add_argument("--savedir", default="/home/dedey/smraiz/input/",
                        help="Save directory for storing features",
                        type=str)
    <a id="change">parser.add_argument("--num-shards"</a><a id="change">, default=2100,
                        help="Number of shards to create. WARNING: Don&quott change across runs on the same dataset.",
                        type=int)</a>
    <a id="change">parser.add_argument("--shard-index"</a><a id="change">, default=0,
                        help="Particular shard to process. Must be less than num_shards",
                        type=int)</a>
    parser.add_argument("--batch-size", default=42,
                        help="Batch size for feature extraction.",
                        type=int)
    parser.add_argument("--gpuid", default=0,
                        help="GPU id to use. -1 will use cpu.",
                        type=int)
    args<a id="change"> = </a><a id="change">parser.parse_args()</a>

    &#47&#47 set device
    <a id="change">if </a>torch.cuda.is_available() and args.gpuid &gt;= 0:
        device = f"cuda:{args.gpuid}"
    else:
        device = "cpu"</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/microsoft/archai/commit/1f0a38e723b2db5c6bc6d461c0e1193ac22306bb#diff-b14430ca4603b5d26889ab14d1b19460688ad86c9c4d0aa195e6e89123d99150L15' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 79250875</div><div id='project'> Project Name: microsoft/archai</div><div id='commit'> Commit Name: 1f0a38e723b2db5c6bc6d461c0e1193ac22306bb</div><div id='time'> Time: 2022-12-16</div><div id='author'> Author: dedey@microsoft.com</div><div id='file'> File Name: scripts/misc/hf_featurize.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: main(0)</div><div id='n_method'> N Method Name: main(0)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: scripts/misc/hf_featurize.py</div><div id='n_file'> N File Name: scripts/misc/hf_featurize.py</div><div id='m_start'> M Start Line: 17</div><div id='m_end'> M End Line: 56</div><div id='n_start'> N Start Line: 18</div><div id='n_end'> N End Line: 87</div><BR>