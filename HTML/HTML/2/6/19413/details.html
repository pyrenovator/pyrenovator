<html><h3>Pattern ID :19413
</h3><img src='63348166.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
                total_time = fin-star
                print(colorama.Fore.CYAN + &quotDetection on image&quot + colorama.Fore.RESET, file_counter,&quotof&quot, len(img_list), &quotfinished in &quot + colorama.Fore.YELLOW + &quot{:.4f}&quot.format(total_time) + colorama.Fore.RESET + &quot seconds&quot)
                file_counter += 1
            <a id="change">print(</a>colorama<a id="change">.Fore.WHITE + "--------------------------------------------------------------------------" + </a>colorama.Fore.RESET<a id="change">)</a>

    &#47&#47 Unloads both models if possible, to allow hent-AI to remain open while DCP runs.
    def unload_model(self):
        del self.esrgan_instance</code></pre><h3>After Change</h3><pre><code class='java'>
                total_time = fin-star
                print(colorama.Fore.CYAN + &quotDetection on image&quot + colorama.Fore.RESET, file_counter,&quotof&quot, len(img_list), &quotfinished in &quot + colorama.Fore.YELLOW + &quot{:.4f}&quot.format(total_time) + colorama.Fore.RESET + &quot seconds&quot)
                file_counter += 1
            <a id="change">log("--------------------------------------------------------------------------"</a>, Ansi.GRAY<a id="change">)</a>

    &#47&#47 Unloads both models if possible, to allow hent-AI to remain open while DCP runs.
    def unload_model(self):
        del self.esrgan_instance</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 8</div><BR><div id='size'>Non-data size: 4</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/gusb3ll/tsuki/commit/9e8cddb75b22abff729c78b0a8f5ce67b0f34d83#diff-b0ccbbd0f2ff785529f7ce4370db7726b84ca7d6f420fbb8edf88af6002db718L538' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 63348166</div><div id='project'> Project Name: gusb3ll/tsuki</div><div id='commit'> Commit Name: 9e8cddb75b22abff729c78b0a8f5ce67b0f34d83</div><div id='time'> Time: 2022-02-20</div><div id='author'> Author: 77166960+Gusb3ll@users.noreply.github.com</div><div id='file'> File Name: Modules/HentAI/detector.py</div><div id='m_class'> M Class Name: Detector</div><div id='n_method'> N Class Name: Detector</div><div id='m_method'> M Method Name: run_on_folder(7)</div><div id='n_method'> N Method Name: run_on_folder(7)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: Modules/HentAI/detector.py</div><div id='n_file'> N File Name: Modules/HentAI/detector.py</div><div id='m_start'> M Start Line: 549</div><div id='m_end'> M End Line: 589</div><div id='n_start'> N Start Line: 538</div><div id='n_end'> N End Line: 578</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        try:
            self.esr_model_path = os.path.join(os.path.abspath(&quot.&quot), "4x_FatalPixels_340000_G.pth")
        except:
            <a id="change">print(</a>colorama<a id="change">.Fore.RED + "ERROR in Detector init: ESRGAN model not found, make sure you have 4x_FatalPixels_340000_G.pth in this directory" + </a>colorama.Fore.RESET<a id="change">)</a>
            return
        &#47&#47 Scan for cuda compatible GPU for ESRGAN. Mask-RCNN *should* automatically use a GPU if available.
        self.hardware = &quotcpu&quot
        if self.model.check_cuda_gpu()==True:</code></pre><h3>After Change</h3><pre><code class='java'>
        self.hardware = &quotcpu&quot
        if self.model.check_cuda_gpu()==True:
            &#47&#47 print("CUDA-compatible GPU located! ****DEBUG CPU MODE****")
            <a id="change">log("CUDA-compatible GPU located!"</a>, Ansi.GREEN<a id="change">)</a>
            self.hardware = &quotcuda&quot
        &#47&#47 destroy model. Will re init during weight load.
        self.model = []
</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/gusb3ll/tsuki/commit/9e8cddb75b22abff729c78b0a8f5ce67b0f34d83#diff-b0ccbbd0f2ff785529f7ce4370db7726b84ca7d6f420fbb8edf88af6002db718L53' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 63348167</div><div id='project'> Project Name: gusb3ll/tsuki</div><div id='commit'> Commit Name: 9e8cddb75b22abff729c78b0a8f5ce67b0f34d83</div><div id='time'> Time: 2022-02-20</div><div id='author'> Author: 77166960+Gusb3ll@users.noreply.github.com</div><div id='file'> File Name: Modules/HentAI/detector.py</div><div id='m_class'> M Class Name: Detector</div><div id='n_method'> N Class Name: Detector</div><div id='m_method'> M Method Name: __init__(2)</div><div id='n_method'> N Method Name: __init__(2)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: Modules/HentAI/detector.py</div><div id='n_file'> N File Name: Modules/HentAI/detector.py</div><div id='m_start'> M Start Line: 74</div><div id='m_end'> M End Line: 87</div><div id='n_start'> N Start Line: 70</div><div id='n_end'> N End Line: 82</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>

    &#47&#47 Announce completion, TODO: offer to run DCP from DCP directory
    detect_instance.unload_model()
    <a id="change">print(</a>colorama<a id="change">.Fore.GREEN + &quot----- Process complete, please close HentAI UI to continue -----&quot + </a>colorama.Fore.RESET<a id="change">)</a>
    popup = Tk()
    popup.title(&quotSuccess!&quot)
    label = Label(popup, text=&quotProcess executed successfully! Now you can run DeepCreamPy.&quot)
    label.pack(side=TOP, fill=X, pady=20, padx=10)</code></pre><h3>After Change</h3><pre><code class='java'>
          
    if(is_mosaic == True and is_video==False):
        &#47&#47 Copy input folder to decensor_input_original. NAMES MUST MATCH for DCP
        <a id="change">log(&quotCopying inputs into input_original dcp folder&quot</a>, Ansi.CYAN<a id="change">)</a>
        for fil in listdir(in_path):
            if fil.endswith(&quotjpg&quot) or fil.endswith(&quotpng&quot) or fil.endswith(&quotjpeg&quot) or fil.endswith(&quotJPG&quot) or fil.endswith(&quotPNG&quot) or fil.endswith(&quotJPEG&quot):
                try:
                    shutil.copy(in_path + &quot/&quot + fil, dcp_dir + &quot/decensor_input_original/&quot + fil) &#47&#47 DCP is compatible with original jpg input.</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/gusb3ll/tsuki/commit/9e8cddb75b22abff729c78b0a8f5ce67b0f34d83#diff-bb15e3687c27216f0c69c305988dc4268cf8c31b7c5c694666a15cc7bd7fab3bL97' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 63348164</div><div id='project'> Project Name: gusb3ll/tsuki</div><div id='commit'> Commit Name: 9e8cddb75b22abff729c78b0a8f5ce67b0f34d83</div><div id='time'> Time: 2022-02-20</div><div id='author'> Author: 77166960+Gusb3ll@users.noreply.github.com</div><div id='file'> File Name: Modules/HentAI/main.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: hentAI_detection(6)</div><div id='n_method'> N Method Name: hentAI_detection(6)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: Modules/HentAI/main.py</div><div id='n_file'> N File Name: Modules/HentAI/main.py</div><div id='m_start'> M Start Line: 117</div><div id='m_end'> M End Line: 157</div><div id='n_start'> N Start Line: 118</div><div id='n_end'> N End Line: 158</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
    def unload_model(self):
        del self.esrgan_instance
        self.model.unload_model()
        <a id="change">print(</a>colorama<a id="change">.Fore.GREEN + &quotModel unload successful!&quot + </a>colorama.Fore.RESET<a id="change">)</a>

&#47&#47 main only used for debugging here. Comment out pls
&quot&quot&quotif __name__ == &quot__main__&quot:
    import argparse</code></pre><h3>After Change</h3><pre><code class='java'>
    def unload_model(self):
        del self.esrgan_instance
        self.model.unload_model()
        <a id="change">log(&quotModel unload successful!&quot</a>, Ansi.GREEN<a id="change">)</a>

&#47&#47 main only used for debugging here. Comment out pls
&quot&quot&quotif __name__ == &quot__main__&quot:
    import argparse</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/gusb3ll/tsuki/commit/9e8cddb75b22abff729c78b0a8f5ce67b0f34d83#diff-b0ccbbd0f2ff785529f7ce4370db7726b84ca7d6f420fbb8edf88af6002db718L592' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 63348180</div><div id='project'> Project Name: gusb3ll/tsuki</div><div id='commit'> Commit Name: 9e8cddb75b22abff729c78b0a8f5ce67b0f34d83</div><div id='time'> Time: 2022-02-20</div><div id='author'> Author: 77166960+Gusb3ll@users.noreply.github.com</div><div id='file'> File Name: Modules/HentAI/detector.py</div><div id='m_class'> M Class Name: Detector</div><div id='n_method'> N Class Name: Detector</div><div id='m_method'> M Method Name: unload_model(1)</div><div id='n_method'> N Method Name: unload_model(1)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: Modules/HentAI/detector.py</div><div id='n_file'> N File Name: Modules/HentAI/detector.py</div><div id='m_start'> M Start Line: 595</div><div id='m_end'> M End Line: 595</div><div id='n_start'> N Start Line: 584</div><div id='n_end'> N End Line: 584</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        otext = hconfig[&quotUSER&quot][&quotsrcdir&quot]
        mtext = hconfig[&quotUSER&quot][&quotgmask&quot]
    else:
        <a id="change">print(</a>colorama<a id="change">.Fore.RED + "ERROR in get_cfg: Unable to read USER section" + </a>colorama.Fore.RESET<a id="change">)</a>
    
    dvar.set(dtext)
    ovar.set(otext)
    mvar.set(mtext)</code></pre><h3>After Change</h3><pre><code class='java'>
        otext = hconfig[&quotUSER&quot][&quotsrcdir&quot]
        mtext = hconfig[&quotUSER&quot][&quotgmask&quot]
    else:
        <a id="change">log("ERROR in get_cfg: Unable to read USER section"</a>, Ansi.RED<a id="change">)</a>
    
    dvar.set(dtext)
    ovar.set(otext)
    mvar.set(mtext)</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/gusb3ll/tsuki/commit/9e8cddb75b22abff729c78b0a8f5ce67b0f34d83#diff-bb15e3687c27216f0c69c305988dc4268cf8c31b7c5c694666a15cc7bd7fab3bL206' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 63348181</div><div id='project'> Project Name: gusb3ll/tsuki</div><div id='commit'> Commit Name: 9e8cddb75b22abff729c78b0a8f5ce67b0f34d83</div><div id='time'> Time: 2022-02-20</div><div id='author'> Author: 77166960+Gusb3ll@users.noreply.github.com</div><div id='file'> File Name: Modules/HentAI/main.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: get_cfg(0)</div><div id='n_method'> N Method Name: get_cfg(0)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: Modules/HentAI/main.py</div><div id='n_file'> N File Name: Modules/HentAI/main.py</div><div id='m_start'> M Start Line: 214</div><div id='m_end'> M End Line: 214</div><div id='n_start'> N Start Line: 215</div><div id='n_end'> N End Line: 215</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
    detect_instance.run_ESRGAN(in_path = in_path, is_video = is_video, force_jpg = force_jpg)
    loader.destroy()

    <a id="change">print(</a>colorama<a id="change">.Fore.GREEN + &quot----- Process complete, please close HentAI UI to continue -----&quot + </a>colorama.Fore.RESET<a id="change">)</a>
    popup = Tk()
    popup.title(&quotSuccess!&quot)
    label = Label(popup, text=&quotProcess executed successfully!&quot)
    label.pack(side=TOP, fill=X, pady=20, padx=10)</code></pre><h3>After Change</h3><pre><code class='java'>
    detect_instance.run_ESRGAN(in_path = in_path, is_video = is_video, force_jpg = force_jpg)
    loader.destroy()

    <a id="change">log(&quotProcess complete, please close HentAI UI to continue&quot</a>, Ansi.GREEN<a id="change">)</a>
    popup = Tk()
    popup.title(&quotSuccess!&quot)
    label = Label(popup, text=&quotProcess executed successfully!&quot)
    label.pack(side=TOP, fill=X, pady=20, padx=10)</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/gusb3ll/tsuki/commit/9e8cddb75b22abff729c78b0a8f5ce67b0f34d83#diff-bb15e3687c27216f0c69c305988dc4268cf8c31b7c5c694666a15cc7bd7fab3bL170' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 63348162</div><div id='project'> Project Name: gusb3ll/tsuki</div><div id='commit'> Commit Name: 9e8cddb75b22abff729c78b0a8f5ce67b0f34d83</div><div id='time'> Time: 2022-02-20</div><div id='author'> Author: 77166960+Gusb3ll@users.noreply.github.com</div><div id='file'> File Name: Modules/HentAI/main.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: hentAI_TGAN(3)</div><div id='n_method'> N Method Name: hentAI_TGAN(3)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: Modules/HentAI/main.py</div><div id='n_file'> N File Name: Modules/HentAI/main.py</div><div id='m_start'> M Start Line: 179</div><div id='m_end'> M End Line: 190</div><div id='n_start'> N Start Line: 180</div><div id='n_end'> N End Line: 191</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
                                        model_dir=DEFAULT_LOGS_DIR)
        try:
            self.model.load_weights(self.weights_path, by_name=True)
            <a id="change">print(</a>colorama<a id="change">.Fore.CYAN + "\nWeights loaded" + </a>colorama.Fore.RESET<a id="change">)</a>
        except Exception as e:
            print(colorama.Fore.RED + "\nERROR in load_weights: Model Load. Ensure you have your weights.h5 file!" + colorama.Fore.RESET, end=&quot &quot)
            print(e)
</code></pre><h3>After Change</h3><pre><code class='java'>
        self.model = modellib.MaskRCNN(mode="inference", config=self.config, model_dir=DEFAULT_LOGS_DIR)
        try:
            self.model.load_weights(self.weights_path, by_name=True)
            <a id="change">log("Weights loaded"</a>, Ansi.GREEN<a id="change">)</a>
        except Exception as e:
            log("ERROR in load_weights: Model Load. Ensure you have your weights.h5 file!", Ansi.RED, end=&quot &quot)
            log(e, Ansi.RED)
</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/gusb3ll/tsuki/commit/9e8cddb75b22abff729c78b0a8f5ce67b0f34d83#diff-b0ccbbd0f2ff785529f7ce4370db7726b84ca7d6f420fbb8edf88af6002db718L108' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 63348195</div><div id='project'> Project Name: gusb3ll/tsuki</div><div id='commit'> Commit Name: 9e8cddb75b22abff729c78b0a8f5ce67b0f34d83</div><div id='time'> Time: 2022-02-20</div><div id='author'> Author: 77166960+Gusb3ll@users.noreply.github.com</div><div id='file'> File Name: Modules/HentAI/detector.py</div><div id='m_class'> M Class Name: Detector</div><div id='n_method'> N Class Name: Detector</div><div id='m_method'> M Method Name: load_weights(1)</div><div id='n_method'> N Method Name: load_weights(1)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: Modules/HentAI/detector.py</div><div id='n_file'> N File Name: Modules/HentAI/detector.py</div><div id='m_start'> M Start Line: 109</div><div id='m_end'> M End Line: 116</div><div id='n_start'> N Start Line: 104</div><div id='n_end'> N End Line: 111</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>

    &#47&#47 Clean out temp working images from all directories in ESR_temp. Code from https://stackoverflow.com/questions/185936/how-to-delete-the-contents-of-a-folder
    def clean_work_dirs(self):
        <a id="change">print(</a>colorama<a id="change">.Fore.CYAN + "Cleaning work dirs..." + </a>colorama.Fore.RESET<a id="change">)</a>
        folders = [self.out_path, self.out_path2, self.temp_path, self.temp_path2]
        for folder in folders:
            for filename in os.listdir(folder):
                file_path = os.path.join(folder, filename)</code></pre><h3>After Change</h3><pre><code class='java'>

    &#47&#47 Clean out temp working images from all directories in ESR_temp. Code from https://stackoverflow.com/questions/185936/how-to-delete-the-contents-of-a-folder
    def clean_work_dirs(self):
        <a id="change">log("Cleaning work dirs..."</a>, Ansi.CYAN<a id="change">)</a>
        folders = [self.out_path, self.out_path2, self.temp_path, self.temp_path2]
        for folder in folders:
            for filename in os.listdir(folder):
                file_path = os.path.join(folder, filename)</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/gusb3ll/tsuki/commit/9e8cddb75b22abff729c78b0a8f5ce67b0f34d83#diff-b0ccbbd0f2ff785529f7ce4370db7726b84ca7d6f420fbb8edf88af6002db718L93' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 63348126</div><div id='project'> Project Name: gusb3ll/tsuki</div><div id='commit'> Commit Name: 9e8cddb75b22abff729c78b0a8f5ce67b0f34d83</div><div id='time'> Time: 2022-02-20</div><div id='author'> Author: 77166960+Gusb3ll@users.noreply.github.com</div><div id='file'> File Name: Modules/HentAI/detector.py</div><div id='m_class'> M Class Name: Detector</div><div id='n_method'> N Class Name: Detector</div><div id='m_method'> M Method Name: clean_work_dirs(1)</div><div id='n_method'> N Method Name: clean_work_dirs(1)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: Modules/HentAI/detector.py</div><div id='n_file'> N File Name: Modules/HentAI/detector.py</div><div id='m_start'> M Start Line: 94</div><div id='m_end'> M End Line: 105</div><div id='n_start'> N Start Line: 89</div><div id='n_end'> N End Line: 100</div><BR>