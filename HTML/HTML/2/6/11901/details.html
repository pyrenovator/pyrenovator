<html><h3>Pattern ID :11901
</h3><img src='40048635.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>

    def on_epoch_end(self, steps, epoch, logs=None):
        just_show()
        metrics = self.evaluate(<a id="change">valid_dataset.data[:valid_len]</a>)  &#47&#47 评测模型
        if metrics[&quotbleu&quot] &gt; self.best_bleu:
            self.best_bleu = metrics[&quotbleu&quot]
            &#47&#47 model.save_weights(&quot./best_model.pt&quot)  &#47&#47 保存模型</code></pre><h3>After Change</h3><pre><code class='java'>
    def on_epoch_end(self, steps, epoch, logs=None):
        just_show()
        metrics = self.evaluate(valid_dataset.data)  &#47&#47 评测模型
        metrics_test<a id="change"> = </a><a id="change">self.evaluate(</a>test_dataset.data<a id="change">)</a>  &#47&#47 评测模型
        if metrics[&quotbleu&quot] &gt; self.best_bleu:
            self.best_bleu = metrics[&quotbleu&quot]
            &#47&#47 model.save_weights(&quot./best_model.pt&quot)  &#47&#47 保存模型
        metrics[&quotbest_bleu&quot] = self.best_bleu
        print(&quotvalid_data:&quot, metrics)
        <a id="change">print(&quottest_data:&quot</a>, metrics_test<a id="change">)</a>
    
    def evaluate(self, data, topk=1):
        total = 0
        rouge_1, rouge_2, rouge_l, bleu = 0, 0, 0, 0</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 4</div><BR><div id='size'>Non-data size: 5</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/tongjilibo/bert4torch/commit/4fdfebc7c80dc153d28249f748df2831aece8218#diff-3c1225d94fe97e5b610269ed4aa26770b320ae88ee8ab0ee40f359519bc0c03cL119' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 40048635</div><div id='project'> Project Name: tongjilibo/bert4torch</div><div id='commit'> Commit Name: 4fdfebc7c80dc153d28249f748df2831aece8218</div><div id='time'> Time: 2022-09-23</div><div id='author'> Author: lb@libos-MacBook-Pro.local</div><div id='file'> File Name: examples/seq2seq/task_seq2seq_autotitle_csl_t5_pegasus.py</div><div id='m_class'> M Class Name: Evaluator</div><div id='n_method'> N Class Name: Evaluator</div><div id='m_method'> M Method Name: on_epoch_end(4)</div><div id='n_method'> N Method Name: on_epoch_end(4)</div><div id='m_parent_class'> M Parent Class: Callback</div><div id='n_parent_class'> N Parent Class: Callback</div><div id='m_file'> M File Name: examples/seq2seq/task_seq2seq_autotitle_csl_t5_pegasus.py</div><div id='n_file'> N File Name: examples/seq2seq/task_seq2seq_autotitle_csl_t5_pegasus.py</div><div id='m_start'> M Start Line: 119</div><div id='m_end'> M End Line: 119</div><div id='n_start'> N Start Line: 119</div><div id='n_end'> N End Line: 126</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>

    def on_epoch_end(self, steps, epoch, logs=None):
        just_show()
        metrics = self.evaluate(<a id="change">valid_dataset.data[:valid_len]</a>)  &#47&#47 评测模型
        if metrics[&quotbleu&quot] &gt; self.best_bleu:
            self.best_bleu = metrics[&quotbleu&quot]
            &#47&#47 model.save_weights(&quot./best_model.pt&quot)  &#47&#47 保存模型</code></pre><h3>After Change</h3><pre><code class='java'>
    def on_epoch_end(self, steps, epoch, logs=None):
        just_show()
        metrics = self.evaluate(valid_dataset.data)  &#47&#47 评测模型
        metrics_test<a id="change"> = </a><a id="change">self.evaluate(</a>test_dataset.data<a id="change">)</a>  &#47&#47 评测模型
        if metrics[&quotbleu&quot] &gt; self.best_bleu:
            self.best_bleu = metrics[&quotbleu&quot]
            &#47&#47 model.save_weights(&quot./best_model.pt&quot)  &#47&#47 保存模型
        metrics[&quotbest_bleu&quot] = self.best_bleu
        print(&quotvalid_data:&quot, metrics)
        <a id="change">print(&quottest_data:&quot</a>, metrics_test<a id="change">)</a>
    
    def evaluate(self, data, topk=1):
        total = 0
        rouge_1, rouge_2, rouge_l, bleu = 0, 0, 0, 0</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/tongjilibo/bert4torch/commit/4fdfebc7c80dc153d28249f748df2831aece8218#diff-2eef311eed7b64c9a41d95547f10aa3f043634751ce8e0a0b2851ddf4a59e648L128' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 40048634</div><div id='project'> Project Name: tongjilibo/bert4torch</div><div id='commit'> Commit Name: 4fdfebc7c80dc153d28249f748df2831aece8218</div><div id='time'> Time: 2022-09-23</div><div id='author'> Author: lb@libos-MacBook-Pro.local</div><div id='file'> File Name: examples/seq2seq/task_seq2seq_autotitle_csl_unilm.py</div><div id='m_class'> M Class Name: Evaluator</div><div id='n_method'> N Class Name: Evaluator</div><div id='m_method'> M Method Name: on_epoch_end(4)</div><div id='n_method'> N Method Name: on_epoch_end(4)</div><div id='m_parent_class'> M Parent Class: Callback</div><div id='n_parent_class'> N Parent Class: Callback</div><div id='m_file'> M File Name: examples/seq2seq/task_seq2seq_autotitle_csl_unilm.py</div><div id='n_file'> N File Name: examples/seq2seq/task_seq2seq_autotitle_csl_unilm.py</div><div id='m_start'> M Start Line: 130</div><div id='m_end'> M End Line: 130</div><div id='n_start'> N Start Line: 130</div><div id='n_end'> N End Line: 137</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>

    def on_epoch_end(self, steps, epoch, logs=None):
        just_show()
        metrics = self.evaluate(<a id="change">valid_dataset.data[:valid_len]</a>)  &#47&#47 评测模型
        if metrics[&quotbleu&quot] &gt; self.best_bleu:
            self.best_bleu = metrics[&quotbleu&quot]
            &#47&#47 model.save_weights(&quot./best_model.pt&quot)  &#47&#47 保存模型</code></pre><h3>After Change</h3><pre><code class='java'>
    def on_epoch_end(self, steps, epoch, logs=None):
        just_show()
        metrics = self.evaluate(valid_dataset.data)  &#47&#47 评测模型
        metrics_test<a id="change"> = </a><a id="change">self.evaluate(</a>test_dataset.data<a id="change">)</a>  &#47&#47 评测模型
        if metrics[&quotbleu&quot] &gt; self.best_bleu:
            self.best_bleu = metrics[&quotbleu&quot]
            &#47&#47 model.save_weights(&quot./best_model.pt&quot)  &#47&#47 保存模型
        metrics[&quotbest_bleu&quot] = self.best_bleu
        print(&quotvalid_data:&quot, metrics)
        <a id="change">print(&quottest_data:&quot</a>, metrics_test<a id="change">)</a>
    
    def evaluate(self, data, topk=1):
        total = 0
        rouge_1, rouge_2, rouge_l, bleu = 0, 0, 0, 0</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/tongjilibo/bert4torch/commit/4fdfebc7c80dc153d28249f748df2831aece8218#diff-286daa2ec507669a84db557f98fbccf8434c669617b9e23b7ce99fc69989e7d9L115' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 40048637</div><div id='project'> Project Name: tongjilibo/bert4torch</div><div id='commit'> Commit Name: 4fdfebc7c80dc153d28249f748df2831aece8218</div><div id='time'> Time: 2022-09-23</div><div id='author'> Author: lb@libos-MacBook-Pro.local</div><div id='file'> File Name: examples/seq2seq/task_seq2seq_autotitle_csl_bart.py</div><div id='m_class'> M Class Name: Evaluator</div><div id='n_method'> N Class Name: Evaluator</div><div id='m_method'> M Method Name: on_epoch_end(4)</div><div id='n_method'> N Method Name: on_epoch_end(4)</div><div id='m_parent_class'> M Parent Class: Callback</div><div id='n_parent_class'> N Parent Class: Callback</div><div id='m_file'> M File Name: examples/seq2seq/task_seq2seq_autotitle_csl_bart.py</div><div id='n_file'> N File Name: examples/seq2seq/task_seq2seq_autotitle_csl_bart.py</div><div id='m_start'> M Start Line: 117</div><div id='m_end'> M End Line: 117</div><div id='n_start'> N Start Line: 117</div><div id='n_end'> N End Line: 124</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>

    def on_epoch_end(self, steps, epoch, logs=None):
        just_show()
        metrics = self.evaluate(<a id="change">valid_dataset.data[:valid_len]</a>)  &#47&#47 评测模型
        if metrics[&quotbleu&quot] &gt; self.best_bleu:
            self.best_bleu = metrics[&quotbleu&quot]
            &#47&#47 model.save_weights(&quot./best_model.pt&quot)  &#47&#47 保存模型</code></pre><h3>After Change</h3><pre><code class='java'>
    def on_epoch_end(self, steps, epoch, logs=None):
        just_show()
        metrics = self.evaluate(valid_dataset.data)  &#47&#47 评测模型
        metrics_test<a id="change"> = </a><a id="change">self.evaluate(</a>test_dataset.data<a id="change">)</a>  &#47&#47 评测模型
        if metrics[&quotbleu&quot] &gt; self.best_bleu:
            self.best_bleu = metrics[&quotbleu&quot]
            &#47&#47 model.save_weights(&quot./best_model.pt&quot)  &#47&#47 保存模型
        metrics[&quotbest_bleu&quot] = self.best_bleu
        print(&quotvalid_data:&quot, metrics)
        <a id="change">print(&quottest_data:&quot</a>, metrics_test<a id="change">)</a>
    
    def evaluate(self, data, topk=1):
        total = 0
        rouge_1, rouge_2, rouge_l, bleu = 0, 0, 0, 0</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/tongjilibo/bert4torch/commit/4fdfebc7c80dc153d28249f748df2831aece8218#diff-5725ee39bd8cb391a090c31aa69002c9369797321d479fe13365d2ae9a975cf9L114' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 40048636</div><div id='project'> Project Name: tongjilibo/bert4torch</div><div id='commit'> Commit Name: 4fdfebc7c80dc153d28249f748df2831aece8218</div><div id='time'> Time: 2022-09-23</div><div id='author'> Author: lb@libos-MacBook-Pro.local</div><div id='file'> File Name: examples/seq2seq/task_seq2seq_autotitle_csl_uer_t5.py</div><div id='m_class'> M Class Name: Evaluator</div><div id='n_method'> N Class Name: Evaluator</div><div id='m_method'> M Method Name: on_epoch_end(4)</div><div id='n_method'> N Method Name: on_epoch_end(4)</div><div id='m_parent_class'> M Parent Class: Callback</div><div id='n_parent_class'> N Parent Class: Callback</div><div id='m_file'> M File Name: examples/seq2seq/task_seq2seq_autotitle_csl_uer_t5.py</div><div id='n_file'> N File Name: examples/seq2seq/task_seq2seq_autotitle_csl_uer_t5.py</div><div id='m_start'> M Start Line: 116</div><div id='m_end'> M End Line: 116</div><div id='n_start'> N Start Line: 116</div><div id='n_end'> N End Line: 123</div><BR>