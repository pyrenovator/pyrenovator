<html><h3>Pattern ID :5569
</h3><img src='19700782.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>

        &#47&#47 Select data
        data, labels = self.dataloader[self.data_idx // self.dataloader.batch_size]
        data<a id="change">, labels</a> = data[0:self.num_data_points], labels[0:self.num_data_points]
        data = data.to(**setup)
        labels = labels.to(device=setup[&quotdevice&quot])
</code></pre><h3>After Change</h3><pre><code class='java'>
        for data_point in range(self.num_data_points):
            datum, label = self.dataloader.dataset[pointer]
            data += [datum]
            labels<a id="change"> += </a>[<a id="change">torch.as_tensor(</a>label<a id="change">)</a>]
            pointer += server_payload[&quotdata&quot].classes
        data<a id="change"> = torch</a><a id="change">.stack(</a>data<a id="change">)</a>.to(**self.setup)
        labels = torch.stack(labels).to(device=self.setup[&quotdevice&quot])

        &#47&#47 Compute local updates</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 4</div><BR><div id='size'>Non-data size: 5</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/jonasgeiping/breaching/commit/9970fc2cd79885d2710383036d5ff70dc67b6b03#diff-222118a39af19077a8b428b60923841d31a00f445f3963533670a0eaa87a9924L43' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 19700782</div><div id='project'> Project Name: jonasgeiping/breaching</div><div id='commit'> Commit Name: 9970fc2cd79885d2710383036d5ff70dc67b6b03</div><div id='time'> Time: 2021-09-05</div><div id='author'> Author: jonas.geiping@googlemail.com</div><div id='file'> File Name: breaching/cases/users.py</div><div id='m_class'> M Class Name: UserSingleStep</div><div id='n_method'> N Class Name: UserSingleStep</div><div id='m_method'> M Method Name: compute_local_updates(2)</div><div id='n_method'> N Method Name: compute_local_updates(2)</div><div id='m_parent_class'> M Parent Class: torch.nn.Module</div><div id='n_parent_class'> N Parent Class: torch.nn.Module</div><div id='m_file'> M File Name: breaching/cases/users.py</div><div id='n_file'> N File Name: breaching/cases/users.py</div><div id='m_start'> M Start Line: 43</div><div id='m_end'> M End Line: 51</div><div id='n_start'> N Start Line: 43</div><div id='n_end'> N End Line: 57</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
            for neuron, label in neuron_dict.items():
                self.remask(layer=layer, neuron=neuron)

        return mark_list<a id="change">, mask_list, entropy_list</a>

    def remask(self, layer: str, neuron: int):
        &#47&#47 no bound
        atanh_mark = torch.randn(self.data_shape, device=env[&quotdevice&quot])</code></pre><h3>After Change</h3><pre><code class='java'>
                loss_list.append(loss)
        mark_list = torch.stack(mark_list)
        if use_mask:
            mask_list<a id="change"> = </a><a id="change">torch.stack(</a>mask_list<a id="change">)</a>
        loss_list<a id="change"> = </a><a id="change">torch.as_tensor(</a>loss_list<a id="change">)</a>
        return mark_list, mask_list, loss_list

    def remask(self, _input: torch.Tensor, _label: torch.Tensor, layer: str, neuron: int,
               label: int, use_mask: bool = True, validate_interval: int = 100) -&gt; (torch.Tensor, torch.Tensor, float):</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/ain-soph/trojanzoo/commit/1684c28ef38502abb83d37beb845b69007e33274#diff-7af6064ea7ec79a26e3db236e9cf91c2f5bb481beb04de7a8aadbb1986e10026L51' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 19700776</div><div id='project'> Project Name: ain-soph/trojanzoo</div><div id='commit'> Commit Name: 1684c28ef38502abb83d37beb845b69007e33274</div><div id='time'> Time: 2020-07-07</div><div id='author'> Author: ain-soph@live.com</div><div id='file'> File Name: trojanzoo/defense/backdoor/abs.py</div><div id='m_class'> M Class Name: ABS</div><div id='n_method'> N Class Name: ABS</div><div id='m_method'> M Method Name: get_potential_triggers(2)</div><div id='n_method'> N Method Name: get_potential_triggers(1)</div><div id='m_parent_class'> M Parent Class: Defense_Backdoor</div><div id='n_parent_class'> N Parent Class: Defense_Backdoor</div><div id='m_file'> M File Name: trojanzoo/defense/backdoor/abs.py</div><div id='n_file'> N File Name: trojanzoo/defense/backdoor/abs.py</div><div id='m_start'> M Start Line: 51</div><div id='m_end'> M End Line: 62</div><div id='n_start'> N Start Line: 64</div><div id='n_end'> N End Line: 89</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>

        &#47&#47 Select data
        data, labels = self.dataloader[self.data_idx // self.dataloader.batch_size]
        data, labels = data[0:self.num_data_points]<a id="change">, labels[0:self.num_data_points]</a>
        data = data.to(**setup)
        labels = labels.to(device=setup[&quotdevice&quot])

        &#47&#47 Compute local updates</code></pre><h3>After Change</h3><pre><code class='java'>
        for data_point in range(self.num_data_points):
            datum, label = self.dataloader.dataset[pointer]
            data += [datum]
            labels<a id="change"> += </a>[<a id="change">torch.as_tensor(</a>label<a id="change">)</a>]
            pointer += server_payload[&quotdata&quot].classes
        data<a id="change"> = </a><a id="change">torch.stack(</a>data<a id="change">)</a>.to(**self.setup)
        labels = torch.stack(labels).to(device=self.setup[&quotdevice&quot])

        &#47&#47 Compute local updates</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/jonasgeiping/breaching/commit/9970fc2cd79885d2710383036d5ff70dc67b6b03#diff-222118a39af19077a8b428b60923841d31a00f445f3963533670a0eaa87a9924L39' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 19700778</div><div id='project'> Project Name: jonasgeiping/breaching</div><div id='commit'> Commit Name: 9970fc2cd79885d2710383036d5ff70dc67b6b03</div><div id='time'> Time: 2021-09-05</div><div id='author'> Author: jonas.geiping@googlemail.com</div><div id='file'> File Name: breaching/cases/users.py</div><div id='m_class'> M Class Name: UserSingleStep</div><div id='n_method'> N Class Name: UserSingleStep</div><div id='m_method'> M Method Name: compute_local_updates(2)</div><div id='n_method'> N Method Name: compute_local_updates(2)</div><div id='m_parent_class'> M Parent Class: torch.nn.Module</div><div id='n_parent_class'> N Parent Class: torch.nn.Module</div><div id='m_file'> M File Name: breaching/cases/users.py</div><div id='n_file'> N File Name: breaching/cases/users.py</div><div id='m_start'> M Start Line: 43</div><div id='m_end'> M End Line: 51</div><div id='n_start'> N Start Line: 43</div><div id='n_end'> N End Line: 57</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
                if i == 0:
                    layer_output_all = layer_output
                else:
                    layer_output_all = torch.cat((layer_output_all<a id="change">, layer_output</a>))

            layer_output_mean = torch.mean(layer_output_all, dim=0)
</code></pre><h3>After Change</h3><pre><code class='java'>
                    idx.append(k)
            class_dataset = torch.utils.data.Subset(self.mix_dataset, idx)
            class_input, class_label = dataset_to_list(class_dataset)
            class_input<a id="change"> = </a><a id="change">torch.stack(</a>class_input<a id="change">)</a>
            class_label<a id="change"> = </a><a id="change">torch.as_tensor(</a>class_label<a id="change">, dtype=torch.long)</a>
            class_dataset = TensorDataset(class_input, class_label)
            class_dataloader = self.dataset.get_dataloader(mode=&quottrain&quot, dataset=self.class_dataset, num_workers=0)

            layer_output_all = []   &#47&#47 TODO</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/ain-soph/trojanzoo/commit/4adb8ae3e90425855448bfd8fc212f8d91f5332c#diff-0fc81071950862dd1ef5dde8002b9de607e77ad41be1611495ea702ca94cf4e9L94' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 19700779</div><div id='project'> Project Name: ain-soph/trojanzoo</div><div id='commit'> Commit Name: 4adb8ae3e90425855448bfd8fc212f8d91f5332c</div><div id='time'> Time: 2021-06-01</div><div id='author'> Author: ain-soph@live.com</div><div id='file'> File Name: trojanvision/defenses/backdoor/spectral_signature.py</div><div id='m_class'> M Class Name: SpectralSignature</div><div id='n_method'> N Class Name: SpectralSignature</div><div id='m_method'> M Method Name: get_clean_dataloader(1)</div><div id='n_method'> N Method Name: get_clean_dataloader(1)</div><div id='m_parent_class'> M Parent Class: BackdoorDefense</div><div id='n_parent_class'> N Parent Class: BackdoorDefense</div><div id='m_file'> M File Name: trojanvision/defenses/backdoor/spectral_signature.py</div><div id='n_file'> N File Name: trojanvision/defenses/backdoor/spectral_signature.py</div><div id='m_start'> M Start Line: 114</div><div id='m_end'> M End Line: 126</div><div id='n_start'> N Start Line: 113</div><div id='n_end'> N End Line: 125</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>

        &#47&#47 Default return value. Erring on the side of caution here by
        &#47&#47 being super verbose.
        return [([]<a id="change">, []</a>)]
</code></pre><h3>After Change</h3><pre><code class='java'>

        &#47&#47 Next, let&quots try the infinite pairs.
        try:
            infinite_pairs<a id="change"> = </a><a id="change">torch.as_tensor(
                </a>cofaces[1][dim]<a id="change">, dtype=torch.long
            )</a>
        except IndexError:
            infinite_pairs = None

        if infinite_pairs is not None:
            print(&quotinfinite_pairs =&quot, infinite_pairs)

            &#47&#47 &quotPair off&quot all the indices
            max_index = torch.argmax(x)
            fake_destroyers = torch.empty_like(infinite_pairs).fill_(max_index)

            infinite_pairs<a id="change"> = </a><a id="change">torch.stack(
                </a>(infinite_pairs, fake_destroyers), 1<a id="change">
            )</a>

            print(&quotinfinite pairs, fixed =&quot, infinite_pairs)

        return result</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/aidos-lab/pytorch-topological/commit/0dd25924d9fd7691de14281351dcee1edd8cfc26#diff-55e452f337a40ea32b5684b3ef902cea8be96c3dfbf8d1bf1649e99874c84074L64' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 19700775</div><div id='project'> Project Name: aidos-lab/pytorch-topological</div><div id='commit'> Commit Name: 0dd25924d9fd7691de14281351dcee1edd8cfc26</div><div id='time'> Time: 2021-12-21</div><div id='author'> Author: bastian@rieck.me</div><div id='file'> File Name: torch_topological/nn/cubical.py</div><div id='m_class'> M Class Name: Cubical</div><div id='n_method'> N Class Name: Cubical</div><div id='m_method'> M Method Name: _extract_generators_and_diagrams(4)</div><div id='n_method'> N Method Name: _extract_generators_and_diagrams(4)</div><div id='m_parent_class'> M Parent Class: nn.Module</div><div id='n_parent_class'> N Parent Class: nn.Module</div><div id='m_file'> M File Name: torch_topological/nn/cubical.py</div><div id='n_file'> N File Name: torch_topological/nn/cubical.py</div><div id='m_start'> M Start Line: 88</div><div id='m_end'> M End Line: 119</div><div id='n_start'> N Start Line: 74</div><div id='n_end'> N End Line: 141</div><BR>