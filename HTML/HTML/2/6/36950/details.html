<html><h3>Pattern ID :36950
</h3><img src='105204535.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
        self.truncation_strategy = truncation_strategy
        self.model_save_path = model_save_path

        self._padding_strategy = &quotmax_length&quot<a id="change"> if </a>self.max_length<a id="change"> else </a>&quotlongest&quot

    def __getstate__(self):
        if self.model_save_path:</code></pre><h3>After Change</h3><pre><code class='java'>
        self.max_length = max_length
        self.model_save_path = model_save_path

        <a id="change">if self.pooling_strategy == &quotauto&quot</a>:
            self.pooling_strategy = &quotcls&quot
            raise DeprecationWarning(
                "&quotauto&quot pooling_strategy is deprecated, please use"
                " &quotcls&quot to maintain the old default behavior."
            )

        if self.pooling_strategy not in [&quotcls&quot, &quotmean&quot, &quotmax&quot, &quotmin&quot]:
            <a id="change">self.logger.error(
                f"pooling strategy not found: {self.pooling_strategy}."
                " The allowed pooling strategies are &quotcls&quot, &quotmean&quot, &quotmax&quot, &quotmin&quot."</a><a id="change">
            )</a>
            <a id="change">raise </a>NotImplementedError

    def __getstate__(self):
        if self.model_save_path:</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 5</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/jina-ai/jina-hub/commit/d3f5bdbdddc7b2d6a4e5fcf08deb2c5f8d883f23#diff-fcb1ce83dfd96635a32864081c41108eb930519cef0a664f0ec5db4808d9ca41L23' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 105204535</div><div id='project'> Project Name: jina-ai/jina-hub</div><div id='commit'> Commit Name: d3f5bdbdddc7b2d6a4e5fcf08deb2c5f8d883f23</div><div id='time'> Time: 2020-12-21</div><div id='author'> Author: 69796623+tadej-redstone@users.noreply.github.com</div><div id='file'> File Name: encoders/nlp/TransformerTorchEncoder/__init__.py</div><div id='m_class'> M Class Name: TransformerTorchEncoder</div><div id='n_method'> N Class Name: TransformerTorchEncoder</div><div id='m_method'> M Method Name: __init__(7)</div><div id='n_method'> N Method Name: __init__(7)</div><div id='m_parent_class'> M Parent Class: TorchDevice,BaseEncoder</div><div id='n_parent_class'> N Parent Class: TorchDevice,BaseEncoder</div><div id='m_file'> M File Name: encoders/nlp/TransformerTorchEncoder/__init__.py</div><div id='n_file'> N File Name: encoders/nlp/TransformerTorchEncoder/__init__.py</div><div id='m_start'> M Start Line: 43</div><div id='m_end'> M End Line: 79</div><div id='n_start'> N Start Line: 23</div><div id='n_end'> N End Line: 68</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        self.truncation_strategy = truncation_strategy
        self.model_save_path = model_save_path

        self._padding_strategy = &quotmax_length&quot<a id="change"> if </a>self.max_length<a id="change"> else </a>&quotlongest&quot

    def __getstate__(self):
        if self.model_save_path:</code></pre><h3>After Change</h3><pre><code class='java'>
                &quot "cls" to maintain the old default behavior.&quot
            )

        <a id="change">if self.pooling_strategy not in [&quotcls&quot, &quotmean&quot, &quotmax&quot, &quotmin&quot]</a>:
            <a id="change">self.logger.error(
                f&quotpooling strategy not found: {self.pooling_strategy}.&quot
                &quot The allowed pooling strategies are "cls", "mean", "max", "min".&quot</a><a id="change">
            )</a>
            <a id="change">raise </a>NotImplementedError

    def post_init(self):
        from transformers import TFAutoModel, AutoTokenizer</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/jina-ai/jina-hub/commit/1c2e2b83aefe41d83ee374f96df9642504e0358c#diff-b9bbe6f111188d9d3dc409614e58f2568711490364722c446e6d701540185e76L37' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 105204537</div><div id='project'> Project Name: jina-ai/jina-hub</div><div id='commit'> Commit Name: 1c2e2b83aefe41d83ee374f96df9642504e0358c</div><div id='time'> Time: 2020-12-29</div><div id='author'> Author: tadej.svetina@gmail.com</div><div id='file'> File Name: encoders/nlp/TransformerTFEncoder/__init__.py</div><div id='m_class'> M Class Name: TransformerTFEncoder</div><div id='n_method'> N Class Name: TransformerTFEncoder</div><div id='m_method'> M Method Name: __init__(7)</div><div id='n_method'> N Method Name: __init__(7)</div><div id='m_parent_class'> M Parent Class: TFDevice,BaseEncoder</div><div id='n_parent_class'> N Parent Class: TFDevice,BaseEncoder</div><div id='m_file'> M File Name: encoders/nlp/TransformerTFEncoder/__init__.py</div><div id='n_file'> N File Name: encoders/nlp/TransformerTFEncoder/__init__.py</div><div id='m_start'> M Start Line: 43</div><div id='m_end'> M End Line: 78</div><div id='n_start'> N Start Line: 23</div><div id='n_end'> N End Line: 67</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        visible_maddrs_str = [str(a) for a in dht.get_visible_maddrs()]
        logger.info(f"Running DHT node on {visible_maddrs_str}, initial peers = {initial_peers}")

        num_handlers = num_handlers<a id="change"> if </a>num_handlers is not None<a id="change"> else </a>num_blocks * 8
        device = device or ("cuda" if torch.cuda.is_available() else "cpu")
        block_config = DistributedBloomConfig.from_pretrained(block_config, use_auth_token=True)
        memory_cache = MemoryCache(device, cache_size_bytes)</code></pre><h3>After Change</h3><pre><code class='java'>
        device = device or ("cuda" if torch.cuda.is_available() else "cpu")
        memory_cache = MemoryCache(device, cache_size_bytes)

        <a id="change">if block_indices is not None</a>:
            try:
                start, end = block_indices.split(&quot:&quot)
                start, end = map(int, map(str.strip, (start, end)))
            except Exception as e:
                <a id="change">logger.error(f"Failed to parse --block_indices ({e}), must be start:end (e.g. 0:33)"</a><a id="change">)</a>
                <a id="change">raise</a>
            block_indices = range(start, end)
        else:
            assert num_blocks is not None
            block_indices = range(num_blocks) &#47&#47 TODO replace with proper load balancing</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/bigscience-workshop/distributed-bloom/commit/20497f81d1d2e7f123364726ac5259bc56c29e99#diff-e0bb43e77afdc23f85aefba41e3d8fda1554c6402c8e08536508ed6246d8068fL82' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 105204536</div><div id='project'> Project Name: bigscience-workshop/distributed-bloom</div><div id='commit'> Commit Name: 20497f81d1d2e7f123364726ac5259bc56c29e99</div><div id='time'> Time: 2022-06-17</div><div id='author'> Author: justheuristic@gmail.com</div><div id='file'> File Name: src/server/server.py</div><div id='m_class'> M Class Name: Server</div><div id='n_method'> N Class Name: Server</div><div id='m_method'> M Method Name: create(16)</div><div id='n_method'> N Method Name: create(14)</div><div id='m_parent_class'> M Parent Class: threading.Thread</div><div id='n_parent_class'> N Parent Class: threading.Thread</div><div id='m_file'> M File Name: src/server/server.py</div><div id='n_file'> N File Name: src/server/server.py</div><div id='m_start'> M Start Line: 109</div><div id='m_end'> M End Line: 115</div><div id='n_start'> N Start Line: 86</div><div id='n_end'> N End Line: 151</div><BR>