<link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
        image_z = self.clip_model.encode_image(pred_rgb)
        image_z = image_z / image_z.norm(dim=-1, keepdim=True) &#47&#47 normalize features

        loss = - <a id="change">(image_z * text_z).sum(-1).mean()</a>

        return loss

</code></pre><h3>After Change</h3><pre><code class='java'>
        image_z = self.clip_model.encode_image(self.aug(pred_rgb))
        image_z = image_z / image_z.norm(dim=-1, keepdim=True) &#47&#47 normalize features

        loss<a id="change"> = </a>0
        if &quotimage&quot in clip_z:
            loss = loss<a id="change"> - </a>(image_z * clip_z[&quotimage&quot]).sum(-1).mean()
        
        if &quottext&quot in clip_z:
            loss = loss<a id="change"> - </a><a id="change">(image_z * clip_z[&quottext&quot]).sum(</a>-1<a id="change">)</a>.mean()

        loss<a id="change"> = </a>loss * grad_scale

        return loss
</code></pre>