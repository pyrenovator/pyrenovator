<html><h3>Pattern ID :14758
</h3><img src='48508709.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
        &#47&#47 is_package check currently fails, because pkg_resources.working_set
        &#47&#47 is not refreshed automatically (see &#47&#473923). We&quotre trying to work
        &#47&#47 around this here be requiring the package explicitly.
        <a id="change">try:
            </a>pkg_resources.working_set.require(model_name)
        <a id="change">except</a>:  &#47&#47 noqa: E722
            &#47&#47 Maybe it&quots possible to remove this â€“ mostly worried about cross-
            &#47&#47 platform and cross-Python copmpatibility here
            pass</code></pre><h3>After Change</h3><pre><code class='java'>
    can be shortcut, model name or, if --direct flag is set, full model name
    with version. For direct downloads, the compatibility check will be skipped.
    
    <a id="change">if </a><a id="change">not require_package("spacy") and "--no-deps" not in pip_args</a>:
        msg.warn(
            "Skipping model package dependencies and setting `--no-deps`. "
            "You don&quott seem to have the spaCy package itself installed "
            "(maybe because you&quotve built from source?), so installing the "
            "model dependencies would cause spaCy to be downloaded, which "
            "probably isn&quott what you want. If the model package has other "
            "dependencies, you&quotll have to install them manually."
        )
        pip_args<a id="change"> = </a>pip_args + ("--no-deps",)
    dl_tpl = "{m}-{v}/{m}-{v}.tar.gz&#47&#47egg={m}=={v}"
    if direct:
        components = model.split("-")</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 5</div><BR><div id='size'>Non-data size: 6</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/explosion/spaCy/commit/a84025d70b276df3a84b31b024525c51c04f53cf#diff-adb0f441d727775dfc118c89141dd2daab3ca94d3054627b748439171e4eea43L31' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 48508709</div><div id='project'> Project Name: explosion/spaCy</div><div id='commit'> Commit Name: a84025d70b276df3a84b31b024525c51c04f53cf</div><div id='time'> Time: 2019-09-16</div><div id='author'> Author: ines@ines.io</div><div id='file'> File Name: spacy/cli/download.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: download(2)</div><div id='n_method'> N Method Name: download(2)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: spacy/cli/download.py</div><div id='n_file'> N File Name: spacy/cli/download.py</div><div id='m_start'> M Start Line: 39</div><div id='m_end'> M End Line: 82</div><div id='n_start'> N Start Line: 31</div><div id='n_end'> N End Line: 85</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
            default_dtype = {}

        &#47&#47 Saving the most expensive methods for last
        <a id="change">try:
            </a>return tf.convert_to_tensor(value, dtype=tf_dtype)
        <a id="change">except </a>ValueError:
            try:
                return tf.ragged.stack([np.array(subarr, dtype=np_dtype) for subarr in value])
            except ValueError:</code></pre><h3>After Change</h3><pre><code class='java'>
            default_dtype = {"dtype": tf.int64}
        elif isinstance(value, (np.number, np.ndarray)) and np.issubdtype(value.dtype, np.floating):
            default_dtype = {"dtype": tf.float32}
        elif <a id="change">config.PIL_AVAILABLE and "PIL" in sys.modules</a>:
            import PIL.Image

            if isinstance(value, PIL.Image.Image):
                value<a id="change"> = </a>np.asarray(value)

        return tf.convert_to_tensor(value, **{**default_dtype, **self.tf_tensor_kwargs})
</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/huggingface/datasets/commit/1b935dab9d2f171a8c6294269421fe967eb55e34#diff-e2457f8d454cefdf13507a29e34af59e946323b8f93133526f9fa0ad478786ecL34' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 48508741</div><div id='project'> Project Name: huggingface/datasets</div><div id='commit'> Commit Name: 1b935dab9d2f171a8c6294269421fe967eb55e34</div><div id='time'> Time: 2022-10-10</div><div id='author'> Author: 42851186+lhoestq@users.noreply.github.com</div><div id='file'> File Name: src/datasets/formatting/tf_formatter.py</div><div id='m_class'> M Class Name: TFFormatter</div><div id='n_method'> N Class Name: TFFormatter</div><div id='m_method'> M Method Name: _tensorize(2)</div><div id='n_method'> N Method Name: _tensorize(2)</div><div id='m_parent_class'> M Parent Class: Subscript</div><div id='n_parent_class'> N Parent Class: Subscript</div><div id='m_file'> M File Name: src/datasets/formatting/tf_formatter.py</div><div id='n_file'> N File Name: src/datasets/formatting/tf_formatter.py</div><div id='m_start'> M Start Line: 37</div><div id='m_end'> M End Line: 65</div><div id='n_start'> N Start Line: 57</div><div id='n_end'> N End Line: 72</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
            word_idx = prompt.split().index(word, offset_idx)
        except:
            for punct in (&quot.&quot, &quot,&quot, &quot!&quot, &quot?&quot):
                <a id="change">try:
                    </a>word_idx = prompt.split().index(word + punct)
                    break
                <a id="change">except</a>:
                    pass

    if word_idx is None:</code></pre><h3>After Change</h3><pre><code class='java'>
                &#47&#47 check to see if the extra tokens were from punctuation
                no_punc = [t for t in w_token if t not in punc_tokens]
                search_no_punc = [t for t in search_tokens if t not in punc_tokens]
                <a id="change">if </a><a id="change">no_punc and no_punc == search_no_punc</a>:
                    merge_idxs<a id="change"> += </a>calc_token_positions(idx, len(search_tokens))
                    word_idx = idx
            elif w_token == search_tokens:
                merge_idxs += calc_token_positions(idx, len(search_tokens))</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/castorini/daam/commit/854e6ddfdae1781009b31b66b2d5bb15d852fccf#diff-ea4e615a144dec76002186f2cde018c58e9a14487f738b334af1572531829aaeL52' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 48508704</div><div id='project'> Project Name: castorini/daam</div><div id='commit'> Commit Name: 854e6ddfdae1781009b31b66b2d5bb15d852fccf</div><div id='time'> Time: 2022-12-08</div><div id='author'> Author: alotofcatz@gmail.com</div><div id='file'> File Name: daam/utils.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: compute_token_merge_indices(5)</div><div id='n_method'> N Method Name: compute_token_merge_indices(5)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: daam/utils.py</div><div id='n_file'> N File Name: daam/utils.py</div><div id='m_start'> M Start Line: 53</div><div id='m_end'> M End Line: 90</div><div id='n_start'> N Start Line: 54</div><div id='n_end'> N End Line: 91</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
                if do_print:
                    print(&quotresources:&quot, resources)

                <a id="change">try:
                    </a>estimated_runtime = node.estimate_runtime(resources)
                <a id="change">except </a>Exception as e:
                    print(&quotTime estimator errors out.  &quot
                          &quotDefaulting estimated time to 1 day.&quot)
                    print(&quotError: {}&quot.format(str(e)))</code></pre><h3>After Change</h3><pre><code class='java'>
                if do_print:
                    print(&quotresources:&quot, resources)

                <a id="change">if </a><a id="change">num_resources == 1 and node.estimate_runtime_func is None</a>:
                    print(&quotTime estimator not set and only one possible &quot
                          &quotresource choice; defaulting estimated time to 1 hr.&quot)
                    estimated_runtime<a id="change"> = </a>1 * 3600
                else:
                    estimated_runtime = node.estimate_runtime(resources)
                if minimize_cost:</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/skypilot-org/skypilot/commit/b8d9669b1a46a70a91e7061d44e4ba3630a4878b#diff-29e1580cd3110f2187424743b65ddc99b9765416938cba77e17c26d4f4cad76dL114' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 48508713</div><div id='project'> Project Name: skypilot-org/skypilot</div><div id='commit'> Commit Name: b8d9669b1a46a70a91e7061d44e4ba3630a4878b</div><div id='time'> Time: 2021-10-14</div><div id='author'> Author: zongheng.y@gmail.com</div><div id='file'> File Name: prototype/sky/optimizer.py</div><div id='m_class'> M Class Name: Optimizer</div><div id='n_method'> N Class Name: Optimizer</div><div id='m_method'> M Method Name: _optimize_cost(2)</div><div id='n_method'> N Method Name: _optimize_cost(2)</div><div id='m_parent_class'> M Parent Class: object</div><div id='n_parent_class'> N Parent Class: object</div><div id='m_file'> M File Name: prototype/sky/optimizer.py</div><div id='n_file'> N File Name: prototype/sky/optimizer.py</div><div id='m_start'> M Start Line: 138</div><div id='m_end'> M End Line: 154</div><div id='n_start'> N Start Line: 129</div><div id='n_end'> N End Line: 158</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        better = True  &#47&#47 whether we find a better model in one trial
        if self._ensemble:
            self.best_model = {}
        <a id="change">try:
            </a>from ray.tune.suggest import ConcurrencyLimiter
        <a id="change">except </a>ImportError:
            from .searcher.suggestion import ConcurrencyLimiter
        if self._hpo_method in (&quotcfo&quot, &quotgrid&quot):
            from flaml import CFO as SearchAlgo</code></pre><h3>After Change</h3><pre><code class='java'>
                searcher = search_state.search_alg.searcher
                if searcher.is_ls_ever_converged and not self._ever_converged_per_learner[estimator]:
                    self._ever_converged_per_learner[estimator] = searcher.is_ls_ever_converged
                <a id="change">if </a><a id="change">all(self._ever_converged_per_learner.values()) and \
                   self._state.time_from_start &gt; self._warn_threshold * self._time_taken_best_iter</a>:
                    logger.warn("All estimator hyperparameters local search has converged at least once, "
                                f"and the total search time exceeds {self._warn_threshold} times the time taken "
                                "to find the best model.")
                    self._warn_threshold<a id="change"> *= </a>10
            else:
                logger.info(f"no enough budget for learner {estimator}")
                if self._estimator_index is not None:</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/microsoft/flaml/commit/10082b9262a862ef51cf09117bc5d13e43d1ca0d#diff-47aff7bcc3e528c362ea162261b640e1e276e2bce981dfafc6cce49d3d81e324L1165' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 48508729</div><div id='project'> Project Name: microsoft/flaml</div><div id='commit'> Commit Name: 10082b9262a862ef51cf09117bc5d13e43d1ca0d</div><div id='time'> Time: 2021-08-11</div><div id='author'> Author: qw2ky@virginia.edu</div><div id='file'> File Name: flaml/automl.py</div><div id='m_class'> M Class Name: AutoML</div><div id='n_method'> N Class Name: AutoML</div><div id='m_method'> M Method Name: _search(1)</div><div id='n_method'> N Method Name: _search(1)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: flaml/automl.py</div><div id='n_file'> N File Name: flaml/automl.py</div><div id='m_start'> M Start Line: 1187</div><div id='m_end'> M End Line: 1399</div><div id='n_start'> N Start Line: 1203</div><div id='n_end'> N End Line: 1454</div><BR>