<html><h3>Pattern ID :28604
</h3><img src='84474440.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>

    seconds_per_beat = 60 / DEFAULT_TEMPO
    seconds_per_tick = seconds_per_beat / float(ticks_per_beat)
    ticks_per_second = <a id="change">float(</a>ticks_per_beat<a id="change">)</a> / seconds_per_beat

    &#47&#47 get specific time for notes
    notes = []
    i = 0
    st = 0
    while i &lt; len(temp_notes):
        pitch = temp_notes[i]
        j = i
        while j + 1 &lt; len(temp_notes) and temp_notes[j + 1] == pitch:
            j += 1
        duration = int((j - i + 1) * ticks_per_second / rate)
        &#47&#47 duration (end time)
        ed = st + duration
        st = ed
        notes.append(
            miditoolkit.midi.containers.Note(
                start=st, end=ed, pitch=pitch, velocity=DEFAULT_VELOCITY
            )
        )
        i = j + 1

    &#47&#47 get specific time for tempos
    tempos = []
    i = 0
    st = 0
    while i &lt; len(temp_tempos):
        bpm = temp_tempos[i]
        j = i
        while j + 1 &lt; len(temp_tempos) and temp_tempos[j + 1] == bpm:
            j += 1
        duration = int((j - i + 1) * ticks_per_second / rate)
        tempos.append(
            miditoolkit.midi.containers.TempoChange(bpm, st)
        )
        st<a id="change"> = </a>st + duration
        i = j + 1

    &#47&#47 write</code></pre><h3>After Change</h3><pre><code class='java'>
        bpm = temp_tempos[i]
        if bpm == 0 :
            bpm = DEFAULT_TEMPO
        ticks_per_second = DEFAULT_RESOLUTION<a id="change"> * bpm / </a>60
        &#47&#47 acc_time += ( i - last_i) / rate
        
        &#47&#47int( i  * ticks_per_second / rate)
        j = i
        while j + 1 &lt; len(temp_tempos) and temp_tempos[j + 1] == bpm:
            j += 1
        tempos.append(
            miditoolkit.midi.containers.TempoChange(bpm, acc_tick)
        )
        acc_tick<a id="change"> += </a><a id="change">int(</a>( j - last_i + 1)   * ticks_per_second / rate<a id="change">)</a>
        last_i = j
        i = j + 1
    tick_to_time = get_tick_to_time_mapping(ticks_per_beat, tempos)
</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 6</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/sjtmusicteam/muskits/commit/6d602b1150c42852c587245c54b9412824d1a842#diff-fa0e8b40b7d4f3b12f66685446b0d3165f6e397b28b96f892aa8a2fde7b74972L54' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 84474440</div><div id='project'> Project Name: sjtmusicteam/muskits</div><div id='commit'> Commit Name: 6d602b1150c42852c587245c54b9412824d1a842</div><div id='time'> Time: 2021-09-17</div><div id='author'> Author: 934356561@qq.com</div><div id='file'> File Name: muskit/fileio/utils.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: seq_to_midi(6)</div><div id='n_method'> N Method Name: seq_to_midi(6)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: muskit/fileio/utils.py</div><div id='n_file'> N File Name: muskit/fileio/utils.py</div><div id='m_start'> M Start Line: 54</div><div id='m_end'> M End Line: 98</div><div id='n_start'> N Start Line: 88</div><div id='n_end'> N End Line: 141</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
                stream = av_video.streams.video[0]
                n_frames = stream.frames
                duration = stream.duration
                duration<a id="change"> *= </a><a id="change">float(</a>stream.time_base<a id="change">)</a>
                fps = n_frames / duration

            timestamps.append([i * fps for i in range(n_frames)])
            fpss.append(fps)</code></pre><h3>After Change</h3><pre><code class='java'>
            &#47&#47 estimated timestamps are not correct.
            with av.open(instance) as av_video:
                stream = av_video.streams.video[0]
                duration = stream.duration<a id="change"> * </a>stream.time_base
                fps = stream.base_rate
                n_frames<a id="change"> = </a><a id="change">int(</a>int(duration)<a id="change"> * </a>fps<a id="change">)</a>

            timestamps.append([Fraction(i, fps) for i in range(n_frames)])
            fpss.append(fps)
        else:</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/lightly-ai/lightly/commit/18e5b071ca50986a84cf1bc48a33ad6164ef7492#diff-4bb17e004c846c55984590334464045b748859d9c86659638fdad2dc71667cadL163' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 84474188</div><div id='project'> Project Name: lightly-ai/lightly</div><div id='commit'> Commit Name: 18e5b071ca50986a84cf1bc48a33ad6164ef7492</div><div id='time'> Time: 2020-12-17</div><div id='author'> Author: igor_7779@hotmail.com</div><div id='file'> File Name: lightly/data/_video.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: _make_dataset(4)</div><div id='n_method'> N Method Name: _make_dataset(4)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: lightly/data/_video.py</div><div id='n_file'> N File Name: lightly/data/_video.py</div><div id='m_start'> M Start Line: 214</div><div id='m_end'> M End Line: 220</div><div id='n_start'> N Start Line: 191</div><div id='n_end'> N End Line: 196</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        self.bb = self.add_weight(name="positional_embedding", shape=(kk_blocks, num_heads), initializer="zeros", trainable=True)
        strides = int(tf.math.ceil(tf.math.sqrt(float(kk_blocks / qq_blocks))))
        q_blocks_h = q_blocks_w = int(tf.math.sqrt(float(qq_blocks)))
        k_blocks_h = k_blocks_w<a id="change"> = </a>int(tf.math.sqrt(<a id="change">float(</a>kk_blocks<a id="change">)</a>))

        x1, y1 = tf.meshgrid(range(q_blocks_h), range(q_blocks_w))
        x2, y2 = tf.meshgrid(range(k_blocks_h), range(k_blocks_w))</code></pre><h3>After Change</h3><pre><code class='java'>

        strides = int(tf.math.ceil(tf.math.sqrt(float(kk_blocks / qq_blocks))))
        if self.key_height == -1:
            k_blocks_h = q_blocks_h<a id="change"> * </a>strides
            while kk_blocks % k_blocks_h != 0:
                k_blocks_h -= 1
            k_blocks_w<a id="change"> = </a><a id="change">int(</a>kk_blocks<a id="change"> / </a>k_blocks_h<a id="change">)</a>
        else:
            k_blocks_h, k_blocks_w = self.key_height, int(kk_blocks / self.key_height)
        self.k_blocks_h, self.k_blocks_w = k_blocks_h, k_blocks_w
        &#47&#47 print(f"{q_blocks_h = }, {q_blocks_w = }, {k_blocks_h = }, {k_blocks_w = }, {strides = }")</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/leondgarse/keras_cv_attention_models/commit/4b675139fef68fbaf97bd575c11ea1736ee6de94#diff-419ea771811e38fb2e106cf19724ad992d4d6f2fbae3c511c734548a78b6d63bL22' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 84474273</div><div id='project'> Project Name: leondgarse/keras_cv_attention_models</div><div id='commit'> Commit Name: 4b675139fef68fbaf97bd575c11ea1736ee6de94</div><div id='time'> Time: 2022-07-22</div><div id='author'> Author: leondgarse@gmail.com</div><div id='file'> File Name: keras_cv_attention_models/levit/levit.py</div><div id='m_class'> M Class Name: MultiHeadPositionalEmbedding</div><div id='n_method'> N Class Name: MultiHeadPositionalEmbedding</div><div id='m_method'> M Method Name: build(2)</div><div id='n_method'> N Method Name: build(2)</div><div id='m_parent_class'> M Parent Class: keras.layers.Layer</div><div id='n_parent_class'> N Parent Class: keras.layers.Layer</div><div id='m_file'> M File Name: keras_cv_attention_models/levit/levit.py</div><div id='n_file'> N File Name: keras_cv_attention_models/levit/levit.py</div><div id='m_start'> M Start Line: 26</div><div id='m_end'> M End Line: 27</div><div id='n_start'> N Start Line: 27</div><div id='n_end'> N End Line: 40</div><BR>