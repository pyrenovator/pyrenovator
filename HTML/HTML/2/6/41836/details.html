<html><h3>Pattern ID :41836
</h3><img src='117243308.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>

        &#47&#47 setting the device

        if not exists(accelerator) and <a id="change">not</a> exists(device):
            diffusion_prior_device<a id="change"> = </a><a id="change">next(</a>diffusion_prior.parameters()<a id="change">)</a>.device
            self.print(f&quotaccelerator not given, and device not specified: defaulting to device of diffusion prior parameters - {diffusion_prior_device}&quot)
            self.device = diffusion_prior_device
        else:</code></pre><h3>After Change</h3><pre><code class='java'>

        &#47&#47 mixed precision checks

        <a id="change">if </a>(
            exists(self.accelerator) 
            and <a id="change">self.accelerator.distributed_type == DistributedType.DEEPSPEED</a> 
            and self.diffusion_prior.clip is not None
            ):
            &#47&#47 Then we need to make sure clip is using the correct precision or else deepspeed will error
            cast_type_map<a id="change"> = </a>{
                "fp16": torch.half,
                "bf16": torch.bfloat16,
                "no": torch.float</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 6</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/lucidrains/dalle2-pytorch/commit/f9423d308b6f36e51152c2c45045ff4ebb308287#diff-617450527162fa367141dbf45e8b201673573479820af0ffc56ba93b7f70947fL177' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 117243308</div><div id='project'> Project Name: lucidrains/dalle2-pytorch</div><div id='commit'> Commit Name: f9423d308b6f36e51152c2c45045ff4ebb308287</div><div id='time'> Time: 2022-07-20</div><div id='author'> Author: 51308183+nousr@users.noreply.github.com</div><div id='file'> File Name: dalle2_pytorch/trainer.py</div><div id='m_class'> M Class Name: DiffusionPriorTrainer</div><div id='n_method'> N Class Name: DiffusionPriorTrainer</div><div id='m_method'> M Method Name: __init__(10)</div><div id='n_method'> N Method Name: __init__(12)</div><div id='m_parent_class'> M Parent Class: nn.Module</div><div id='n_parent_class'> N Parent Class: nn.Module</div><div id='m_file'> M File Name: dalle2_pytorch/trainer.py</div><div id='n_file'> N File Name: dalle2_pytorch/trainer.py</div><div id='m_start'> M Start Line: 182</div><div id='m_end'> M End Line: 240</div><div id='n_start'> N Start Line: 177</div><div id='n_end'> N End Line: 246</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
            dataiter = iter(dataloader)
            &#47&#47 Set encoder and decoder to be in training mode

            for step in range(1, num_batches_per_epoch<a id="change"> + </a>1):
                batch<a id="change"> = </a><a id="change">next(</a>dataiter<a id="change">)</a>
                &#47&#47 Construct batch (currently just using Torch&quots default batch-creator)
                contexts, targets, traj_ts_info, extra_context = self.unpack_batch(batch)

                &#47&#47 Use an algorithm-specific augmentation strategy to augment either</code></pre><h3>After Change</h3><pre><code class='java'>
            loss_record.append(loss_meter.avg)

            epochs_trained += 1
            <a id="change">if epochs_trained &gt;= training_epochs</a>:
                training_complete<a id="change"> = </a>True

            should_save_checkpoint = (training_complete or
                                      epochs_trained % self.save_interval == 0)</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/humancompatibleai/eirli/commit/a862749c9f67968ddec51d83ceb5ff286517ab57#diff-da75b71a2421881ac87f16bdedbc66a6eee21a60650cb052fb123cfe1436b72fL204' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 117243309</div><div id='project'> Project Name: humancompatibleai/eirli</div><div id='commit'> Commit Name: a862749c9f67968ddec51d83ceb5ff286517ab57</div><div id='time'> Time: 2020-11-10</div><div id='author'> Author: codywild@berkeley.edu</div><div id='file'> File Name: src/il_representations/algos/representation_learner.py</div><div id='m_class'> M Class Name: RepresentationLearner</div><div id='n_method'> N Class Name: RepresentationLearner</div><div id='m_method'> M Method Name: learn(4)</div><div id='n_method'> N Method Name: learn(4)</div><div id='m_parent_class'> M Parent Class: BaseEnvironmentLearner</div><div id='n_parent_class'> N Parent Class: BaseEnvironmentLearner</div><div id='m_file'> M File Name: src/il_representations/algos/representation_learner.py</div><div id='n_file'> N File Name: src/il_representations/algos/representation_learner.py</div><div id='m_start'> M Start Line: 224</div><div id='m_end'> M End Line: 332</div><div id='n_start'> N Start Line: 224</div><div id='n_end'> N End Line: 336</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
            dataiter = iter(dataloader)
            &#47&#47 Set encoder and decoder to be in training mode

            for step in range(1, num_batches_per_epoch<a id="change"> + </a>1):
                batch<a id="change"> = </a><a id="change">next(</a>dataiter<a id="change">)</a>
                &#47&#47 Construct batch (currently just using Torch&quots default batch-creator)
                contexts, targets, traj_ts_info, extra_context = self.unpack_batch(batch)

                &#47&#47 Use an algorithm-specific augmentation strategy to augment either</code></pre><h3>After Change</h3><pre><code class='java'>
            loss_record.append(loss_meter.avg)

            epochs_trained += 1
            <a id="change">if epochs_trained &gt;= training_epochs</a>:
                training_complete<a id="change"> = </a>True

            should_save_checkpoint = (training_complete or
                                      epochs_trained % self.save_interval == 0)</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/humancompatibleai/eirli/commit/406d01948fae64f0ec8b970402ffc13856832c28#diff-da75b71a2421881ac87f16bdedbc66a6eee21a60650cb052fb123cfe1436b72fL204' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 117243299</div><div id='project'> Project Name: humancompatibleai/eirli</div><div id='commit'> Commit Name: 406d01948fae64f0ec8b970402ffc13856832c28</div><div id='time'> Time: 2020-11-10</div><div id='author'> Author: codywild@berkeley.edu</div><div id='file'> File Name: src/il_representations/algos/representation_learner.py</div><div id='m_class'> M Class Name: RepresentationLearner</div><div id='n_method'> N Class Name: RepresentationLearner</div><div id='m_method'> M Method Name: learn(4)</div><div id='n_method'> N Method Name: learn(4)</div><div id='m_parent_class'> M Parent Class: BaseEnvironmentLearner</div><div id='n_parent_class'> N Parent Class: BaseEnvironmentLearner</div><div id='m_file'> M File Name: src/il_representations/algos/representation_learner.py</div><div id='n_file'> N File Name: src/il_representations/algos/representation_learner.py</div><div id='m_start'> M Start Line: 224</div><div id='m_end'> M End Line: 332</div><div id='n_start'> N Start Line: 224</div><div id='n_end'> N End Line: 336</div><BR>