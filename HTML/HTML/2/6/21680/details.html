<html><h3>Pattern ID :21680
</h3><img src='69188191.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
        super(CEM, self).__init__()
        self.conv1 = conv_block(channels[0], fea_channel, kernel_size=1, padding=0, relu=False)
        self.conv2 = nn.Sequential(
            conv_block(<a id="change">channels[1]</a>, fea_channel, kernel_size=1, padding=0, relu=False),
            nn.Upsample(scale_factor=2, mode=&quotnearest&quot),
            )
        self.conv3 = nn.Sequential(</code></pre><h3>After Change</h3><pre><code class='java'>
    def __init__(self, channels, fea_channel, conv_block):
        super(CEM, self).__init__()
        for i, c in enumerate(channels):
            layer_name<a id="change"> = </a>f&quotconv{i+1}&quot
            if i == 0:
                layer = conv_block(c, fea_channel, kernel_size=1, relu=False)
            else:
                layer = nn.Sequential(
                    conv_block(c, fea_channel, kernel_size=1, relu=False),
                    nn.Upsample(scale_factor=2**i, mode=&quotnearest&quot),
                )
            <a id="change">self.add_module(</a>layer_name, layer<a id="change">)</a>

        layer_name<a id="change"> = </a>f&quotconv{i+2}&quot
        layer = nn.Sequential(
            nn.AdaptiveAvgPool2d(1),
            conv_block(channels[-1], fea_channel, kernel_size=1, relu=False),
        )
        <a id="change">self.add_module(</a>layer_name, layer<a id="change">)</a>
        self.relu = nn.ReLU(inplace=True)

    def forward(self, inputs):
        out = None</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 5</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/zhangheng19931123/mutualguide/commit/77156267d218aaa468e504be0ed373179fc281ee#diff-82f55adf2ae6906fcf8de98581ec0096c67b7949b37c5a59b4e824581f6cb546L14' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 69188191</div><div id='project'> Project Name: zhangheng19931123/mutualguide</div><div id='commit'> Commit Name: 77156267d218aaa468e504be0ed373179fc281ee</div><div id='time'> Time: 2021-11-26</div><div id='author'> Author: zhangheng19931123@gmail.com</div><div id='file'> File Name: models/neck/ssd_neck.py</div><div id='m_class'> M Class Name: CEM</div><div id='n_method'> N Class Name: CEM</div><div id='m_method'> M Method Name: __init__(4)</div><div id='n_method'> N Method Name: __init__(4)</div><div id='m_parent_class'> M Parent Class: nn.Module</div><div id='n_parent_class'> N Parent Class: nn.Module</div><div id='m_file'> M File Name: models/neck/ssd_neck.py</div><div id='n_file'> N File Name: models/neck/ssd_neck.py</div><div id='m_start'> M Start Line: 14</div><div id='m_end'> M End Line: 19</div><div id='n_start'> N Start Line: 14</div><div id='n_end'> N End Line: 30</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        super(CEM, self).__init__()
        self.conv1 = conv_block(channels[0], fea_channel, kernel_size=1, padding=0, relu=False)
        self.conv2 = nn.Sequential(
            conv_block(<a id="change">channels[1]</a>, fea_channel, kernel_size=1, padding=0, relu=False),
            nn.Upsample(scale_factor=2, mode=&quotnearest&quot),
            )
        self.conv3 = nn.Sequential(</code></pre><h3>After Change</h3><pre><code class='java'>
    def __init__(self, channels, fea_channel, conv_block):
        super(CEM, self).__init__()
        for i, c in enumerate(channels):
            layer_name<a id="change"> = </a>f&quotconv{i+1}&quot
            if i == 0:
                layer = conv_block(c, fea_channel, kernel_size=1, relu=False)
            else:
                layer = nn.Sequential(
                    conv_block(c, fea_channel, kernel_size=1, relu=False),
                    nn.Upsample(scale_factor=2**i, mode=&quotnearest&quot),
                )
            <a id="change">self.add_module(</a>layer_name, layer<a id="change">)</a>

        layer_name<a id="change"> = </a>f&quotconv{i+2}&quot
        layer = nn.Sequential(
            nn.AdaptiveAvgPool2d(1),
            conv_block(channels[-1], fea_channel, kernel_size=1, relu=False),
        )
        <a id="change">self.add_module(</a>layer_name, layer<a id="change">)</a>
        self.relu = nn.ReLU(inplace=True)

    def forward(self, inputs):
        out = None</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/zhanghengdev/mutualguide/commit/77156267d218aaa468e504be0ed373179fc281ee#diff-82f55adf2ae6906fcf8de98581ec0096c67b7949b37c5a59b4e824581f6cb546L12' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 69188190</div><div id='project'> Project Name: zhanghengdev/mutualguide</div><div id='commit'> Commit Name: 77156267d218aaa468e504be0ed373179fc281ee</div><div id='time'> Time: 2021-11-26</div><div id='author'> Author: zhangheng19931123@gmail.com</div><div id='file'> File Name: models/neck/ssd_neck.py</div><div id='m_class'> M Class Name: CEM</div><div id='n_method'> N Class Name: CEM</div><div id='m_method'> M Method Name: __init__(4)</div><div id='n_method'> N Method Name: __init__(4)</div><div id='m_parent_class'> M Parent Class: nn.Module</div><div id='n_parent_class'> N Parent Class: nn.Module</div><div id='m_file'> M File Name: models/neck/ssd_neck.py</div><div id='n_file'> N File Name: models/neck/ssd_neck.py</div><div id='m_start'> M Start Line: 14</div><div id='m_end'> M End Line: 19</div><div id='n_start'> N Start Line: 14</div><div id='n_end'> N End Line: 30</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
                    out_channels_list[layer_idx] for layer_idx in block["layers"]
                )
            else:
                out_channels = <a id="change">out_channels_list[block["layers"]]</a>
            curr_out_channels = out_channels

        elif block["type"] == "shortcut":
            module.add_module("shortcut_{}".format(i), EmptyLayer())</code></pre><h3>After Change</h3><pre><code class='java'>
    out_channels_list = []

    for i, block in enumerate(blocks):
        <a id="change">module</a> = torch.nn.Sequential()

        if block["type"] == "convolutional":
            batch_normalize = "batch_normalize" in block
            bias = not batch_normalize
            kernel_size = block["size"]
            padding = (kernel_size - 1) // 2 if "pad" in block else 0
            in_channels = prev_layer_out_channels
            out_channels = block["filters"]

            conv = torch.nn.Conv2d(
                in_channels=in_channels, out_channels=out_channels,
                kernel_size=kernel_size, stride=block["stride"],
                padding=padding, bias=bias
            )
            module.add_module("conv_{}".format(i), conv)

            if batch_normalize:
                bn = torch.nn.BatchNorm2d(num_features=out_channels)
                module.add_module("batch_norm_{}".format(i), bn)

            if block["activation"] == "leaky":
                acti = torch.nn.LeakyReLU(negative_slope=0.1, inplace=True)
                module.add_module("leaky_{}".format(i), acti)

            &#47&#47 Update the number of current (output) channels.
            curr_out_channels = out_channels
        
        elif block["type"] == "maxpool":
            stride = block["stride"]
            maxpool<a id="change"> = </a>MaxPool2dPad(
                kernel_size=block["size"], stride=stride
            )
            pdb.set_trace()
            <a id="change">module.add_module(</a>"maxpool_{}".format(i), maxpool<a id="change">)</a>

        elif block["type"] == "route":
            module.add_module("route_{}".format(i), EmptyLayer())

            out_channels = sum(
                out_channels_list[layer_idx] for layer_idx in block["layers"]
            )

            curr_out_channels = out_channels

        elif block["type"] == "shortcut":
            module.add_module("shortcut_{}".format(i), EmptyLayer())

        elif block["type"] == "upsample":
            &#47&#47 TODO: Upsample is deprecated in favor of Interpolate; consider
            &#47&#47 using this and/or other interpolation methods?
            upsample = torch.nn.Upsample(
                scale_factor=block["stride"], mode="nearest"
            )
            module.add_module("upsample_{}".format(i), upsample)

        elif block["type"] == "yolo":
            anchors<a id="change"> = </a>[block["anchors"][idx] for idx in block["mask"]]
            <a id="change">module.add_module(</a>"yolo_{}".format(i), YOLOLayer(anchors)<a id="change">)</a>

        modules.append(module)
        prev_layer_out_channels = curr_out_channels
        out_channels_list.append(curr_out_channels)</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/nrsyed/pytorch-yolov3/commit/53b6d3990dbd9b11f39926c6ea780926a493e9e4#diff-31cc18a53d5b8fedb96834a67a29230fa9b0941beceb2bf9ce43eb893a3080b9L83' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 69188187</div><div id='project'> Project Name: nrsyed/pytorch-yolov3</div><div id='commit'> Commit Name: 53b6d3990dbd9b11f39926c6ea780926a493e9e4</div><div id='time'> Time: 2020-03-15</div><div id='author'> Author: najam.r.syed@gmail.com</div><div id='file'> File Name: darknet.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: blocks2modules(2)</div><div id='n_method'> N Method Name: blocks2modules(2)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: darknet.py</div><div id='n_file'> N File Name: darknet.py</div><div id='m_start'> M Start Line: 88</div><div id='m_end'> M End Line: 153</div><div id='n_start'> N Start Line: 116</div><div id='n_end'> N End Line: 187</div><BR>