<html><h3>Pattern ID :3125
</h3><img src='11971943.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
        
        

        <a id="change">return {
            </a>&quotinput_ids&quot: torch.randint(0, self.config[&quotn_token&quot], (BATCH_SIZE, SEQ_LEN)),
            &quotpast_key_values&quot: tuple([torch.zeros(self.config[&quotpast_key_values&quot], BATCH_SIZE, self.config[&quotn_head&quot], SEQ_LEN, self.config[&quotd_head&quot]) for _ in range(self.config[&quotn_layer&quot])])<a id="change">
        }</a>


class MemTransformerLMOnnxModel(OnnxModel):
    MemTransformerLM that enables addtiional ONNX optimizations.</code></pre><h3>After Change</h3><pre><code class='java'>
        input_ids = torch.randint(0, self.config.n_token, (self.batch_size, self.seq_len))
        past_key_values =  tuple([torch.zeros(self.config.past_key_values, self.batch_size, self.config.n_head, self.seq_len, self.config.d_head) for _ in range(self.config.n_layer)])

        common_mockups<a id="change"> = </a><a id="change">OrderedDict({</a>&quotinput_ids&quot: input_ids, &quotpast_key_values&quot: past_key_values<a id="change">}</a><a id="change">)</a>
        
        <a id="change">return </a>common_mockups

    
class MemTransformerLMOnnxModel(OnnxModel):</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 4</div><BR><div id='size'>Non-data size: 6</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/microsoft/archai/commit/a3a8fba1e1034fb7c5402560948d5c759fdc73bb#diff-f64e4fc33dbe5d004cd151a4445566a4a3dff25cb57581d79d3133887b07ab4cL48' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 11971943</div><div id='project'> Project Name: microsoft/archai</div><div id='commit'> Commit Name: a3a8fba1e1034fb7c5402560948d5c759fdc73bb</div><div id='time'> Time: 2022-12-16</div><div id='author'> Author: gth.rosa@uol.com.br</div><div id='file'> File Name: archai/nlp/models/mem_transformer/onnx_mem_transformer.py</div><div id='m_class'> M Class Name: MemTransformerLMOnnxConfig</div><div id='n_method'> N Class Name: MemTransformerLMOnnxConfig</div><div id='m_method'> M Method Name: mockups(1)</div><div id='n_method'> N Method Name: mockups(1)</div><div id='m_parent_class'> M Parent Class: OnnxConfig</div><div id='n_parent_class'> N Parent Class: OnnxConfig</div><div id='m_file'> M File Name: archai/nlp/models/mem_transformer/onnx_mem_transformer.py</div><div id='n_file'> N File Name: archai/nlp/models/mem_transformer/onnx_mem_transformer.py</div><div id='m_start'> M Start Line: 60</div><div id='m_end'> M End Line: 63</div><div id='n_start'> N Start Line: 48</div><div id='n_end'> N End Line: 53</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>

        

        <a id="change">return {
            </a>&quotinput_ids&quot: torch.randint(0, self.config[&quotn_token&quot], (BATCH_SIZE, SEQ_LEN))<a id="change">,
        }</a>

    @property
    def inputs(self) -&gt; OrderedDict:
        Defines the inputs and their shapes to be used when exporting to ONNX.</code></pre><h3>After Change</h3><pre><code class='java'>
    @property
    def mockups(self) -&gt; Mapping[str, torch.Tensor]:
        input_ids = torch.randint(0, self.config.n_token, (self.batch_size, self.seq_len))
        common_mockups<a id="change"> = </a><a id="change">OrderedDict({</a>&quotinput_ids&quot: input_ids<a id="change">}</a><a id="change">)</a>
        
        <a id="change">return </a>common_mockups

    @property
    def inputs(self) -&gt; Mapping[str, Mapping[int, str]]:</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/microsoft/archai/commit/5865865a1b4ecc482048f5ec8de9fa33a4c9247d#diff-93171255c4cae472202ed874e4a24794d07d6d10b9959a37d04bc910d7a03bf6L63' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 11971975</div><div id='project'> Project Name: microsoft/archai</div><div id='commit'> Commit Name: 5865865a1b4ecc482048f5ec8de9fa33a4c9247d</div><div id='time'> Time: 2022-12-16</div><div id='author'> Author: gth.rosa@uol.com.br</div><div id='file'> File Name: archai/nlp/models/config_base.py</div><div id='m_class'> M Class Name: OnnxConfig</div><div id='n_method'> N Class Name: OnnxConfig</div><div id='m_method'> M Method Name: mockups(1)</div><div id='n_method'> N Method Name: mockups(1)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: archai/nlp/models/config_base.py</div><div id='n_file'> N File Name: archai/nlp/models/config_base.py</div><div id='m_start'> M Start Line: 71</div><div id='m_end'> M End Line: 73</div><div id='n_start'> N Start Line: 97</div><div id='n_end'> N End Line: 100</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
    &#47&#47 df.columns = ["t"] + ["input_{}".format(num) for num in list(range(len(lags.columns)))] + \
    &#47&#47              ["target_{}".format(num) for num in list(range(len(targets.columns)))]
    &#47&#47 return df
    inputs = <a id="change">[</a>lags<a id="change"></a>]
    input_names = ["lags"]
    if n_trend == 1:
        inputs += [time]
        input_names += ["trend"]
    elif n_trend &gt; 1:
        raise NotImplementedError
    <a id="change">return </a>inputs, input_names, targets


def check_dataframe(df):</code></pre><h3>After Change</h3><pre><code class='java'>
    &#47&#47 time = np.expand_dims(time, axis=1)

    &#47&#47 data is stored in OrderedDict
    inputs<a id="change"> = </a><a id="change">OrderedDict({</a>"time": time<a id="change">}</a><a id="change">)</a>

    if n_lags &gt; 0:
        lags = np.array([series[i: i + n_lags] for i in range(n_samples)])
        inputs["lags"] = lags
    &#47&#47 if n_changepoints &gt; 0:
    &#47&#47     inputs["n_changepoints"] = breakpoint_passed
    &#47&#47     raise NotImplementedError

    targets = None
    if n_forecasts &gt; 0:
        targets = [series[i + n_lags: i + n_lags + n_forecasts] for i in range(n_samples)]
        targets = np.array(targets)
        &#47&#47 else:
        &#47&#47 targets = [[None] * n_samples]
        &#47&#47 targets = np.array(targets)

    if verbose:
        for key, value in inputs.items():
            print(key, "shape: ", value.shape)
    <a id="change">return </a>inputs, targets


def check_dataframe(df):</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/ourownstory/neural_prophet/commit/384f1803a758d07de17db9631d9941c4d7a65de3#diff-8909e3372a9dbfa9801c78cdd6a93d8a7cebb2034e9fd6e129d6aab402e2db96L125' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 11971956</div><div id='project'> Project Name: ourownstory/neural_prophet</div><div id='commit'> Commit Name: 384f1803a758d07de17db9631d9941c4d7a65de3</div><div id='time'> Time: 2020-05-19</div><div id='author'> Author: oskar.triebe@merantix.com</div><div id='file'> File Name: code/make_dataset.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: tabularize_univariate_datetime(4)</div><div id='n_method'> N Method Name: tabularize_univariate_datetime(5)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: code/make_dataset.py</div><div id='n_file'> N File Name: code/make_dataset.py</div><div id='m_start'> M Start Line: 125</div><div id='m_end'> M End Line: 176</div><div id='n_start'> N Start Line: 152</div><div id='n_end'> N End Line: 184</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
            for each state dicts at this position.
    
    max_depth = 0
    sorted_state_dicts = <a id="change">[</a>[]<a id="change"></a>] * len(override_name2state_dict)

    for override_key, override_state_dict in override_name2state_dict.items():
        depth = len(override_key.split(&quot.&quot)) - 1
        sorted_state_dicts[depth].append(override_state_dict)
        max_depth = depth if depth &gt; max_depth else max_depth

    sorted_state_dicts = sorted_state_dicts[: max_depth + 1]
    <a id="change">return </a>sorted_state_dicts


def get_state_dict_with_prefix(prefix: str, </code></pre><h3>After Change</h3><pre><code class='java'>
    for override_key, override_state_dict in override_name2state_dict.items():
        depth = len(override_key.split(&quot.&quot)) - 1
        if depth not in depth2override_state_dicts:
            depth2override_state_dicts[depth] = <a id="change">[</a>override_state_dict<a id="change"></a>]
        else:
            depth2override_state_dicts[depth].append(override_state_dict)
    depth2override_state_dicts<a id="change"> = </a><a id="change">OrderedDict(</a>sorted(depth2override_state_dicts.items())<a id="change">)</a>
    <a id="change">return </a>depth2override_state_dicts


def get_state_dict_with_prefix(prefix: str, </code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/eora-ai/torchok/commit/961bcf5658d68296a207353f876289a489c7a62c#diff-1ad4e7223c13ccce6aade94bf0c56df0fa7e83e39e7891185142032a53f5e4b2L26' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 11971973</div><div id='project'> Project Name: eora-ai/torchok</div><div id='commit'> Commit Name: 961bcf5658d68296a207353f876289a489c7a62c</div><div id='time'> Time: 2022-07-04</div><div id='author'> Author: rashit.bayazitov.1995@gmail.com</div><div id='file'> File Name: src/constructor/load.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: sort_state_dict_by_depth(1)</div><div id='n_method'> N Method Name: sort_state_dict_by_depth(1)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: src/constructor/load.py</div><div id='n_file'> N File Name: src/constructor/load.py</div><div id='m_start'> M Start Line: 37</div><div id='m_end'> M End Line: 46</div><div id='n_start'> N Start Line: 38</div><div id='n_end'> N End Line: 47</div><BR>