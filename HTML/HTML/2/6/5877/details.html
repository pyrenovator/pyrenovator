<html><h3>Pattern ID :5877
</h3><img src='20769916.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
            ent_token_len = len(ent2token)
            token_start_index = 0 if ent_token_len &gt; 0 else - 1
            while token_start_index != -1:
                <a id="change">try:
                    </a>token_start_index<a id="change"> = </a>text2tokens.index(ent2token[0], token_start_index)
                    if text2tokens[token_start_index:token_start_index + ent_token_len] == ent2token:
                        break
                    else:
                        token_start_index = text2tokens.index(ent2token[0], token_start_index + 1)
                <a id="change">except </a>ValueError:
                    print(f&quot[{ent}] 无法对应到 [{text}] 的token_span，已丢弃&quot)
                    token_start_index = -1
            </code></pre><h3>After Change</h3><pre><code class='java'>

            &#47&#47 寻找ent的token_span
            token_start_indexs = [i for i,v in enumerate(text2tokens) if v==ent2token[0]]
            token_end_indexs = <a id="change">[i for i,v in enumerate(text2tokens) if v==ent2token[-1]]</a>
            
            token_start_index = list(filter(lambda x:token2char_span_mapping[x][0] == ent_span[0], token_start_indexs))
            token_end_index<a id="change"> = </a>list(filter(lambda x:token2char_span_mapping[x][-1]-1 == ent_span[1], token_end_indexs)) &#47&#47 token2char_span_mapping[x][-1]-1 减1是因为原始的char_span是闭区间，而token2char_span是开区间

            if len(token_start_index)==0 or len(token_end_index)==0:
                print(f&quot[{ent}] 无法对应到 [{text}] 的token_span，已丢弃&quot)</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 5</div><BR><div id='size'>Non-data size: 6</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/gaohongkui/globalpointer_pytorch/commit/5146e4d180d865b94c8e0d173320f021df21498d#diff-a9ca103e95ab74ef9bae0986b5cc4c9f3230e50b062e7855c929b211a1d038a5L42' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 20769916</div><div id='project'> Project Name: gaohongkui/globalpointer_pytorch</div><div id='commit'> Commit Name: 5146e4d180d865b94c8e0d173320f021df21498d</div><div id='time'> Time: 2021-07-31</div><div id='author'> Author: 1427224680@qq.com</div><div id='file'> File Name: common/utils.py</div><div id='m_class'> M Class Name: Preprocessor</div><div id='n_method'> N Class Name: Preprocessor</div><div id='m_method'> M Method Name: get_ent2token_spans(3)</div><div id='n_method'> N Method Name: get_ent2token_spans(3)</div><div id='m_parent_class'> M Parent Class: object</div><div id='n_parent_class'> N Parent Class: object</div><div id='m_file'> M File Name: common/utils.py</div><div id='n_file'> N File Name: common/utils.py</div><div id='m_start'> M Start Line: 42</div><div id='m_end'> M End Line: 68</div><div id='n_start'> N Start Line: 42</div><div id='n_end'> N End Line: 58</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
            if p.returncode != 0:
                raise Exception("dvipng error", serr)

            <a id="change">try:
                </a>depth<a id="change"> = </a>int(re.search(r"\[1 depth=(-?\d+)\]", sout).group(1))
            <a id="change">except</a>:
                depth = 0

            png = open(pngfile, "rb").read()</code></pre><h3>After Change</h3><pre><code class='java'>
            if p.returncode != 0:
                raise Exception(&quotPDFpng error&quot, serr)

            png<a id="change">=</a><a id="change">[open(pngfile.replace(&quot.png&quot, &quot&quot)+&quot-%i.png&quot % i, &quotrb&quot).read() for i in range(len(self.math))]</a>
            return png

        finally:
            &#47&#47 Cleanup temporaries</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/lukas-blecher/latex-ocr/commit/d4f7bfd36b2751ef8bb0ddd17e3e633d4d072467#diff-fa4089e8a1b4c36ad8263be050d34e31ea1d452268658ee5bc4298c393f1dc64L60' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 20769918</div><div id='project'> Project Name: lukas-blecher/latex-ocr</div><div id='commit'> Commit Name: d4f7bfd36b2751ef8bb0ddd17e3e633d4d072467</div><div id='time'> Time: 2020-12-13</div><div id='author'> Author: luk.blecher@gmx.de</div><div id='file'> File Name: dataset/latex2png.py</div><div id='m_class'> M Class Name: Latex</div><div id='n_method'> N Class Name: Latex</div><div id='m_method'> M Method Name: convert_file(3)</div><div id='n_method'> N Method Name: convert_file(3)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: dataset/latex2png.py</div><div id='n_file'> N File Name: dataset/latex2png.py</div><div id='m_start'> M Start Line: 79</div><div id='m_end'> M End Line: 105</div><div id='n_start'> N Start Line: 69</div><div id='n_end'> N End Line: 90</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        the concatenated values to feed into neural networks

    
    <a id="change">try:
        </a>n_fields<a id="change"> = </a>len(batch[0])
    <a id="change">except </a>Exception:
        raise ValueError("No data")
    ret = []
    for i in range(n_fields):</code></pre><h3>After Change</h3><pre><code class='java'>
    
    if isinstance(batch[0], dict):
        keys = batch[0].keys()
        collated<a id="change"> = </a>_default_collate_fn(<a id="change">[tuple(b[k] for k in keys) for b in batch]</a>)
        return {k: collated[i] for i, k in enumerate(keys)}
    else:
        return _default_collate_fn(batch)</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/deeppsp/torch_ecg/commit/c7cd8be9b8aa243c40c5fe2cdcd799a24fa21b6b#diff-52ed9d3fb708e19d44c401863d1b8254ecde3c6cb0014fc2bf726b1cd0cea01cL678' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 20769912</div><div id='project'> Project Name: deeppsp/torch_ecg</div><div id='commit'> Commit Name: c7cd8be9b8aa243c40c5fe2cdcd799a24fa21b6b</div><div id='time'> Time: 2022-08-02</div><div id='author'> Author: wenh06@gmail.com</div><div id='file'> File Name: torch_ecg/utils/utils_nn.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: default_collate_fn(1)</div><div id='n_method'> N Method Name: default_collate_fn(1)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: torch_ecg/utils/utils_nn.py</div><div id='n_file'> N File Name: torch_ecg/utils/utils_nn.py</div><div id='m_start'> M Start Line: 697</div><div id='m_end'> M End Line: 707</div><div id='n_start'> N Start Line: 699</div><div id='n_end'> N End Line: 706</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>

    def _update(self):
        while self.update_bar.n &lt; self.ndocs:
            <a id="change">try:
                </a>batch<a id="change"> = </a>self.tq.get()
            <a id="change">except</a>:
                break

            if self.func_lock is not None:</code></pre><h3>After Change</h3><pre><code class='java'>
            with self.batch_lock:
                batch = self._get_batch_to_update()

            old_keys<a id="change"> = </a><a id="change">[set(document.keys()) for document in batch]</a>

            if self.func_lock is not None:
                with self.func_lock:
                    new_batch = self.func(batch, *self.func_args, **self.func_kwargs)</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/relevanceai/relevanceai/commit/c88d8a1835da3d3556a1097327289588b51a1789#diff-6381bc42fc96d5408fc21bc0c5e13e7e988d68b4ad1b822e38153923b3d9ccf4L155' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 20769930</div><div id='project'> Project Name: relevanceai/relevanceai</div><div id='commit'> Commit Name: c88d8a1835da3d3556a1097327289588b51a1789</div><div id='time'> Time: 2022-08-22</div><div id='author'> Author: joseph.twin@relevance.ai</div><div id='file'> File Name: relevanceai/operations_new/ops_run.py</div><div id='m_class'> M Class Name: PullUpdatePush</div><div id='n_method'> N Class Name: PullUpdatePush</div><div id='m_method'> M Method Name: _update(1)</div><div id='n_method'> N Method Name: _update(1)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: relevanceai/operations_new/ops_run.py</div><div id='n_file'> N File Name: relevanceai/operations_new/ops_run.py</div><div id='m_start'> M Start Line: 157</div><div id='m_end'> M End Line: 167</div><div id='n_start'> N Start Line: 159</div><div id='n_end'> N End Line: 170</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
    &#47&#47 files = files[:1000]

    for f in tqdm(files):
        <a id="change">try:
            </a>mid<a id="change"> = </a>mido.MidiFile(f)
        <a id="change">except </a>Exception:
            continue
        
        g = (Path(dest_path) / f.relative_to(data_path)).with_suffix(&quot.pkl&quot)</code></pre><h3>After Change</h3><pre><code class='java'>
def main(data_path, dest_path, n_jobs=4):
    data_dir = Path(data_path)
    files = list(data_dir.glob(&quot**/*.mid&quot))
    files_out = <a id="change">[
        (Path(dest_path) / f.relative_to(data_path))
        for f in files]</a>
    parents<a id="change"> = </a>{g.parent for g in files_out}
    for parent in list(parents):
        parent.mkdir(parents=True, exist_ok=True)
</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/intelligent-instruments-lab/iil-python-tools/commit/dbb5cf68b2b6902addf71a598302850beb1473cf#diff-9d738772070de4df243e741743f664299e8ce7ef188e1d5d6f035c83cce242d9L9' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 20769931</div><div id='project'> Project Name: intelligent-instruments-lab/iil-python-tools</div><div id='commit'> Commit Name: dbb5cf68b2b6902addf71a598302850beb1473cf</div><div id='time'> Time: 2022-02-21</div><div id='author'> Author: victor.shepardson@gmail.com</div><div id='file'> File Name: scripts/lakh_prep.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: main(3)</div><div id='n_method'> N Method Name: main(3)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: scripts/lakh_prep.py</div><div id='n_file'> N File Name: scripts/lakh_prep.py</div><div id='m_start'> M Start Line: 11</div><div id='m_end'> M End Line: 43</div><div id='n_start'> N Start Line: 41</div><div id='n_end'> N End Line: 56</div><BR>