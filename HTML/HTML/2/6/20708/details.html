<html><h3>Pattern ID :20708
</h3><img src='66614448.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
            file_feats = feat
        else:
            file_feats = torch.cat((file_feats, feat), 0)
        <a id="change">feat.detach()</a>
    return file_feats


if __name__ == &quot__main__&quot:</code></pre><h3>After Change</h3><pre><code class='java'>
            file_feats = feat
        else:
            file_feats = torch.cat((file_feats, feat), 0)
        s<a id="change"> = time</a><a id="change">.time()</a>
        torch.cuda.empty_cache()
        sys.stdout.write(
            "\r &gt;&gt; {}/{} clearCacheCost: {} ".format(cnt, wholeLen, <a id="change">time.time()</a><a id="change"> - </a>s))
        sys.stdout.flush()
    return file_feats
</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 5</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/leoluopy/groupfacepytorch/commit/f9aba87fa9b8f3d0cd2303ca43be39436932b0a5#diff-e2b054a4371e1ec7f3d6441681e31ec5fa1e22a181e51148fc976bdb9775df95L110' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 66614448</div><div id='project'> Project Name: leoluopy/groupfacepytorch</div><div id='commit'> Commit Name: f9aba87fa9b8f3d0cd2303ca43be39436932b0a5</div><div id='time'> Time: 2021-02-06</div><div id='author'> Author: lpy1990fff</div><div id='file'> File Name: cluster_ims.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: GetAllFilesFeat(1)</div><div id='n_method'> N Method Name: GetAllFilesFeat(1)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: cluster_ims.py</div><div id='n_file'> N File Name: cluster_ims.py</div><div id='m_start'> M Start Line: 110</div><div id='m_end'> M End Line: 118</div><div id='n_start'> N Start Line: 115</div><div id='n_end'> N End Line: 123</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        token_ids = torch.unsqueeze(torch.LongTensor(input_ids), 0).to(self.device)
        attention_mask = torch.unsqueeze(torch.LongTensor(encode_results.get(&quotattention_mask&quot)), 0).to(self.device)
        segment_ids = torch.unsqueeze(torch.LongTensor(encode_results.get(&quottoken_type_ids&quot)), 0).to(self.device)
        model_outputs = <a id="change">self.model(token_ids, attention_mask, segment_ids).detach()</a>.to(&quotcpu&quot)
        model_output = torch.squeeze(model_outputs)
        results = self.data_manager.extract_entities(sentence, model_output)
        results_dict = {}</code></pre><h3>After Change</h3><pre><code class='java'>
        
        预测接口
        
        start_time<a id="change"> = </a><a id="change">time.time()</a>
        encode_results = self.data_manager.tokenizer(sentence, padding=&quotmax_length&quot)
        input_ids = encode_results.get(&quotinput_ids&quot)
        token_ids = torch.unsqueeze(torch.LongTensor(input_ids), 0).to(self.device)
        attention_mask = torch.unsqueeze(torch.LongTensor(encode_results.get(&quotattention_mask&quot)), 0).to(self.device)
        segment_ids = torch.unsqueeze(torch.LongTensor(encode_results.get(&quottoken_type_ids&quot)), 0).to(self.device)
        logits, _ = self.model(token_ids, attention_mask, segment_ids)
        logit = torch.squeeze(logits.to(&quotcpu&quot))
        results = self.data_manager.extract_entities(sentence, logit)
        self.logger.info(&quotpredict time consumption: %.3f(ms)&quot % ((<a id="change">time.time() - </a>start_time) * 1000))
        results_dict = {}
        for class_id, result_set in results.items():
            results_dict[self.data_manager.reverse_categories[class_id]] = list(result_set)</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/stanleylsx/entity_extractor_by_binary_tagging/commit/53fb785dbe629c71f02b0f58a40d3f36e5eb3dc2#diff-37057fd6c2d2a9dd7d0167af43022d320464f2295904468cba54a58d1f90f3b4L25' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 66614440</div><div id='project'> Project Name: stanleylsx/entity_extractor_by_binary_tagging</div><div id='commit'> Commit Name: 53fb785dbe629c71f02b0f58a40d3f36e5eb3dc2</div><div id='time'> Time: 2022-06-08</div><div id='author'> Author: gzlishouxian@gmail.com</div><div id='file'> File Name: engines/predict.py</div><div id='m_class'> M Class Name: Predictor</div><div id='n_method'> N Class Name: Predictor</div><div id='m_method'> M Method Name: predict_one(2)</div><div id='n_method'> N Method Name: predict_one(2)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: engines/predict.py</div><div id='n_file'> N File Name: engines/predict.py</div><div id='m_start'> M Start Line: 31</div><div id='m_end'> M End Line: 35</div><div id='n_start'> N Start Line: 30</div><div id='n_end'> N End Line: 39</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
            file_feats = feat
        else:
            file_feats = torch.cat((file_feats, feat), 0)
        <a id="change">feat.detach()</a>
    return file_feats


if __name__ == &quot__main__&quot:</code></pre><h3>After Change</h3><pre><code class='java'>
            file_feats = feat
        else:
            file_feats = torch.cat((file_feats, feat), 0)
        s<a id="change"> = </a><a id="change">time.time()</a>
        torch.cuda.empty_cache()
        sys.stdout.write(
            "\r &gt;&gt; {}/{} clearCacheCost: {} ".format(cnt, wholeLen, <a id="change">time.time() - </a>s))
        sys.stdout.flush()
    return file_feats
</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/leoluopy/groupfacepytorch/commit/f9aba87fa9b8f3d0cd2303ca43be39436932b0a5#diff-e2b054a4371e1ec7f3d6441681e31ec5fa1e22a181e51148fc976bdb9775df95L103' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 66614449</div><div id='project'> Project Name: leoluopy/groupfacepytorch</div><div id='commit'> Commit Name: f9aba87fa9b8f3d0cd2303ca43be39436932b0a5</div><div id='time'> Time: 2021-02-06</div><div id='author'> Author: lpy1990fff</div><div id='file'> File Name: cluster_ims.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: GetAllFilesFeat(1)</div><div id='n_method'> N Method Name: GetAllFilesFeat(1)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: cluster_ims.py</div><div id='n_file'> N File Name: cluster_ims.py</div><div id='m_start'> M Start Line: 110</div><div id='m_end'> M End Line: 118</div><div id='n_start'> N Start Line: 115</div><div id='n_end'> N End Line: 123</div><BR>