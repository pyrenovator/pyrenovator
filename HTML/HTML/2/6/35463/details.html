<html><h3>Pattern ID :35463
</h3><img src='100748323.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
    fn_tasks: List[str] = dataclasses.field(default_factory=list)

    def tasks_for_fp(self, items: List[Any]) -&gt; Iterable[str]:
        <a id="change">for </a>i, <a id="change">fp_item</a> in <a id="change">enumerate(</a>self.fp_items<a id="change">):
            </a><a id="change">if </a>fp_item in items:
                yield <a id="change">self.fp_tasks[i]</a>

    def tasks_for_fn(self, items: List[Any]) -&gt; Iterable[str]:
        for i, fn_item in enumerate(self.fn_items):
            if fn_item in items:</code></pre><h3>After Change</h3><pre><code class='java'>
        self.fn_items_to_tasks.setdefault(item, set()).add(task)

    def tasks_for_fp(self, items: List[Any]) -&gt; Iterable[str]:
        return <a id="change">(
            task
            for item, tasks in self.fp_items_to_tasks.items()
            for task in tasks
            if item in items
        )</a>

    def tasks_for_fn(self, items: List[Any]) -&gt; Iterable[str]:
        return (
            task</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 5</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/astrazeneca/kazu/commit/2f11a76f871f1fcd91983cc15171db358718d00a#diff-8ca462b963e2e1645fc17134596b12f0d8c2c0bb78bea8503197777b7eb09ae8L155' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 100748323</div><div id='project'> Project Name: astrazeneca/kazu</div><div id='commit'> Commit Name: 2f11a76f871f1fcd91983cc15171db358718d00a</div><div id='time'> Time: 2022-11-30</div><div id='author'> Author: elliot.ford@astrazeneca.com</div><div id='file'> File Name: kazu/tests/test_acceptance_test.py</div><div id='m_class'> M Class Name: AggregatedAccuracyResult</div><div id='n_method'> N Class Name: AggregatedAccuracyResult</div><div id='m_method'> M Method Name: tasks_for_fp(2)</div><div id='n_method'> N Method Name: tasks_for_fp(2)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: kazu/tests/test_acceptance_test.py</div><div id='n_file'> N File Name: kazu/tests/test_acceptance_test.py</div><div id='m_start'> M Start Line: 155</div><div id='m_end'> M End Line: 159</div><div id='n_start'> N Start Line: 167</div><div id='n_end'> N End Line: 172</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
    for s in ss:
      if s != -1:
        tsum *= s
    <a id="change">for </a>i,<a id="change">s</a> in <a id="change">enumerate(</a>ss<a id="change">):
      </a><a id="change">if </a>s == -1:
        <a id="change">ss[i]</a> = np.prod(x.shape) // tsum
    assert np.prod(x.shape) == np.prod(ss)
    x = unary_op(ctx, &quota&quot, x)
    x.shape = tuple(ss)</code></pre><h3>After Change</h3><pre><code class='java'>

    &#47&#47 I&quotm sorry for this code
    tsum = functools.reduce(lambda x,y: x*y, (s for s in shape if s != -1), 1)
    shape = tuple(<a id="change">np</a>.prod(x.shape) // tsum if s == -1 else s for s in shape)
    assert np.prod(x.shape) == np.prod(shape)
    x = unary_op(ctx, &quota&quot, x)
    x.shape = shape</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/geohot/tinygrad/commit/28474949b89bf5b29bb46b0ae0e862a311e3f8fc#diff-b7e8a4d3462e65523c8cfd523079177ad58eb9176481ea76a4dedbe501683059L315' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 100748324</div><div id='project'> Project Name: geohot/tinygrad</div><div id='commit'> Commit Name: 28474949b89bf5b29bb46b0ae0e862a311e3f8fc</div><div id='time'> Time: 2020-11-13</div><div id='author'> Author: 44067540+dustcollector12@users.noreply.github.com</div><div id='file'> File Name: tinygrad/opsgpu.py</div><div id='m_class'> M Class Name: Reshape</div><div id='n_method'> N Class Name: Reshape</div><div id='m_method'> M Method Name: forward(3)</div><div id='n_method'> N Method Name: forward(3)</div><div id='m_parent_class'> M Parent Class: Function</div><div id='n_parent_class'> N Parent Class: Function</div><div id='m_file'> M File Name: tinygrad/opsgpu.py</div><div id='n_file'> N File Name: tinygrad/opsgpu.py</div><div id='m_start'> M Start Line: 317</div><div id='m_end'> M End Line: 329</div><div id='n_start'> N Start Line: 319</div><div id='n_end'> N End Line: 323</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
                yield self.fp_tasks[i]

    def tasks_for_fn(self, items: List[Any]) -&gt; Iterable[str]:
        <a id="change">for </a>i, <a id="change">fn_item</a> in <a id="change">enumerate(</a>self.fn_items<a id="change">):
            </a><a id="change">if </a>fn_item in items:
                yield <a id="change">self.fn_tasks[i]</a>

    @property
    def fp(self):
        return len(self.fp_items)</code></pre><h3>After Change</h3><pre><code class='java'>
        )

    def tasks_for_fn(self, items: List[Any]) -&gt; Iterable[str]:
        return <a id="change">(
            task
            for item, tasks in self.fn_items_to_tasks.items()
            for task in tasks
            if item in items
        )</a>

    @property
    def precision(self):
        div = self.fp + self.tp</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/astrazeneca/kazu/commit/2f11a76f871f1fcd91983cc15171db358718d00a#diff-8ca462b963e2e1645fc17134596b12f0d8c2c0bb78bea8503197777b7eb09ae8L159' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 100748328</div><div id='project'> Project Name: astrazeneca/kazu</div><div id='commit'> Commit Name: 2f11a76f871f1fcd91983cc15171db358718d00a</div><div id='time'> Time: 2022-11-30</div><div id='author'> Author: elliot.ford@astrazeneca.com</div><div id='file'> File Name: kazu/tests/test_acceptance_test.py</div><div id='m_class'> M Class Name: AggregatedAccuracyResult</div><div id='n_method'> N Class Name: AggregatedAccuracyResult</div><div id='m_method'> M Method Name: tasks_for_fn(2)</div><div id='n_method'> N Method Name: tasks_for_fn(2)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: kazu/tests/test_acceptance_test.py</div><div id='n_file'> N File Name: kazu/tests/test_acceptance_test.py</div><div id='m_start'> M Start Line: 160</div><div id='m_end'> M End Line: 164</div><div id='n_start'> N Start Line: 175</div><div id='n_end'> N End Line: 180</div><BR>