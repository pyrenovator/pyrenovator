<html><h3>Pattern ID :9928
</h3><img src='35543390.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
        &#47&#47 收集decoder解码过程中的prediction
        predictions = torch.stack(predictions, dim=1)  &#47&#47 bs*seq_len*1
        predictions = predictions.squeeze(dim=2)  &#47&#47 bs*seq_len
        <a id="change">return </a>predictions

    def critic(self, fake_sequence):
        rDefine the Critic graph which is derived from the seq2seq Discriminator. This will be</code></pre><h3>After Change</h3><pre><code class='java'>
            c = c.contiguous()
            encoder_final_state = (h, c)
        else:
            encoder_outputs<a id="change">, encoder_final_state = self</a><a id="change">.encoder(</a>masked_rnn_inputs, inputs_length<a id="change">)</a>

        seq_len = inputs.size()[1]
        hidden_size = encoder_final_state
        predictions = []
        values = []
        for t in range(seq_len):
            input = sequence_rnn_inputs[:, t, :].unsqueeze(dim=1)  &#47&#47 bs*1*emb_dim
            if self.attention_type is not None:
                encoder_mask = torch.ones_like(inputs)
                rnn_output<a id="change">, hidden_size, _ = self</a><a id="change">.decoder(</a>input, hidden_size, encoder_outputs, encoder_mask<a id="change">)</a>
            else:
                rnn_output, hidden_size = self.decoder(input, hidden_size)
            prediction = self.fc_linear(rnn_output)  &#47&#47 bs*1*1
            prediction = prediction.squeeze(dim=2).squeeze(dim=1)  &#47&#47 bs</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 4</div><BR><div id='size'>Non-data size: 5</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/rucaibox/textbox/commit/cc5517ab006f13503389f456551219a634d7ca28#diff-8c38df79909d6be1910c35532aa80d652bbab509c0abd98b262a4a93c2b7c540L103' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 35543390</div><div id='project'> Project Name: rucaibox/textbox</div><div id='commit'> Commit Name: cc5517ab006f13503389f456551219a634d7ca28</div><div id='time'> Time: 2020-12-26</div><div id='author'> Author: 1318829605@qq.com</div><div id='file'> File Name: textbox/module/Discriminator/MaskGANDiscriminator.py</div><div id='m_class'> M Class Name: MaskGANDiscriminator</div><div id='n_method'> N Class Name: MaskGANDiscriminator</div><div id='m_method'> M Method Name: forward(6)</div><div id='n_method'> N Method Name: forward(6)</div><div id='m_parent_class'> M Parent Class: GenerativeAdversarialNet</div><div id='n_parent_class'> N Parent Class: GenerativeAdversarialNet</div><div id='m_file'> M File Name: textbox/module/Discriminator/MaskGANDiscriminator.py</div><div id='n_file'> N File Name: textbox/module/Discriminator/MaskGANDiscriminator.py</div><div id='m_start'> M Start Line: 118</div><div id='m_end'> M End Line: 138</div><div id='n_start'> N Start Line: 103</div><div id='n_end'> N End Line: 137</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        super().__init__()

    def forward(self, x):
        <a id="change">return </a>x
</code></pre><h3>After Change</h3><pre><code class='java'>
        if mems.ndim == 2:
            mems = repeat(mems, &quotn d -&gt; b n d&quot, b = b)

        enc<a id="change"> = </a><a id="change">self.encoder(</a>src<a id="change">, context = mems)</a>
        out<a id="change"> = </a><a id="change">self.decoder(</a>tgt<a id="change">, context = enc)</a>

        mems = self.mem_updater(mems, enc)
        return out, mems
</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/lucidrains/memformer/commit/f8648dffb97894391d67166550584ddb60f7e413#diff-3739fa9ed5b04cd8606fb4ef1d563baf1344fd72b2610c00224ab2f0b223cd86L10' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 35543388</div><div id='project'> Project Name: lucidrains/memformer</div><div id='commit'> Commit Name: f8648dffb97894391d67166550584ddb60f7e413</div><div id='time'> Time: 2020-10-28</div><div id='author'> Author: lucidrains@gmail.com</div><div id='file'> File Name: memformer/memformer.py</div><div id='m_class'> M Class Name: Memformer</div><div id='n_method'> N Class Name: Memformer</div><div id='m_method'> M Method Name: forward(4)</div><div id='n_method'> N Method Name: forward(2)</div><div id='m_parent_class'> M Parent Class: nn.Module</div><div id='n_parent_class'> N Parent Class: nn.Module</div><div id='m_file'> M File Name: memformer/memformer.py</div><div id='n_file'> N File Name: memformer/memformer.py</div><div id='m_start'> M Start Line: 10</div><div id='m_end'> M End Line: 11</div><div id='n_start'> N Start Line: 150</div><div id='n_end'> N End Line: 161</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        self.args = args

    def forward(self, x: torch.Tensor):
        <a id="change">return </a>self.decoder.generate(torch.LongTensor([self.args.bos_token]*len(x)).to(x.device),
                                     self.args.max_seq_len, eos_token=self.args.eos_token, context=self.encoder(x))

</code></pre><h3>After Change</h3><pre><code class='java'>
        self.args = args

    def forward(self, x: torch.Tensor, tgt_seq: torch.Tensor, **kwargs):
        encoded<a id="change"> = </a><a id="change">self.encoder(</a>x<a id="change">)</a>
        out<a id="change"> = </a><a id="change">self.decoder(</a>tgt_seq<a id="change">, context=encoded, **kwargs)</a>
        return out

    @torch.no_grad()
    def generate(self, x: torch.Tensor):</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/lukas-blecher/latex-ocr/commit/e2b55fb4715f3ab5792f7a1accd07b737c744f96#diff-12f7a2fee1f027defb166ee393c7f1d95d92f6413ae2538b7560b04682dfa7fdL16' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 35543385</div><div id='project'> Project Name: lukas-blecher/latex-ocr</div><div id='commit'> Commit Name: e2b55fb4715f3ab5792f7a1accd07b737c744f96</div><div id='time'> Time: 2022-05-19</div><div id='author'> Author: yuhang.tao.email@gmail.com</div><div id='file'> File Name: pix2tex/models/utils.py</div><div id='m_class'> M Class Name: Model</div><div id='n_method'> N Class Name: Model</div><div id='m_method'> M Method Name: forward(3)</div><div id='n_method'> N Method Name: forward(2)</div><div id='m_parent_class'> M Parent Class: nn.Module</div><div id='n_parent_class'> N Parent Class: nn.Module</div><div id='m_file'> M File Name: pix2tex/models/utils.py</div><div id='n_file'> N File Name: pix2tex/models/utils.py</div><div id='m_start'> M Start Line: 17</div><div id='m_end'> M End Line: 18</div><div id='n_start'> N Start Line: 16</div><div id='n_end'> N End Line: 19</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        super().__init__()

    def forward(self, x):
        <a id="change">return </a>x
</code></pre><h3>After Change</h3><pre><code class='java'>
        )

    def forward(self, src, tgt, mems = None):
        enc<a id="change"> = </a><a id="change">self.encoder(</a>src<a id="change">)</a>
        out<a id="change"> = </a><a id="change">self.decoder(</a>tgt<a id="change">, context = enc)</a>
        return out
</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/lucidrains/x-transformers/commit/b61f9d7e9c6b3af6d669822eb3874fc624982073#diff-2e64ac8840195d7dc3e07a3aac70b50bbab1cdf80f3a7432be40105e6097fc0aL15' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 35543396</div><div id='project'> Project Name: lucidrains/x-transformers</div><div id='commit'> Commit Name: b61f9d7e9c6b3af6d669822eb3874fc624982073</div><div id='time'> Time: 2020-10-28</div><div id='author'> Author: lucidrains@gmail.com</div><div id='file'> File Name: x_transformers/x_transformers.py</div><div id='m_class'> M Class Name: XTransformer</div><div id='n_method'> N Class Name: XTransformer</div><div id='m_method'> M Method Name: forward(4)</div><div id='n_method'> N Method Name: forward(2)</div><div id='m_parent_class'> M Parent Class: nn.Module</div><div id='n_parent_class'> N Parent Class: nn.Module</div><div id='m_file'> M File Name: x_transformers/x_transformers.py</div><div id='n_file'> N File Name: x_transformers/x_transformers.py</div><div id='m_start'> M Start Line: 15</div><div id='m_end'> M End Line: 16</div><div id='n_start'> N Start Line: 145</div><div id='n_end'> N End Line: 148</div><BR>