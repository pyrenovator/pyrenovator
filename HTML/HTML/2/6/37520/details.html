<html><h3>Pattern ID :37520
</h3><img src='108061968.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
    :param actual_folder: The output folder with the actually produced files.
    :param run: An AzureML run
    
    <a id="change">logging.debug(f"Checking job output against expected files in folder {expected_folder}"</a><a id="change">)</a>
    <a id="change">logging.debug(f"Current working directory: {Path.cwd()}"</a><a id="change">)</a>
    messages = []
    if not expected_folder.is_dir():
        raise ValueError(f"Folder with expected files does not exist: {expected_folder}")
    if run and is_offline_run_context(run):</code></pre><h3>After Change</h3><pre><code class='java'>
    messages = []
    if run and is_offline_run_context(run):
        logging.warning("Skipping file comparison because the given run context is an AzureML offline run.")
        return <a id="change">[]</a>
    files_in_run: List[str] = run.get_file_names() if run else []
    temp_folder = Path(tempfile.mkdtemp()) if run else None
    for file in expected_folder.rglob("*"):
        &#47&#47 rglob also returns folders, skip those</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 3</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/microsoft/innereye-deeplearning/commit/be36e392062eadc4863d09867f3b03fcf1b02d9e#diff-6498adfa8b54ae4ec16cc7b14f10dd3fcaaa901256453928908653a9d6019766L237' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 108061968</div><div id='project'> Project Name: microsoft/innereye-deeplearning</div><div id='commit'> Commit Name: be36e392062eadc4863d09867f3b03fcf1b02d9e</div><div id='time'> Time: 2021-06-21</div><div id='author'> Author: antonsc@microsoft.com</div><div id='file'> File Name: InnerEye/ML/baselines_util.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: compare_folder_contents(3)</div><div id='n_method'> N Method Name: compare_folder_contents(3)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: InnerEye/ML/baselines_util.py</div><div id='n_file'> N File Name: InnerEye/ML/baselines_util.py</div><div id='m_start'> M Start Line: 237</div><div id='m_end'> M End Line: 276</div><div id='n_start'> N Start Line: 239</div><div id='n_end'> N End Line: 265</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
    :param actual_folder: The output folder with the actually produced files.
    :param run: An AzureML run
    
    <a id="change">logging.debug(f"Checking job output against expected files in folder {expected_folder}"</a><a id="change">)</a>
    logging.debug(f"Current working directory: {Path.cwd()}")
    messages = []
    if not expected_folder.is_dir():
        raise ValueError(f"Folder with expected files does not exist: {expected_folder}")
    if run and is_offline_run_context(run):
        logging.warning("Skipping file comparison because the given run context is an AzureML offline run.")
        return
    files_in_run: List[str] = run.get_file_names() if run else []
    temp_folder = Path(tempfile.mkdtemp()) if run else None
    for file in expected_folder.rglob("*"):
        &#47&#47 rglob also returns folders, skip those
        if file.is_dir():
            continue
        logging.debug(f"Checking file {file}")
        &#47&#47 All files stored in AzureML runs use Linux-style path
        file_relative = file.relative_to(expected_folder).as_posix()
        if str(file_relative).startswith(REGRESSION_TEST_AZUREML_FOLDER) or \
                str(file_relative).startswith(REGRESSION_TEST_AZUREML_PARENT_FOLDER):
            continue
        actual_file: Optional[Path] = None
        if actual_folder:
            actual_file = actual_folder / file_relative
            if not actual_file.is_file():
                actual_file = None
        elif temp_folder is not None and run is not None:
            if file_relative in files_in_run:
                actual_file = temp_folder / file_relative
                run.download_file(name=str(file_relative), output_file_path=str(actual_file))
        message = compare_files(expected=file, actual=actual_file) if actual_file else "Missing file"
        if message:
            <a id="change">logging.debug(f"Error: {message}"</a><a id="change">)</a>
            messages.append(f"{message}: {file_relative}")
    if temp_folder:
        shutil.rmtree(temp_folder)
    if messages:</code></pre><h3>After Change</h3><pre><code class='java'>
    messages = []
    if run and is_offline_run_context(run):
        logging.warning("Skipping file comparison because the given run context is an AzureML offline run.")
        return <a id="change">[]</a>
    files_in_run: List[str] = run.get_file_names() if run else []
    temp_folder = Path(tempfile.mkdtemp()) if run else None
    for file in expected_folder.rglob("*"):
        &#47&#47 rglob also returns folders, skip those</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/microsoft/innereye-deeplearning/commit/be36e392062eadc4863d09867f3b03fcf1b02d9e#diff-6498adfa8b54ae4ec16cc7b14f10dd3fcaaa901256453928908653a9d6019766L223' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 108061969</div><div id='project'> Project Name: microsoft/innereye-deeplearning</div><div id='commit'> Commit Name: be36e392062eadc4863d09867f3b03fcf1b02d9e</div><div id='time'> Time: 2021-06-21</div><div id='author'> Author: antonsc@microsoft.com</div><div id='file'> File Name: InnerEye/ML/baselines_util.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: compare_folder_contents(3)</div><div id='n_method'> N Method Name: compare_folder_contents(3)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: InnerEye/ML/baselines_util.py</div><div id='n_file'> N File Name: InnerEye/ML/baselines_util.py</div><div id='m_start'> M Start Line: 237</div><div id='m_end'> M End Line: 276</div><div id='n_start'> N Start Line: 239</div><div id='n_end'> N End Line: 265</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
            received_ID_col = True
            log.debug("Received df with ID col")
            if len(new_df["ID"].unique()) &gt; 1:
                <a id="change">log.debug("Received df with many time series"</a><a id="change">)</a>
                received_single_time_series = False
            else:
                <a id="change">log.debug("Received df with single time series"</a><a id="change">)</a>
        else:
            new_df["ID"] = "__df__"
            log.debug("Received df with single time series")
    elif df is None:</code></pre><h3>After Change</h3><pre><code class='java'>
    if not df_has_id_column:
        log.debug("Provided DataFrame (df) contains a single time series.")
        df_copy["ID"] = "__df__"
        return df_copy, df_has_id_column, True, <a id="change">[</a>"__df__"<a id="change"></a>]

    &#47&#47 Create a list of unique ID values
    unique_id_values: list[str] = df_copy["ID"].unique().tolist()</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/ourownstory/neural_prophet/commit/ddcb2d23c702ca2583d530c67b4ba2fe673cedd0#diff-cb8ae2d50e5d5d245ed6fcc8cadf2baf7294fa9ac5c63e819fbfe34f0e4c2552L25' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 108061970</div><div id='project'> Project Name: ourownstory/neural_prophet</div><div id='commit'> Commit Name: ddcb2d23c702ca2583d530c67b4ba2fe673cedd0</div><div id='time'> Time: 2023-03-01</div><div id='author'> Author: noxan@users.noreply.github.com</div><div id='file'> File Name: neuralprophet/df_utils.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: prep_or_copy_df(1)</div><div id='n_method'> N Method Name: prep_or_copy_df(1)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: neuralprophet/df_utils.py</div><div id='n_file'> N File Name: neuralprophet/df_utils.py</div><div id='m_start'> M Start Line: 25</div><div id='m_end'> M End Line: 63</div><div id='n_start'> N Start Line: 25</div><div id='n_end'> N End Line: 64</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        
        Starts the tritonserver docker container using docker-py
        
        <a id="change">logger.debug("Starting triton server."</a><a id="change">)</a>

        if len(self._gpus) == 1 and self._gpus[0] == "all":
            devices = [docker.types.DeviceRequest(count=-1, capabilities=[["gpu"]])]
        else:
            devices = [docker.types.DeviceRequest(device_ids=self._gpus, capabilities=[["gpu"]])]

        &#47&#47 Mount required directories
        volumes = {
            self._server_config["model-repository"]: {"bind": self._server_config["model-repository"], "mode": "ro"}
        }

        &#47&#47 Map ports, use config values but set to server defaults if not
        &#47&#47 specified
        triton_ports = self.get_ports()

        ports = {
            triton_ports["http"]: triton_ports["http"],
            triton_ports["grpc"]: triton_ports["grpc"],
            triton_ports["metrics"]: triton_ports["metrics"],
        }

        try:
            &#47&#47 Run the docker container
            <a id="change">logger.debug(
                f"Starting docker container with {self._tritonserver_image} device_requests={devices} "
                f"volumes={volumes} ports={ports}"</a><a id="change">
            )</a>
            self._tritonserver_container = self._docker_client.containers.run(
                image=self._tritonserver_image,
                device_requests=devices,
                volumes=volumes,</code></pre><h3>After Change</h3><pre><code class='java'>
        Starts the tritonserver docker container using docker-py
        
        devices = self._get_devices()
        mount_as_volumes = <a id="change">[</a>pathlib.Path(self._server_config["model-repository"])<a id="change"></a>]

        &#47&#47 Map ports, use config values but set to server defaults if not
        &#47&#47 specified</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/triton-inference-server/model_navigator/commit/5e37049c455ffcf2a5758cc79c4eeee50edeae35#diff-77f75b4440ebea25df9f24f5f54a9089e441b0d9dc8f78018f9a191544c34fc2L58' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 108061975</div><div id='project'> Project Name: triton-inference-server/model_navigator</div><div id='commit'> Commit Name: 5e37049c455ffcf2a5758cc79c4eeee50edeae35</div><div id='time'> Time: 2022-01-14</div><div id='author'> Author: pziecina@nvidia.com</div><div id='file'> File Name: model_navigator/triton/server/server_docker.py</div><div id='m_class'> M Class Name: TritonServerDocker</div><div id='n_method'> N Class Name: TritonServerDocker</div><div id='m_method'> M Method Name: start(1)</div><div id='n_method'> N Method Name: start(1)</div><div id='m_parent_class'> M Parent Class: TritonServer</div><div id='n_parent_class'> N Parent Class: TritonServer</div><div id='m_file'> M File Name: model_navigator/triton/server/server_docker.py</div><div id='n_file'> N File Name: model_navigator/triton/server/server_docker.py</div><div id='m_start'> M Start Line: 62</div><div id='m_end'> M End Line: 118</div><div id='n_start'> N Start Line: 63</div><div id='n_end'> N End Line: 91</div><BR>