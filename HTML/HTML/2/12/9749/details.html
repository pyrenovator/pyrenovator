<html><h3>Pattern ID :9749
</h3><img src='35031527.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
                                                use_hlo_cost_model,
                                                profiling_database_filename,
                                                cached_compute_cost)
        elif <a id="change">stage_mode == "uniform"</a>:
            self.stage_option = UniformStageOption()
        else:
            <a id="change">raise ValueError(f"Invalid stage mode: {stage_mode}"</a><a id="change">)</a>

    def compile_executable(
        self,
        fun: lu.WrappedFun,</code></pre><h3>After Change</h3><pre><code class='java'>
        if layer_option == "manual":
            layer_option = ManualLayerOption()
        self.layer_option = layer_option or AutoLayerOption(layer_num=2)
        <a id="change">if stage_option == "auto"</a>:
            stage_option<a id="change"> = </a>AutoStageOption(
                submesh_physical_shape_space="power_of_two",
                submesh_logical_shape_space="single_node_model_parallel",
                stage_imbalance_tolerance=np.inf,
                use_hlo_cost_model=False,
                profiling_database_filename=None,
                cached_compute_cost=None,
            )
        elif <a id="change">stage_option == "uniform"</a>:
            stage_option<a id="change"> = </a>UniformStageOption()
        self.stage_option = stage_option or UniformStageOption()

    def compile_executable(</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 5</div><BR><div id='size'>Non-data size: 10</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/alpa-projects/alpa/commit/bd4764673bdadcd27212cf0279f0e65fe2637868#diff-0cfa50c6462428d19372ba13da75e9d45a340cdd726285703cf545770d8d9dc0L182' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 35031527</div><div id='project'> Project Name: alpa-projects/alpa</div><div id='commit'> Commit Name: bd4764673bdadcd27212cf0279f0e65fe2637868</div><div id='time'> Time: 2022-07-01</div><div id='author'> Author: lianminzheng@gmail.com</div><div id='file'> File Name: alpa/parallel_method.py</div><div id='m_class'> M Class Name: PipeshardParallel</div><div id='n_method'> N Class Name: PipeshardParallel</div><div id='m_method'> M Method Name: __init__(7)</div><div id='n_method'> N Method Name: __init__(12)</div><div id='m_parent_class'> M Parent Class: ParallelMethod</div><div id='n_parent_class'> N Parent Class: ParallelMethod</div><div id='m_file'> M File Name: alpa/parallel_method.py</div><div id='n_file'> N File Name: alpa/parallel_method.py</div><div id='m_start'> M Start Line: 182</div><div id='m_end'> M End Line: 203</div><div id='n_start'> N Start Line: 184</div><div id='n_end'> N End Line: 197</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        self.negative_weight = config[&quotnegative_weight&quot]
        self.gamma = config[&quotgamma&quot]
        neg_num_dict = config[&quotneg_sampling&quot]
        <a id="change">if &quotuniform&quot in neg_num_dict</a>:
            self.neg_seq_len = neg_num_dict[&quotuniform&quot]
        elif &quotpopularity&quot in neg_num_dict:
            self.neg_seq_len<a id="change"> = </a>neg_num_dict[&quotpopularity&quot]
        else:
            <a id="change">raise ValueError(&quotneg_sampling must be uniform or popularity&quot</a><a id="change">)</a>
        self.reg_weight = config[&quotreg_weight&quot]

        &#47&#47 Get user transaction history
        self.history_item_id, _, self.history_item_len = dataset.history_item_matrix()</code></pre><h3>After Change</h3><pre><code class='java'>
        &#47&#47 feature space mapping matrix of user and item
        self.UI_map = nn.Linear(self.embedding_size,
                                self.embedding_size, bias=False)
        <a id="change">if self.aggregator in [&quotuser_attention&quot, &quotself_attention&quot]</a>:
            self.W_k = nn.Sequential(nn.Linear(self.embedding_size, self.embedding_size),
                                     nn.Tanh())
            <a id="change">if self.aggregator == &quotself_attention&quot</a>:
                self.W_q<a id="change"> = </a>nn.Linear(self.embedding_size, 1, bias=False)
        &#47&#47 dropout
        self.dropout = nn.Dropout(0.1)
        self.require_pow = config[&quotrequire_pow&quot]</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/rucaibox/recbole/commit/283d4a486cc57cae7a4680e08c29c9302f307a0e#diff-1616debdea916026d29c3f84ac8cccd5371107ae8f554fc98b0313b2aa3c1023L39' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 35031524</div><div id='project'> Project Name: rucaibox/recbole</div><div id='commit'> Commit Name: 283d4a486cc57cae7a4680e08c29c9302f307a0e</div><div id='time'> Time: 2022-05-07</div><div id='author'> Author: 18697951462@qq.com</div><div id='file'> File Name: recbole/model/general_recommender/simplex.py</div><div id='m_class'> M Class Name: SimpleX</div><div id='n_method'> N Class Name: SimpleX</div><div id='m_method'> M Method Name: __init__(3)</div><div id='n_method'> N Method Name: __init__(3)</div><div id='m_parent_class'> M Parent Class: GeneralRecommender</div><div id='n_parent_class'> N Parent Class: GeneralRecommender</div><div id='m_file'> M File Name: recbole/model/general_recommender/simplex.py</div><div id='n_file'> N File Name: recbole/model/general_recommender/simplex.py</div><div id='m_start'> M Start Line: 47</div><div id='m_end'> M End Line: 57</div><div id='n_start'> N Start Line: 43</div><div id='n_end'> N End Line: 71</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
    else:
        task_cfg = copy.deepcopy(config)

    <a id="change">if "hydra" in task_cfg</a> and hydra_overrides:
        <a id="change">raise ValueError(
            "`hydra_overrides` cannot be specified when `config` is already derived from a HydraConfig"</a><a id="change">
        )</a>

    if config_dir is not None:
        config_dir = str(Path(config_dir).absolute())
    search_path = create_config_search_path(config_dir)

    hydra = Hydra.create_main_hydra2(task_name=job_name, config_search_path=search_path)
    try:
        <a id="change">if "hydra" not in task_cfg</a>:
            task_cfg, config_name = _gen_config(task_cfg)
            hydra_cfg = get_hydra_cfg(overrides=hydra_overrides, config_dir=config_dir)
            with open_dict(task_cfg):
                task_cfg<a id="change"> = </a>OmegaConf.merge(
                    task_cfg,
                    dict(hydra=OmegaConf.create(hydra_cfg)),
                )
            task_cfg.hydra.job.config_name = config_name

        multirun<a id="change"> = </a>multirun_overrides is not None and len(multirun_overrides) &gt; 0
        if multirun:
            sweeper = Plugins.instance().instantiate_sweeper(
                config=task_cfg,</code></pre><h3>After Change</h3><pre><code class='java'>
        config_name = _store_config(config, config_name)
        task_cfg = _load_config(config_name=config_name, overrides=overrides)
    else:
        <a id="change">if len(overrides) &gt; 0</a>:
            raise ValueError(
                "Non-empty overrides provided with full config object already provided, did you mean `multirun_overrides`?"
            )</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/mit-ll-responsible-ai/hydra-zen/commit/14fe02bc8490312762d6c897c7697b8a7f67a9ad#diff-101224c18e167676796f155bc72c00b529e6a85022c2986b7bbbc659539c9fd3L104' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 35031521</div><div id='project'> Project Name: mit-ll-responsible-ai/hydra-zen</div><div id='commit'> Commit Name: 14fe02bc8490312762d6c897c7697b8a7f67a9ad</div><div id='time'> Time: 2021-04-06</div><div id='author'> Author: jgoodwin@ll.mit.edu</div><div id='file'> File Name: src/hydra_utils/experimental/_implementations.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: hydra_launch(7)</div><div id='n_method'> N Method Name: hydra_launch(6)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: src/hydra_utils/experimental/_implementations.py</div><div id='n_file'> N File Name: src/hydra_utils/experimental/_implementations.py</div><div id='m_start'> M Start Line: 207</div><div id='m_end'> M End Line: 234</div><div id='n_start'> N Start Line: 91</div><div id='n_end'> N End Line: 203</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>

        if self.dim ==2:
            make_conv = ConvNormActive2D
        elif <a id="change">dim ==3</a>:
            make_conv<a id="change"> = </a>ConvNormActive3D
        else:
            <a id="change">raise ValueError(&quotdim should be 2 or 3&quot</a><a id="change">)</a>

        &#47&#47 构建projection
        if self.out_channels != self.in_channels: &#47&#47 输入输出channel不一样，则添加projection改变输入通道,用于不同stage的过渡处
            self.projection = make_conv(in_channels=self.in_channels,out_channels=self.out_channels)</code></pre><h3>After Change</h3><pre><code class='java'>


        &#47&#47 build list
        <a id="change">if self.type == &quot33&quot</a>:
            self.conv_list = nn.ModuleList([])
            self.conv_list.append(ConvNormActive(in_channels, out_channels, kernel_size=3, norm=norm, active=active, gn_c = gn_c, dim = dim))
            self.conv_list.append(ConvNormActive(out_channels, out_channels, kernel_size=3, norm=norm, active=&quotNone&quot, gn_c = gn_c, dim = dim))
        elif <a id="change">self.type == &quot131&quot</a>:
            self.conv_list<a id="change"> = </a>nn.ModuleList([])
            self.conv_list.append(ConvNormActive(in_channels, middle_channels, kernel_size=1, norm=norm, active=active, gn_c = gn_c, dim = dim, padding=0))
            self.conv_list.append(ConvNormActive(middle_channels, middle_channels, kernel_size=3, norm=norm, active=active, gn_c = gn_c, dim = dim))
            self.conv_list.append(ConvNormActive(middle_channels, out_channels, kernel_size=1, norm=norm, active=&quotNone&quot, gn_c = gn_c, dim = dim, padding=0))</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/wamawama/wama_modules/commit/b2bf89e72b262002500e8271f984d6f8afac7eb3#diff-fd72c83d7a844cbbdef927405a10ec8803d51b0f46ea91e27f31e7b97e5e3c1cL362' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 35031531</div><div id='project'> Project Name: wamawama/wama_modules</div><div id='commit'> Commit Name: b2bf89e72b262002500e8271f984d6f8afac7eb3</div><div id='time'> Time: 2022-10-25</div><div id='author'> Author: wmy19970215@gmail.com</div><div id='file'> File Name: wama_modules/BaseModule.py</div><div id='m_class'> M Class Name: ResBlock</div><div id='n_method'> N Class Name: ResBlock</div><div id='m_method'> M Method Name: __init__(9)</div><div id='n_method'> N Method Name: __init__(6)</div><div id='m_parent_class'> M Parent Class: nn.Module</div><div id='n_parent_class'> N Parent Class: nn.Module</div><div id='m_file'> M File Name: wama_modules/BaseModule.py</div><div id='n_file'> N File Name: wama_modules/BaseModule.py</div><div id='m_start'> M Start Line: 362</div><div id='m_end'> M End Line: 384</div><div id='n_start'> N Start Line: 357</div><div id='n_end'> N End Line: 389</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        hidden_states = outputs[&quotdecoder_hidden_states&quot][-1]
        eos_mask = source_ids.eq(self.config.eos_token_id)

        <a id="change">if len(torch.unique(eos_mask.sum(1))) &gt; 1</a>:
            <a id="change">raise ValueError("All examples must have the same number of &lt;eos&gt; tokens."</a><a id="change">)</a>
        vec = hidden_states[eos_mask, :].view(hidden_states.size(0), -1,
                                              hidden_states.size(-1))[:, -1, :]

        logits = self.classifier(vec)</code></pre><h3>After Change</h3><pre><code class='java'>

        if self.args.model_type == &quotcodet5&quot:
            vec = self.get_t5_vec(source_ids)
        elif <a id="change">self.args.model_type == &quotbart&quot</a>:
            vec<a id="change"> = </a>self.get_bart_vec(source_ids)
        elif <a id="change">self.args.model_type == &quotroberta&quot</a>:
            vec<a id="change"> = </a>self.get_roberta_vec(source_ids)

        logits = self.classifier(vec)
        prob = nn.functional.softmax(logits)</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/salesforce/codet5/commit/0bf3c0c43e92fcf54d9df68c793ac22f2b60aad4#diff-dcfeaa5ac3dffd54264034760914588d92fc7395c81eaa9274715840dc28100bL110' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 35031528</div><div id='project'> Project Name: salesforce/codet5</div><div id='commit'> Commit Name: 0bf3c0c43e92fcf54d9df68c793ac22f2b60aad4</div><div id='time'> Time: 2021-10-29</div><div id='author'> Author: 337111657@qq.com</div><div id='file'> File Name: models.py</div><div id='m_class'> M Class Name: CloneModel</div><div id='n_method'> N Class Name: CloneModel</div><div id='m_method'> M Method Name: forward(3)</div><div id='n_method'> N Method Name: forward(3)</div><div id='m_parent_class'> M Parent Class: nn.Module</div><div id='n_parent_class'> N Parent Class: nn.Module</div><div id='m_file'> M File Name: models.py</div><div id='n_file'> N File Name: models.py</div><div id='m_start'> M Start Line: 111</div><div id='m_end'> M End Line: 125</div><div id='n_start'> N Start Line: 103</div><div id='n_end'> N End Line: 116</div><BR>