<html><h3>Pattern ID :19822
</h3><img src='64519096.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
    passthrough_kernel = passthrough_faker(args.layer_depth)

    new_checkpoint = copy.deepcopy(checkpoint)
    <a id="change">new_checkpoint[&quotstate_dict&quot]</a>[f&quot{args.layer_name}.output_shift&quot] = torch.Tensor([1.]).to(device)
    new_checkpoint[&quotstate_dict&quot][f&quot{args.layer_name}.weight_bits&quot] = torch.Tensor([8.]).to(device)
    new_checkpoint[&quotstate_dict&quot][f&quot{args.layer_name}.bias_bits&quot] = torch.Tensor([8.]).to(device)
    new_checkpoint[&quotstate_dict&quot][f&quot{args.layer_name}.quantize_activation&quot] = \</code></pre><h3>After Change</h3><pre><code class='java'>
    &#47&#47 remove `module.` prefix from the state dictionary keys if model is trained with GPU
    &#47&#47 (see:https://discuss.pytorch.org/t/prefix-parameter-names-in-saved-model-if-trained-by-multi-
    &#47&#47 gpu/494)
    <a id="change">new_state_dict = </a><a id="change">OrderedDict()</a>
    <a id="change">for </a>k, v in new_checkpoint[&quotstate_dict&quot].items()<a id="change">:
        </a>name<a id="change"> = </a><a id="change">k.replace("module."</a>, <a id="change">&quot&quot</a><a id="change">)</a>
        <a id="change">new_state_dict[name] = </a>v

    new_state_dict[f&quot{args.layer_name}.output_shift&quot] = torch.Tensor([1.]).to(device)
    new_state_dict[f&quot{args.layer_name}.weight_bits&quot] = torch.Tensor([8.]).to(device)</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 8</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/maximintegratedai/ai8x-synthesis/commit/463492555545c12077688ba6ecacd0f0c64cddd8#diff-a8d6f427c253e8ae5b6b890cc7bc5f4a4961b765676e130182b44483caaabf1cL52' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 64519096</div><div id='project'> Project Name: maximintegratedai/ai8x-synthesis</div><div id='commit'> Commit Name: 463492555545c12077688ba6ecacd0f0c64cddd8</div><div id='time'> Time: 2021-11-22</div><div id='author'> Author: 81234105+seldauyanik-maxim@users.noreply.github.com</div><div id='file'> File Name: izer/add_fake_passthrough.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: main(0)</div><div id='n_method'> N Method Name: main(0)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: izer/add_fake_passthrough.py</div><div id='n_file'> N File Name: izer/add_fake_passthrough.py</div><div id='m_start'> M Start Line: 52</div><div id='m_end'> M End Line: 74</div><div id='n_start'> N Start Line: 53</div><div id='n_end'> N End Line: 82</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        torch.Tensor([0.]).to(device)
    new_checkpoint[&quotstate_dict&quot][f&quot{args.layer_name}.shift_quantile&quot] = \
        torch.Tensor([1.]).to(device)
    <a id="change">new_checkpoint[&quotstate_dict&quot]</a>[f&quot{args.layer_name}.op.weight&quot] = \
        passthrough_kernel.weight.data.to(device)

    move_layer = False</code></pre><h3>After Change</h3><pre><code class='java'>
    &#47&#47 remove `module.` prefix from the state dictionary keys if model is trained with GPU
    &#47&#47 (see:https://discuss.pytorch.org/t/prefix-parameter-names-in-saved-model-if-trained-by-multi-
    &#47&#47 gpu/494)
    <a id="change">new_state_dict = </a><a id="change">OrderedDict()</a>
    <a id="change">for </a>k, v in new_checkpoint[&quotstate_dict&quot].items()<a id="change">:
        </a>name<a id="change"> = </a><a id="change">k.replace("module."</a>, <a id="change">&quot&quot</a><a id="change">)</a>
        <a id="change">new_state_dict[name] = </a>v

    new_state_dict[f&quot{args.layer_name}.output_shift&quot] = torch.Tensor([1.]).to(device)
    new_state_dict[f&quot{args.layer_name}.weight_bits&quot] = torch.Tensor([8.]).to(device)</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/maximintegratedai/ai8x-synthesis/commit/463492555545c12077688ba6ecacd0f0c64cddd8#diff-a8d6f427c253e8ae5b6b890cc7bc5f4a4961b765676e130182b44483caaabf1cL44' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 64519098</div><div id='project'> Project Name: maximintegratedai/ai8x-synthesis</div><div id='commit'> Commit Name: 463492555545c12077688ba6ecacd0f0c64cddd8</div><div id='time'> Time: 2021-11-22</div><div id='author'> Author: 81234105+seldauyanik-maxim@users.noreply.github.com</div><div id='file'> File Name: izer/add_fake_passthrough.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: main(0)</div><div id='n_method'> N Method Name: main(0)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: izer/add_fake_passthrough.py</div><div id='n_file'> N File Name: izer/add_fake_passthrough.py</div><div id='m_start'> M Start Line: 52</div><div id='m_end'> M End Line: 74</div><div id='n_start'> N Start Line: 53</div><div id='n_end'> N End Line: 82</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
    
    model = ResNet(Bottleneck, [3, 4, 6, 3], last_stride=last_stride, **kwargs)
    if pretrained:
        model.load_state_dict(model_zoo.load_url(<a id="change">model_urls[&quotresnet50&quot]</a>))
    return model

</code></pre><h3>After Change</h3><pre><code class='java'>
    model = ResNet(Bottleneck, [3, 4, 6, 3], last_stride=last_stride, **kwargs)
    if pretrained:
        state_dict = torch.load(model_urls[&quotresnet50_ibn_a&quot])
        <a id="change">new_state_dict = </a><a id="change">OrderedDict()</a>
        <a id="change">for </a>k in state_dict[&quotstate_dict&quot]<a id="change">:
            </a>new_k<a id="change"> = </a><a id="change">k.replace(&quotmodule.&quot</a>, <a id="change">&quot&quot</a><a id="change">)</a>
            <a id="change">new_state_dict[new_k] = </a>state_dict[&quotstate_dict&quot][k]
        model.load_state_dict(new_state_dict, strict=True)
    return model
</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/tencentyouturesearch/personreid-youreid/commit/a82d51979279b93a4f34eff01d16de2af6f02b4d#diff-bdd2d0a909c806b879fc1c51f7c6921fa3974a6f8c9a627b38d2d7f99c5bc8f0L189' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 64519102</div><div id='project'> Project Name: tencentyouturesearch/personreid-youreid</div><div id='commit'> Commit Name: a82d51979279b93a4f34eff01d16de2af6f02b4d</div><div id='time'> Time: 2020-08-13</div><div id='author'> Author: fufuyu@tencent.com</div><div id='file'> File Name: models/backbones/resnet_ibn_a.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: resnet50_ibn_a(2)</div><div id='n_method'> N Method Name: resnet50_ibn_a(2)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: models/backbones/resnet_ibn_a.py</div><div id='n_file'> N File Name: models/backbones/resnet_ibn_a.py</div><div id='m_start'> M Start Line: 194</div><div id='m_end'> M End Line: 196</div><div id='n_start'> N Start Line: 195</div><div id='n_end'> N End Line: 202</div><BR>