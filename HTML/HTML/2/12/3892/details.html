<html><h3>Pattern ID :3892
</h3><img src='14746337.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
  def toCPU(x): return x

  def unary_op(x, op):
    <a id="change">if </a>op == UnaryOps.NOOP: <a id="change">return x[:]</a>
    elif <a id="change">op == UnaryOps.NEG</a>: <a id="change">return </a>-x
    elif <a id="change"></a>op == UnaryOps.RELU: <a id="change">return </a>x.relu()
    elif op == UnaryOps.EXP: return x.exp()
    elif op == UnaryOps.LOG: return x.log()
    elif op == UnaryOps.SIGN: return x.sign()
    else: <a id="change">raise </a><a id="change">Exception(f"{op} isn&quott supported"</a><a id="change">)</a>

  def binary_op(x, op, y):
    if op == BinaryOps.ADD: return x+y
    elif op == BinaryOps.SUB: return x-y</code></pre><h3>After Change</h3><pre><code class='java'>
  def fromCPU(x): return x.view(CPUBuffer)
  def toCPU(x): return x

  def unary_op(x, op): <a id="change">return </a>fxn_for_op[op](x)
  def binary_op(x, op, y): return fxn_for_op[op](x, y)

  def reduce_op(x, op, new_shape):</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 11</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/geohot/tinygrad/commit/df16b455a7f04554d7471417ecd5bcd7466f8101#diff-f95ebbe862be0c2efafe626875b5d1e1f16f69b87b564849abbfa2ee7b4adb68L21' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 14746337</div><div id='project'> Project Name: geohot/tinygrad</div><div id='commit'> Commit Name: df16b455a7f04554d7471417ecd5bcd7466f8101</div><div id='time'> Time: 2022-07-03</div><div id='author'> Author: 72895+geohot@users.noreply.github.com</div><div id='file'> File Name: tinygrad/llops/ops_cpu.py</div><div id='m_class'> M Class Name: CPUBuffer</div><div id='n_method'> N Class Name: CPUBuffer</div><div id='m_method'> M Method Name: unary_op(2)</div><div id='n_method'> N Method Name: unary_op(2)</div><div id='m_parent_class'> M Parent Class: np.ndarray</div><div id='n_parent_class'> N Parent Class: np.ndarray</div><div id='m_file'> M File Name: tinygrad/llops/ops_cpu.py</div><div id='n_file'> N File Name: tinygrad/llops/ops_cpu.py</div><div id='m_start'> M Start Line: 21</div><div id='m_end'> M End Line: 28</div><div id='n_start'> N Start Line: 27</div><div id='n_end'> N End Line: 27</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
                        "Something went wrong when retrieving experiments. Please check if QlibRecorder is running or the name/id of the experiment is correct."
                    )
        else:
            <a id="change">if </a>experiment_name is not None:
                <a id="change">if experiment_name in experiments</a>:
                    <a id="change">return </a>experiments[experiment_name]
                else:
                    <a id="change">if </a>create:
                        logger.warning(
                            f"No valid experiment found. Create experiment with name {experiment_name} for further process."
                        )
                        <a id="change">return </a>self.start_exp(experiment_name)
                    else:
                        <a id="change">raise </a><a id="change">Exception(
                            "Something went wrong when retrieving experiments. Please check if QlibRecorder is running or the name/id of the experiment is correct."</a><a id="change">
                        )</a>
            else:
                for name in experiments:
                    if experiments[name].id == experiment_id:
                        <a id="change">return experiments[name]</a>
                if create:
                    logger.warning(f"No valid experiment found. Use the Default experiment for further process.")
                    return self.start_exp()
                else:</code></pre><h3>After Change</h3><pre><code class='java'>
            if self.active_experiment:
                return self.active_experiment
            else:
                <a id="change">return </a>self.__get_exp_by_name(create=create, run=run)
        else:
            if experiment_name is not None:
                return self.__get_exp_by_name(experiment_name, create=create, run=run)</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/microsoft/qlib/commit/64ed43b791ca7b22877e9e480cbeb8c5eb25c728#diff-e5df31bd210e4f211f646f4edfc4859a4ab575477977ec3e663957c4d1ec4f09L226' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 14746353</div><div id='project'> Project Name: microsoft/qlib</div><div id='commit'> Commit Name: 64ed43b791ca7b22877e9e480cbeb8c5eb25c728</div><div id='time'> Time: 2020-11-17</div><div id='author'> Author: dw1920@nyu.edu</div><div id='file'> File Name: qlib/workflow/expm.py</div><div id='m_class'> M Class Name: MLflowExpManager</div><div id='n_method'> N Class Name: MLflowExpManager</div><div id='m_method'> M Method Name: get_exp(5)</div><div id='n_method'> N Method Name: get_exp(4)</div><div id='m_parent_class'> M Parent Class: ExpManager</div><div id='n_parent_class'> N Parent Class: ExpManager</div><div id='m_file'> M File Name: qlib/workflow/expm.py</div><div id='n_file'> N File Name: qlib/workflow/expm.py</div><div id='m_start'> M Start Line: 228</div><div id='m_end'> M End Line: 268</div><div id='n_start'> N Start Line: 263</div><div id='n_end'> N End Line: 275</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
                        "Something went wrong when retrieving recorders. Please check if QlibRecorder is running."
                    )
        else:
            <a id="change">if </a>recorder_id is not None:
                if recorder_id in recorders:
                    <a id="change">return recorders[recorder_id]</a>
                else:
                    &#47&#47 mlflow does not support create a run with given id
                    raise Exception(
                        "Something went wrong when retrieving recorders. Please check if id of the recorder is correct."
                    )
            else:
                for rid in recorders:
                    <a id="change">if recorders[rid].name == recorder_name</a>:
                        <a id="change">return </a>recorders[rid]
                <a id="change">if </a>create:
                    recorders = self.list_recorders()
                    logger.warning(f"No valid recorder found. Create a new recorder with name {recorder_name}.")
                    recorder = self.create_recorder()
                    recorder.name = recorder_name
                    recorder.start_run()
                    <a id="change">return </a>recorder
                else:
                    <a id="change">raise </a><a id="change">Exception(
                        "Something went wrong when retrieving experiments. Please check if the name of the experiment is correct."</a><a id="change">
                    )</a>

    def list_recorders(self):
        runs = self.client.list_run_infos(self.id, run_view_type=1)[::-1]</code></pre><h3>After Change</h3><pre><code class='java'>
            if recorder_id is not None:
                return self._get_recorder_by_id(recorder_id, create=create)
            else:
                <a id="change">return </a>self._get_recorder_by_name(recorder_name, create=create)

    def list_recorders(self):
        runs = self.client.search_runs(self.id, run_view_type=1)[::-1]</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/microsoft/qlib/commit/64ed43b791ca7b22877e9e480cbeb8c5eb25c728#diff-f58669cf1211c432859293e0c65b1a6ca13769eb98e3ce9cb656c7a76bbe536fL210' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 14746345</div><div id='project'> Project Name: microsoft/qlib</div><div id='commit'> Commit Name: 64ed43b791ca7b22877e9e480cbeb8c5eb25c728</div><div id='time'> Time: 2020-11-17</div><div id='author'> Author: dw1920@nyu.edu</div><div id='file'> File Name: qlib/workflow/exp.py</div><div id='m_class'> M Class Name: MLflowExperiment</div><div id='n_method'> N Class Name: MLflowExperiment</div><div id='m_method'> M Method Name: get_recorder(4)</div><div id='n_method'> N Method Name: get_recorder(4)</div><div id='m_parent_class'> M Parent Class: Experiment</div><div id='n_parent_class'> N Parent Class: Experiment</div><div id='m_file'> M File Name: qlib/workflow/exp.py</div><div id='n_file'> N File Name: qlib/workflow/exp.py</div><div id='m_start'> M Start Line: 216</div><div id='m_end'> M End Line: 256</div><div id='n_start'> N Start Line: 286</div><div id='n_end'> N End Line: 293</div><BR>