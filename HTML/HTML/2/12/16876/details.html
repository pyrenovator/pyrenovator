<html><h3>Pattern ID :16876
</h3><img src='56719200.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
        if hasattr(self, "data_dict"):
            return {k: [] for k in self.data_dict.keys()}, {}
        data_dict: Dict[str, torch.tensor] = {}
        variables_to_update: Dict[str, Sequence[str]] = <a id="change">{}</a>
        for name in self.variables:
            if name in SINGLE_LEVEL_VARS:
                data_dict[name]<a id="change"> = </a>[]
            &#47&#47&#47&#47 if variable is an instance of specific multi level vars
            elif name in NAME_LEVEL_TO_VAR_LEVEL:
                data_dict[name]<a id="change"> = []</a>
            elif name in PRESSURE_LEVEL_VARS:
                variables_to_add<a id="change"> = </a>[]
                for level in DEFAULT_PRESSURE_LEVELS:
                    variables_to_add.append(f"{name}_{level}")
                    data_dict[f"{name}_{level}"]<a id="change"> = </a>[]
                variables_to_update[name]<a id="change"> = </a>variables_to_add
            else:
                raise NotImplementedError(
                    f"{name} is not either in single-level or pressure-level dict"
                )
        <a id="change">return </a>data_dict, variables_to_update

    def load_from_nc_by_years(self, data_dir: str, years) -&gt; Dict[str, torch.tensor]:
        data_dict, variables_to_update = self.initialize_data_dict()</code></pre><h3>After Change</h3><pre><code class='java'>

    def initialize_data_dict(self) -&gt; Dict[str, Sequence]:
        data_dict: Dict[str, Sequence] = {}
        <a id="change">for </a>variables in self.variables_map.values()<a id="change">:
            </a>for variable in variables:
                data_dict[variable]<a id="change"> = </a>[]
        <a id="change">return </a>data_dict

    def load_from_nc_by_years(self, data_dir: str, years) -&gt; Dict[str, torch.tensor]:
        data_dict: Dict[</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 11</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/aditya-grover/climate-learn/commit/8d930517f6b72d9fec5ba857114888d09274a493#diff-84573fa02843c1d9013292e23728d1ace522ad871e6953b2f47bddab83d50605L83' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 56719200</div><div id='project'> Project Name: aditya-grover/climate-learn</div><div id='commit'> Commit Name: 8d930517f6b72d9fec5ba857114888d09274a493</div><div id='time'> Time: 2023-04-11</div><div id='author'> Author: prakhar6sharma@gmail.com</div><div id='file'> File Name: src/climate_learn/data/climate_dataset/era5_module.py</div><div id='m_class'> M Class Name: ERA5</div><div id='n_method'> N Class Name: ERA5</div><div id='m_method'> M Method Name: initialize_data_dict(1)</div><div id='n_method'> N Method Name: initialize_data_dict(1)</div><div id='m_parent_class'> M Parent Class: ClimateDataset</div><div id='n_parent_class'> N Parent Class: ClimateDataset</div><div id='m_file'> M File Name: src/climate_learn/data/climate_dataset/era5_module.py</div><div id='n_file'> N File Name: src/climate_learn/data/climate_dataset/era5_module.py</div><div id='m_start'> M Start Line: 83</div><div id='m_end'> M End Line: 103</div><div id='n_start'> N Start Line: 99</div><div id='n_end'> N End Line: 103</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        if hasattr(self, "data_dict"):
            return {k: [] for k in self.data_dict.keys()}, {}
        data_dict: Dict[str, torch.tensor] = {}
        variables_to_update<a id="change">: Dict[str, Sequence[str]] = </a>{}
        for name in self.variables:
            if name in SINGLE_LEVEL_VARS:
                data_dict[name] = <a id="change">[]</a>
            &#47&#47&#47&#47 if variable is an instance of specific multi level vars
            elif name in NAME_LEVEL_TO_VAR_LEVEL:
                data_dict[name]<a id="change"> = []</a>
            elif name in PRESSURE_LEVEL_VARS:
                variables_to_add<a id="change"> = </a>[]
                for level in DEFAULT_PRESSURE_LEVELS:
                    variables_to_add.append(f"{name}_{level}")
                    data_dict[f"{name}_{level}"]<a id="change"> = </a>[]
                variables_to_update[name]<a id="change"> = </a>variables_to_add
            else:
                raise NotImplementedError(
                    f"{name} is not either in single-level or pressure-level dict"
                )
        <a id="change">return </a>data_dict, variables_to_update

    def load_from_nc_by_years(self, data_dir: str, years) -&gt; Dict[str, torch.tensor]:
        data_dict, variables_to_update = self.initialize_data_dict()</code></pre><h3>After Change</h3><pre><code class='java'>

    def initialize_data_dict(self) -&gt; Dict[str, Sequence]:
        data_dict: Dict[str, Sequence] = {}
        <a id="change">for variables</a> in self.variables_map.values()<a id="change">:
            </a>for variable in variables:
                data_dict[variable]<a id="change"> = </a>[]
        <a id="change">return </a>data_dict

    def load_from_nc_by_years(self, data_dir: str, years) -&gt; Dict[str, torch.tensor]:
        data_dict: Dict[</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/aditya-grover/climate-learn/commit/8d930517f6b72d9fec5ba857114888d09274a493#diff-84573fa02843c1d9013292e23728d1ace522ad871e6953b2f47bddab83d50605L80' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 56719205</div><div id='project'> Project Name: aditya-grover/climate-learn</div><div id='commit'> Commit Name: 8d930517f6b72d9fec5ba857114888d09274a493</div><div id='time'> Time: 2023-04-11</div><div id='author'> Author: prakhar6sharma@gmail.com</div><div id='file'> File Name: src/climate_learn/data/climate_dataset/era5_module.py</div><div id='m_class'> M Class Name: ERA5</div><div id='n_method'> N Class Name: ERA5</div><div id='m_method'> M Method Name: initialize_data_dict(1)</div><div id='n_method'> N Method Name: initialize_data_dict(1)</div><div id='m_parent_class'> M Parent Class: ClimateDataset</div><div id='n_parent_class'> N Parent Class: ClimateDataset</div><div id='m_file'> M File Name: src/climate_learn/data/climate_dataset/era5_module.py</div><div id='n_file'> N File Name: src/climate_learn/data/climate_dataset/era5_module.py</div><div id='m_start'> M Start Line: 83</div><div id='m_end'> M End Line: 103</div><div id='n_start'> N Start Line: 99</div><div id='n_end'> N End Line: 103</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>

        edge_weight = F.embedding(g.edata[dgl.ETYPE].long(), h)
        with g.local_scope():
            h<a id="change"> = </a>self.feats
            edge_weight = self.linear_e1(edge_weight)
            x = self.nn_conv1(g, h, edge_weight=edge_weight)
            x<a id="change"> = </a>F.dropout(x, p=self.dropout, training=False)
            if self.num_node_layer == 2:
                &#47&#47edge_weight = self.linear_e2(edge_weight)
                x = self.nn_conv2(g, x, edge_weight=edge_weight)
                x = F.dropout(x, p=self.dropout, training=False)

            x = self.emd2pred(x)
            x = F.dropout(x, p=self.dropout, training=False)

            <a id="change">return </a>x


class AGNNConv(nn.Module):</code></pre><h3>After Change</h3><pre><code class='java'>
        &#47&#47 For full graph training, directly use the graph
        if n_feats is None:
            &#47&#47 full graph training
            n_feats<a id="change"> = </a>self.h_n_dict()

        &#47&#47 Forward of n layers of CompGraphConv

        for layer in self.edge_layers:
            h = self.cl_graph.ndata[&quoth&quot]
            h_e = self.cl_graph.edata[&quotw&quot]
            h = th.relu(layer(self.cl_graph, h, h_e))
            h = F.dropout(h, p=self.dropout, training=False)

        edge_weight = <a id="change">{}</a>
        for i, e in enumerate(hg.canonical_etypes):
            edge_weight[e]<a id="change"> = </a>h[i].expand(hg.num_edges(e), -1)
        temp = self.h_n_dict()
        n_feats<a id="change"> = {}</a>
        <a id="change">for n</a> in hg.ntypes<a id="change">:
            </a>n_feats[n]<a id="change"> = </a>temp[n]
        if hasattr(hg, &quotntypes&quot):
            &#47&#47edge_weight = F.embedding(hg.edata[dgl.ETYPE].long(), h)

            &#47&#47 full graph training
           &#47&#47 edge_weight = self.linear_e1(edge_weight)
            for layer in self.node_layers:
                n_feats = layer(hg, n_feats, edge_weight)
                n_feats = F.dropout(n_feats, p=self.dropout, training=False)
        else:
            &#47&#47 minibatch training
            pass
        n_feats = self.emd2pred(n_feats)
        n_feats = F.dropout(n_feats, p=self.dropout, training=False)
        <a id="change">return </a>n_feats


class AGNNConv(nn.Module):</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/bupt-gamma/openhgnn/commit/5b978d8c10bf24304d51be5f4c2c306d5720b7b3#diff-429162e7bcdfbbc409aabd0e6317a9f8bd71ecc0fdb9f27c08cab2cd0cda454cL48' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 56719231</div><div id='project'> Project Name: bupt-gamma/openhgnn</div><div id='commit'> Commit Name: 5b978d8c10bf24304d51be5f4c2c306d5720b7b3</div><div id='time'> Time: 2021-04-14</div><div id='author'> Author: theheavenszhao@outlook.com</div><div id='file'> File Name: openhgnn/models/RSHN.py</div><div id='m_class'> M Class Name: RSHN</div><div id='n_method'> N Class Name: RSHN</div><div id='m_method'> M Method Name: forward(3)</div><div id='n_method'> N Method Name: forward(3)</div><div id='m_parent_class'> M Parent Class: BaseModel</div><div id='n_parent_class'> N Parent Class: nn.Module</div><div id='m_file'> M File Name: openhgnn/models/RSHN.py</div><div id='n_file'> N File Name: openhgnn/models/RSHN.py</div><div id='m_start'> M Start Line: 49</div><div id='m_end'> M End Line: 74</div><div id='n_start'> N Start Line: 65</div><div id='n_end'> N End Line: 97</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
     print(conf) &#47&#47 {&quotFOO&quot: &quotValue1,Value2&quot, &quotBAR&quot: &quotValue3&quot}

    
    conf<a id="change">: Dict[str, str] = {}</a>
    arg = arg.strip()
    if len(arg) == 0:
        return {}

    kv_delimiter: str = "="
    pair_delimiter: str = ","

    cpos: int = 0
    while cpos &lt; len(arg):
        key = _get_key(arg, cpos, kv_delimiter)
        cpos += len(key) + 1
        value<a id="change"> = </a>_get_value(arg, cpos, kv_delimiter, pair_delimiter)
        cpos += len(value) + 1
        conf[key] = value
    <a id="change">return </a>conf


def _get_key(arg: str, spos: int, kv_delimiter: str = "=") -&gt; str:</code></pre><h3>After Change</h3><pre><code class='java'>
        else:
            return vk[0:idx], vk[idx + 1 :]

    arg_map: Dict[str, str] = <a id="change">{}</a>

    if not arg:
        return arg_map

    &#47&#47 split cfgs
    cfg_kv_delim = "="

    &#47&#47 ["FOO", "v1;v2,BAR", v3, "BAZ", "v4,v5"]
    split_arg = [s for s in arg.split(cfg_kv_delim) if s]  &#47&#47 remove empty
    split_arg_len = len(split_arg)

    if split_arg_len &lt; 2:  &#47&#47 no kv -&gt; malformed str
        raise ValueError(f"`{arg}` does not have at least one `key=value` pair")

    &#47&#47 since we split on "=" so we end up with ["KEY1", "val1,KEY2", "val2,KEY_n", "val_n"]
    key<a id="change"> = </a>split_arg[0]  &#47&#47 first element is always a key
    &#47&#47 middle elements are value_{n}&lt;delim&gt;key_{n+1}
    <a id="change">for vk</a> in split_arg[1 : split_arg_len - 1]<a id="change">:  &#47&#47 python deals with
        </a>val, key_next = parse_val_key(vk)
        arg_map[key] = val
        key<a id="change"> = </a>key_next
    val<a id="change"> = </a>split_arg[-1]  &#47&#47 last element is always a value
    arg_map[key]<a id="change"> = </a>val
    <a id="change">return </a>arg_map


&#47&#47 pyre-ignore-all-errors[3, 2]</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/pytorch/torchx/commit/f16607e1cdd96e1e5a9b07ba954509a8da6ede20#diff-3768732b61f67df58f24c2d6f8b004982665a8e37ae4fa8fb3a9633b7f8ec840L13' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 56719151</div><div id='project'> Project Name: pytorch/torchx</div><div id='commit'> Commit Name: f16607e1cdd96e1e5a9b07ba954509a8da6ede20</div><div id='time'> Time: 2022-04-05</div><div id='author'> Author: kiuk@fb.com</div><div id='file'> File Name: torchx/util/types.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: to_dict(1)</div><div id='n_method'> N Method Name: to_dict(1)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: torchx/util/types.py</div><div id='n_file'> N File Name: torchx/util/types.py</div><div id='m_start'> M Start Line: 25</div><div id='m_end'> M End Line: 40</div><div id='n_start'> N Start Line: 71</div><div id='n_end'> N End Line: 95</div><BR>