<html><h3>Pattern ID :504
</h3><img src='2763178.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
        prediction2 = self.vector_prediction(
            rprime, v, key, rank, merge_fun, join_fun, invar_mode, covar_mode)

        delta<a id="change"> = max(1e-3</a>, <a id="change">np.mean(np</a><a id="change">.square(</a>r<a id="change">)))</a>
        npt.assert_allclose(prediction1_prime - prediction2, 0, atol=1e-1*delta)

    @settings(deadline=None)
    @given(</code></pre><h3>After Change</h3><pre><code class='java'>
        hs.sampled_from(INVARIANT_MODES))
    def test_rotation_covariance_vector(self, q, rv, rank, merge_fun, join_fun,
                                        invar_mode, covar_mode):
        <a id="change">errs = </a><a id="change">[]</a>
        <a id="change">for </a>scale in FLOAT_SCALES<a id="change">:
            </a>r, v = rv; r<a id="change"> = </a>r<a id="change">*scale</a>; v<a id="change"> = </a>v<a id="change">*scale</a>
            rprime = rowan.rotate(q[None], r).astype(np.float32)

            key = &quotrotation_covariance&quot
            prediction1 = self.vector_prediction(
                r, v, key, rank, merge_fun, join_fun, invar_mode, covar_mode)
            prediction1_prime = rowan.rotate(q, prediction1)
            prediction2 = self.vector_prediction(
                rprime, v, key, rank, merge_fun, join_fun, invar_mode, covar_mode)

            <a id="change">errs.append(</a><a id="change">np.mean(</a>np.square(prediction1_prime - prediction2)<a id="change">))</a>

        <a id="change">with np.errstate(divide=&quotignore&quot)</a><a id="change">:
            x</a><a id="change">, y</a> = <a id="change">np.log(</a>FLOAT_SCALES<a id="change">)</a><a id="change">, np.log(errs)</a>
        <a id="change">filt = np</a><a id="change">.isfinite(y</a><a id="change">)</a>
        <a id="change">x</a><a id="change">, y</a> = <a id="change">x[filt], y[filt]</a>
        <a id="change">if len(x) &gt; 2</a>:
            <a id="change">corrcoef</a><a id="change"> = np.corrcoef(x</a><a id="change">, y)[0, 1]</a>
            if corrcoef &lt; .9:
                print(x, y, corrcoef)
            <a id="change">if np.isfinite(corrcoef</a><a id="change">)</a>:
                <a id="change">self.assertGreater(corrcoef</a>, <a id="change">.9</a><a id="change">)</a>

    @settings(deadline=None)
    @given(
        unit_quaternions(),</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 36</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/klarh/geometric_algebra_attention/commit/ddd8d2e08ab7c709ac2a544844b26c6609e792b3#diff-87a26a2cfe50c5fe7cfdaecf5219294ed38e4e13a224f49944973cffeb10c7cdL112' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 2763178</div><div id='project'> Project Name: klarh/geometric_algebra_attention</div><div id='commit'> Commit Name: ddd8d2e08ab7c709ac2a544844b26c6609e792b3</div><div id='time'> Time: 2021-10-12</div><div id='author'> Author: mspells@vectorinstitute.ai</div><div id='file'> File Name: tests/test_internals.py</div><div id='m_class'> M Class Name: AllTests</div><div id='n_method'> N Class Name: AllTests</div><div id='m_method'> M Method Name: test_rotation_covariance_vector(8)</div><div id='n_method'> N Method Name: test_rotation_covariance_vector(8)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: tests/test_internals.py</div><div id='n_file'> N File Name: tests/test_internals.py</div><div id='m_start'> M Start Line: 112</div><div id='m_end'> M End Line: 123</div><div id='n_start'> N Start Line: 135</div><div id='n_end'> N End Line: 160</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        prediction2 = self.vector_prediction(
            rprime, v, key, rank, merge_fun, join_fun, invar_mode, covar_mode)

        delta<a id="change"> = max(1e-3</a>, <a id="change">np.mean(</a><a id="change">np.square(</a>r<a id="change">)))</a>
        npt.assert_allclose(prediction1_prime - prediction2, 0, atol=1e-1*delta)

    @settings(deadline=None)
    @given(</code></pre><h3>After Change</h3><pre><code class='java'>
        hs.sampled_from(INVARIANT_MODES))
    def test_rotation_covariance_vector(self, q, rv, rank, merge_fun, join_fun,
                                        invar_mode, covar_mode):
        <a id="change">errs = </a><a id="change">[]</a>
        <a id="change">for </a><a id="change">scale</a> in FLOAT_SCALES<a id="change">:
            </a>r, v = rv; r<a id="change"> = </a>r<a id="change">*</a>scale; v<a id="change"> = </a>v<a id="change">*</a>scale
            rprime = rowan.rotate(q[None], r).astype(np.float32)

            key = &quotrotation_covariance&quot
            prediction1 = self.vector_prediction(
                r, v, key, rank, merge_fun, join_fun, invar_mode, covar_mode)
            prediction1_prime = rowan.rotate(q, prediction1)
            prediction2 = self.vector_prediction(
                rprime, v, key, rank, merge_fun, join_fun, invar_mode, covar_mode)

            <a id="change">errs.append(</a><a id="change">np.mean(</a>np.square(prediction1_prime - prediction2)<a id="change">))</a>

        <a id="change">with np.errstate(divide=&quotignore&quot)</a><a id="change">:
            </a>x<a id="change">, y</a> = <a id="change">np.log(</a>FLOAT_SCALES<a id="change">)</a><a id="change">, np.log(errs)</a>
        <a id="change">filt = </a><a id="change">np.isfinite(</a>y<a id="change">)</a>
        x<a id="change">, y</a> = <a id="change">x[filt], y[filt]</a>
        <a id="change">if len(x) &gt; 2</a>:
            <a id="change">corrcoef</a><a id="change"> = np.corrcoef(</a><a id="change">x, y)[0, 1]</a>
            if corrcoef &lt; .9:
                print(x, y, corrcoef)
            <a id="change">if np.isfinite(</a>corrcoef<a id="change">)</a>:
                <a id="change">self.assertGreater(</a>corrcoef, <a id="change">.9</a><a id="change">)</a>

    @settings(deadline=None)
    @given(
        unit_quaternions(),</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/klarh/geometric_algebra_attention/commit/ddd8d2e08ab7c709ac2a544844b26c6609e792b3#diff-87a26a2cfe50c5fe7cfdaecf5219294ed38e4e13a224f49944973cffeb10c7cdL110' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 2763179</div><div id='project'> Project Name: klarh/geometric_algebra_attention</div><div id='commit'> Commit Name: ddd8d2e08ab7c709ac2a544844b26c6609e792b3</div><div id='time'> Time: 2021-10-12</div><div id='author'> Author: mspells@vectorinstitute.ai</div><div id='file'> File Name: tests/test_internals.py</div><div id='m_class'> M Class Name: AllTests</div><div id='n_method'> N Class Name: AllTests</div><div id='m_method'> M Method Name: test_rotation_covariance_vector(8)</div><div id='n_method'> N Method Name: test_rotation_covariance_vector(8)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: tests/test_internals.py</div><div id='n_file'> N File Name: tests/test_internals.py</div><div id='m_start'> M Start Line: 112</div><div id='m_end'> M End Line: 123</div><div id='n_start'> N Start Line: 135</div><div id='n_end'> N End Line: 160</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        prediction2 = self.value_prediction(rprime, v, key, rank, merge_fun, join_fun, invar_mode)

        self.assertEqual(v[0].shape, prediction1.shape)
        delta<a id="change"> = max(1e-3</a>, <a id="change">np.mean(</a><a id="change">np.square(</a>v<a id="change">)))</a>
        npt.assert_allclose(prediction1 - prediction2, 0, atol=1e-1*delta)

    @settings(deadline=None)
    @given(</code></pre><h3>After Change</h3><pre><code class='java'>
        hs.sampled_from(MERGE_MODES),
        hs.sampled_from(INVARIANT_MODES))
    def test_rotation_invariance_value(self, q, rv, rank, merge_fun, join_fun, invar_mode):
        <a id="change">errs = </a><a id="change">[]</a>
        <a id="change">for </a><a id="change">scale</a> in FLOAT_SCALES<a id="change">:
            </a>r, v = rv; r<a id="change"> = </a>r<a id="change">*</a>scale; v<a id="change"> = </a>v<a id="change">*</a>scale
            rprime = rowan.rotate(q[None], r).astype(np.float32)

            key = &quotrotation_invariance&quot
            prediction1 = self.value_prediction(r, v, key, rank, merge_fun, join_fun, invar_mode)
            prediction2 = self.value_prediction(rprime, v, key, rank, merge_fun, join_fun, invar_mode)

            self.assertEqual(v[0].shape, prediction1.shape)
            <a id="change">errs.append(</a><a id="change">np.mean(</a>np.square(prediction1 - prediction2)<a id="change">))</a>

        <a id="change">with np.errstate(divide=&quotignore&quot)</a><a id="change">:
            </a>x<a id="change">, y</a> = <a id="change">np.log(</a>FLOAT_SCALES<a id="change">), np.log(errs)</a>
        <a id="change">filt = </a><a id="change">np.isfinite(</a>y<a id="change">)</a>
        x<a id="change">, y</a> = <a id="change">x[filt], y[filt]</a>
        <a id="change">if len(x) &gt; 2</a>:
            <a id="change">corrcoef</a><a id="change"> = np.corrcoef(</a><a id="change">x, y)[0, 1]</a>
            <a id="change">if np.isfinite(</a>corrcoef<a id="change">)</a>:
                <a id="change">self.assertGreater(</a>corrcoef, <a id="change">.9</a><a id="change">)</a>

    @settings(deadline=None)
    @given(
        point_cloud(),</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/klarh/geometric_algebra_attention/commit/ddd8d2e08ab7c709ac2a544844b26c6609e792b3#diff-87a26a2cfe50c5fe7cfdaecf5219294ed38e4e13a224f49944973cffeb10c7cdL60' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 2763176</div><div id='project'> Project Name: klarh/geometric_algebra_attention</div><div id='commit'> Commit Name: ddd8d2e08ab7c709ac2a544844b26c6609e792b3</div><div id='time'> Time: 2021-10-12</div><div id='author'> Author: mspells@vectorinstitute.ai</div><div id='file'> File Name: tests/test_internals.py</div><div id='m_class'> M Class Name: AllTests</div><div id='n_method'> N Class Name: AllTests</div><div id='m_method'> M Method Name: test_rotation_invariance_value(7)</div><div id='n_method'> N Method Name: test_rotation_invariance_value(7)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: tests/test_internals.py</div><div id='n_file'> N File Name: tests/test_internals.py</div><div id='m_start'> M Start Line: 61</div><div id='m_end'> M End Line: 70</div><div id='n_start'> N Start Line: 65</div><div id='n_end'> N End Line: 86</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        prediction2[swap_i] = prediction2[swap_j]
        prediction2[swap_j] = temp

        delta<a id="change"> = max(1e-3</a>, <a id="change">np.mean(</a><a id="change">np.square(</a>v<a id="change">)))</a>
        npt.assert_allclose(prediction1 - prediction2, 0, atol=1e-1*delta)

    @settings(deadline=None)
    @given(</code></pre><h3>After Change</h3><pre><code class='java'>
        hs.sampled_from(MERGE_MODES),
        hs.sampled_from(INVARIANT_MODES))
    def test_permutation_equivariance_value(self, rv, swap_i, swap_j, rank, merge_fun, join_fun, invar_mode):
        <a id="change">errs = </a><a id="change">[]</a>
        <a id="change">for </a><a id="change">scale</a> in FLOAT_SCALES<a id="change">:
            </a>r, v = rv; r<a id="change"> = </a>r<a id="change">*</a>scale; v<a id="change"> = </a>v<a id="change">*</a>scale
            swap_i = swap_i%len(r)
            swap_j = swap_j%len(r)
            rprime, vprime = r.copy(), v.copy()
            rprime[swap_i], rprime[swap_j] = r[swap_j], r[swap_i]
            vprime[swap_i], vprime[swap_j] = v[swap_j], v[swap_i]

            key = &quotpermutation_equivariance&quot
            prediction1 = self.value_prediction(r, v, key, rank, merge_fun, join_fun, invar_mode, reduce=False)
            prediction2 = self.value_prediction(rprime, vprime, key, rank, merge_fun, join_fun, invar_mode, reduce=False)

            self.assertEqual(v.shape, prediction1.shape)
            temp = prediction2[swap_i].copy()
            prediction2[swap_i] = prediction2[swap_j]
            prediction2[swap_j] = temp
            <a id="change">errs.append(</a><a id="change">np.mean(</a>np.square(prediction1 - prediction2)<a id="change">))</a>

        <a id="change">with np.errstate(divide=&quotignore&quot)</a><a id="change">:
            </a>x<a id="change">, y</a> = <a id="change">np.log(</a>FLOAT_SCALES<a id="change">)</a><a id="change">, np.log(errs)</a>
        <a id="change">filt = </a><a id="change">np.isfinite(</a>y<a id="change">)</a>
        x<a id="change">, y</a> = <a id="change">x[filt], y[filt]</a>
        <a id="change">if len(x) &gt; 2</a>:
            <a id="change">corrcoef</a><a id="change"> = np.corrcoef(</a><a id="change">x, y)[0, 1]</a>
            <a id="change">if np.isfinite(</a>corrcoef<a id="change">)</a>:
                <a id="change">self.assertGreater(</a>corrcoef, <a id="change">.9</a><a id="change">)</a>

    @settings(deadline=None)
    @given(
        unit_quaternions(),</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/klarh/geometric_algebra_attention/commit/ddd8d2e08ab7c709ac2a544844b26c6609e792b3#diff-87a26a2cfe50c5fe7cfdaecf5219294ed38e4e13a224f49944973cffeb10c7cdL81' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 2763177</div><div id='project'> Project Name: klarh/geometric_algebra_attention</div><div id='commit'> Commit Name: ddd8d2e08ab7c709ac2a544844b26c6609e792b3</div><div id='time'> Time: 2021-10-12</div><div id='author'> Author: mspells@vectorinstitute.ai</div><div id='file'> File Name: tests/test_internals.py</div><div id='m_class'> M Class Name: AllTests</div><div id='n_method'> N Class Name: AllTests</div><div id='m_method'> M Method Name: test_permutation_equivariance_value(8)</div><div id='n_method'> N Method Name: test_permutation_equivariance_value(8)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: tests/test_internals.py</div><div id='n_file'> N File Name: tests/test_internals.py</div><div id='m_start'> M Start Line: 82</div><div id='m_end'> M End Line: 99</div><div id='n_start'> N Start Line: 96</div><div id='n_end'> N End Line: 124</div><BR>