<html><h3>Pattern ID :14948
</h3><img src='49811354.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
	y1 = y
	y2 = y + h
	&#47&#47cv2.rectangle(img, (x1, y1), (x2, y2), (0, 255, 0), 2)
	font_size<a id="change"> = </a><a id="change">round(</a>w / (line_count<a id="change"> * 1.2</a>)<a id="change">)</a>
	rows = h // font_size
	cols = w // font_size
	while rows * cols &lt; len(text) :
		font_size -= 1</code></pre><h3>After Change</h3><pre><code class='java'>
	&#47&#47 	font_size -= 1
	&#47&#47 	rows = h // font_size
	&#47&#47 	cols = w // font_size
	fg_avg = (fg[0] + fg[1] + fg[2])<a id="change"> / 3</a>
	if bg :
		bg_avg = (bg[0] + bg[1] + bg[2]) / 3
		<a id="change">if abs(fg_avg - bg_avg) &lt; 40</a> :
			bg<a id="change"> = </a>None
	bgsize = int(max(font_size * 0.07, 1)) if bg else 0
	spacing_y = 0&#47&#47int(max(font_size * 0.05, 1))
	spacing_x = spacing_y</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 4</div><BR><div id='size'>Non-data size: 7</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/zyddnys/manga-image-translator/commit/605e7ecd9cf3b0a00b67fab40020c269a7bea4a3#diff-a00d57a134f11bad95204dec4abd6df6ae878f21b5826d1211aa9e4570e77203L256' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 49811354</div><div id='project'> Project Name: zyddnys/manga-image-translator</div><div id='commit'> Commit Name: 605e7ecd9cf3b0a00b67fab40020c269a7bea4a3</div><div id='time'> Time: 2021-07-26</div><div id='author'> Author: zyddnys@outlook.com</div><div id='file'> File Name: text_render.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: put_text_vertical(13)</div><div id='n_method'> N Method Name: put_text_vertical(11)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: text_render.py</div><div id='n_file'> N File Name: text_render.py</div><div id='m_start'> M Start Line: 256</div><div id='m_end'> M End Line: 289</div><div id='n_start'> N Start Line: 264</div><div id='n_end'> N End Line: 304</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
            max_val = max(img_tmp.shape[1], img_tmp.shape[0])

            &#47&#47 2) divide the image in tiles
            tiles = slice_image(img, <a id="change">round(</a>max_val<a id="change">/45</a><a id="change">)</a>)

            &#47&#47 3) upscale each tiles
            for tile in tiles:
                tile_adapted  = adapt_image_for_deeplearning(tile.filename)
                tile_adapted  = tile_adapted.to(device, non_blocking = True)
                tile_upscaled = model(tile_adapted)
                tile_upscaled = tensor2uint(tile_upscaled)
                imsave(tile_upscaled, tile.filename)
                tile.image  = Image.open(tile.filename)
                tile.coords = (tile.coords[0]*4, tile.coords[1]*4)

            &#47&#47 6) then reconstruct the image by tiles upscaled
            image_upscaled = reunion_image(tiles)
            
            &#47&#47 7) remove tiles file
            delete_tiles_from_disk(tiles)

            &#47&#47 8) try to remove tiles segmentation
            if "BSRGAN" in AI_model:
                image_upscaled<a id="change"> = </a>remove_image_patches_imperfection(image_upscaled, upscale_factor)

            &#47&#47 9) save reconstructed image
            cv2.imwrite(result_path, image_upscaled)</code></pre><h3>After Change</h3><pre><code class='java'>
            img_tmp = cv2.imread(img)
            val = min(img_tmp.shape[1], img_tmp.shape[0])
            num_tiles = round(val/cut_image_factor)
            <a id="change">if (num_tiles % 2) != 0</a>:
                num_tiles<a id="change"> += </a>1

            &#47&#47 3) divide the image in tiles
            tiles = slice_image(img, num_tiles)</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/djdefrag/qualityscaler/commit/66cef0855cfbe41b27938a88cd316575f61f5507#diff-84f2858c19a17bc7224331c82c8eb4a2050df894e2e6f84183ecec96e1e47024L617' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 49811329</div><div id='project'> Project Name: djdefrag/qualityscaler</div><div id='commit'> Commit Name: 66cef0855cfbe41b27938a88cd316575f61f5507</div><div id='time'> Time: 2022-05-04</div><div id='author'> Author: jjluca96@gmail.com</div><div id='file'> File Name: QualityScaler.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: torch_AI_upscale_video_frames(4)</div><div id='n_method'> N Method Name: torch_AI_upscale_video_frames(4)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: QualityScaler.py</div><div id='n_file'> N File Name: QualityScaler.py</div><div id='m_start'> M Start Line: 620</div><div id='m_end'> M End Line: 673</div><div id='n_start'> N Start Line: 416</div><div id='n_end'> N End Line: 465</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
            max_val = max(img_tmp.shape[1], img_tmp.shape[0])

            &#47&#47 2) divide the image in tiles
            tiles = slice_image(img, <a id="change">round(</a>max_val<a id="change">/45</a><a id="change">)</a>)

            &#47&#47 3) upscale each tiles
            for tile in tiles:
                tile_adapted  = adapt_image_for_deeplearning(tile.filename)
                tile_adapted  = tile_adapted.to(device, non_blocking = True)
                tile_upscaled = model(tile_adapted)
                tile_upscaled = tensor2uint(tile_upscaled)
                imsave(tile_upscaled, tile.filename)
                tile.image  = Image.open(tile.filename)
                tile.coords = (tile.coords[0]*4, tile.coords[1]*4)

            &#47&#47 6) then reconstruct the image by tiles upscaled
            image_upscaled = reunion_image(tiles)
            
            &#47&#47 7) remove tiles file
            delete_tiles_from_disk(tiles)

            &#47&#47 8) try to remove tiles segmentation
            if "BSRGAN" in AI_model:
                image_upscaled<a id="change"> = </a>remove_image_patches_imperfection(image_upscaled, upscale_factor)

            &#47&#47 9) save reconstructed image
            cv2.imwrite(result_path, image_upscaled)</code></pre><h3>After Change</h3><pre><code class='java'>
            img_tmp = cv2.imread(img)
            val = min(img_tmp.shape[1], img_tmp.shape[0])
            num_tiles = round(val/cut_image_factor)
            <a id="change">if (num_tiles % 2) != 0</a>:
                num_tiles<a id="change"> += </a>1

            &#47&#47 3) divide the image in tiles
            tiles = slice_image(img, num_tiles)</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/djdefrag/qualityscaler/commit/66cef0855cfbe41b27938a88cd316575f61f5507#diff-84f2858c19a17bc7224331c82c8eb4a2050df894e2e6f84183ecec96e1e47024L560' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 49811330</div><div id='project'> Project Name: djdefrag/qualityscaler</div><div id='commit'> Commit Name: 66cef0855cfbe41b27938a88cd316575f61f5507</div><div id='time'> Time: 2022-05-04</div><div id='author'> Author: jjluca96@gmail.com</div><div id='file'> File Name: QualityScaler.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: torch_AI_upscale_multiple_images(4)</div><div id='n_method'> N Method Name: torch_AI_upscale_multiple_images(4)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: QualityScaler.py</div><div id='n_file'> N File Name: QualityScaler.py</div><div id='m_start'> M Start Line: 563</div><div id='m_end'> M End Line: 616</div><div id='n_start'> N Start Line: 364</div><div id='n_end'> N End Line: 414</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
	y1 = y
	y2 = y + h
	&#47&#47cv2.rectangle(img, (x1, y1), (x2, y2), (0, 255, 0), 2)
	font_size<a id="change"> = </a><a id="change">round(</a>h / (line_count<a id="change"> * 1.2</a>)<a id="change">)</a>
	rows = h // font_size
	cols = w // font_size
	while rows * cols &lt; len(text) :
		font_size -= 1</code></pre><h3>After Change</h3><pre><code class='java'>
	&#47&#47 	cols = w // font_size
	fg_avg = (fg[0] + fg[1] + fg[2]) / 3
	if bg :
		bg_avg = (bg[0] + bg[1] + bg[2])<a id="change"> / 3</a>
		<a id="change">if abs(fg_avg - bg_avg) &lt; 40</a> :
			bg<a id="change"> = </a>None
	bgsize = int(max(font_size * 0.07, 1)) if bg else 0
	spacing_x = 0&#47&#47int(max(font_size * 0.05, 1))
	spacing_y = spacing_x</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/zyddnys/manga-image-translator/commit/605e7ecd9cf3b0a00b67fab40020c269a7bea4a3#diff-a00d57a134f11bad95204dec4abd6df6ae878f21b5826d1211aa9e4570e77203L295' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 49811347</div><div id='project'> Project Name: zyddnys/manga-image-translator</div><div id='commit'> Commit Name: 605e7ecd9cf3b0a00b67fab40020c269a7bea4a3</div><div id='time'> Time: 2021-07-26</div><div id='author'> Author: zyddnys@outlook.com</div><div id='file'> File Name: text_render.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: put_text_horizontal(13)</div><div id='n_method'> N Method Name: put_text_horizontal(11)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: text_render.py</div><div id='n_file'> N File Name: text_render.py</div><div id='m_start'> M Start Line: 296</div><div id='m_end'> M End Line: 331</div><div id='n_start'> N Start Line: 310</div><div id='n_end'> N End Line: 350</div><BR>