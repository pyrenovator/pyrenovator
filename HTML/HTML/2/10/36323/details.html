<html><h3>Pattern ID :36323
</h3><img src='102903846.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
        sess.close()

        bokeh_session.server_session.close("test complete")
        <a id="change">os.killpg(os</a><a id="change">.getpgid(</a>process.pid<a id="change">)</a>, signal.SIGTERM<a id="change">)</a>

    def test_eval_scores_with_spatial_svd_pruner(self):

        pruner = SpatialSvdPruner()</code></pre><h3>After Change</h3><pre><code class='java'>

        layer_db.mark_picked_layers([layer1, layer2])

        <a id="change">process = </a>None
        <a id="change">try:
            </a>url, process = start_bokeh_server_session()
            bokeh_session = BokehServerSession(url=url, session_id="compression")

            &#47&#47 Instantiate child
            greedy_algo = comp_ratio_select.GreedyCompRatioSelectAlgo(layer_db=layer_db, pruner=pruner,
                                                                      cost_calculator=SpatialSvdCostCalculator(),
                                                                      eval_func=eval_func, eval_iterations=20,
                                                                      cost_metric=CostMetric.mac, target_comp_ratio=0.5,
                                                                      num_candidates=10, use_monotonic_fit=True,
                                                                      saved_eval_scores_dict=None,
                                                                      comp_ratio_rounding_algo=None, use_cuda=False,
                                                                      bokeh_session=bokeh_session)

            eval_dict = greedy_algo._compute_eval_scores_for_all_comp_ratio_candidates()

            self.assertEqual(50, eval_dict[&quotconv2d/Conv2D&quot][Decimal(&quot0.5&quot)])
            self.assertEqual(60, eval_dict[&quotconv2d/Conv2D&quot][Decimal(&quot0.4&quot)])

            self.assertEqual(11, eval_dict[&quotconv2d_1/Conv2D&quot][Decimal(&quot0.9&quot)])

            tf.compat.v1.reset_default_graph()
            sess.close()

            bokeh_session.server_session.close("test complete")
        finally:
            <a id="change">if process</a>:
                <a id="change">process.terminate()</a>
                <a id="change">process.join()</a>

    def test_eval_scores_with_spatial_svd_pruner(self):

        pruner = SpatialSvdPruner()</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 8</div><BR><div id='size'>Non-data size: 7</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/quic/aimet/commit/d11f625cdf15996474398087c124082490ab5404#diff-281bed15783caf8fb9888aba402e472856aa7fe9ab81aa960bd3077d0e6bf477L142' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 102903846</div><div id='project'> Project Name: quic/aimet</div><div id='commit'> Commit Name: d11f625cdf15996474398087c124082490ab5404</div><div id='time'> Time: 2023-05-02</div><div id='author'> Author: quic_kyunggeu@quicinc.com</div><div id='file'> File Name: TrainingExtensions/tensorflow/test/python/non_eager/test_comp_ratio_select.py</div><div id='m_class'> M Class Name: TestTrainingExtensionsCompRatioSelect</div><div id='n_method'> N Class Name: TestTrainingExtensionsCompRatioSelect</div><div id='m_method'> M Method Name: test_eval_scores(1)</div><div id='n_method'> N Method Name: test_eval_scores(1)</div><div id='m_parent_class'> M Parent Class: unittest.TestCase</div><div id='n_parent_class'> N Parent Class: unittest.TestCase</div><div id='m_file'> M File Name: TrainingExtensions/tensorflow/test/python/non_eager/test_comp_ratio_select.py</div><div id='n_file'> N File Name: TrainingExtensions/tensorflow/test/python/non_eager/test_comp_ratio_select.py</div><div id='m_start'> M Start Line: 142</div><div id='m_end'> M End Line: 166</div><div id='n_start'> N Start Line: 147</div><div id='n_end'> N End Line: 178</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        progress_bar.update()
        self.assertEqual(progress_bar.calculate_percentage_complete(), 100.0)
        bokeh_session.server_session.close("test complete")
        <a id="change">os.killpg(</a><a id="change">os.getpgid(</a>process.pid<a id="change">)</a>, signal.SIGTERM<a id="change">)</a>

    def test_show_zoomed_in_plot_from_start(self):
        layout = bokeh_plots.PlotsLayout()
</code></pre><h3>After Change</h3><pre><code class='java'>
        self.assertEqual(total_weights_expected, total_weights_actual)

    def test_progress_bar(self):
        <a id="change">process = </a>None
        <a id="change">try:
            </a>visualization_url, process = start_bokeh_server_session()
            bokeh_session = BokehServerSession(url=visualization_url, session_id="test")
            progress_bar = ProgressBar(total=10, bokeh_document=bokeh_session, title="testing", color="green")
            for i in range(10):
                progress_bar.update()
            progress_bar.update()
            self.assertEqual(progress_bar.calculate_percentage_complete(), 100.0)
            bokeh_session.server_session.close("test complete")
        finally:
            <a id="change">if process</a>:
                <a id="change">process.terminate()</a>
                <a id="change">process.join()</a>

    def test_show_zoomed_in_plot_from_start(self):
        layout = bokeh_plots.PlotsLayout()
</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/quic/aimet/commit/d11f625cdf15996474398087c124082490ab5404#diff-70c065dfc81b572cede9276c7f0a6be27898070cfb2d541e09685502856bc479L91' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 102903847</div><div id='project'> Project Name: quic/aimet</div><div id='commit'> Commit Name: d11f625cdf15996474398087c124082490ab5404</div><div id='time'> Time: 2023-05-02</div><div id='author'> Author: quic_kyunggeu@quicinc.com</div><div id='file'> File Name: TrainingExtensions/torch/test/python/test_plots_bokeh.py</div><div id='m_class'> M Class Name: VisualizeNetwork</div><div id='n_method'> N Class Name: VisualizeNetwork</div><div id='m_method'> M Method Name: test_progress_bar(1)</div><div id='n_method'> N Method Name: test_progress_bar(1)</div><div id='m_parent_class'> M Parent Class: unittest.TestCase</div><div id='n_parent_class'> N Parent Class: unittest.TestCase</div><div id='m_file'> M File Name: TrainingExtensions/torch/test/python/test_plots_bokeh.py</div><div id='n_file'> N File Name: TrainingExtensions/torch/test/python/test_plots_bokeh.py</div><div id='m_start'> M Start Line: 92</div><div id='m_end'> M End Line: 100</div><div id='n_start'> N Start Line: 92</div><div id='n_end'> N End Line: 107</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        sess.close()

        bokeh_session.server_session.close("test complete")
        <a id="change">os.killpg(</a><a id="change">os.getpgid(</a>process.pid<a id="change">)</a>, signal.SIGTERM<a id="change">)</a>

    def test_find_min_max_eval_scores(self):

        eval_scores_dict = {&quotlayer1&quot: {Decimal(&quot0.1&quot): 90, Decimal(&quot0.5&quot): 50, Decimal(&quot0.7&quot): 30, Decimal(&quot0.8&quot): 20},</code></pre><h3>After Change</h3><pre><code class='java'>

        layer_db.mark_picked_layers([layer1, layer2])

        <a id="change">process = </a>None
        <a id="change">try:
            </a>url, process = start_bokeh_server_session()
            bokeh_session = BokehServerSession(url=url, session_id="compression")

            &#47&#47 Instantiate child
            greedy_algo = comp_ratio_select.GreedyCompRatioSelectAlgo(layer_db=layer_db, pruner=pruner,
                                                                      cost_calculator=SpatialSvdCostCalculator(),
                                                                      eval_func=eval_func, eval_iterations=20,
                                                                      cost_metric=CostMetric.mac, target_comp_ratio=0.5,
                                                                      num_candidates=10, use_monotonic_fit=True,
                                                                      saved_eval_scores_dict=None,
                                                                      comp_ratio_rounding_algo=None, use_cuda=False,
                                                                      bokeh_session=bokeh_session)

            dict = greedy_algo._compute_eval_scores_for_all_comp_ratio_candidates()

            print()
            print(dict)
            self.assertEqual(90, dict[&quotconv2d/Conv2D&quot][Decimal(&quot0.1&quot)])

            self.assertEqual(51, dict[&quotconv2d_1/Conv2D&quot][Decimal(&quot0.5&quot)])
            self.assertEqual(21, dict[&quotconv2d_1/Conv2D&quot][Decimal(&quot0.8&quot)])

            tf.compat.v1.reset_default_graph()
            sess.close()

            bokeh_session.server_session.close("test complete")
        finally:
            <a id="change">if process</a>:
                <a id="change">process.terminate()</a>
                <a id="change">process.join()</a>

    def test_find_min_max_eval_scores(self):

        eval_scores_dict = {&quotlayer1&quot: {Decimal(&quot0.1&quot): 90, Decimal(&quot0.5&quot): 50, Decimal(&quot0.7&quot): 30, Decimal(&quot0.8&quot): 20},</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/quic/aimet/commit/d11f625cdf15996474398087c124082490ab5404#diff-281bed15783caf8fb9888aba402e472856aa7fe9ab81aa960bd3077d0e6bf477L168' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 102903845</div><div id='project'> Project Name: quic/aimet</div><div id='commit'> Commit Name: d11f625cdf15996474398087c124082490ab5404</div><div id='time'> Time: 2023-05-02</div><div id='author'> Author: quic_kyunggeu@quicinc.com</div><div id='file'> File Name: TrainingExtensions/tensorflow/test/python/non_eager/test_comp_ratio_select.py</div><div id='m_class'> M Class Name: TestTrainingExtensionsCompRatioSelect</div><div id='n_method'> N Class Name: TestTrainingExtensionsCompRatioSelect</div><div id='m_method'> M Method Name: test_eval_scores_with_spatial_svd_pruner(1)</div><div id='n_method'> N Method Name: test_eval_scores_with_spatial_svd_pruner(1)</div><div id='m_parent_class'> M Parent Class: unittest.TestCase</div><div id='n_parent_class'> N Parent Class: unittest.TestCase</div><div id='m_file'> M File Name: TrainingExtensions/tensorflow/test/python/non_eager/test_comp_ratio_select.py</div><div id='n_file'> N File Name: TrainingExtensions/tensorflow/test/python/non_eager/test_comp_ratio_select.py</div><div id='m_start'> M Start Line: 194</div><div id='m_end'> M End Line: 220</div><div id='n_start'> N Start Line: 204</div><div id='n_end'> N End Line: 237</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        &#47&#47 delete temp directory
        shutil.rmtree(str(&quot./temp_meta/&quot))

        <a id="change">os.killpg(</a><a id="change">os.getpgid(</a>process.pid<a id="change">)</a>, signal.SIGTERM<a id="change">)</a>

        sess.close()
</code></pre><h3>After Change</h3><pre><code class='java'>
        params = SpatialSvdParameters(input_op_names=[&quotreshape_input&quot], output_op_names=[&quotlinear/BiasAdd&quot],
                                      mode=SpatialSvdParameters.Mode.auto, params=auto_params)

        <a id="change">process = </a>None
        <a id="change">try:
            </a>url, process = start_bokeh_server_session()

            spatial_svd_algo = CompressionFactory.create_spatial_svd_algo(sess, None, eval_callback, 100, (1, 28, 28),
                                                                          CostMetric.mac, params, url)
            self.assertTrue(0 == 0)
            &#47&#47 delete temp directory
            shutil.rmtree(str(&quot./temp_meta/&quot))
            sess.close()
        finally:
            <a id="change">if process</a>:
                <a id="change">process.terminate()</a>
                <a id="change">process.join()</a>
</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/quic/aimet/commit/d11f625cdf15996474398087c124082490ab5404#diff-e4fc8eea4984dc3b3e7e9fd5fbcdab7f012eca5da436b076e6a24541b1e722d9L93' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 102903850</div><div id='project'> Project Name: quic/aimet</div><div id='commit'> Commit Name: d11f625cdf15996474398087c124082490ab5404</div><div id='time'> Time: 2023-05-02</div><div id='author'> Author: quic_kyunggeu@quicinc.com</div><div id='file'> File Name: TrainingExtensions/tensorflow/test/python/non_eager/test_compression_factory.py</div><div id='m_class'> M Class Name: TestTfCompressionFactory</div><div id='n_method'> N Class Name: TestTfCompressionFactory</div><div id='m_method'> M Method Name: test_spatial_svd_factory_with_bokeh_session(1)</div><div id='n_method'> N Method Name: test_spatial_svd_factory_with_bokeh_session(1)</div><div id='m_parent_class'> M Parent Class: unittest.TestCase</div><div id='n_parent_class'> N Parent Class: unittest.TestCase</div><div id='m_file'> M File Name: TrainingExtensions/tensorflow/test/python/non_eager/test_compression_factory.py</div><div id='n_file'> N File Name: TrainingExtensions/tensorflow/test/python/non_eager/test_compression_factory.py</div><div id='m_start'> M Start Line: 119</div><div id='m_end'> M End Line: 129</div><div id='n_start'> N Start Line: 119</div><div id='n_end'> N End Line: 132</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        sess.close()

        bokeh_session.server_session.close("test complete")
        <a id="change">os.killpg(</a><a id="change">os.getpgid(</a>process.pid<a id="change">)</a>, signal.SIGTERM<a id="change">)</a>

    def test_select_per_layer_comp_ratios_with_spatial_svd_pruner(self):

        pruner = SpatialSvdPruner()</code></pre><h3>After Change</h3><pre><code class='java'>
        except OSError:
            pass

        <a id="change">process = </a>None
        <a id="change">try:
            </a>url, process = start_bokeh_server_session()
            bokeh_session = BokehServerSession(url=url, session_id="compression")

            &#47&#47 Instantiate child
            greedy_algo = comp_ratio_select.GreedyCompRatioSelectAlgo(layer_db=layer_db, pruner=pruner,
                                                                      cost_calculator=SpatialSvdCostCalculator(),
                                                                      eval_func=eval_func, eval_iterations=20,
                                                                      cost_metric=CostMetric.mac,
                                                                      target_comp_ratio=Decimal(0.6), num_candidates=10,
                                                                      use_monotonic_fit=True, saved_eval_scores_dict=None,
                                                                      comp_ratio_rounding_algo=rounding_algo,
                                                                      use_cuda=False,
                                                                      bokeh_session=bokeh_session)

            layer_comp_ratio_list, stats = greedy_algo.select_per_layer_comp_ratios()

            original_cost = SpatialSvdCostCalculator.compute_model_cost(layer_db)

            for layer in layer_db:
                if layer not in selected_layers:
                    layer_comp_ratio_list.append(LayerCompRatioPair(layer, None))
            compressed_cost = SpatialSvdCostCalculator.calculate_compressed_cost(layer_db, layer_comp_ratio_list,
                                                                                 CostMetric.mac)
            rounding_algo.round.side_effect = [0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9,
                                               0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9]
            actual_compression_ratio = compressed_cost.mac / original_cost.mac
            self.assertTrue(math.isclose(Decimal(0.6), actual_compression_ratio, abs_tol=0.05))
            self.assertTrue(os.path.isfile(&quot./data/greedy_selection_eval_scores_dict.pkl&quot))

            print(&quot\n&quot)
            for pair in layer_comp_ratio_list:
                print(pair)

            &#47&#47 lets repeat with a saved eval_dict
            greedy_algo = comp_ratio_select.GreedyCompRatioSelectAlgo(layer_db=layer_db, pruner=pruner,
                                                                      cost_calculator=SpatialSvdCostCalculator(),
                                                                      eval_func=eval_func, eval_iterations=20,
                                                                      cost_metric=CostMetric.mac,
                                                                      target_comp_ratio=Decimal(0.6), num_candidates=10,
                                                                      use_monotonic_fit=True,
                                                                      saved_eval_scores_dict=&quot./data/greedy_selection_eval_scores_dict.pkl&quot,
                                                                      comp_ratio_rounding_algo=rounding_algo,
                                                                      use_cuda=False,
                                                                      bokeh_session=bokeh_session)

            layer_comp_ratio_list, stats = greedy_algo.select_per_layer_comp_ratios()

            original_cost = SpatialSvdCostCalculator.compute_model_cost(layer_db)

            for layer in layer_db:
                if layer not in selected_layers:
                    layer_comp_ratio_list.append(LayerCompRatioPair(layer, None))
            compressed_cost = SpatialSvdCostCalculator.calculate_compressed_cost(layer_db, layer_comp_ratio_list,
                                                                                 CostMetric.mac)

            actual_compression_ratio = compressed_cost.mac / original_cost.mac
            self.assertTrue(math.isclose(Decimal(0.6), actual_compression_ratio, abs_tol=0.05))

            print(&quot\n&quot)
            for pair in layer_comp_ratio_list:
                print(pair)

            tf.compat.v1.reset_default_graph()
            sess.close()

            bokeh_session.server_session.close("test complete")
        finally:
            <a id="change">if process</a>:
                <a id="change">process.terminate()</a>
                <a id="change">process.join()</a>

    def test_select_per_layer_comp_ratios_with_spatial_svd_pruner(self):

        pruner = SpatialSvdPruner()</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/quic/aimet/commit/d11f625cdf15996474398087c124082490ab5404#diff-281bed15783caf8fb9888aba402e472856aa7fe9ab81aa960bd3077d0e6bf477L286' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 102903851</div><div id='project'> Project Name: quic/aimet</div><div id='commit'> Commit Name: d11f625cdf15996474398087c124082490ab5404</div><div id='time'> Time: 2023-05-02</div><div id='author'> Author: quic_kyunggeu@quicinc.com</div><div id='file'> File Name: TrainingExtensions/tensorflow/test/python/non_eager/test_comp_ratio_select.py</div><div id='m_class'> M Class Name: TestTrainingExtensionsCompRatioSelect</div><div id='n_method'> N Class Name: TestTrainingExtensionsCompRatioSelect</div><div id='m_method'> M Method Name: test_select_per_layer_comp_ratios(1)</div><div id='n_method'> N Method Name: test_select_per_layer_comp_ratios(1)</div><div id='m_parent_class'> M Parent Class: unittest.TestCase</div><div id='n_parent_class'> N Parent Class: unittest.TestCase</div><div id='m_file'> M File Name: TrainingExtensions/tensorflow/test/python/non_eager/test_comp_ratio_select.py</div><div id='n_file'> N File Name: TrainingExtensions/tensorflow/test/python/non_eager/test_comp_ratio_select.py</div><div id='m_start'> M Start Line: 322</div><div id='m_end'> M End Line: 388</div><div id='n_start'> N Start Line: 337</div><div id='n_end'> N End Line: 410</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        sess.close()

        bokeh_session.server_session.close("test complete")
        <a id="change">os.killpg(</a><a id="change">os.getpgid(</a>process.pid<a id="change">)</a>, signal.SIGTERM<a id="change">)</a>
</code></pre><h3>After Change</h3><pre><code class='java'>
        selected_layers = [layer for layer in layer_db if layer.module.type == &quotConv2D&quot]
        layer_db.mark_picked_layers(selected_layers)

        <a id="change">process = </a>None
        <a id="change">try:
            </a>url, process = start_bokeh_server_session()
            bokeh_session = BokehServerSession(url=url, session_id="compression")

            &#47&#47 Instantiate child
            greedy_algo = comp_ratio_select.GreedyCompRatioSelectAlgo(layer_db=layer_db, pruner=pruner,
                                                                      cost_calculator=SpatialSvdCostCalculator(),
                                                                      eval_func=eval_func, eval_iterations=20,
                                                                      cost_metric=CostMetric.mac,
                                                                      target_comp_ratio=Decimal(0.4), num_candidates=10,
                                                                      use_monotonic_fit=True, saved_eval_scores_dict=None,
                                                                      comp_ratio_rounding_algo=rounding_algo,
                                                                      use_cuda=False,
                                                                      bokeh_session=bokeh_session)

            layer_comp_ratio_list, stats = greedy_algo.select_per_layer_comp_ratios()

            original_cost = SpatialSvdCostCalculator.compute_model_cost(layer_db)

            for layer in layer_db:
                if layer not in selected_layers:
                    layer_comp_ratio_list.append(LayerCompRatioPair(layer, None))
            compressed_cost = SpatialSvdCostCalculator.calculate_compressed_cost(layer_db, layer_comp_ratio_list,
                                                                                 CostMetric.mac)

            actual_compression_ratio = compressed_cost.mac / original_cost.mac
            self.assertTrue(math.isclose(Decimal(0.3), actual_compression_ratio, abs_tol=0.8))

            print(&quot\n&quot)
            for pair in layer_comp_ratio_list:
                print(pair)

            tf.compat.v1.reset_default_graph()
            sess.close()

            bokeh_session.server_session.close("test complete")
        finally:
            <a id="change">if process</a>:
                <a id="change">process.terminate()</a>
                <a id="change">process.join()</a>
</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/quic/aimet/commit/d11f625cdf15996474398087c124082490ab5404#diff-281bed15783caf8fb9888aba402e472856aa7fe9ab81aa960bd3077d0e6bf477L390' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 102903848</div><div id='project'> Project Name: quic/aimet</div><div id='commit'> Commit Name: d11f625cdf15996474398087c124082490ab5404</div><div id='time'> Time: 2023-05-02</div><div id='author'> Author: quic_kyunggeu@quicinc.com</div><div id='file'> File Name: TrainingExtensions/tensorflow/test/python/non_eager/test_comp_ratio_select.py</div><div id='m_class'> M Class Name: TestTrainingExtensionsCompRatioSelect</div><div id='n_method'> N Class Name: TestTrainingExtensionsCompRatioSelect</div><div id='m_method'> M Method Name: test_select_per_layer_comp_ratios_with_spatial_svd_pruner(1)</div><div id='n_method'> N Method Name: test_select_per_layer_comp_ratios_with_spatial_svd_pruner(1)</div><div id='m_parent_class'> M Parent Class: unittest.TestCase</div><div id='n_parent_class'> N Parent Class: unittest.TestCase</div><div id='m_file'> M File Name: TrainingExtensions/tensorflow/test/python/non_eager/test_comp_ratio_select.py</div><div id='n_file'> N File Name: TrainingExtensions/tensorflow/test/python/non_eager/test_comp_ratio_select.py</div><div id='m_start'> M Start Line: 418</div><div id='m_end'> M End Line: 453</div><div id='n_start'> N Start Line: 438</div><div id='n_end'> N End Line: 478</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        sess.close()

        bokeh_session.server_session.close("test complete")
        <a id="change">os.killpg(</a><a id="change">os.getpgid(</a>process.pid<a id="change">)</a>, signal.SIGTERM<a id="change">)</a>

    def test_eval_scores(self):

        pruner = unittest.mock.MagicMock()</code></pre><h3>After Change</h3><pre><code class='java'>
        layer_db.mark_picked_layers([layer1])
        eval_func.side_effect = [90, 80, 70, 60, 50, 40, 30, 20, 10]

        <a id="change">process = </a>None
        <a id="change">try:
            </a>url, process = start_bokeh_server_session()
            bokeh_session = BokehServerSession(url=url, session_id="compression")

            &#47&#47 Instantiate child
            greedy_algo = comp_ratio_select.GreedyCompRatioSelectAlgo(layer_db=layer_db, pruner=pruner,
                                                                      cost_calculator=SpatialSvdCostCalculator(),
                                                                      eval_func=eval_func, eval_iterations=20,
                                                                      cost_metric=CostMetric.mac, target_comp_ratio=0.5,
                                                                      num_candidates=10, use_monotonic_fit=True,
                                                                      saved_eval_scores_dict=None,
                                                                      comp_ratio_rounding_algo=None, use_cuda=False,
                                                                      bokeh_session=bokeh_session)
            progress_bar = ProgressBar(1, "eval scores", "green", bokeh_document=bokeh_session)
            data_table = DataTable(num_columns=3, num_rows=1,
                                   column_names=[&quot0.1&quot, &quot0.2&quot, &quot0.3&quot, &quot0.4&quot, &quot0.5&quot, &quot0.6&quot, &quot0.7&quot, &quot0.8&quot, &quot0.9&quot],
                                   row_index_names=[layer1.name], bokeh_document=bokeh_session)

            pruner.prune_model.return_value = layer_db
            eval_dict = greedy_algo._compute_layerwise_eval_score_per_comp_ratio_candidate(data_table, progress_bar, layer1)

            self.assertEqual(90, eval_dict[Decimal(&quot0.1&quot)])

            tf.compat.v1.reset_default_graph()
            sess.close()

            bokeh_session.server_session.close("test complete")
        finally:
            <a id="change">if process</a>:
                <a id="change">process.terminate()</a>
                <a id="change">process.join()</a>

    def test_eval_scores(self):

        pruner = unittest.mock.MagicMock()</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/quic/aimet/commit/d11f625cdf15996474398087c124082490ab5404#diff-281bed15783caf8fb9888aba402e472856aa7fe9ab81aa960bd3077d0e6bf477L64' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 102903849</div><div id='project'> Project Name: quic/aimet</div><div id='commit'> Commit Name: d11f625cdf15996474398087c124082490ab5404</div><div id='time'> Time: 2023-05-02</div><div id='author'> Author: quic_kyunggeu@quicinc.com</div><div id='file'> File Name: TrainingExtensions/tensorflow/test/python/non_eager/test_comp_ratio_select.py</div><div id='m_class'> M Class Name: TestTrainingExtensionsCompRatioSelect</div><div id='n_method'> N Class Name: TestTrainingExtensionsCompRatioSelect</div><div id='m_method'> M Method Name: test_per_layer_eval_scores(1)</div><div id='n_method'> N Method Name: test_per_layer_eval_scores(1)</div><div id='m_parent_class'> M Parent Class: unittest.TestCase</div><div id='n_parent_class'> N Parent Class: unittest.TestCase</div><div id='m_file'> M File Name: TrainingExtensions/tensorflow/test/python/non_eager/test_comp_ratio_select.py</div><div id='n_file'> N File Name: TrainingExtensions/tensorflow/test/python/non_eager/test_comp_ratio_select.py</div><div id='m_start'> M Start Line: 88</div><div id='m_end'> M End Line: 114</div><div id='n_start'> N Start Line: 88</div><div id='n_end'> N End Line: 121</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
            progress_bar.update()
        progress_bar.update()
        bokeh_session.server_session.close("test complete")
        <a id="change">os.killpg(</a><a id="change">os.getpgid(</a>process.pid<a id="change">)</a>, signal.SIGTERM<a id="change">)</a>

    def test_module_data_frame_mapping(self):
        layer_weights_map = plotting_utils.map_all_module_weights_to_data_frame(model)
</code></pre><h3>After Change</h3><pre><code class='java'>
        layout.complete_layout()

    def test_invoke_progress_bar(self):
        <a id="change">process = </a>None
        <a id="change">try:
            </a>visualization_url, process = start_bokeh_server_session()
            bokeh_session = BokehServerSession(url=visualization_url, session_id="test")
            progress_bar = ProgressBar(80, title="Some Title Goes Here", color="green", bokeh_document=bokeh_session)

            for i in range(80):
                progress_bar.update()
            progress_bar.update()
            bokeh_session.server_session.close("test complete")
        finally:
            <a id="change">if process</a>:
                <a id="change">process.terminate()</a>
                <a id="change">process.join()</a>

    def test_module_data_frame_mapping(self):
        layer_weights_map = plotting_utils.map_all_module_weights_to_data_frame(model)
</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/quic/aimet/commit/d11f625cdf15996474398087c124082490ab5404#diff-70c065dfc81b572cede9276c7f0a6be27898070cfb2d541e09685502856bc479L117' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 102903852</div><div id='project'> Project Name: quic/aimet</div><div id='commit'> Commit Name: d11f625cdf15996474398087c124082490ab5404</div><div id='time'> Time: 2023-05-02</div><div id='author'> Author: quic_kyunggeu@quicinc.com</div><div id='file'> File Name: TrainingExtensions/torch/test/python/test_plots_bokeh.py</div><div id='m_class'> M Class Name: VisualizeNetwork</div><div id='n_method'> N Class Name: VisualizeNetwork</div><div id='m_method'> M Method Name: test_invoke_progress_bar(1)</div><div id='n_method'> N Method Name: test_invoke_progress_bar(1)</div><div id='m_parent_class'> M Parent Class: unittest.TestCase</div><div id='n_parent_class'> N Parent Class: unittest.TestCase</div><div id='m_file'> M File Name: TrainingExtensions/torch/test/python/test_plots_bokeh.py</div><div id='n_file'> N File Name: TrainingExtensions/torch/test/python/test_plots_bokeh.py</div><div id='m_start'> M Start Line: 118</div><div id='m_end'> M End Line: 126</div><div id='n_start'> N Start Line: 123</div><div id='n_end'> N End Line: 138</div><BR>