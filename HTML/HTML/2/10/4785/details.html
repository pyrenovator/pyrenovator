<html><h3>Pattern ID :4785
</h3><img src='16931266.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
        for example_artifact in examples:
            for split in artifact_utils.decode_split_names(
                    example_artifact.split_names):
                example_uris[split]<a id="change"> = </a>artifact_utils.get_split_uri(
                    <a id="change">[</a>example_artifact<a id="change"></a>], split)

        output_examples.split_names = artifact_utils.encode_split_names(
            sorted(example_uris.keys()))</code></pre><h3>After Change</h3><pre><code class='java'>
        output_examples = artifact_utils.get_single_instance(
            output_dict[PREDICTIONS])

        <a id="change">if EXAMPLES not in input_dict</a>:
            raise ValueError(&quot\&quotexamples\&quot is missing in input dict.&quot)
        <a id="change">if </a>MODEL not in input_dict:
            raise ValueError(&quotInput models are not valid, model &quot
                             &quotneed to be specified.&quot)
        if MODEL_BLESSING in input_dict:
            model_blessing = artifact_utils.get_single_instance(
                input_dict[&quotmodel_blessing&quot])
            if not model_utils.is_model_blessed(model_blessing):
                <a id="change">logging.info(&quotModel on %s was not blessed&quot</a>, model_blessing.uri<a id="change">)</a>
                return
        else:
            <a id="change">logging.info(
                &quotModel blessing is not provided, exported model will be &quot
                &quotused.&quot</a><a id="change">)</a>

        model = artifact_utils.get_single_instance(
            input_dict[MODEL])
        model_path = path_utils.serving_model_path(model.uri)</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 7</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/maiot-io/zenml/commit/1f86eb5ae94e0dc71caf2edadd7a41f84a41fa35#diff-549acfa988fe6f9d971198bf183f103ffd348f89f78ce1e80ac7b8d886933c72L49' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 16931266</div><div id='project'> Project Name: maiot-io/zenml</div><div id='commit'> Commit Name: 1f86eb5ae94e0dc71caf2edadd7a41f84a41fa35</div><div id='time'> Time: 2021-03-18</div><div id='author'> Author: bariscandurak@hotmail.com</div><div id='file'> File Name: zenml/components/bulk_inferrer/executor.py</div><div id='m_class'> M Class Name: BulkInferrerExecutor</div><div id='n_method'> N Class Name: BulkInferrerExecutor</div><div id='m_method'> M Method Name: Do(4)</div><div id='n_method'> N Method Name: Do(4)</div><div id='m_parent_class'> M Parent Class: base_executor.BaseExecutor</div><div id='n_parent_class'> N Parent Class: base_executor.BaseExecutor</div><div id='m_file'> M File Name: zenml/components/bulk_inferrer/executor.py</div><div id='n_file'> N File Name: zenml/components/bulk_inferrer/executor.py</div><div id='m_start'> M Start Line: 49</div><div id='m_end'> M End Line: 101</div><div id='n_start'> N Start Line: 63</div><div id='n_end'> N End Line: 111</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        self.observable = SimpleNamespace()

        if &quotlocal_energy&quot not in obs_name:
            obs_name<a id="change"> += </a><a id="change">[</a>&quotlocal_energy&quot<a id="change"></a>]

        if self.task == &quotgeo_opt&quot and &quotgeometry&quot not in obs_name:
            obs_name += [&quotgeometry&quot]</code></pre><h3>After Change</h3><pre><code class='java'>
        valid_obs_name = [&quotenergy&quot, &quotlocal_energy&quot,
                          &quotgeometry&quot, &quotparameters&quot, &quotgradients&quot]
        for name in obs_name:
            <a id="change">if name in valid_obs_name</a>:
                continue
            elif <a id="change"></a>hasattr(self.wf, name):
                continue
            else:
                log.info(
                    &quot   Error : Observable %s not recognized&quot % name)
                <a id="change">log.info(&quot         : Possible observable&quot</a><a id="change">)</a>
                for n in valid_obs_name:
                    log.info(&quot         :  - %s&quot % n)
                <a id="change">log.info(
                    &quot         :  - or any method of the wave function&quot</a><a id="change">)</a>
                raise ValueError(&quotObservable not recognized&quot)

        &#47&#47 reset the Namesapce
        self.observable = SimpleNamespace()</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/nlesc-jcer/qmctorch/commit/0b6cce75bd861a38ecc4f52a50452465bb72f4a1#diff-8f57aa5a120bbb08db09f2679603f22d7137d3819dc1c0810e8bc0e8666f9e7eL171' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 16931218</div><div id='project'> Project Name: nlesc-jcer/qmctorch</div><div id='commit'> Commit Name: 0b6cce75bd861a38ecc4f52a50452465bb72f4a1</div><div id='time'> Time: 2020-06-18</div><div id='author'> Author: nicolas.gm.renaud@gmail.com</div><div id='file'> File Name: qmctorch/solver/solver_base.py</div><div id='m_class'> M Class Name: SolverBase</div><div id='n_method'> N Class Name: SolverBase</div><div id='m_method'> M Method Name: track_observable(2)</div><div id='n_method'> N Method Name: track_observable(2)</div><div id='m_parent_class'> M Parent Class: object</div><div id='n_parent_class'> N Parent Class: object</div><div id='m_file'> M File Name: qmctorch/solver/solver_base.py</div><div id='n_file'> N File Name: qmctorch/solver/solver_base.py</div><div id='m_start'> M Start Line: 182</div><div id='m_end'> M End Line: 197</div><div id='n_start'> N Start Line: 180</div><div id='n_end'> N End Line: 228</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>

        examples = input_dict[EXAMPLES]

        example_uris = <a id="change">{}</a>
        for example_artifact in examples:
            for split in artifact_utils.decode_split_names(
                    example_artifact.split_names):
                example_uris[split] = artifact_utils.get_split_uri(
                    [example_artifact], split)

        output_examples.split_names<a id="change"> = </a>artifact_utils.encode_split_names(
            sorted(example_uris.keys()))

        with self._make_beam_pipeline() as pipeline:</code></pre><h3>After Change</h3><pre><code class='java'>

        if EXAMPLES not in input_dict:
            raise ValueError(&quot\&quotexamples\&quot is missing in input dict.&quot)
        <a id="change">if MODEL not in input_dict</a>:
            raise ValueError(&quotInput models are not valid, model &quot
                             &quotneed to be specified.&quot)
        <a id="change">if </a>MODEL_BLESSING in input_dict:
            model_blessing = artifact_utils.get_single_instance(
                input_dict[&quotmodel_blessing&quot])
            if not model_utils.is_model_blessed(model_blessing):
                <a id="change">logging.info(&quotModel on %s was not blessed&quot</a>, model_blessing.uri<a id="change">)</a>
                return
        else:
            <a id="change">logging.info(
                &quotModel blessing is not provided, exported model will be &quot
                &quotused.&quot</a><a id="change">)</a>

        model = artifact_utils.get_single_instance(
            input_dict[MODEL])
        model_path = path_utils.serving_model_path(model.uri)</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/maiot-io/zenml/commit/1f86eb5ae94e0dc71caf2edadd7a41f84a41fa35#diff-549acfa988fe6f9d971198bf183f103ffd348f89f78ce1e80ac7b8d886933c72L40' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 16931201</div><div id='project'> Project Name: maiot-io/zenml</div><div id='commit'> Commit Name: 1f86eb5ae94e0dc71caf2edadd7a41f84a41fa35</div><div id='time'> Time: 2021-03-18</div><div id='author'> Author: bariscandurak@hotmail.com</div><div id='file'> File Name: zenml/components/bulk_inferrer/executor.py</div><div id='m_class'> M Class Name: BulkInferrerExecutor</div><div id='n_method'> N Class Name: BulkInferrerExecutor</div><div id='m_method'> M Method Name: Do(4)</div><div id='n_method'> N Method Name: Do(4)</div><div id='m_parent_class'> M Parent Class: base_executor.BaseExecutor</div><div id='n_parent_class'> N Parent Class: base_executor.BaseExecutor</div><div id='m_file'> M File Name: zenml/components/bulk_inferrer/executor.py</div><div id='n_file'> N File Name: zenml/components/bulk_inferrer/executor.py</div><div id='m_start'> M Start Line: 49</div><div id='m_end'> M End Line: 101</div><div id='n_start'> N Start Line: 63</div><div id='n_end'> N End Line: 111</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>

def set_failed(job_id: int, end_time: Optional[float] = None):
    end_time = time.time() if end_time is None else end_time
    fields_to_set<a id="change"> = </a><a id="change">{
        </a>&quotend_at&quot: end_time,
        &quotstatus&quot: SpotStatus.FAILED.value<a id="change">,
    }</a>
    previsou_status = _CURSOR.execute(
        &quotSELECT status FROM spot WHERE job_id=(?)&quot, (job_id,)).fetchone()
    previsou_status = SpotStatus(previsou_status[0])
    if previsou_status in [SpotStatus.RECOVERING]:</code></pre><h3>After Change</h3><pre><code class='java'>
        WHERE job_id=(?) AND end_at IS null,
        (*list(fields_to_set.values()), job_id))
    _CONN.commit()
    <a id="change">if failure_type == SpotStatus.FAILED</a>:
        logger.info(&quotJob failed due to user code.&quot)
    elif <a id="change"></a>failure_type == SpotStatus.FAILED_NO_RESOURCE:
        <a id="change">logger.info(&quotJob failed due to failing to find available resources &quot
                    &quotafter retries.&quot</a><a id="change">)</a>
    else:
        assert failure_type == SpotStatus.FAILED_CONTROLLER, failure_type
        <a id="change">logger.info(&quotJob failed due to unexpected controller failure.&quot</a><a id="change">)</a>


def set_cancelled(job_id: int):
    _CURSOR.execute(</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/skypilot-org/skypilot/commit/cbe326fbb9a547a1cf452dfa1a5c2d568266180c#diff-3cff00e999e9b517692ce089946e1988672533b2546431d351512773263e90e5L130' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 16931223</div><div id='project'> Project Name: skypilot-org/skypilot</div><div id='commit'> Commit Name: cbe326fbb9a547a1cf452dfa1a5c2d568266180c</div><div id='time'> Time: 2022-06-01</div><div id='author'> Author: zhanghao.wu@outlook.com</div><div id='file'> File Name: sky/spot/spot_state.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: set_failed(3)</div><div id='n_method'> N Method Name: set_failed(2)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: sky/spot/spot_state.py</div><div id='n_file'> N File Name: sky/spot/spot_state.py</div><div id='m_start'> M Start Line: 131</div><div id='m_end'> M End Line: 153</div><div id='n_start'> N Start Line: 134</div><div id='n_end'> N End Line: 171</div><BR>