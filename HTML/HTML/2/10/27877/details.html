<html><h3>Pattern ID :27877
</h3><img src='82810936.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
                    ret_code, out, err = ClientConstants.get_console_pipe_out_err_results(process)
                    if out is not None:
                        out_str = out.decode(encoding="utf-8")
                        <a id="change">if str(out_str).find(FedMLClientRunner.FEDML_BOOTSTRAP_RUN_OK) == -1</a> \
                                and str(out_str).lstrip(&quot &quot).rstrip(&quot &quot) != &quot&quot:
                            <a id="change">logging.error("{}".format(</a>out_str<a id="change">)</a><a id="change">)</a>
                            is_bootstrap_run_ok<a id="change"> = </a>False
                        else:
                            logging.info("{}".format(out_str))
                    if err is not None:</code></pre><h3>After Change</h3><pre><code class='java'>
                    process = ClientConstants.exec_console_with_script(bootstrap_scripts, should_capture_stdout=True,
                                                                       should_capture_stderr=True)
                    ret_code, out, err = ClientConstants.get_console_pipe_out_err_results(process)
                    <a id="change">if </a><a id="change">ret_code is None or ret_code == 0</a>:
                        out_str = out.decode(encoding="utf-8")
                        if out_str != "":
                            logging.info("{}".format(out_str))

                        sys_utils.log_return_info(bootstrap_script_file, ret_code)

                        is_bootstrap_run_ok<a id="change"> = </a>True
                    else:
                        if err is not None:
                            err_str = err.decode(encoding="utf-8")
                            if err_str != "":
                                logging.error("{}".format(err_str))

                        sys_utils.log_return_info(bootstrap_script_file, ret_code)

                        is_bootstrap_run_ok<a id="change"> = </a>False
        except Exception as e:
            logging.error("Bootstrap script error: {}".format(traceback.format_exc()))
            is_bootstrap_run_ok = False</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 9</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/fedml-ai/fedml/commit/55b530e94f5d447a7a3133fc6ec3727630360034#diff-e80d580c8c52b12fe048ba58db4ca171ad8dccec37aa7c8fad24e42431a5e803L238' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 82810936</div><div id='project'> Project Name: fedml-ai/fedml</div><div id='commit'> Commit Name: 55b530e94f5d447a7a3133fc6ec3727630360034</div><div id='time'> Time: 2023-02-08</div><div id='author'> Author: alexliang.kh@gmail.com</div><div id='file'> File Name: python/fedml/cli/edge_deployment/client_runner.py</div><div id='m_class'> M Class Name: FedMLClientRunner</div><div id='n_method'> N Class Name: FedMLClientRunner</div><div id='m_method'> M Method Name: build_dynamic_args(4)</div><div id='n_method'> N Method Name: build_dynamic_args(4)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: python/fedml/cli/edge_deployment/client_runner.py</div><div id='n_file'> N File Name: python/fedml/cli/edge_deployment/client_runner.py</div><div id='m_start'> M Start Line: 272</div><div id='m_end'> M End Line: 288</div><div id='n_start'> N Start Line: 238</div><div id='n_end'> N End Line: 289</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
                    ret_code, out, err = ClientConstants.get_console_pipe_out_err_results(process)
                    if out is not None:
                        out_str = out.decode(encoding="utf-8")
                        <a id="change">if </a>str(out_str).find(FedMLClientRunner.FEDML_BOOTSTRAP_RUN_OK) == -1 \
                                and <a id="change">str(out_str).lstrip(&quot &quot).rstrip(&quot &quot) != &quot&quot</a>:
                            <a id="change">logging.error("{}".format(</a>out_str<a id="change">)</a><a id="change">)</a>
                            is_bootstrap_run_ok<a id="change"> = </a>False
                        else:
                            logging.info("{}".format(out_str))
                    if err is not None:</code></pre><h3>After Change</h3><pre><code class='java'>
                    process = ClientConstants.exec_console_with_script(bootstrap_scripts, should_capture_stdout=True,
                                                                       should_capture_stderr=True)
                    ret_code, out, err = ClientConstants.get_console_pipe_out_err_results(process)
                    <a id="change">if </a><a id="change">ret_code is None or ret_code == 0</a>:
                        out_str = out.decode(encoding="utf-8")
                        if out_str != "":
                            logging.info("{}".format(out_str))

                        sys_utils.log_return_info(bootstrap_script_file, ret_code)

                        is_bootstrap_run_ok<a id="change"> = </a>True
                    else:
                        if err is not None:
                            err_str = err.decode(encoding="utf-8")
                            if err_str != "":
                                logging.error("{}".format(err_str))

                        sys_utils.log_return_info(bootstrap_script_file, ret_code)

                        is_bootstrap_run_ok<a id="change"> = </a>False
        except Exception as e:
            logging.error("Bootstrap script error: {}".format(traceback.format_exc()))
            is_bootstrap_run_ok = False</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/fedml-ai/fedml/commit/c4d450d5441e5b910b39e5ff1758d3787848cf66#diff-e80d580c8c52b12fe048ba58db4ca171ad8dccec37aa7c8fad24e42431a5e803L209' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 82810935</div><div id='project'> Project Name: fedml-ai/fedml</div><div id='commit'> Commit Name: c4d450d5441e5b910b39e5ff1758d3787848cf66</div><div id='time'> Time: 2023-02-08</div><div id='author'> Author: alex.gpt.llm@gmail.com</div><div id='file'> File Name: python/fedml/cli/edge_deployment/client_runner.py</div><div id='m_class'> M Class Name: FedMLClientRunner</div><div id='n_method'> N Class Name: FedMLClientRunner</div><div id='m_method'> M Method Name: build_dynamic_args(4)</div><div id='n_method'> N Method Name: build_dynamic_args(4)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: python/fedml/cli/edge_deployment/client_runner.py</div><div id='n_file'> N File Name: python/fedml/cli/edge_deployment/client_runner.py</div><div id='m_start'> M Start Line: 272</div><div id='m_end'> M End Line: 288</div><div id='n_start'> N Start Line: 238</div><div id='n_end'> N End Line: 289</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
            )
        )
    else:
        <a id="change">if hub_modelID is None</a>:
            <a id="change">logger.error(
                "Requested file {} does not exists locally. It can be downloaded from HuggingFace ModelHub using &quothub_modelID&quot argument".format(
                    </a>filename<a id="change">
                )</a><a id="change">
            )</a>
            raise FileNotFoundError

        os.makedirs(local_path, exist_ok=True)

        url = huggingface_hub.hf_hub_url(hub_modelID, filename)
        logger.info(
            "Downloading requested file {} from {}.".format(filename, url)
        )

        fetched_file<a id="change"> = </a>huggingface_hub.cached_download(
            url, cache_dir=local_path, **download_kwargs
        )
</code></pre><h3>After Change</h3><pre><code class='java'>
    savedir.mkdir(exist_ok=True)
    sourcefile = f"{source}/{filename}"
    destination = savedir / filename
    <a id="change">if </a><a id="change">source.startswith("http://") or source.startswith("https://")</a>:
        &#47&#47 Interpret source as web address.
        &#47&#47 Download
        try:
            urllib.request.urlretrieve(sourcefile, destination)
        except urllib.error.URLError:
            raise ValueError(
                f"Interpreted {source} as web address, but could not download."
            )
    elif pathlib.Path(source).is_dir():
        &#47&#47 Interpret source as local directory path
        &#47&#47 Just symlink
        sourcepath<a id="change"> = </a>pathlib.Path(sourcefile).absolute()
        destination.unlink(missing_ok=True)
        destination.symlink_to(sourcepath)
    else:
        &#47&#47 Interpret source as huggingface hub ID
        &#47&#47 Use huggingface hub&quots fancy cached download.
        try:
            import huggingface_hub
        except ImportError:
            &#47&#47 Extra tools pattern:
            raise ValueError(
                f"Interpreted {source} as Huggingface hub ID, but Huggingface-hub"
                "is not installed. Please install with pip install huggingface-hub"
            )
        url = huggingface_hub.hf_hub_url(source, filename)
        fetched_file<a id="change"> = </a>huggingface_hub.cached_download(url, cache_dir=savedir)
        &#47&#47 Huggingface hub downloads to etag filename, symlink to the expected one:
        sourcepath = pathlib.Path(fetched_file).absolute()
        destination.unlink(missing_ok=True)</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/speechbrain/speechbrain/commit/bddc7b68453731ac3cac39e3dc8e33b6e447f8f2#diff-6332605fb909b83ff80819220ae5281dc964c4ecd14251a925a5f43e8f05e98fL25' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 82810930</div><div id='project'> Project Name: speechbrain/speechbrain</div><div id='commit'> Commit Name: bddc7b68453731ac3cac39e3dc8e33b6e447f8f2</div><div id='time'> Time: 2021-02-26</div><div id='author'> Author: aku.rouhe@aalto.fi</div><div id='file'> File Name: speechbrain/pretrained/fetching.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: fetch(3)</div><div id='n_method'> N Method Name: fetch(3)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: speechbrain/pretrained/fetching.py</div><div id='n_file'> N File Name: speechbrain/pretrained/fetching.py</div><div id='m_start'> M Start Line: 25</div><div id='m_end'> M End Line: 56</div><div id='n_start'> N Start Line: 10</div><div id='n_end'> N End Line: 79</div><BR>