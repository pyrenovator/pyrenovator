<html><h3>Pattern ID :18355
</h3><img src='60059173.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
            task=Tasks.multi_modal_embedding)
        test_str_embedding = pipe_line_multi_modal_embedding(
            self.test_text)[&quottext_embedding&quot]
        print(np.sum(<a id="change">np.abs(test_str_embedding</a><a id="change">)</a>))


if __name__ == &quot__main__&quot:</code></pre><h3>After Change</h3><pre><code class='java'>
        pipeline_multi_modal_embedding = pipeline(
            task=Tasks.multi_modal_embedding,
            model_revision=self.model_version)
        <a id="change">text_embedding</a> = pipeline_multi_modal_embedding(
            self.test_input)[OutputKeys.TEXT_EMBEDDING]
        print(&quotl1-norm: {}&quot.format(
            <a id="change">torch.norm(text_embedding</a><a id="change">, p=1, dim=-1)</a>.item()))
        <a id="change">print(&quotl2-norm: {}&quot.format(torch.norm(text_embedding,
                                              dim=-1).item()</a><a id="change">)</a><a id="change">)</a>  &#47&#47 should be 1.0


if __name__ == &quot__main__&quot:</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 6</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/modelscope/modelscope/commit/4c08bd752a7faf06ab4a6d5de29f663e0e08066e#diff-836f964587f88e24ea34b86099821bc70189e07c657f6127cea3250567031a8cL46' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 60059173</div><div id='project'> Project Name: modelscope/modelscope</div><div id='commit'> Commit Name: 4c08bd752a7faf06ab4a6d5de29f663e0e08066e</div><div id='time'> Time: 2022-08-17</div><div id='author'> Author: ya235025@alibaba-inc.com</div><div id='file'> File Name: tests/pipelines/test_multi_modal_embedding.py</div><div id='m_class'> M Class Name: MultiModalEmbeddingTest</div><div id='n_method'> N Class Name: MultiModalEmbeddingTest</div><div id='m_method'> M Method Name: test_run_with_default_model(1)</div><div id='n_method'> N Method Name: test_run_with_default_model(1)</div><div id='m_parent_class'> M Parent Class: unittest.TestCase</div><div id='n_parent_class'> N Parent Class: unittest.TestCase</div><div id='m_file'> M File Name: tests/pipelines/test_multi_modal_embedding.py</div><div id='n_file'> N File Name: tests/pipelines/test_multi_modal_embedding.py</div><div id='m_start'> M Start Line: 46</div><div id='m_end'> M End Line: 48</div><div id='n_start'> N Start Line: 51</div><div id='n_end'> N End Line: 56</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
    def test_run(self):
        pipe_line_multi_modal_embedding = pipeline(
            Tasks.multi_modal_embedding, model=self.model_id)
        <a id="change">test_str_embedding</a> = pipe_line_multi_modal_embedding(
            self.test_text)[&quottext_embedding&quot]
        print(np.sum(<a id="change">np.abs(</a>test_str_embedding<a id="change">)</a>))

    @unittest.skipUnless(test_level() &gt;= 2, &quotskip test in current test level&quot)
    def test_run_with_model_from_modelhub(self):</code></pre><h3>After Change</h3><pre><code class='java'>
            Tasks.multi_modal_embedding,
            model=self.model_id,
            model_revision=self.model_version)
        <a id="change">text_embedding</a> = pipeline_multi_modal_embedding(
            self.test_input)[OutputKeys.TEXT_EMBEDDING]
        print(&quotl1-norm: {}&quot.format(
            <a id="change">torch.norm(</a>text_embedding<a id="change">, p=1, dim=-1)</a>.item()))
        <a id="change">print(&quotl2-norm: {}&quot.format(torch.norm(text_embedding,
                                              dim=-1).item()</a><a id="change">)</a><a id="change">)</a>  &#47&#47 should be 1.0

    @unittest.skipUnless(test_level() &gt;= 1, &quotskip test in current test level&quot)
    def test_run_with_model_from_modelhub(self):</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/modelscope/modelscope/commit/4c08bd752a7faf06ab4a6d5de29f663e0e08066e#diff-836f964587f88e24ea34b86099821bc70189e07c657f6127cea3250567031a8cL18' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 60059168</div><div id='project'> Project Name: modelscope/modelscope</div><div id='commit'> Commit Name: 4c08bd752a7faf06ab4a6d5de29f663e0e08066e</div><div id='time'> Time: 2022-08-17</div><div id='author'> Author: ya235025@alibaba-inc.com</div><div id='file'> File Name: tests/pipelines/test_multi_modal_embedding.py</div><div id='m_class'> M Class Name: MultiModalEmbeddingTest</div><div id='n_method'> N Class Name: MultiModalEmbeddingTest</div><div id='m_method'> M Method Name: test_run(1)</div><div id='n_method'> N Method Name: test_run(1)</div><div id='m_parent_class'> M Parent Class: unittest.TestCase</div><div id='n_parent_class'> N Parent Class: unittest.TestCase</div><div id='m_file'> M File Name: tests/pipelines/test_multi_modal_embedding.py</div><div id='n_file'> N File Name: tests/pipelines/test_multi_modal_embedding.py</div><div id='m_start'> M Start Line: 21</div><div id='m_end'> M End Line: 23</div><div id='n_start'> N Start Line: 25</div><div id='n_end'> N End Line: 30</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        model = Model.from_pretrained(self.model_id)
        pipe_line_multi_modal_embedding = pipeline(
            task=Tasks.multi_modal_embedding, model=model)
        <a id="change">test_str_embedding</a> = pipe_line_multi_modal_embedding(
            self.test_text)[&quottext_embedding&quot]
        print(np.sum(<a id="change">np.abs(</a>test_str_embedding<a id="change">)</a>))

    @unittest.skipUnless(test_level() &gt;= 2, &quotskip test in current test level&quot)
    def test_run_with_model_name(self):</code></pre><h3>After Change</h3><pre><code class='java'>
            task=Tasks.multi_modal_embedding,
            model=model,
            model_revision=self.model_version)
        <a id="change">text_embedding</a> = pipeline_multi_modal_embedding(
            self.test_input)[OutputKeys.TEXT_EMBEDDING]
        print(&quotl1-norm: {}&quot.format(
            <a id="change">torch.norm(</a>text_embedding<a id="change">, p=1, dim=-1)</a>.item()))
        <a id="change">print(&quotl2-norm: {}&quot.format(torch.norm(text_embedding,
                                              dim=-1).item()</a><a id="change">)</a><a id="change">)</a>  &#47&#47 should be 1.0

    @unittest.skipUnless(test_level() &gt;= 1, &quotskip test in current test level&quot)
    def test_run_with_default_model(self):</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/modelscope/modelscope/commit/4c08bd752a7faf06ab4a6d5de29f663e0e08066e#diff-836f964587f88e24ea34b86099821bc70189e07c657f6127cea3250567031a8cL26' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 60059171</div><div id='project'> Project Name: modelscope/modelscope</div><div id='commit'> Commit Name: 4c08bd752a7faf06ab4a6d5de29f663e0e08066e</div><div id='time'> Time: 2022-08-17</div><div id='author'> Author: ya235025@alibaba-inc.com</div><div id='file'> File Name: tests/pipelines/test_multi_modal_embedding.py</div><div id='m_class'> M Class Name: MultiModalEmbeddingTest</div><div id='n_method'> N Class Name: MultiModalEmbeddingTest</div><div id='m_method'> M Method Name: test_run_with_model_from_modelhub(1)</div><div id='n_method'> N Method Name: test_run_with_model_from_modelhub(1)</div><div id='m_parent_class'> M Parent Class: unittest.TestCase</div><div id='n_parent_class'> N Parent Class: unittest.TestCase</div><div id='m_file'> M File Name: tests/pipelines/test_multi_modal_embedding.py</div><div id='n_file'> N File Name: tests/pipelines/test_multi_modal_embedding.py</div><div id='m_start'> M Start Line: 30</div><div id='m_end'> M End Line: 32</div><div id='n_start'> N Start Line: 39</div><div id='n_end'> N End Line: 44</div><BR>