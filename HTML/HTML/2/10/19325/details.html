<html><h3>Pattern ID :19325
</h3><img src='63072242.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>

        if "js_place_length" in result:
            results.append(result)
            <a id="change">if num_sample &lt; 0</a>:
                if len(results) == abs(num_sample):
                    <a id="change">break</a>
    if not results:
        logger.error("No solution is found")
        return
</code></pre><h3>After Change</h3><pre><code class='java'>
        )
        auc_pred = auc_pred.cpu().numpy()

        <a id="change">for </a>threshold in [0.6, 0.4, 0.2, 0]<a id="change">:
            </a>keep = success_pred &gt; threshold
            <a id="change">if keep.sum() &gt; 0</a>:
                <a id="change">break</a>

        success_pred = success_pred[keep]
        length_pred = length_pred[keep]
        auc_pred = auc_pred[keep]</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 7</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/wkentaro/safepicking/commit/ff8d814b270cd083c0295ae7f30192ca46d865f5#diff-3755888d9f65827df523334c3436d07328a743cc66a21fe8ff8d7085b51b25fdL30' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 63072242</div><div id='project'> Project Name: wkentaro/safepicking</div><div id='commit'> Commit Name: ff8d814b270cd083c0295ae7f30192ca46d865f5</div><div id='time'> Time: 2021-05-28</div><div id='author'> Author: www.kentaro.wada@gmail.com</div><div id='file'> File Name: examples/reorient/learned.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: plan_and_execute_reorient(5)</div><div id='n_method'> N Method Name: plan_and_execute_reorient(5)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: examples/reorient/learned.py</div><div id='n_file'> N File Name: examples/reorient/learned.py</div><div id='m_start'> M Start Line: 30</div><div id='m_end'> M End Line: 142</div><div id='n_start'> N Start Line: 76</div><div id='n_end'> N End Line: 144</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>

        if "js_place_length" in result:
            results.append(result)
            <a id="change">if num_sample &lt; 0</a>:
                if len(results) == abs(num_sample):
                    <a id="change">break</a>
    if not results:
        logger.error("No solution is found")
        return
</code></pre><h3>After Change</h3><pre><code class='java'>
        )
        auc_pred = auc_pred.cpu().numpy()

        <a id="change">for </a><a id="change">threshold</a> in [0.6, 0.4, 0.2, 0]<a id="change">:
            </a>keep = success_pred &gt; threshold
            <a id="change">if keep.sum() &gt; 0</a>:
                <a id="change">break</a>

        success_pred = success_pred[keep]
        length_pred = length_pred[keep]
        auc_pred = auc_pred[keep]</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/wkentaro/reorientbot/commit/ff8d814b270cd083c0295ae7f30192ca46d865f5#diff-3755888d9f65827df523334c3436d07328a743cc66a21fe8ff8d7085b51b25fdL27' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 63072243</div><div id='project'> Project Name: wkentaro/reorientbot</div><div id='commit'> Commit Name: ff8d814b270cd083c0295ae7f30192ca46d865f5</div><div id='time'> Time: 2021-05-28</div><div id='author'> Author: www.kentaro.wada@gmail.com</div><div id='file'> File Name: examples/reorient/learned.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: plan_and_execute_reorient(5)</div><div id='n_method'> N Method Name: plan_and_execute_reorient(5)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: examples/reorient/learned.py</div><div id='n_file'> N File Name: examples/reorient/learned.py</div><div id='m_start'> M Start Line: 30</div><div id='m_end'> M End Line: 142</div><div id='n_start'> N Start Line: 76</div><div id='n_end'> N End Line: 144</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>

        layer_dict = {0: 2, 1: 5, 2: 8, 3: 9, 4: 10, 5: 11, 6: 12, 7: 13, 8: 14, 9: 17, 10: 20, 11: None}

        <a id="change">for </a><a id="change">layer_num_orig</a> in range(12)<a id="change">:
            &#47&#47 Load the trained generator.
            </a>self.restore_model(self.test_iters)
            
            &#47&#47 Set data loader.
            if self.dataset == &quotCelebA&quot:
                data_loader = self.celeba_loader
            elif self.dataset == &quotRaFD&quot:
                data_loader = self.rafd_loader

            &#47&#47 Initialize Metrics
            l1_error = 0.0
            l2_error = 0.0
            min_dist = 0.0
            l0_error = 0.0
            perceptual_error = 0.0
            n_samples = 0

            &#47&#47 11 layers + output
            &#47&#47 layer_num_orig = 11

            print(&quotLayer&quot, layer_num_orig)
            for i, (x_real, c_org) in enumerate(data_loader):
                &#47&#47 Black image
                black = np.zeros((1,3,256,256))
                black = torch.FloatTensor(black).to(self.device)

                &#47&#47 Prepare input images and target domain labels.
                x_real = x_real.to(self.device)
                c_trg_list = self.create_labels(c_org, self.c_dim, self.dataset, self.selected_attrs)

                layer_num = layer_dict[layer_num_orig]
                pgd_attack = attacks.LinfPGDAttack(model=self.G, device=self.device, feat=layer_num)

                &#47&#47 Translate images.
                x_fake_list = [x_real]

                &#47&#47 if i == 0:
                &#47&#47     x_adv, perturb = pgd_attack.perturb(x_real, x_real, c_trg_list[0])

                for c_trg in c_trg_list:
                    &#47&#47 Attack
                    x_adv, perturb = pgd_attack.perturb(x_real, black, c_trg)
                    &#47&#47 x_adv = x_real + perturb
                    &#47&#47 x_adv = self.blur_tensor(x_adv)

                    &#47&#47 Metrics
                    with torch.no_grad():
                        &#47&#47 gen, preproc_x = self.G(x_adv, c_trg)
                        gen, gen_feats = self.G(x_adv, c_trg)

                        &#47&#47 Add to lists
                        &#47&#47 x_fake_list.append(preproc_x)
                        x_fake_list.append(x_adv)
                        x_fake_list.append(gen)

                        &#47&#47 No Attack
                        &#47&#47 gen_noattack, _ = self.G(x_real, c_trg)
                        gen_noattack, gen_noattack_feats = self.G(x_real, c_trg)

                        l1_error += F.l1_loss(gen, gen_noattack)
                        l2_error += F.mse_loss(gen, gen_noattack)
                        l0_error += (gen - gen_noattack).norm(0)
                        min_dist += (gen - gen_noattack).norm(float(&quot-inf&quot))
                        n_samples += 1

                &#47&#47 Save the translated images.
                x_concat = torch.cat(x_fake_list, dim=3)
                &#47&#47 result_path = os.path.join(self.result_dir, &quot{}-images.jpg&quot.format(i+1))
                result_path = os.path.join(self.result_dir, &quot{}-{}-images.jpg&quot.format(layer_num_orig, i+1))
                save_image(self.denorm(x_concat.data.cpu()), result_path, nrow=1, padding=0)
                &#47&#47 print(&quotSaved real and fake images into {}...&quot.format(result_path))
                <a id="change">if i == 3</a>:
                    <a id="change">break</a>
                &#47&#47 if i == 199:
                &#47&#47     break
            
            &#47&#47 Print metrics</code></pre><h3>After Change</h3><pre><code class='java'>
            &#47&#47 print(&quotSaved real and fake images into {}...&quot.format(result_path))
            &#47&#47 if i == 3:
            &#47&#47     break
            <a id="change">if i == 199</a>:
                <a id="change">break</a>
        
        &#47&#47 Print metrics
        print(&quot{} images. L1 error: {}. L2 error: {}. L0 error: {}. L_-inf error: {}. Perceptual error: {}.&quot.format(n_samples, 
        l1_error / n_samples, l2_error / n_samples, l0_error / n_samples, min_dist / n_samples, perceptual_error / n_samples))</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/natanielruiz/disrupting-deepfakes/commit/4161e50d0efc7a176c9010f77b9c9e27746209d1#diff-b700ed60ba32817f1933c49049485378be754d9c9f56fc1fd510f39fe9ce0ee0L661' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 63072246</div><div id='project'> Project Name: natanielruiz/disrupting-deepfakes</div><div id='commit'> Commit Name: 4161e50d0efc7a176c9010f77b9c9e27746209d1</div><div id='time'> Time: 2019-12-26</div><div id='author'> Author: nruiz@Nataniels-MacBook-Pro.local</div><div id='file'> File Name: stargan/solver.py</div><div id='m_class'> M Class Name: Solver</div><div id='n_method'> N Class Name: Solver</div><div id='m_method'> M Method Name: test_attack(1)</div><div id='n_method'> N Method Name: test_attack(1)</div><div id='m_parent_class'> M Parent Class: object</div><div id='n_parent_class'> N Parent Class: object</div><div id='m_file'> M File Name: stargan/solver.py</div><div id='n_file'> N File Name: stargan/solver.py</div><div id='m_start'> M Start Line: 664</div><div id='m_end'> M End Line: 747</div><div id='n_start'> N Start Line: 576</div><div id='n_end'> N End Line: 659</div><BR>