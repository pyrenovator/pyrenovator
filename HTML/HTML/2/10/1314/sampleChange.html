<link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
                    continue
                union.append(document)

        ranked<a id="change"> = </a><a id="change">[]</a>
        <a id="change">for </a>document in union<a id="change">:
            </a>similarity = similarities.get(document.get(self.key, None), None)
            if similarity is not None:
                <a id="change">ranked.append(</a>{**document, **{"similarity": similarity}}<a id="change">)</a>
            else:
                ranked.append(document)

        <a id="change">return </a>ranked

    def __or__(self, other) -&gt; "Union":
        Union operator</code></pre><h3>After Change</h3><pre><code class='java'>

            retrieved = model(**query)

            <a id="change">if </a>not retrieved:
                continue

            similarities<a id="change"> = </a>softmax([doc.get("similarity", 1.0) <a id="change">for</a> doc in retrieved], axis=0)

            for document, similarity in <a id="change">zip(</a>retrieved, similarities<a id="change">)</a>:

                &#47&#47 Remove similarities to avoid duplicates
                if "similarity" in document:</code></pre>