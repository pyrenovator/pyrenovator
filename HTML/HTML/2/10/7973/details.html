<html><h3>Pattern ID :7973
</h3><img src='28408997.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
                    result_array[b, i, ...],
                    params["subject_spacing"][b],
                )
                hd += <a id="change">numpy.percentile(numpy.hstack(</a>(hd1, hd2)<a id="change">)</a>, percentile<a id="change">)</a>
                avg_counter += 1
    return torch.tensor(hd / avg_counter)

</code></pre><h3>After Change</h3><pre><code class='java'>
                    result_array[b, i, ...],
                    params["subject_spacing"][b],
                )
                current_hd<a id="change"> = </a><a id="change">numpy.percentile(numpy.hstack(</a>(hd1, hd2)<a id="change">)</a>, percentile<a id="change">)</a>
                hd += current_hd
                <a id="change">hd_per_label.append(</a>current_hd<a id="change">)</a>
                avg_counter += 1
    
    <a id="change">if per_label</a>:
        return <a id="change">torch.tensor(hd_per_label</a><a id="change">)</a>
    else:
        return torch.tensor(hd / avg_counter)

</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 4</div><BR><div id='size'>Non-data size: 8</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/mlcommons/gandlf/commit/cbac226bb3998c1bfc565a7756410edbf1044a2d#diff-f71c168bec6392bbaf7945f38665d79839fc99ded9f902ffcef66e41abccd947L126' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 28408997</div><div id='project'> Project Name: mlcommons/gandlf</div><div id='commit'> Commit Name: cbac226bb3998c1bfc565a7756410edbf1044a2d</div><div id='time'> Time: 2021-12-29</div><div id='author'> Author: sarthak.pati@hotmail.com</div><div id='file'> File Name: GANDLF/metrics/segmentation.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: hd_generic(5)</div><div id='n_method'> N Method Name: hd_generic(4)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: GANDLF/metrics/segmentation.py</div><div id='n_file'> N File Name: GANDLF/metrics/segmentation.py</div><div id='m_start'> M Start Line: 150</div><div id='m_end'> M End Line: 152</div><div id='n_start'> N Start Line: 126</div><div id='n_end'> N End Line: 194</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
                threshold = max(min(params["subject_spacing"][0]), 1).item()
                return_nsd += _nsd_base(hd1, hd2, threshold)
                return_hd100 += np.percentile(np.hstack((hd1, hd2)), 100)
                return_hd95 += <a id="change">np.percentile(np.hstack(</a>(hd1, hd2)<a id="change">)</a>, 95<a id="change">)</a>
                avg_counter += 1

    return (
        torch.tensor(return_nsd / avg_counter),</code></pre><h3>After Change</h3><pre><code class='java'>
                threshold = max(min(params["subject_spacing"][0]), 1).item()
                temp_nsd = _nsd_base(hd1, hd2, threshold)
                temp_hd100 = np.percentile(np.hstack((hd1, hd2)), 100)
                temp_hd95<a id="change"> = </a><a id="change">np.percentile(np.hstack(</a>(hd1, hd2)<a id="change">)</a>, 95<a id="change">)</a>
                if per_label:
                    return_nsd.append(temp_nsd)
                    return_hd100.append(temp_hd100)
                    <a id="change">return_hd95.append(</a>temp_hd95<a id="change">)</a>
                else:
                    return_nsd += temp_nsd
                    return_hd100 += temp_hd100
                    return_hd95 += temp_hd95
                    avg_counter += 1

    <a id="change">if per_label</a>:
        (
            torch.tensor(return_nsd),
            torch.tensor(return_hd100),
            <a id="change">torch.tensor(</a>return_hd95<a id="change">)</a>,
        )
    else:
        (</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/mlcommons/gandlf/commit/18c266d0ac454ed9256d5775ecbc91819a438521#diff-f71c168bec6392bbaf7945f38665d79839fc99ded9f902ffcef66e41abccd947L265' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 28408996</div><div id='project'> Project Name: mlcommons/gandlf</div><div id='commit'> Commit Name: 18c266d0ac454ed9256d5775ecbc91819a438521</div><div id='time'> Time: 2023-05-25</div><div id='author'> Author: sarthak.pati@hotmail.com</div><div id='file'> File Name: GANDLF/metrics/segmentation.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: _calculator_generic_all_surface_distances(4)</div><div id='n_method'> N Method Name: _calculator_generic_all_surface_distances(3)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: GANDLF/metrics/segmentation.py</div><div id='n_file'> N File Name: GANDLF/metrics/segmentation.py</div><div id='m_start'> M Start Line: 289</div><div id='m_end'> M End Line: 309</div><div id='n_start'> N Start Line: 269</div><div id='n_end'> N End Line: 330</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
                    result_array[b, i, ...],
                    params["subject_spacing"][b],
                )
                hd += <a id="change">numpy.percentile(numpy.hstack(</a>(hd1, hd2)<a id="change">)</a>, percentile<a id="change">)</a>
                avg_counter += 1
    return torch.tensor(hd / avg_counter)

</code></pre><h3>After Change</h3><pre><code class='java'>

    hd = 0
    avg_counter = 0
    <a id="change">hd_per_label</a> = []
    for b in range(0, result_array.shape[0]):
        for i in range(0, params["model"]["num_classes"]):
            if i != params["model"]["ignore_label_validation"]:
                hd1 = __surface_distances(
                    result_array[b, i, ...],
                    target_array[b, i, ...],
                )
                hd2 = __surface_distances(
                    target_array[b, i, ...],
                    result_array[b, i, ...],
                    params["subject_spacing"][b],
                )
                current_hd<a id="change"> = </a><a id="change">numpy.percentile(numpy.hstack(</a>(hd1, hd2)<a id="change">)</a>, percentile<a id="change">)</a>
                hd += current_hd
                <a id="change">hd_per_label.append(</a>current_hd<a id="change">)</a>
                avg_counter += 1
    
    <a id="change">if per_label</a>:
        return <a id="change">torch.tensor(</a>hd_per_label<a id="change">)</a>
    else:
        return torch.tensor(hd / avg_counter)

</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/mlcommons/gandlf/commit/cbac226bb3998c1bfc565a7756410edbf1044a2d#diff-f71c168bec6392bbaf7945f38665d79839fc99ded9f902ffcef66e41abccd947L95' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 28408998</div><div id='project'> Project Name: mlcommons/gandlf</div><div id='commit'> Commit Name: cbac226bb3998c1bfc565a7756410edbf1044a2d</div><div id='time'> Time: 2021-12-29</div><div id='author'> Author: sarthak.pati@hotmail.com</div><div id='file'> File Name: GANDLF/metrics/segmentation.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: hd_generic(5)</div><div id='n_method'> N Method Name: hd_generic(4)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: GANDLF/metrics/segmentation.py</div><div id='n_file'> N File Name: GANDLF/metrics/segmentation.py</div><div id='m_start'> M Start Line: 150</div><div id='m_end'> M End Line: 152</div><div id='n_start'> N Start Line: 126</div><div id='n_end'> N End Line: 194</div><BR>