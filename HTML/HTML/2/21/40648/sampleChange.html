<link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
    def __call__(
        self, input_ids: torch.LongTensor, scores: torch.FloatTensor, absolute_step: torch.IntTensor
    ) -&gt; torch.FloatTensor:
        <a id="change">idx</a> = <a id="change">torch.ones(
            </a>(<a id="change">scores.shape[0]</a><a id="change">, len(self.begin_suppress_tokens)</a>)<a id="change">, dtype=torch.long, device=scores.device
        ) * </a>torch.tensor(self.begin_suppress_tokens)
        cond = absolute_step + 1 == self.begin_index
        val<a id="change"> = </a>cond<a id="change"> * torch.ones_like(idx) * </a>LARGE_NEGATIVE_CONST
        <a id="change">scores.scatter_add_(1</a>, <a id="change">idx</a>, val<a id="change">)</a>
        <a id="change">return scores</a>


class IPUForceTokensLogitsProcessor(ForceTokensLogitsProcessor):
    def __call__(</code></pre><h3>After Change</h3><pre><code class='java'>
    def __call__(
        self, input_ids: torch.LongTensor, scores: torch.FloatTensor, absolute_step: torch.IntTensor
    ) -&gt; torch.FloatTensor:
        <a id="change">mask</a> = self.mask.to(scores.device)
        cond = absolute_step != self.begin_index
        mask |= cond
        <a id="change">return mask</a><a id="change"> * scores + </a>(<a id="change">1</a><a id="change"> - mask</a>)<a id="change"> * </a>VERY_LARGE_NEGATIVE_CONST


class IPUForceTokensLogitsProcessor(ForceTokensLogitsProcessor):</code></pre>