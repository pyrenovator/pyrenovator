<html><h3>Pattern ID :4814
</h3><img src='16956324.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
        point_cloud())
    def test_rotation_covariance_label_vector(self, q, rv, rv2):
        errs = []
        <a id="change">for </a>scale in FLOAT_SCALES<a id="change">:
            </a>r, v = rv; r<a id="change"> = </a>r<a id="change">*scale</a>; v<a id="change"> = </a>v<a id="change">*scale</a>
            v2 = rv2[1]
            rprime<a id="change"> = </a>rowan.rotate(q[None], r).astype(np.float32)

            key<a id="change"> = </a>&quotrotation_covariance_label&quot
            prediction1<a id="change"> = </a>self.label_vector_prediction(r, v, v2, key)
            prediction1_prime = rowan.rotate(q[None], prediction1)
            prediction2<a id="change"> = </a>self.label_vector_prediction(rprime, v, v2, key)

            errs.append(np.mean(np.square(prediction1_prime - prediction2)))
</code></pre><h3>After Change</h3><pre><code class='java'>
    def test_rotation_covariance_label_vector(self, q, rv, rv2):
        r, v = rv
        v2 = rv2[1]
        rprime<a id="change"> = </a>rowan.rotate(q[None], r).astype(np.float32)

        key<a id="change"> = </a>&quotrotation_covariance_label&quot
        prediction1<a id="change"> = </a>self.label_vector_prediction(r, v, v2, key)
        prediction1_prime = rowan.rotate(q[None], prediction1)
        prediction2<a id="change"> = </a>self.label_vector_prediction(rprime, v, v2, key)

        err<a id="change"> = </a>np.max(np.square(prediction1_prime - prediction2))
        <a id="change">self.assertLess(</a>err, <a id="change">1e-5</a><a id="change">)</a>

class TFRandom:
    @staticmethod
    def seed(seed):</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 15</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/klarh/geometric_algebra_attention/commit/549321f82c9b20c24ecf43b58cb03935d980e18e#diff-87a26a2cfe50c5fe7cfdaecf5219294ed38e4e13a224f49944973cffeb10c7cdL144' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 16956324</div><div id='project'> Project Name: klarh/geometric_algebra_attention</div><div id='commit'> Commit Name: 549321f82c9b20c24ecf43b58cb03935d980e18e</div><div id='time'> Time: 2022-01-14</div><div id='author'> Author: mspells@vectorinstitute.ai</div><div id='file'> File Name: tests/test_internals.py</div><div id='m_class'> M Class Name: AllTests</div><div id='n_method'> N Class Name: AllTests</div><div id='m_method'> M Method Name: test_rotation_covariance_label_vector(4)</div><div id='n_method'> N Method Name: test_rotation_covariance_label_vector(4)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: tests/test_internals.py</div><div id='n_file'> N File Name: tests/test_internals.py</div><div id='m_start'> M Start Line: 170</div><div id='m_end'> M End Line: 190</div><div id='n_start'> N Start Line: 144</div><div id='n_end'> N End Line: 154</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        point_cloud())
    def test_rotation_covariance_label_vector(self, q, rv, rv2):
        errs = []
        <a id="change">for scale</a> in FLOAT_SCALES<a id="change">:
            </a>r, v = rv; r<a id="change"> = </a>r<a id="change">*</a>scale; v<a id="change"> = </a>v<a id="change">*</a>scale
            v2 = rv2[1]
            rprime<a id="change"> = </a>rowan.rotate(q[None], r).astype(np.float32)

            key<a id="change"> = </a>&quotrotation_covariance_label&quot
            prediction1 = self.label_vector_prediction(r, v, v2, key)
            prediction1_prime<a id="change"> = </a>rowan.rotate(q[None], prediction1)
            prediction2<a id="change"> = </a>self.label_vector_prediction(rprime, v, v2, key)

            errs.append(np.mean(np.square(prediction1_prime - prediction2)))
</code></pre><h3>After Change</h3><pre><code class='java'>
    def test_rotation_covariance_label_vector(self, q, rv, rv2):
        r, v = rv
        v2 = rv2[1]
        rprime<a id="change"> = </a>rowan.rotate(q[None], r).astype(np.float32)

        key<a id="change"> = </a>&quotrotation_covariance_label&quot
        prediction1 = self.label_vector_prediction(r, v, v2, key)
        prediction1_prime<a id="change"> = </a>rowan.rotate(q[None], prediction1)
        prediction2<a id="change"> = </a>self.label_vector_prediction(rprime, v, v2, key)

        err<a id="change"> = </a>np.max(np.square(prediction1_prime - prediction2))
        <a id="change">self.assertLess(</a>err, <a id="change">1e-5</a><a id="change">)</a>

class TFRandom:
    @staticmethod
    def seed(seed):</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/klarh/geometric_algebra_attention/commit/549321f82c9b20c24ecf43b58cb03935d980e18e#diff-87a26a2cfe50c5fe7cfdaecf5219294ed38e4e13a224f49944973cffeb10c7cdL169' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 16956360</div><div id='project'> Project Name: klarh/geometric_algebra_attention</div><div id='commit'> Commit Name: 549321f82c9b20c24ecf43b58cb03935d980e18e</div><div id='time'> Time: 2022-01-14</div><div id='author'> Author: mspells@vectorinstitute.ai</div><div id='file'> File Name: tests/test_internals.py</div><div id='m_class'> M Class Name: AllTests</div><div id='n_method'> N Class Name: AllTests</div><div id='m_method'> M Method Name: test_rotation_covariance_label_vector(4)</div><div id='n_method'> N Method Name: test_rotation_covariance_label_vector(4)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: tests/test_internals.py</div><div id='n_file'> N File Name: tests/test_internals.py</div><div id='m_start'> M Start Line: 170</div><div id='m_end'> M End Line: 190</div><div id='n_start'> N Start Line: 144</div><div id='n_end'> N End Line: 154</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        hs.sampled_from(INVARIANT_MODES))
    def test_rotation_invariance_value(self, q, rv, rank, merge_fun, join_fun, invar_mode):
        errs = []
        <a id="change">for scale</a> in FLOAT_SCALES<a id="change">:
            </a>r, v = rv; r<a id="change"> = </a>r<a id="change">*</a>scale; v<a id="change"> = </a>v<a id="change">*</a>scale
            rprime<a id="change"> = </a>rowan.rotate(q[None], r).astype(np.float32)

            key<a id="change"> = </a>&quotrotation_invariance&quot
            prediction1<a id="change"> = </a>self.value_prediction(r, v, key, rank, merge_fun, join_fun, invar_mode)
            prediction2<a id="change"> = </a>self.value_prediction(rprime, v, key, rank, merge_fun, join_fun, invar_mode)

            self.assertEqual(v[0].shape, prediction1.shape)
            errs.append(np.mean(np.square(prediction1 - prediction2)))</code></pre><h3>After Change</h3><pre><code class='java'>
        hs.sampled_from(INVARIANT_MODES))
    def test_rotation_invariance_value(self, q, rv, rank, merge_fun, join_fun, invar_mode):
        r, v = rv
        rprime<a id="change"> = </a>rowan.rotate(q[None], r).astype(np.float32)

        key<a id="change"> = </a>&quotrotation_invariance&quot
        prediction1<a id="change"> = </a>self.value_prediction(r, v, key, rank, merge_fun, join_fun, invar_mode)
        prediction2<a id="change"> = </a>self.value_prediction(rprime, v, key, rank, merge_fun, join_fun, invar_mode)

        self.assertEqual(v[0].shape, prediction1.shape)
        err<a id="change"> = </a>np.max(np.square(prediction1 - prediction2))
        <a id="change">self.assertLess(</a>err, <a id="change">1e-5</a><a id="change">)</a>

    @settings(deadline=None)
    @given(
        hs.integers(0, 128),</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/klarh/geometric_algebra_attention/commit/549321f82c9b20c24ecf43b58cb03935d980e18e#diff-87a26a2cfe50c5fe7cfdaecf5219294ed38e4e13a224f49944973cffeb10c7cdL64' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 16956398</div><div id='project'> Project Name: klarh/geometric_algebra_attention</div><div id='commit'> Commit Name: 549321f82c9b20c24ecf43b58cb03935d980e18e</div><div id='time'> Time: 2022-01-14</div><div id='author'> Author: mspells@vectorinstitute.ai</div><div id='file'> File Name: tests/test_internals.py</div><div id='m_class'> M Class Name: AllTests</div><div id='n_method'> N Class Name: AllTests</div><div id='m_method'> M Method Name: test_rotation_invariance_value(7)</div><div id='n_method'> N Method Name: test_rotation_invariance_value(7)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: tests/test_internals.py</div><div id='n_file'> N File Name: tests/test_internals.py</div><div id='m_start'> M Start Line: 65</div><div id='m_end'> M End Line: 86</div><div id='n_start'> N Start Line: 64</div><div id='n_end'> N End Line: 73</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
    def test_rotation_covariance_vector(self, q, rv, rank, merge_fun, join_fun,
                                        invar_mode, covar_mode):
        errs = []
        <a id="change">for scale</a> in FLOAT_SCALES<a id="change">:
            </a>r, v = rv; r<a id="change"> = </a>r<a id="change">*</a>scale; v<a id="change"> = </a>v<a id="change">*</a>scale
            rprime<a id="change"> = </a>rowan.rotate(q[None], r).astype(np.float32)

            key<a id="change"> = </a>&quotrotation_covariance&quot
            prediction1<a id="change"> = </a>self.vector_prediction(
                r, v, key, rank, merge_fun, join_fun, invar_mode, covar_mode)
            prediction1_prime = rowan.rotate(q, prediction1)
            prediction2<a id="change"> = </a>self.vector_prediction(
                rprime, v, key, rank, merge_fun, join_fun, invar_mode, covar_mode)

            errs.append(np.mean(np.square(prediction1_prime - prediction2)))</code></pre><h3>After Change</h3><pre><code class='java'>
    def test_rotation_covariance_vector(self, q, rv, rank, merge_fun, join_fun,
                                        invar_mode, covar_mode):
        r, v = rv
        rprime<a id="change"> = </a>rowan.rotate(q[None], r).astype(np.float32)

        key<a id="change"> = </a>&quotrotation_covariance&quot
        prediction1<a id="change"> = </a>self.vector_prediction(
            r, v, key, rank, merge_fun, join_fun, invar_mode, covar_mode)
        prediction1_prime = rowan.rotate(q, prediction1)
        prediction2<a id="change"> = </a>self.vector_prediction(
            rprime, v, key, rank, merge_fun, join_fun, invar_mode, covar_mode)

        if np.max(np.linalg.norm(prediction2, axis=-1)) &gt; 1e2:
            print(&quot---&quot)
            print(r)
            print(v)
            print(prediction1_prime)
            print(prediction2)
            print(np.max(np.square(prediction1_prime - prediction2)))
        err<a id="change"> = </a>np.max(np.square(prediction1_prime - prediction2))
        <a id="change">self.assertLess(</a>err, <a id="change">1e-5</a><a id="change">)</a>

    @settings(deadline=None)
    @given(
        unit_quaternions(),</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/klarh/geometric_algebra_attention/commit/549321f82c9b20c24ecf43b58cb03935d980e18e#diff-87a26a2cfe50c5fe7cfdaecf5219294ed38e4e13a224f49944973cffeb10c7cdL139' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 16956367</div><div id='project'> Project Name: klarh/geometric_algebra_attention</div><div id='commit'> Commit Name: 549321f82c9b20c24ecf43b58cb03935d980e18e</div><div id='time'> Time: 2022-01-14</div><div id='author'> Author: mspells@vectorinstitute.ai</div><div id='file'> File Name: tests/test_internals.py</div><div id='m_class'> M Class Name: AllTests</div><div id='n_method'> N Class Name: AllTests</div><div id='m_method'> M Method Name: test_rotation_covariance_vector(8)</div><div id='n_method'> N Method Name: test_rotation_covariance_vector(8)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: tests/test_internals.py</div><div id='n_file'> N File Name: tests/test_internals.py</div><div id='m_start'> M Start Line: 141</div><div id='m_end'> M End Line: 164</div><div id='n_start'> N Start Line: 118</div><div id='n_end'> N End Line: 136</div><BR>