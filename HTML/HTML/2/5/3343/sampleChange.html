<link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
    if trainer.is_main_process():
        click.secho(f"Measuring performance on {tracker_context}", fg="green", blink=True)

    <a id="change">with torch.no_grad()</a><a id="change">:
        </a>total_loss = 0.0
        total_samples = 0.0

        for image_embeddings, text_data in dataloader:
            image_embeddings = image_embeddings.to(trainer.device)
            text_data = text_data.to(trainer.device)

            batches = image_embeddings.shape[0]

            input_args = dict(image_embed=image_embeddings)

            if text_conditioned:
                input_args = dict(**input_args, text=text_data)
            else:
                input_args = dict(**input_args, text_embed=text_data)

            if use_ema:
                loss = trainer.ema_diffusion_prior(**input_args)
            else:
                loss = trainer(**input_args)

            total_loss<a id="change"> += </a>loss * batches
            total_samples += batches

        avg_loss = total_loss / total_samples</code></pre><h3>After Change</h3><pre><code class='java'>
    
    trainer.eval()

    use_ema = "ema"<a id="change"> if </a>use_ema<a id="change"> else </a>"online"
    tracker_folder = f"metrics/{use_ema}-{split}"

    &#47&#47 detemine if valid timesteps are passed</code></pre>