<html><h3>Pattern ID :34778
</h3><img src='99762419.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
    def load_or_build_caches(self):
        for index in self.indices:
            index.load_or_build_cache()
        all_indices<a id="change"> = </a>{index.parser.name: index for index in self.indices}

        <a id="change">for </a>entity_class, ontologies in self.entity_class_to_ontology_mappings.items()<a id="change">:
            </a>current_indices = set()
            for ontology_name in ontologies:
                index<a id="change"> = </a>all_indices.get(ontology_name)
                if index is None:
                    logger.warning(f"No index found for {ontology_name}")
                else:</code></pre><h3>After Change</h3><pre><code class='java'>
    def load_or_build_caches(self):
        for index in self.indices:
            index.load_or_build_cache()
            indices_for_current_class = <a id="change">self.entity_class_to_indices.setdefault(
                </a>index.parser.entity_class, set()<a id="change">
            )</a>
            indices_for_current_class.add(index)

    def _run(self, docs: List[Document]) -&gt; Tuple[List[Document], List[Document]]:
        </code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 4</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/astrazeneca/kazu/commit/2a204ce1ab31f084903c52033590280652950470#diff-71197b63fb1b485f5ee9392ade30e6a0ba93ab996b673490cb245a7cf61ccf8cL47' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 99762419</div><div id='project'> Project Name: astrazeneca/kazu</div><div id='commit'> Commit Name: 2a204ce1ab31f084903c52033590280652950470</div><div id='time'> Time: 2022-11-30</div><div id='author'> Author: elliot.ford@astrazeneca.com</div><div id='file'> File Name: kazu/steps/linking/dictionary.py</div><div id='m_class'> M Class Name: DictionaryEntityLinkingStep</div><div id='n_method'> N Class Name: DictionaryEntityLinkingStep</div><div id='m_method'> M Method Name: load_or_build_caches(1)</div><div id='n_method'> N Method Name: load_or_build_caches(1)</div><div id='m_parent_class'> M Parent Class: BaseStep</div><div id='n_parent_class'> N Parent Class: BaseStep</div><div id='m_file'> M File Name: kazu/steps/linking/dictionary.py</div><div id='n_file'> N File Name: kazu/steps/linking/dictionary.py</div><div id='m_start'> M Start Line: 53</div><div id='m_end'> M End Line: 68</div><div id='n_start'> N Start Line: 47</div><div id='n_end'> N End Line: 52</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
    def load_or_build_caches(self):
        for index in self.indices:
            index.load_or_build_cache()
        all_indices<a id="change"> = </a>{index.parser.name: index for index in self.indices}

        for entity_class, ontologies in self.entity_class_to_ontology_mappings.items():
            current_indices = set()
            <a id="change">for ontology_name</a> in ontologies<a id="change">:
                </a>index<a id="change"> = </a>all_indices.get(ontology_name)
                if index is None:
                    logger.warning(f"No index found for {ontology_name}")
                else:</code></pre><h3>After Change</h3><pre><code class='java'>
    def load_or_build_caches(self):
        for index in self.indices:
            index.load_or_build_cache()
            indices_for_current_class = <a id="change">self.entity_class_to_indices.setdefault(
                </a>index.parser.entity_class, set()<a id="change">
            )</a>
            indices_for_current_class.add(index)

    def _run(self, docs: List[Document]) -&gt; Tuple[List[Document], List[Document]]:
        </code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/astrazeneca/kazu/commit/2a204ce1ab31f084903c52033590280652950470#diff-71197b63fb1b485f5ee9392ade30e6a0ba93ab996b673490cb245a7cf61ccf8cL50' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 99762406</div><div id='project'> Project Name: astrazeneca/kazu</div><div id='commit'> Commit Name: 2a204ce1ab31f084903c52033590280652950470</div><div id='time'> Time: 2022-11-30</div><div id='author'> Author: elliot.ford@astrazeneca.com</div><div id='file'> File Name: kazu/steps/linking/dictionary.py</div><div id='m_class'> M Class Name: DictionaryEntityLinkingStep</div><div id='n_method'> N Class Name: DictionaryEntityLinkingStep</div><div id='m_method'> M Method Name: load_or_build_caches(1)</div><div id='n_method'> N Method Name: load_or_build_caches(1)</div><div id='m_parent_class'> M Parent Class: BaseStep</div><div id='n_parent_class'> N Parent Class: BaseStep</div><div id='m_file'> M File Name: kazu/steps/linking/dictionary.py</div><div id='n_file'> N File Name: kazu/steps/linking/dictionary.py</div><div id='m_start'> M Start Line: 53</div><div id='m_end'> M End Line: 68</div><div id='n_start'> N Start Line: 47</div><div id='n_end'> N End Line: 52</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        for index in self.indices:
            index.set_embedding_model(self.embedding_model, self.trainer)
            index.load_or_build_cache()
        all_indices<a id="change"> = </a>{index.parser.name: index for index in self.indices}

        for entity_class, ontologies in self.entity_class_to_ontology_mappings.items():
            current_indices = set()
            <a id="change">for ontology_name</a> in ontologies<a id="change">:
                </a>index<a id="change"> = </a>all_indices.get(ontology_name)
                if index is None:
                    logger.warning(f"No index found for {ontology_name}")
                else:</code></pre><h3>After Change</h3><pre><code class='java'>
        for index in self.indices:
            index.set_embedding_model(self.embedding_model, self.trainer)
            index.load_or_build_cache()
            indices_for_current_class = <a id="change">self.entity_class_to_indices.setdefault(
                </a>index.parser.entity_class, set()<a id="change">
            )</a>
            indices_for_current_class.add(index)

    def _run(self, docs: List[Document]) -&gt; Tuple[List[Document], List[Document]]:
        </code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/astrazeneca/kazu/commit/2a204ce1ab31f084903c52033590280652950470#diff-5d0b0ded5b343b5692f05ff69dc8f3b4f8d860427b9eb29f6b3cbe52194fa86cL67' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 99762405</div><div id='project'> Project Name: astrazeneca/kazu</div><div id='commit'> Commit Name: 2a204ce1ab31f084903c52033590280652950470</div><div id='time'> Time: 2022-11-30</div><div id='author'> Author: elliot.ford@astrazeneca.com</div><div id='file'> File Name: kazu/steps/linking/sapbert.py</div><div id='m_class'> M Class Name: SapBertForEntityLinkingStep</div><div id='n_method'> N Class Name: SapBertForEntityLinkingStep</div><div id='m_method'> M Method Name: load_or_build_caches(1)</div><div id='n_method'> N Method Name: load_or_build_caches(1)</div><div id='m_parent_class'> M Parent Class: BaseStep</div><div id='n_parent_class'> N Parent Class: BaseStep</div><div id='m_file'> M File Name: kazu/steps/linking/sapbert.py</div><div id='n_file'> N File Name: kazu/steps/linking/sapbert.py</div><div id='m_start'> M Start Line: 71</div><div id='m_end'> M End Line: 86</div><div id='n_start'> N Start Line: 65</div><div id='n_end'> N End Line: 71</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
            artifacts_key = [artifacts_key]

        &#47&#47 prepare_ensemble
        ensemble_dict<a id="change"> = </a>{}
        for key in artifacts_key:
            ensemble_dict.setdefault(key, {})
        &#47&#47 filter records
        recs_flt = list_recorders(self.exp_name, rec_filter_func)
        for _, rec in recs_flt.items():
            group_key = get_group_key_func(rec)
            for key in artifacts_key:
                artifact = rec.load_object(self.artifacts_path[key])
                ensemble_dict[key][group_key] = artifact

        if isinstance(artifacts_key, str):
            return ensemble(ensemble_dict[artifacts_key])

        collect_dict = {}
        <a id="change">for key</a> in artifacts_key<a id="change">:
            </a>collect_dict[key]<a id="change"> = </a>ensemble(ensemble_dict[key])
        return collect_dict
</code></pre><h3>After Change</h3><pre><code class='java'>
            rec_key = self._get_key(rec)
            for key in artifacts_key:
                artifact = rec.load_object(self.artifacts_path[key])
                <a id="change">collect_dict.setdefault(</a>key, {}<a id="change">)</a>[rec_key] = artifact

        return collect_dict</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/microsoft/qlib/commit/bd7a1c11b981099cdbe9a69429e3566be36854be#diff-d147087cd1318a7a9270b2ecb2f5b3fd80d361b6ac645d8de9fc2910dc879a74L35' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 99762412</div><div id='project'> Project Name: microsoft/qlib</div><div id='commit'> Commit Name: bd7a1c11b981099cdbe9a69429e3566be36854be</div><div id='time'> Time: 2021-04-01</div><div id='author'> Author: lzh222333@163.com</div><div id='file'> File Name: qlib/workflow/task/collect.py</div><div id='m_class'> M Class Name: RecorderCollector</div><div id='n_method'> N Class Name: RecorderCollector</div><div id='m_method'> M Method Name: collect(3)</div><div id='n_method'> N Method Name: collect(5)</div><div id='m_parent_class'> M Parent Class: Collector</div><div id='n_parent_class'> N Parent Class: Collector</div><div id='m_file'> M File Name: qlib/workflow/task/collect.py</div><div id='n_file'> N File Name: qlib/workflow/task/collect.py</div><div id='m_start'> M Start Line: 35</div><div id='m_end'> M End Line: 72</div><div id='n_start'> N Start Line: 59</div><div id='n_end'> N End Line: 66</div><BR>