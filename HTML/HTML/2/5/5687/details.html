<html><h3>Pattern ID :5687
</h3><img src='19988867.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
        if labels is not None:
            &#47&#47 Prediction scores of the language modeling head (scores for each vocabulary token before SoftMax).
            logits_gen = outputs_gen.logits &#47&#47 shape: (batch_size, sequence_length, config.vocab_size)
            predict_ids = <a id="change">torch.argmax(</a>logits_gen<a id="change">, dim=2) + 1</a>
            labels_disc = (predict_ids != labels).to(torch.long)
        else:
            labels_disc = None
</code></pre><h3>After Change</h3><pre><code class='java'>
            output_attentions=None, 
            output_hidden_states=None, return_dict=None
        ):
        return_dict = return_dict<a id="change"> if return_dict is not None</a><a id="change"> else </a>self.config.use_return_dict

        outputs_gen = self.generator(
            input_ids=input_ids, attention_mask=attention_mask, token_type_ids=token_type_ids, </code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 4</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/retarfi/language-pretraining/commit/a85c892e2f3cc1b1c4a448226509b6be977aca2a#diff-2ab458989f9a1c4e0c8dfb20cfb9dcbfbb0c9671651bd5df7c188d99658d99ddL45' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 19988867</div><div id='project'> Project Name: retarfi/language-pretraining</div><div id='commit'> Commit Name: a85c892e2f3cc1b1c4a448226509b6be977aca2a</div><div id='time'> Time: 2021-07-12</div><div id='author'> Author: valerososoccer@gmail.com</div><div id='file'> File Name: utils/model.py</div><div id='m_class'> M Class Name: ElectraForPretrainingModel</div><div id='n_method'> N Class Name: ElectraForPretrainingModel</div><div id='m_method'> M Method Name: forward(11)</div><div id='n_method'> N Method Name: forward(11)</div><div id='m_parent_class'> M Parent Class: PreTrainedModel</div><div id='n_parent_class'> N Parent Class: PreTrainedModel</div><div id='m_file'> M File Name: utils/model.py</div><div id='n_file'> N File Name: utils/model.py</div><div id='m_start'> M Start Line: 45</div><div id='m_end'> M End Line: 86</div><div id='n_start'> N Start Line: 45</div><div id='n_end'> N End Line: 87</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>

        for i in range(len(y)):
            for class_id in [int(x) for x in torch.unique(y[i])]:
                y_pred_i = (<a id="change">y_pred[i].argmax(</a>0<a id="change">)</a> == class_id).numpy()
                y_i = (y[i] == class_id).numpy()

                tp = np.logical_and(y_pred_i, y_i).sum()
                y_pred_i_count = y_pred_i.sum()
                y_i_count = y_i.sum()

                self._evals[class_id][&quotdice&quot] += (<a id="change">2</a><a id="change">*</a>tp) / (y_pred_i_count + y_i_count)
                self._evals[class_id][&quotcount&quot] += 1

    def compute(self):</code></pre><h3>After Change</h3><pre><code class='java'>

            dice = (2 * tp_count + self.smooth) / (gt_count + pred_count + self.smooth)

            classes_ids = [0]<a id="change"> if self.average == &quotmicro&quot</a><a id="change"> else </a>torch.unique(y[i]).tolist()
            for class_id in [int(x) for x in classes_ids]:
                self._evals[class_id][&quotdice&quot] += dice[class_id]
                self._evals[class_id][&quotcount&quot] += 1</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/deepchecks/deepchecks/commit/2d0e3893155e7b4294f49917fedc1eed7d2531cb#diff-01e17948e7a139eeb020a08cdefdfec45f69fca74107b0cf9012f6d4ce1c0dc6L35' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 19988871</div><div id='project'> Project Name: deepchecks/deepchecks</div><div id='commit'> Commit Name: 2d0e3893155e7b4294f49917fedc1eed7d2531cb</div><div id='time'> Time: 2022-09-14</div><div id='author'> Author: 92314933+nirhutnik@users.noreply.github.com</div><div id='file'> File Name: deepchecks/vision/metrics_utils/semantic_segmentation_metrics.py</div><div id='m_class'> M Class Name: MeanDice</div><div id='n_method'> N Class Name: MeanDice</div><div id='m_method'> M Method Name: update(2)</div><div id='n_method'> N Method Name: update(2)</div><div id='m_parent_class'> M Parent Class: Metric</div><div id='n_parent_class'> N Parent Class: Metric</div><div id='m_file'> M File Name: deepchecks/vision/metrics_utils/semantic_segmentation_metrics.py</div><div id='n_file'> N File Name: deepchecks/vision/metrics_utils/semantic_segmentation_metrics.py</div><div id='m_start'> M Start Line: 40</div><div id='m_end'> M End Line: 51</div><div id='n_start'> N Start Line: 59</div><div id='n_end'> N End Line: 74</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
    max_outliers_ratio = max(round(max_outliers_ratio, 3), 0.001)

    if quantiles_vector[int(1000 - max_outliers_ratio * 1000)] &gt; outlier_score_threshold:
        ratio_above_threshold = round((<a id="change">1000</a><a id="change"> - </a><a id="change">np.argmax(</a>quantiles_vector &gt; outlier_score_threshold<a id="change">)</a>) / 1000, 3)
        details = f&quot{format_percent(ratio_above_threshold)} of dataset samples above outlier threshold&quot
        return ConditionResult(ConditionCategory.WARN, details)
    else:</code></pre><h3>After Change</h3><pre><code class='java'>
                               max_outliers_ratio: float = 0):
    max_outliers_ratio = max(round(max_outliers_ratio, 3), 0.001)
    score_at_max_outliers_ratio = quantiles_vector[int(1000 - max_outliers_ratio * 1000)]
    category = ConditionCategory.WARN<a id="change"> if score_at_max_outliers_ratio &gt; outlier_score_threshold</a><a id="change"> \
        else </a>ConditionCategory.PASS

    quantiles_above_threshold = quantiles_vector &gt; outlier_score_threshold
    if quantiles_above_threshold.any():</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/deepchecks/deepchecks/commit/ddc6c0edf7fe008a1cbe2cab9dbef92316cfdfee#diff-7252cab2224b847528f0cf3c0cba8fba9091f4f2dc586b08d5421d36900c7395L178' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 19988872</div><div id='project'> Project Name: deepchecks/deepchecks</div><div id='commit'> Commit Name: ddc6c0edf7fe008a1cbe2cab9dbef92316cfdfee</div><div id='time'> Time: 2022-05-22</div><div id='author'> Author: matan@deepchecks.com</div><div id='file'> File Name: deepchecks/tabular/checks/data_integrity/outlier_sample_detection.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: _condition_outliers_number(3)</div><div id='n_method'> N Method Name: _condition_outliers_number(3)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: deepchecks/tabular/checks/data_integrity/outlier_sample_detection.py</div><div id='n_file'> N File Name: deepchecks/tabular/checks/data_integrity/outlier_sample_detection.py</div><div id='m_start'> M Start Line: 182</div><div id='m_end'> M End Line: 187</div><div id='n_start'> N Start Line: 181</div><div id='n_end'> N End Line: 192</div><BR>