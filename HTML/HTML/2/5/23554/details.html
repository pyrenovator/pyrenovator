<html><h3>Pattern ID :23554
</h3><img src='73792508.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
    model.eval()
    model.cpu()
    hook.remove()
    <a id="change">print(f"Feature mean is {mu.item()}, feature std is {std.item()}."</a><a id="change">)</a>
    return std, mu


def partially_disable_embedding(embedding_layer, v_length):</code></pre><h3>After Change</h3><pre><code class='java'>
        log.info(f"Computing feature distribution before the probe layer {target_layer} from external data.")
        for i, batch in enumerate(server.external_dataloader):
            inputs = batch["input_ids"].to(device=server.setup["device"])
            <a id="change">try:
                </a>model(inputs)
            <a id="change">except </a>RuntimeError:
                <a id="change">pass</a>
                &#47&#47 This is likely the worst-possible way to break execution after  the hook ...
            feats.append(features["linear_probe"].detach().view(inputs.shape[0] * inputs.shape[1], -1).clone())
    else:
        log.info(f"Computing feature distribution before the probe layer{target_layer} from random tokens.")</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 5</div><BR><div id='size'>Non-data size: 4</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/jonasgeiping/breaching/commit/c00d126c4ec4ff31ad0d7c6d76115bef950dfdd5#diff-e36f9383f4361eb797c312672cf07df6f9f08bcb5edfe0041cf704d07d1963f3L9' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 73792508</div><div id='project'> Project Name: jonasgeiping/breaching</div><div id='commit'> Commit Name: c00d126c4ec4ff31ad0d7c6d76115bef950dfdd5</div><div id='time'> Time: 2022-01-21</div><div id='author'> Author: jonas.geiping@googlemail.com</div><div id='file'> File Name: breaching/cases/malicious_modifications/analytic_transformer_utils.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: compute_feature_distribution(4)</div><div id='n_method'> N Method Name: compute_feature_distribution(3)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: breaching/cases/malicious_modifications/analytic_transformer_utils.py</div><div id='n_file'> N File Name: breaching/cases/malicious_modifications/analytic_transformer_utils.py</div><div id='m_start'> M Start Line: 19</div><div id='m_end'> M End Line: 50</div><div id='n_start'> N Start Line: 9</div><div id='n_end'> N End Line: 52</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
            except ImportError:
                raise ImportError("sklearn missing")
            except:
                <a id="change">print("Couldn&quott calculate silhouette scores"</a><a id="change">)</a>
        return documents_to_upsert

    def _get_cluster_field_name(self):
        alias = self.alias</code></pre><h3>After Change</h3><pre><code class='java'>
                self.vector_fields[0],
                documents,
            )
            <a id="change">try:
                </a>self.set_field_across_documents(
                    self._silhouette_score_field_name(),
                    self.calculate_silhouette(vectors, labels),
                    documents_to_upsert
                )
            <a id="change">except</a>:
                <a id="change">pass</a>
            try:
                self.set_field_across_documents(
                    self._squared_error_field_name(),
                    self.calculate_squared_error(vectors, labels, self.model._centroids),</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/relevanceai/relevanceai/commit/90874380279a4375882877a30c5ae860403fb2ff#diff-ea82284844b8ddfbe7e09b97f8a5794b3abfd8728b03dbdc171644a142a02189L92' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 73792511</div><div id='project'> Project Name: relevanceai/relevanceai</div><div id='commit'> Commit Name: 90874380279a4375882877a30c5ae860403fb2ff</div><div id='time'> Time: 2022-07-20</div><div id='author'> Author: jacky@relevance.ai</div><div id='file'> File Name: relevanceai/operations_new/cluster/transform.py</div><div id='m_class'> M Class Name: ClusterTransform</div><div id='n_method'> N Class Name: ClusterTransform</div><div id='m_method'> M Method Name: transform(2)</div><div id='n_method'> N Method Name: transform(2)</div><div id='m_parent_class'> M Parent Class: TransformBase,ClusterAlias</div><div id='n_parent_class'> N Parent Class: TransformBase,ClusterAlias</div><div id='m_file'> M File Name: relevanceai/operations_new/cluster/transform.py</div><div id='n_file'> N File Name: relevanceai/operations_new/cluster/transform.py</div><div id='m_start'> M Start Line: 111</div><div id='m_end'> M End Line: 132</div><div id='n_start'> N Start Line: 90</div><div id='n_end'> N End Line: 121</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
                        unsilence.detect_silence()
                        unsilence.render_media(_path, silent_speed=12, silent_volume=0, audio_only=True)
                except OSError:
                    <a id="change">print("Insufficient rights to preprocess on disk. Continuing without silence removal"</a><a id="change">)</a>
                    _path = path
            else:
                _path = path
            transcript = self.path_to_transcript_dict[path]</code></pre><h3>After Change</h3><pre><code class='java'>
                suffix = path.split(".")[-1]
                _path = os.path.join(os.path.join(cache_dir, "unsilenced_audios"), name + "_unsilenced." + suffix)
                if not os.path.exists(_path):
                    <a id="change">try:
                        </a>unsilence = Unsilence(path)
                        unsilence.detect_silence()
                        unsilence.render_media(_path, silent_speed=12, silent_volume=0, audio_only=True)
                    <a id="change">except </a>Exception:
                        &#47&#47 this has to be way too broad unfortunately, because the author of unsilence raises a bare Exception if the audio is too short.
                        <a id="change">pass</a>
            else:
                _path = path
            transcript = self.path_to_transcript_dict[path]
            wave, sr = sf.read(_path)</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/digitalphonetics/ims-toucan/commit/9cc3890cc7a221c3b2d352f149a5c271d38c2387#diff-a49dac0d7d67877dcf8511175f18c0155a9aba98acf2e0ee7bfd3a2ed69fb144L123' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 73792510</div><div id='project'> Project Name: digitalphonetics/ims-toucan</div><div id='commit'> Commit Name: 9cc3890cc7a221c3b2d352f149a5c271d38c2387</div><div id='time'> Time: 2021-10-04</div><div id='author'> Author: florian.lux@ims.uni-stuttgart.de</div><div id='file'> File Name: TrainingInterfaces/Text_to_Spectrogram/Tacotron2/TacotronDataset.py</div><div id='m_class'> M Class Name: TacotronDataset</div><div id='n_method'> N Class Name: TacotronDataset</div><div id='m_method'> M Method Name: cache_builder_process(9)</div><div id='n_method'> N Method Name: cache_builder_process(9)</div><div id='m_parent_class'> M Parent Class: Dataset</div><div id='n_parent_class'> N Parent Class: Dataset</div><div id='m_file'> M File Name: TrainingInterfaces/Text_to_Spectrogram/Tacotron2/TacotronDataset.py</div><div id='n_file'> N File Name: TrainingInterfaces/Text_to_Spectrogram/Tacotron2/TacotronDataset.py</div><div id='m_start'> M Start Line: 137</div><div id='m_end'> M End Line: 146</div><div id='n_start'> N Start Line: 137</div><div id='n_end'> N End Line: 146</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
    if mismatch_class is not None:
        import h5py

        <a id="change">print("&gt;&gt;&gt;&gt; Reload mismatched weights."</a><a id="change">)</a>
        ff = h5py.File(weight_file, mode="r")
        weights = ff["model_weights"]
        for ii in model.layers:
            if isinstance(ii, mismatch_class) and ii.name in weights:</code></pre><h3>After Change</h3><pre><code class='java'>
    model.load_weights(weight_file, by_name=True, skip_mismatch=True)
    input_height = model.input_shape[1]
    if mismatch_class is not None and request_resolution != input_height:
        <a id="change">try:
            </a>import h5py

            print("&gt;&gt;&gt;&gt; Reload mismatched weights: {} -&gt; {}".format(request_resolution, input_height))
            ff = h5py.File(weight_file, mode="r")
            weights = ff["model_weights"]
            for ii in model.layers:
                if isinstance(ii, mismatch_class) and ii.name in weights:
                    print("&gt;&gt;&gt;&gt; Reload layer:", ii.name)
                    ss = weights[ii.name]
                    &#47&#47 ss = {ww.decode().split("/")[-1] : tf.convert_to_tensor(ss[ww]) for ww in ss.attrs[&quotweight_names&quot]}
                    ss = {ww.decode("utf8") if hasattr(ww, "decode") else ww: tf.convert_to_tensor(ss[ww]) for ww in ss.attrs["weight_names"]}
                    ss = {kk.split("/")[-1]: vv for kk, vv in ss.items()}
                    model.get_layer(ii.name).load_resized_pos_emb(ss, method=method)
            ff.close()

        &#47&#47 print("&gt;&gt;&gt;&gt; Reload mismatched PositionalEmbedding weights: {} -&gt; {}".format(request_resolution, input_shape[0]))
        &#47&#47 bb = keras.models.load_model(pretrained_model)
        &#47&#47 for ii in model.layers:
        &#47&#47     if isinstance(ii, mismatch_class):
        &#47&#47         print("&gt;&gt;&gt;&gt; Reload layer:", ii.name)
        &#47&#47         model.get_layer(ii.name).load_resized_pos_emb(bb.get_layer(ii.name))
        <a id="change">except</a>:
            print("[Error] something went wrong in load_weights_with_mismatch")
            <a id="change">pass</a>


def state_dict_stack_by_layer(state_dict, skip_weights=["num_batches_tracked"], unstack_weights=[]):
    stacked_state_dict = {}</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/leondgarse/keras_cv_attention_models/commit/4b65cfd64524c57ba09b422c673158752b0fa346#diff-37028f58f90dc39d0ed1f23dec40bd7e001ad2d587c2dd6ddd16655aaec34d38L74' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 73792504</div><div id='project'> Project Name: leondgarse/keras_cv_attention_models</div><div id='commit'> Commit Name: 4b65cfd64524c57ba09b422c673158752b0fa346</div><div id='time'> Time: 2022-01-12</div><div id='author'> Author: leondgarse@gmail.com</div><div id='file'> File Name: keras_cv_attention_models/download_and_load.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: load_weights_with_mismatch(5)</div><div id='n_method'> N Method Name: load_weights_with_mismatch(5)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: keras_cv_attention_models/download_and_load.py</div><div id='n_file'> N File Name: keras_cv_attention_models/download_and_load.py</div><div id='m_start'> M Start Line: 74</div><div id='m_end'> M End Line: 92</div><div id='n_start'> N Start Line: 47</div><div id='n_end'> N End Line: 77</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
    &quot&quot&quot

    if type not in supported_image_classification_losses:
        <a id="change">print (&quotError! Provided loss function is not supported yet. For complete list of supported models please type radtorch.modelsutils.supported_list()&quot</a><a id="change">)</a>

    else:
        loss_function=loss_dict[type]
</code></pre><h3>After Change</h3><pre><code class='java'>


def create_loss_function(type):
    <a id="change">try:
        </a>loss_function=supported_loss[type]
        return loss_function
    <a id="change">except</a>:
        raise TypeError(&quotError! Provided loss function is not supported yet. For complete list of supported models please type radtorch.modelsutils.supported_list()&quot)
        <a id="change">pass</a>


def train_model(model, train_data_loader, valid_data_loader, train_data_set, valid_data_set,loss_criterion, optimizer, epochs, device,verbose):
    &quot&quot&quot</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/radtorch/radtorch/commit/ede3744573a81a43804e88d865b586f10bfd58dd#diff-529717470e003b7d942939f443e055ff6fffacc1a4e7cdb5bb437d69803eb2b4L201' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 73792507</div><div id='project'> Project Name: radtorch/radtorch</div><div id='commit'> Commit Name: ede3744573a81a43804e88d865b586f10bfd58dd</div><div id='time'> Time: 2020-04-06</div><div id='author'> Author: elbanan@users.noreply.github.com</div><div id='file'> File Name: radtorch/model.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: create_loss_function(1)</div><div id='n_method'> N Method Name: create_loss_function(1)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: radtorch/model.py</div><div id='n_file'> N File Name: radtorch/model.py</div><div id='m_start'> M Start Line: 206</div><div id='m_end'> M End Line: 213</div><div id='n_start'> N Start Line: 79</div><div id='n_end'> N End Line: 86</div><BR>