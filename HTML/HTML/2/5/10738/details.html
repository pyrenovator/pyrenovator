<html><h3>Pattern ID :10738
</h3><img src='36995671.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
            &#47&#47 we do not plan to do any recomputation.
            if isinstance(x, Tensor):
                &#47&#47 &#47&#47 See note on option 1 below.
                <a id="change">x.detach_().requires_grad_()</a>
                &#47&#47 x = x.data.clone().requires_grad_()
                self.input_buffer[micro_batch_idx] = x
                x = self.layers(x)
            else:</code></pre><h3>After Change</h3><pre><code class='java'>
            if isinstance(x, Tensor):
                &#47&#47 &#47&#47 See note on option 1 below.
                &#47&#47 x.detach_().requires_grad_()
                x<a id="change"> = x.data.clone()</a><a id="change">.requires_grad_()</a>
                self.input_buffer[micro_batch_idx] = x
                x = self.layers(x)
            else:
                &#47&#47 Option 2</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 4</div><BR><div id='size'>Non-data size: 5</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/saareliad/ftpipe/commit/991f08063b224db48c9fed2801a21a4082510b10#diff-23b420d8469016d73a4675ba9b9f6669c701352bf8de1ee18a87e6762644a7dcL205' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 36995671</div><div id='project'> Project Name: saareliad/ftpipe</div><div id='commit'> Commit Name: 991f08063b224db48c9fed2801a21a4082510b10</div><div id='time'> Time: 2019-12-22</div><div id='author'> Author: saareliad@campus.technion.ac.il</div><div id='file'> File Name: pipeline/partition.py</div><div id='m_class'> M Class Name: LastPartition</div><div id='n_method'> N Class Name: LastPartition</div><div id='m_method'> M Method Name: forward(3)</div><div id='n_method'> N Method Name: forward(3)</div><div id='m_parent_class'> M Parent Class: Partition</div><div id='n_parent_class'> N Parent Class: Partition</div><div id='m_file'> M File Name: pipeline/partition.py</div><div id='n_file'> N File Name: pipeline/partition.py</div><div id='m_start'> M Start Line: 205</div><div id='m_end'> M End Line: 205</div><div id='n_start'> N Start Line: 206</div><div id='n_end'> N End Line: 206</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
            if isinstance(x, Tensor):
                &#47&#47 &#47&#47 See note on option 1 below.
                &#47&#47 x.detach_().requires_grad_()
                x<a id="change"> = x.data.clone()</a><a id="change">.requires_grad_()</a>
                self.input_buffer[micro_batch_idx] = x
                x = self.layers(x)
            else:
                &#47&#47 Option 2</code></pre><h3>After Change</h3><pre><code class='java'>
            &#47&#47 we do not plan to do any recomputation.
            if isinstance(x, Tensor):
                &#47&#47 &#47&#47 See note on option 1 below.
                <a id="change">x.detach_().requires_grad_()</a>
                &#47&#47 x = x.data.clone().requires_grad_()
                self.input_buffer[micro_batch_idx] = x
                x = self.layers(x)
            else:</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/saareliad/ftpipe/commit/6e663f58ca4b0d96429921b0c599f3d72866cdc7#diff-23b420d8469016d73a4675ba9b9f6669c701352bf8de1ee18a87e6762644a7dcL200' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 36995672</div><div id='project'> Project Name: saareliad/ftpipe</div><div id='commit'> Commit Name: 6e663f58ca4b0d96429921b0c599f3d72866cdc7</div><div id='time'> Time: 2019-12-21</div><div id='author'> Author: saareliad@campus.technion.ac.il</div><div id='file'> File Name: pipeline/partition.py</div><div id='m_class'> M Class Name: LastPartition</div><div id='n_method'> N Class Name: LastPartition</div><div id='m_method'> M Method Name: forward(3)</div><div id='n_method'> N Method Name: forward(3)</div><div id='m_parent_class'> M Parent Class: Partition</div><div id='n_parent_class'> N Parent Class: Partition</div><div id='m_file'> M File Name: pipeline/partition.py</div><div id='n_file'> N File Name: pipeline/partition.py</div><div id='m_start'> M Start Line: 207</div><div id='m_end'> M End Line: 207</div><div id='n_start'> N Start Line: 205</div><div id='n_end'> N End Line: 205</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
            &#47&#47 we do not plan to do any recomputation.
            if isinstance(x, Tensor):
                &#47&#47 &#47&#47 See note on option 1 below.
                <a id="change">x.detach_().requires_grad_()</a>
                self.input_buffer[micro_batch_idx] = x
                x = self.layers(x)
            else:
                for tensor in x:</code></pre><h3>After Change</h3><pre><code class='java'>
            if isinstance(x, Tensor):
                &#47&#47 &#47&#47 See note on option 1 below.
                &#47&#47 x.detach_().requires_grad_()
                x<a id="change"> = x.data.clone()</a><a id="change">.requires_grad_()</a>
                self.input_buffer[micro_batch_idx] = x
                x = self.layers(x)
            else:
                for tensor in x:</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/saareliad/ftpipe/commit/bd0347bdd711c85026dba6efdd26aa1d4b840aaf#diff-23b420d8469016d73a4675ba9b9f6669c701352bf8de1ee18a87e6762644a7dcL168' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 36995673</div><div id='project'> Project Name: saareliad/ftpipe</div><div id='commit'> Commit Name: bd0347bdd711c85026dba6efdd26aa1d4b840aaf</div><div id='time'> Time: 2019-12-15</div><div id='author'> Author: saareliad@campus.technion.ac.il</div><div id='file'> File Name: pipeline/partition.py</div><div id='m_class'> M Class Name: LastPartition</div><div id='n_method'> N Class Name: LastPartition</div><div id='m_method'> M Method Name: forward(3)</div><div id='n_method'> N Method Name: forward(3)</div><div id='m_parent_class'> M Parent Class: Partition</div><div id='n_parent_class'> N Parent Class: Partition</div><div id='m_file'> M File Name: pipeline/partition.py</div><div id='n_file'> N File Name: pipeline/partition.py</div><div id='m_start'> M Start Line: 174</div><div id='m_end'> M End Line: 174</div><div id='n_start'> N Start Line: 175</div><div id='n_end'> N End Line: 175</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
                    &#47&#47 we don&quott care that the next recv will override it,
                    &#47&#47 as all we need from it is its grad, imidaitly after.
                    &#47&#47 (otherwise, we have to do synchrounous recvs)
                    <a id="change">tensor.detach_().requires_grad_()</a>
                self.input_buffer[micro_batch_idx] = x
                x = self.layers(*x)
        else:
            with torch.no_grad():</code></pre><h3>After Change</h3><pre><code class='java'>
                x = self.layers(x)
            else:
                &#47&#47 Option 2
                x<a id="change"> = </a>[<a id="change">tensor.data.clone().requires_grad_()</a> for tensor in x]

                &#47&#47 for tensor in x:
                &#47&#47     &#47&#47 Option 1: we don&quott copy the tnesor here to save memory,</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/saareliad/ftpipe/commit/fef9c23e28e0e6d2bcf0f597af63425cd0808ba5#diff-23b420d8469016d73a4675ba9b9f6669c701352bf8de1ee18a87e6762644a7dcL168' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 36995674</div><div id='project'> Project Name: saareliad/ftpipe</div><div id='commit'> Commit Name: fef9c23e28e0e6d2bcf0f597af63425cd0808ba5</div><div id='time'> Time: 2019-12-15</div><div id='author'> Author: saareliad@campus.technion.ac.il</div><div id='file'> File Name: pipeline/partition.py</div><div id='m_class'> M Class Name: LastPartition</div><div id='n_method'> N Class Name: LastPartition</div><div id='m_method'> M Method Name: forward(3)</div><div id='n_method'> N Method Name: forward(3)</div><div id='m_parent_class'> M Parent Class: Partition</div><div id='n_parent_class'> N Parent Class: Partition</div><div id='m_file'> M File Name: pipeline/partition.py</div><div id='n_file'> N File Name: pipeline/partition.py</div><div id='m_start'> M Start Line: 179</div><div id='m_end'> M End Line: 185</div><div id='n_start'> N Start Line: 180</div><div id='n_end'> N End Line: 180</div><BR>