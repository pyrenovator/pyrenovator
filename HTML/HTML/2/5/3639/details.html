<html><h3>Pattern ID :3639
</h3><img src='13667408.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
        Outputs: whole coordinates of shape (batch, L, n_atoms, 3)
    
    batch, length = backbones.shape[0], backbones.shape[1] // 3
    new_coords = <a id="change">torch.ones(</a>batch, length, NUM_COORDS_PER_RES, 3<a id="change">, device=backbones.device) * </a>padding
    new_coords[:, :, :3] = rearrange(backbones, &quotb (l back) d -&gt; b l back d&quot, l=length)
    &#47&#47 set the rest of positions to c_alpha
    new_coords[:, :, 3:] = repeat(new_coords[:, :, 2], &quotb l d -&gt; b l scn d&quot, scn=11)</code></pre><h3>After Change</h3><pre><code class='java'>
    new_coords[:, :, 3:] = repeat(new_coords[:, :, 1], &quotb l d -&gt; b l scn d&quot, scn=11)
    new_coords[torch.logical_not(cloud_mask)] = 0.
    &#47&#47 overwrite cbeta
    new_coords[:, :, 4] = <a id="change">predicted[:, :, 4]</a>
    &#47&#47 hard-calculate oxygen position of carbonyl group with parallel version of NERF
    if place_oxygen: 
        &#47&#47 build (=O) position of revery aa in each chain
        for s in range(batch):</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 4</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/lucidrains/alphafold2/commit/3fbddf2be348b349186c787bbf30d1da2f2cd541#diff-f9b2e05be1f80257f9a80ec7cc1290e3337a54fcc62aeee31b23a4cb827f12efL244' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 13667408</div><div id='project'> Project Name: lucidrains/alphafold2</div><div id='commit'> Commit Name: 3fbddf2be348b349186c787bbf30d1da2f2cd541</div><div id='time'> Time: 2021-03-03</div><div id='author'> Author: ericalcaide1@gmail.com</div><div id='file'> File Name: alphafold2_pytorch/utils.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: sidechain_container(6)</div><div id='n_method'> N Method Name: sidechain_container(4)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: alphafold2_pytorch/utils.py</div><div id='n_file'> N File Name: alphafold2_pytorch/utils.py</div><div id='m_start'> M Start Line: 244</div><div id='m_end'> M End Line: 246</div><div id='n_start'> N Start Line: 291</div><div id='n_end'> N End Line: 317</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
def add_clique(W,k):
    K = torch.zeros((len(W),len(W)))
    K[:k,:k] = torch.ones((k,k)) - torch.eye(k)
    W[:k,:k] = <a id="change">torch.ones(</a>(k,k)<a id="change">) - </a>torch.eye(k)
    return W, K</code></pre><h3>After Change</h3><pre><code class='java'>
    indices = random.sample(range(len(W),k))
    l_indices = [(id_i,id_j) for id_i in indices for id_j in indices if id_i!=id_j] &#47&#47Makes all the pairs of indices where we put the clique (get rid of diagonal terms)
    t_ind = torch.tensor(l_indices)
    K[<a id="change">t_ind[:,0]</a>,t_ind[:,1]] = 1
    W[t_ind[:,0],t_ind[:,1]] = 1
    return W,K
    </code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/mlelarge/graph_neural_net/commit/49091cc0f5bdc775afc5fe9056cdc07260470ca7#diff-845718abb813d7715646b2d63513ac597d626177ca2332ddb4baeb3588fa7f9cL220' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 13667410</div><div id='project'> Project Name: mlelarge/graph_neural_net</div><div id='commit'> Commit Name: 49091cc0f5bdc775afc5fe9056cdc07260470ca7</div><div id='time'> Time: 2021-02-18</div><div id='author'> Author: amaury.triboulin@gmail.com</div><div id='file'> File Name: loaders/data_generator.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: add_clique(2)</div><div id='n_method'> N Method Name: add_clique(2)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: loaders/data_generator.py</div><div id='n_file'> N File Name: loaders/data_generator.py</div><div id='m_start'> M Start Line: 221</div><div id='m_end'> M End Line: 223</div><div id='n_start'> N Start Line: 227</div><div id='n_end'> N End Line: 232</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        dtype=matrix.dtype
    )
    addition_matrix = torch.sparse_coo_tensor(
        torch.stack([<a id="change">torch.ones(</a>row.shape[-1]<a id="change">,
                     device=matrix.device)*</a>row_index,
                     torch.arange(row.shape[-1],
                     device=matrix.device)], 0),
        row.to_dense().squeeze(),</code></pre><h3>After Change</h3><pre><code class='java'>
        row = row.coalesce()

    addition_matrix = torch.sparse_coo_tensor(
        torch.stack((<a id="change">row.indices()[0, :]</a> + row_index,
                     row.indices()[1, :]), 0),
        row.values(),
        size=matrix.shape, device=matrix.device,</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/v0lta/pytorch-wavelet-toolbox/commit/c3588d3d82a1968f683b7baf1f5819f7ff2550b4#diff-4cf3e41efbfc338d0b6af6fd66d51bf77a37adf3814121abe1d2f6fc7040efa8L76' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 13667396</div><div id='project'> Project Name: v0lta/pytorch-wavelet-toolbox</div><div id='commit'> Commit Name: c3588d3d82a1968f683b7baf1f5819f7ff2550b4</div><div id='time'> Time: 2021-09-28</div><div id='author'> Author: moritz@wolter.tech</div><div id='file'> File Name: src/ptwt/sparse_math.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: sparse_replace_row(3)</div><div id='n_method'> N Method Name: sparse_replace_row(3)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: src/ptwt/sparse_math.py</div><div id='n_file'> N File Name: src/ptwt/sparse_math.py</div><div id='m_start'> M Start Line: 105</div><div id='m_end'> M End Line: 109</div><div id='n_start'> N Start Line: 104</div><div id='n_end'> N End Line: 110</div><BR>