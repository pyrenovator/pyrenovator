<html><h3>Pattern ID :865
</h3><img src='4263489.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
        l1_loss = l1_loss.mul(out_weights).masked_select(out_masks).sum()
        duration_loss = (duration_loss.mul(duration_weights).masked_select(duration_masks).sum())

        <a id="change">return </a>l1_loss, duration_loss
</code></pre><h3>After Change</h3><pre><code class='java'>
        &#47&#47 apply weight
        l1_loss = l1_loss.mul(out_weights).masked_select(out_masks).sum()
        duration_loss = (duration_loss.mul(duration_weights).masked_select(duration_masks).sum())
        pitch_loss<a id="change"> = </a><a id="change">pitch_loss.mul(variance_weights).masked_select(</a>variance_masks<a id="change">)</a>.sum()
        energy_loss = (energy_loss.mul(variance_weights).masked_select(variance_masks).sum())

        <a id="change">return </a>l1_loss<a id="change">, duration_loss, pitch_loss, energy_loss</a>
</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 5</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/digitalphonetics/ims-toucan/commit/116b9c3f51fb74738622ec2ce379e42f9e478498#diff-d7f9aee10ac5450baf13668ce069a9ea393323a61e8217b09a70a6ecc1e72757L20' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 4263489</div><div id='project'> Project Name: digitalphonetics/ims-toucan</div><div id='commit'> Commit Name: 116b9c3f51fb74738622ec2ce379e42f9e478498</div><div id='time'> Time: 2023-03-11</div><div id='author'> Author: lux.florian@gmail.com</div><div id='file'> File Name: TrainingInterfaces/Text_to_Spectrogram/ToucanTTS/ToucanTTSLoss.py</div><div id='m_class'> M Class Name: ToucanTTSLoss</div><div id='n_method'> N Class Name: ToucanTTSLoss</div><div id='m_method'> M Method Name: forward(12)</div><div id='n_method'> N Method Name: forward(8)</div><div id='m_parent_class'> M Parent Class: torch.nn.Module</div><div id='n_parent_class'> N Parent Class: torch.nn.Module</div><div id='m_file'> M File Name: TrainingInterfaces/Text_to_Spectrogram/ToucanTTS/ToucanTTSLoss.py</div><div id='n_file'> N File Name: TrainingInterfaces/Text_to_Spectrogram/ToucanTTS/ToucanTTSLoss.py</div><div id='m_start'> M Start Line: 50</div><div id='m_end'> M End Line: 53</div><div id='n_start'> N Start Line: 20</div><div id='n_end'> N End Line: 66</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        setattr(interaction, &quotpos_len_list&quot, pos_len_list)
        setattr(interaction, &quotuser_idx_list&quot, user_idx_list)

        <a id="change">return </a>interaction, scores

    def evaluate(self, eval_data, load_best_model=True, model_file=None):
        if load_best_model:</code></pre><h3>After Change</h3><pre><code class='java'>

        ones_tensor = torch.ones(batch_size, dtype=torch.bool, device=self.device)
        used_mask = ones_tensor.index_fill(dim=0, index=used_idx, value=0)
        neg_scores<a id="change"> = </a><a id="change">scores.masked_select(</a>used_mask<a id="change">)</a>
        neg_scores = torch.split(neg_scores, neg_len_list, dim=0)

        final_scores = list(itertools.chain.from_iterable(zip(pos_scores, neg_scores)))
        final_scores = torch.cat(final_scores)

        setattr(interaction, &quotpos_len_list&quot, pos_len_list)
        setattr(interaction, &quotuser_len_list&quot, user_len_list)

        <a id="change">return </a>interaction<a id="change">, final_scores</a>

    def evaluate(self, eval_data, load_best_model=True, model_file=None):
        if load_best_model:</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/rucaibox/recbole/commit/efaf2d8c84961b5042c0d42e08e56a59f064f267#diff-0564ece5aadc13d5923043addc422a8058c6d96026493e84652cedc2f1bdca99L184' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 4263504</div><div id='project'> Project Name: rucaibox/recbole</div><div id='commit'> Commit Name: efaf2d8c84961b5042c0d42e08e56a59f064f267</div><div id='time'> Time: 2020-08-05</div><div id='author'> Author: houyupeng@ruc.edu.cn</div><div id='file'> File Name: trainer/trainer.py</div><div id='m_class'> M Class Name: Trainer</div><div id='n_method'> N Class Name: Trainer</div><div id='m_method'> M Method Name: _full_sort_batch_eval(2)</div><div id='n_method'> N Method Name: _full_sort_batch_eval(2)</div><div id='m_parent_class'> M Parent Class: AbstractTrainer</div><div id='n_parent_class'> N Parent Class: AbstractTrainer</div><div id='m_file'> M File Name: trainer/trainer.py</div><div id='n_file'> N File Name: trainer/trainer.py</div><div id='m_start'> M Start Line: 186</div><div id='m_end'> M End Line: 212</div><div id='n_start'> N Start Line: 187</div><div id='n_end'> N End Line: 211</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        &#47&#47 apply weight
        l1_loss = l1_loss.mul(out_weights).masked_select(out_masks).sum()

        <a id="change">return </a>l1_loss
</code></pre><h3>After Change</h3><pre><code class='java'>

        &#47&#47 apply weight
        l1_loss = l1_loss.mul(out_weights).masked_select(out_masks).sum()
        duration_loss<a id="change"> = </a>(<a id="change">duration_loss.mul(duration_weights).masked_select(</a>duration_masks<a id="change">)</a>.sum())

        <a id="change">return </a>l1_loss<a id="change">, duration_loss</a>
</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/digitalphonetics/ims-toucan/commit/b8532b46fafdc2f07c5ce57d6b7711db0682be18#diff-d7f9aee10ac5450baf13668ce069a9ea393323a61e8217b09a70a6ecc1e72757L17' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 4263499</div><div id='project'> Project Name: digitalphonetics/ims-toucan</div><div id='commit'> Commit Name: b8532b46fafdc2f07c5ce57d6b7711db0682be18</div><div id='time'> Time: 2023-03-09</div><div id='author'> Author: lux.florian@gmail.com</div><div id='file'> File Name: TrainingInterfaces/Text_to_Spectrogram/ToucanTTS/ToucanTTSLoss.py</div><div id='m_class'> M Class Name: ToucanTTSLoss</div><div id='n_method'> N Class Name: ToucanTTSLoss</div><div id='m_method'> M Method Name: forward(8)</div><div id='n_method'> N Method Name: forward(5)</div><div id='m_parent_class'> M Parent Class: torch.nn.Module</div><div id='n_parent_class'> N Parent Class: torch.nn.Module</div><div id='m_file'> M File Name: TrainingInterfaces/Text_to_Spectrogram/ToucanTTS/ToucanTTSLoss.py</div><div id='n_file'> N File Name: TrainingInterfaces/Text_to_Spectrogram/ToucanTTS/ToucanTTSLoss.py</div><div id='m_start'> M Start Line: 35</div><div id='m_end'> M End Line: 43</div><div id='n_start'> N Start Line: 19</div><div id='n_end'> N End Line: 53</div><BR>