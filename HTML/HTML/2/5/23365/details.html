<html><h3>Pattern ID :23365
</h3><img src='73494049.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
def test_extractor(compression_format, gz_file, xz_file, zstd_file, bz2_file, tmp_path, text_file):
    input_paths = {"gzip": gz_file, "xz": xz_file, "zstd": zstd_file, "bz2": bz2_file}
    input_path = str(input_paths[compression_format])
    output_path<a id="change"> = </a>str(tmp_path / "extracted.txt")
    assert Extractor.is_extractable(input_path)
    Extractor.extract(input_path, output_path)
    <a id="change">with open</a><a id="change">(output_path) as f:
        </a>extracted_file_content = f.read()
    with open(text_file) as f:
        expected_file_content = f.read()
    assert extracted_file_content == expected_file_content</code></pre><h3>After Change</h3><pre><code class='java'>
        pytest.skip(reason)
    input_path = str(input_path)
    assert Extractor.is_extractable(input_path)
    output_path = tmp_path / ("extracted"<a id="change"> if </a>is_archive<a id="change"> else </a>"extracted.txt")
    Extractor.extract(input_path, output_path)
    if is_archive:
        assert output_path.is_dir()</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 5</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/huggingface/datasets/commit/44d48a2b12a157a8f5f3b0e114a2884ea0451aea#diff-24ff2537b4f0f0e2917e279686bf69fb986c20223430905764ef2f6a0e53a975L24' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 73494049</div><div id='project'> Project Name: huggingface/datasets</div><div id='commit'> Commit Name: 44d48a2b12a157a8f5f3b0e114a2884ea0451aea</div><div id='time'> Time: 2022-07-15</div><div id='author'> Author: 8515462+albertvillanova@users.noreply.github.com</div><div id='file'> File Name: tests/test_extract.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: test_extractor(9)</div><div id='n_method'> N Method Name: test_extractor(7)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: tests/test_extract.py</div><div id='n_file'> N File Name: tests/test_extract.py</div><div id='m_start'> M Start Line: 24</div><div id='m_end'> M End Line: 33</div><div id='n_start'> N Start Line: 40</div><div id='n_end'> N End Line: 60</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        JitCompiler.__CTX__ += 1

        key = int(os.environ.get(&quotLOCAL_RANK&quot, &quot0&quot))
        temp_loc<a id="change"> = </a>&quot%s-%s.MoE&quot % (tempfile.mktemp(), __ctx__)
        <a id="change">with open</a><a id="change">(temp_loc, &quotw&quot) as fp:
            </a>if IS_HIP_EXTENSION:
              fp.write(&quot&#47&#47include &lt;hip/hip_runtime.h&gt;\n&#47&#47include &lt;hip/hip_fp16.h&gt;\n&quot)
            else:
              fp.write(&quot&#47&#47include &lt;cuda_runtime.h&gt;\n&#47&#47include &lt;cuda_fp16.h&gt;\n&quot)</code></pre><h3>After Change</h3><pre><code class='java'>
        __ctx__ = JitCompiler.__CTX__
        JitCompiler.__CTX__ += 1

        no_nvrtc = 1<a id="change"> if </a>int(os.environ.get(&quotNO_NVRTC&quot, &quot0&quot))<a id="change"> else </a>0
        if not IS_HIP_EXTENSION:
            source = &quot&#47&#47include &lt;cuda_runtime.h&gt;\n&#47&#47include &lt;cuda_fp16.h&gt;\n&quot + source
        else:</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/microsoft/tutel/commit/ee0641459f130a3e2aac030054c208591b8f959a#diff-276aae1fd7354a9b95222ace188e73f36c0d8ab96e7b9269ce0d1df2e20ecd95L21' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 73494050</div><div id='project'> Project Name: microsoft/tutel</div><div id='commit'> Commit Name: ee0641459f130a3e2aac030054c208591b8f959a</div><div id='time'> Time: 2021-09-16</div><div id='author'> Author: weicu@microsoft.com</div><div id='file'> File Name: tutel/impls/jit_compiler.py</div><div id='m_class'> M Class Name: JitCompiler</div><div id='n_method'> N Class Name: JitCompiler</div><div id='m_method'> M Method Name: create_raw(1)</div><div id='n_method'> N Method Name: create_raw(1)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: tutel/impls/jit_compiler.py</div><div id='n_file'> N File Name: tutel/impls/jit_compiler.py</div><div id='m_start'> M Start Line: 25</div><div id='m_end'> M End Line: 36</div><div id='n_start'> N Start Line: 25</div><div id='n_end'> N End Line: 36</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>

    for split in splits:
        img_txt_path = osp.join(img_txt_dir, &quot{}.txt&quot.format(split))
        img_txt_path_debug<a id="change"> = </a>osp.join(img_txt_dir, &quot{}_debug.txt&quot.format(split))
        labels_path = osp.join(data[&quotpath&quot], &quot{}/{}&quot.format(data[&quotlabels&quot], split if is_coco else &quot&quot))
        os.makedirs(labels_path, exist_ok=True)
        coco = COCO(osp.join(data[&quotpath&quot], data[&quotannotations_prefix&quot] + &quot{}.json&quot.format(split)))

        pbar = tqdm(coco.anns.keys(), total=len(coco.anns.keys()))
        pbar.desc = &quotWriting {} labels to {}&quot.format(split, labels_path)
        for id in pbar:
            a = coco.anns[id]

            if a[&quotimage_id&quot] not in coco.imgs:
                continue

            if &quottrain&quot in split:
                if is_coco and a[&quotiscrowd&quot]:
                    continue

            img_info = coco.imgs[a[&quotimage_id&quot]]
            img_h, img_w = img_info[&quotheight&quot], img_info[&quotwidth&quot]
            x, y, w, h = a[&quotbbox&quot]
            xc, yc = x + w / 2, y + h / 2
            xc /= img_w
            yc /= img_h
            w /= img_w
            h /= img_h

            keypoints = np.array(a[&quotkeypoints&quot]).reshape([-1, 3])

            with open(osp.join(labels_path, &quot{}.txt&quot.format(osp.splitext(img_info[&quotfile_name&quot])[0])), &quota&quot) as f:
                &#47&#47 write person object
                s = &quot{} {:.6f} {:.6f} {:.6f} {:.6f}&quot.format(0, xc, yc, w, h)
                if data[&quotpose_obj&quot]:
                    for i, (x, y, v) in enumerate(keypoints):
                        s += &quot {:.6f} {:.6f} {:.6f}&quot.format(x / img_w, y / img_h, v)
                s += &quot\n&quot
                f.write(s)

                &#47&#47 write keypoint objects
                for i, (x, y, v) in enumerate(keypoints):
                    if v:
                        if isinstance(data[&quotkp_bbox&quot], list):
                            kp_bbox = data[&quotkp_bbox&quot][i]
                        else:
                            kp_bbox = data[&quotkp_bbox&quot]

                        s = &quot{} {:.6f} {:.6f} {:.6f} {:.6f}&quot.format(
                            i + 1, x / img_w, y / img_h,
                            kp_bbox * max(img_h, img_w) / img_w,
                            kp_bbox * max(img_h, img_w) / img_h)

                        if data[&quotpose_obj&quot]:
                            for _ in range(keypoints.shape[0]):
                                s += &quot {:.6f} {:.6f} {:.6f}&quot.format(0, 0, 0)
                        s += &quot\n&quot
                        f.write(s)
        pbar.close()

        with open(img_txt_path, &quotw&quot) as f:
            for img_info in coco.imgs.values():
                f.write(osp.join(data[&quotpath&quot], &quotimages&quot,
                                 &quot{}&quot.format(split if is_coco else &quot&quot),
                                 img_info[&quotfile_name&quot]) + &quot\n&quot)

        <a id="change">with open</a><a id="change">(img_txt_path_debug, &quotw&quot) as f:
            </a>for img_info in list(coco.imgs.values())[:128]:
                f.write(osp.join(data[&quotpath&quot], &quotimages&quot,
                                 &quot{}&quot.format(split if is_coco else &quot&quot),
                                 img_info[&quotfile_name&quot]) + &quot\n&quot)</code></pre><h3>After Change</h3><pre><code class='java'>

    splits = [osp.splitext(osp.split(data[s])[-1])[0] for s in [&quottrain&quot, &quotval&quot, &quottest&quot] if s in data]
    annotations = [osp.join(data[&quotpath&quot], data[&quot{}_annotations&quot.format(s)]) for s in [&quottrain&quot, &quotval&quot, &quottest&quot] if s in data]
    test_split = [0<a id="change"> if </a>s in [&quottrain&quot, &quotval&quot]<a id="change"> else </a>1 for s in [&quottrain&quot, &quotval&quot, &quottest&quot] if s in data]
    img_txt_dir = osp.join(data[&quotpath&quot], data[&quotlabels&quot], &quotimg_txt&quot)
    os.makedirs(img_txt_dir, exist_ok=True)
</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/wmcnally/kapao/commit/885d30c862e338d4f9b261fad6b923981e6abf18#diff-f10cd31724bb5abb110239c2bffda1f03e4f24d96b1b04130be39c9247d83404L9' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 73494046</div><div id='project'> Project Name: wmcnally/kapao</div><div id='commit'> Commit Name: 885d30c862e338d4f9b261fad6b923981e6abf18</div><div id='time'> Time: 2021-10-27</div><div id='author'> Author: wmcnally@uwaterloo.ca</div><div id='file'> File Name: utils/labels.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: write_kp_labels(1)</div><div id='n_method'> N Method Name: write_kp_labels(1)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: utils/labels.py</div><div id='n_file'> N File Name: utils/labels.py</div><div id='m_start'> M Start Line: 13</div><div id='m_end'> M End Line: 95</div><div id='n_start'> N Start Line: 18</div><div id='n_end'> N End Line: 86</div><BR>