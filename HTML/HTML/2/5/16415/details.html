<html><h3>Pattern ID :16415
</h3><img src='55210778.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
    for key, fn in files:
        data[key] = np.loadtxt(fn)

    print(<a id="change">"[makenpz] generating {}".format(</a>outp<a id="change">)</a>)
    np.savez_compressed(outp, **data)

</code></pre><h3>After Change</h3><pre><code class='java'>
        inp = os.path.normpath(args.dirname)
        outp = inp + ".npz"
    else:
        inp<a id="change"> = </a><a id="change">os.path.join(</a>os.path.abspath(os.path.dirname(__file__)),
                           &quot..&quot, <a id="change">&quottests&quot</a>, &quotdata&quot, args.dirname<a id="change">)</a>
        outdir_abs = os.path.join(os.getcwd(), args.outdir)
        outp = os.path.join(outdir_abs, args.dirname + ".npz")

    &#47&#47 Skip rebuilding if no sources</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 3</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/scipy/scipy/commit/d7da18962ea09a405036faf7f00d2cc0ef25dc46#diff-3b9d5945dccca9a6b380c6e60f2346f35e2ea2f1bb7e3d88fada84076e516ceeL16' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 55210778</div><div id='project'> Project Name: scipy/scipy</div><div id='commit'> Commit Name: d7da18962ea09a405036faf7f00d2cc0ef25dc46</div><div id='time'> Time: 2021-12-29</div><div id='author'> Author: ralf.gommers@gmail.com</div><div id='file'> File Name: scipy/special/utils/makenpz.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: main(0)</div><div id='n_method'> N Method Name: main(0)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: scipy/special/utils/makenpz.py</div><div id='n_file'> N File Name: scipy/special/utils/makenpz.py</div><div id='m_start'> M Start Line: 22</div><div id='m_end'> M End Line: 61</div><div id='n_start'> N Start Line: 16</div><div id='n_end'> N End Line: 35</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
                load_name_tmp = &quotep_&quot + str(load_epoch) + &quot.m&quot
                self.model.load_state_dict(
                    torch.load(self.tmp_path + load_name_tmp))
                print(<a id="change">&quotload epoch={} model state&quot.format(</a>load_epoch<a id="change">)</a>)
            if lr &lt;= 0.9 * 1e-5:
                break
        best = np.argmax(metrics[&quotaccuracy&quot])  &#47&#47 这个不是最好的一次吗？</code></pre><h3>After Change</h3><pre><code class='java'>
            if self.config[&quothyper_tune&quot]:
                &#47&#47 use ray tune to checkpoint
                with tune.checkpoint_dir(step=epoch) as checkpoint_dir:
                    path<a id="change"> = </a><a id="change">os.path.join(</a>checkpoint_dir, <a id="change">"checkpoint"</a><a id="change">)</a>
                    self.save_model(path)
                &#47&#47 ray tune use loss to determine which params are best
                tune.report(loss=avg_eval_loss, accuracy=avg_eval_acc)
            else:</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/libcity/bigscity-libcity/commit/022010c6ffc7ff440e276127d6e6341751e03d69#diff-3b0408c84ea1982a6fe3d842dd9eff33a8bba27ca54ad0f448b9f8ae7b2c38e4L23' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 55210791</div><div id='project'> Project Name: libcity/bigscity-libcity</div><div id='commit'> Commit Name: 022010c6ffc7ff440e276127d6e6341751e03d69</div><div id='time'> Time: 2021-04-14</div><div id='author'> Author: 33283819+WenMellors@users.noreply.github.com</div><div id='file'> File Name: trafficdl/executor/traj_loc_pred_executor.py</div><div id='m_class'> M Class Name: TrajLocPredExecutor</div><div id='n_method'> N Class Name: TrajLocPredExecutor</div><div id='m_method'> M Method Name: train(3)</div><div id='n_method'> N Method Name: train(3)</div><div id='m_parent_class'> M Parent Class: AbstractExecutor</div><div id='n_parent_class'> N Parent Class: AbstractExecutor</div><div id='m_file'> M File Name: trafficdl/executor/traj_loc_pred_executor.py</div><div id='n_file'> N File Name: trafficdl/executor/traj_loc_pred_executor.py</div><div id='m_start'> M Start Line: 24</div><div id='m_end'> M End Line: 74</div><div id='n_start'> N Start Line: 33</div><div id='n_end'> N End Line: 71</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
    &#47&#47     del chkpt

    def __save_model_weights(self, epoch, loss):
        weight = os.path.join(os.path.split(self.weight_path)[0], <a id="change">"epoch{}, loss{}.pt".format(</a>epoch,loss<a id="change">)</a>)
        chkpt = {&quotepoch&quot: epoch,
                 &quotmodel&quot: self.yolov4.state_dict(),
                 &quotoptimizer&quot: self.optimizer.state_dict()}</code></pre><h3>After Change</h3><pre><code class='java'>
        if mAP &gt; self.best_mAP:
            self.best_mAP = mAP
        best_weight = os.path.join(os.path.split(self.weight_path)[0], "best.pt")
        last_weight<a id="change"> = </a><a id="change">os.path.join(</a>os.path.split(self.weight_path)[0], <a id="change">"last.pt"</a><a id="change">)</a>
        chkpt = {&quotepoch&quot: epoch,
                 &quotbest_mAP&quot: self.best_mAP,
                 &quotmodel&quot: self.yolov4.state_dict(),
                 &quotoptimizer&quot: self.optimizer.state_dict()}</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/argusswift/yolov4-pytorch/commit/2e9ce6dbdb27a756a089d751b7a32e7d8b8a997f#diff-ed183d67207df065a11e1289f19d34cc2abbc5448dea952683cfe9728c342b95L102' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 55210789</div><div id='project'> Project Name: argusswift/yolov4-pytorch</div><div id='commit'> Commit Name: 2e9ce6dbdb27a756a089d751b7a32e7d8b8a997f</div><div id='time'> Time: 2020-07-28</div><div id='author'> Author: your email</div><div id='file'> File Name: train.py</div><div id='m_class'> M Class Name: Trainer</div><div id='n_method'> N Class Name: Trainer</div><div id='m_method'> M Method Name: __save_model_weights(3)</div><div id='n_method'> N Method Name: __save_model_weights(3)</div><div id='m_parent_class'> M Parent Class: object</div><div id='n_parent_class'> N Parent Class: object</div><div id='m_file'> M File Name: train.py</div><div id='n_file'> N File Name: train.py</div><div id='m_start'> M Start Line: 103</div><div id='m_end'> M End Line: 107</div><div id='n_start'> N Start Line: 86</div><div id='n_end'> N End Line: 101</div><BR>