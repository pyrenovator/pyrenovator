<html><h3>Pattern ID :1179
</h3><img src='5880808.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
        score = ((1 + beta ** 2) * tp + smooth) \
                / ((1 + beta ** 2) * tp + beta ** 2 * fn + fp + smooth)
        return score
    <a id="change">return </a>_f_score

&#47&#47 设标签宽W，长H
def fast_hist(a, b, n):</code></pre><h3>After Change</h3><pre><code class='java'>
        inputs = F.interpolate(inputs, size=(ht, wt), mode="bilinear", align_corners=True)
        
    temp_inputs = torch.softmax(inputs.transpose(1, 2).transpose(2, 3).contiguous().view(n, -1, c),-1)
    temp_target<a id="change"> = </a>target.view(n, -1, ct)

    &#47&#47--------------------------------------------&#47&#47
    &#47&#47   计算dice系数
    &#47&#47--------------------------------------------&#47&#47
    temp_inputs<a id="change"> = </a><a id="change">torch.gt(</a>temp_inputs, threhold<a id="change">)</a>.float()
    tp = torch.sum(temp_target[...,:-1] * temp_inputs, axis=[0,1])
    fp = torch.sum(temp_inputs                       , axis=[0,1]) - tp
    fn = torch.sum(temp_target[...,:-1]              , axis=[0,1]) - tp

    score = ((1 + beta ** 2) * tp + smooth) / ((1 + beta ** 2) * tp + beta ** 2 * fn + fp + smooth)
    score = torch.mean(score)
    <a id="change">return </a>score

&#47&#47 设标签宽W，长H
def fast_hist(a, b, n):</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 5</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/bubbliiiing/hrnet-pytorch/commit/b85431a3de8a7df3396c86fe3596f581ba4c25da#diff-7ae5192939647dc1b303306c4b6c110b7c65f4e691a4308112d407aea7805ca8L12' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 5880808</div><div id='project'> Project Name: bubbliiiing/hrnet-pytorch</div><div id='commit'> Commit Name: b85431a3de8a7df3396c86fe3596f581ba4c25da</div><div id='time'> Time: 2022-03-19</div><div id='author'> Author: 3323290568@qq.com</div><div id='file'> File Name: utils/utils_metrics.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: f_score(5)</div><div id='n_method'> N Method Name: f_score(3)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: utils/utils_metrics.py</div><div id='n_file'> N File Name: utils/utils_metrics.py</div><div id='m_start'> M Start Line: 35</div><div id='m_end'> M End Line: 35</div><div id='n_start'> N Start Line: 12</div><div id='n_end'> N End Line: 31</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        &#47&#47 fetch the last hidden state of last timestamp
        c_global = ht = self.gather_indexes(gru_out, interaction[self.ITEM_LIST_LEN] - 1)
        &#47&#47 avoid the influence of padding
        mask<a id="change"> = </a>item_id_list.gt(0).unsqueeze(2).expand_as(gru_out)
        q1 = self.a_1(gru_out)
        q2 = self.a_2(ht)
        q2_expand = q2.unsqueeze(1).expand_as(q1)
        &#47&#47 calculate weighted factors α
        alpha = self.v_t(mask * torch.sigmoid(q1 + q2_expand))
        c_local = torch.sum(alpha.expand_as(gru_out) * gru_out, 1)
        c_t = torch.cat([c_local, c_global], 1)
        c_t = self.ct_dropout(c_t)
        pred = self.b(c_t)

        <a id="change">return </a>pred

    def calculate_loss(self, interaction):
        target_id = interaction[self.TARGET_ITEM_ID]</code></pre><h3>After Change</h3><pre><code class='java'>
        &#47&#47 fetch the last hidden state of last timestamp
        c_global = ht = self.gather_indexes(gru_out, item_seq_len - 1)
        &#47&#47 avoid the influence of padding
        mask<a id="change"> = </a><a id="change">item_seq.gt(</a>0<a id="change">)</a>.unsqueeze(2).expand_as(gru_out)
        q1 = self.a_1(gru_out)
        q2 = self.a_2(ht)
        q2_expand = q2.unsqueeze(1).expand_as(q1)
        &#47&#47 calculate weighted factors α
        alpha = self.v_t(mask * torch.sigmoid(q1 + q2_expand))
        c_local = torch.sum(alpha.expand_as(gru_out) * gru_out, 1)
        c_t = torch.cat([c_local, c_global], 1)
        c_t = self.ct_dropout(c_t)
        seq_output = self.b(c_t)
        <a id="change">return </a>seq_output

    def calculate_loss(self, interaction):
        item_seq = interaction[self.ITEM_SEQ]</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/rucaibox/recbole/commit/1714ed39db89b102bc46fc23155f92de0d8996bd#diff-307e63abec22600af104a8dbc42fb12688d997b677ad0c5898022038427c17e6L80' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 5880815</div><div id='project'> Project Name: rucaibox/recbole</div><div id='commit'> Commit Name: 1714ed39db89b102bc46fc23155f92de0d8996bd</div><div id='time'> Time: 2020-10-15</div><div id='author'> Author: hui.wang@ruc.edu.cn</div><div id='file'> File Name: recbox/model/sequential_recommender/narm.py</div><div id='m_class'> M Class Name: NARM</div><div id='n_method'> N Class Name: NARM</div><div id='m_method'> M Method Name: forward(3)</div><div id='n_method'> N Method Name: forward(2)</div><div id='m_parent_class'> M Parent Class: SequentialRecommender</div><div id='n_parent_class'> N Parent Class: SequentialRecommender</div><div id='m_file'> M File Name: recbox/model/sequential_recommender/narm.py</div><div id='n_file'> N File Name: recbox/model/sequential_recommender/narm.py</div><div id='m_start'> M Start Line: 81</div><div id='m_end'> M End Line: 100</div><div id='n_start'> N Start Line: 76</div><div id='n_end'> N End Line: 95</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
            - betaln(n - value + 1, bad - n + value + 1)
            - betaln(tot + 1, 1)
        )
        <a id="change">return </a>result


class DiscreteUniform(Discrete):</code></pre><h3>After Change</h3><pre><code class='java'>
            - betaln(tot + 1, 1)
        )
        &#47&#47 value in [max(0, n - N + k), min(k, n)]
        lower<a id="change"> = </a>tt.switch(<a id="change">tt.gt(</a>n - N + k, 0<a id="change">)</a>, n - N + k, 0)
        upper<a id="change"> = </a>tt.switch(tt.lt(k, n), k, n)
        <a id="change">return </a>bound(result, lower &lt;= value, value &lt;= upper)


class DiscreteUniform(Discrete):</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/pymc-devs/pymc3/commit/0402aab9594ec7c4f63c4ea35a52428d424652b4#diff-261a77bdd4256cfbcba0070411f44915028fd09e673694f91f32b6303158e77bL906' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 5880832</div><div id='project'> Project Name: pymc-devs/pymc3</div><div id='commit'> Commit Name: 0402aab9594ec7c4f63c4ea35a52428d424652b4</div><div id='time'> Time: 2020-12-22</div><div id='author'> Author: 28983449+ricardoV94@users.noreply.github.com</div><div id='file'> File Name: pymc3/distributions/discrete.py</div><div id='m_class'> M Class Name: HyperGeometric</div><div id='n_method'> N Class Name: HyperGeometric</div><div id='m_method'> M Method Name: logp(2)</div><div id='n_method'> N Method Name: logp(2)</div><div id='m_parent_class'> M Parent Class: Discrete</div><div id='n_parent_class'> N Parent Class: Discrete</div><div id='m_file'> M File Name: pymc3/distributions/discrete.py</div><div id='n_file'> N File Name: pymc3/distributions/discrete.py</div><div id='m_start'> M Start Line: 925</div><div id='m_end'> M End Line: 933</div><div id='n_start'> N Start Line: 920</div><div id='n_end'> N End Line: 936</div><BR>