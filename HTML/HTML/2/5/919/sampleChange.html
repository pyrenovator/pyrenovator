<link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
    &#47&#47 3.8 G Multiply-Adds, 2 FLOPs per MADD, 3 for fwd+bwd.
    flops_for_one_image = 3.8 * (10**9) * 2 * 3

    <a id="change">if </a>isinstance(resources.cloud, clouds.AWS):
        instance = resources.types
        if instance == &quotp3.2xlarge&quot:
            num_v100s = 1
        elif instance == &quotp3.8xlarge&quot:
            num_v100s = 4
        elif instance == &quotp3.16xlarge&quot:
            num_v100s = 8
        else:
            assert False, &quotNot supported: {}&quot.format(resources)

        &#47&#47 Adds communication overheads per step (in seconds).
        communication_slack = 0.0
        if num_v100s == 4:
            communication_slack = 0.15
        elif num_v100s == 8:
            communication_slack = 0.30

        max_per_device_batch_size = 256
        effective_batch_size = max_per_device_batch_size * num_v100s

        &#47&#47 112590 steps, 1024 BS = 90 epochs.
        total_steps = 112590 * (1024.0 / effective_batch_size)
        flops_for_one_batch = flops_for_one_image * max_per_device_batch_size

        &#47&#47 27 TFLOPs, harmonic mean b/t 15TFLOPs (single-precision) & 120 TFLOPs
        &#47&#47 (16 bit).
        utilized_flops = 27 * (10**12)
        <a id="change">print(&quot****** trying 1/3 util for v100&quot</a><a id="change">)</a>
        utilized_flops = 120 * (10**12) / 3

        estimated_step_time_seconds = flops_for_one_batch / utilized_flops \
          + communication_slack</code></pre><h3>After Change</h3><pre><code class='java'>
        if isinstance(resources.types, tuple):
            for t in resources.types:
                if &quotx V100&quot in t:
                    num_v100s<a id="change"> = </a><a id="change">int(</a>t.split(&quotx V100&quot)[0]<a id="change">)</a>
                    assert num_v100s in [1, 2, 4, 8], resources.types
                    return _v100(num_v100s)

        assert &quottpu-v3-8&quot in resources.types, resources</code></pre>