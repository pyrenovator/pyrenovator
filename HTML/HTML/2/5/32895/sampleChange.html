<link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>

            &#47&#47 Push tags away from zero
            non_zero_loss = self.triplet_margin - (total_tags ** 2).sum(dim=-1) / tag_len
            non_zero_loss = torch.max(non_zero_loss, torch.zeros_like(non_zero_loss)).sum() / <a id="change">len(</a>non_zero_loss<a id="change">)</a>

            stitch_losses.append(similarity_loss<a id="change"> + total_neg_loss + </a>non_zero_loss)

            &#47&#47 &#47&#47 build up losses for every stitch
            &#47&#47 for stitch_id in range(gt_stitches[pattern_idx].shape[0]):</code></pre><h3>After Change</h3><pre><code class='java'>
        flat_stitch_tags = stitch_tags.view(batch_size, -1, stitch_tags.shape[-1])

        &#47&#47 https://stackoverflow.com/questions/55628014/indexing-a-3d-tensor-using-a-2d-tensor
        left_sides = flat_stitch_tags[<a id="change">torch.arange(</a>batch_size<a id="change">)</a>.unsqueeze(-1)<a id="change">, gt_stitches[:, 0, :]</a>]
        right_sides = flat_stitch_tags[torch.arange(batch_size).unsqueeze(-1), gt_stitches[:, 1, :]]
        total_tags = torch.cat([left_sides, right_sides], dim=1)
</code></pre>