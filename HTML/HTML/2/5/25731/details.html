<html><h3>Pattern ID :25731
</h3><img src='77993948.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
        Args:
            chunk_ids (List[int]): the chunks to be placed on CUDA
        
        <a id="change">pass</a>

    def _evict(self, evit_chunk_num: int):
        
        evict evit_chunk_num chunks from cuda to cpu.</code></pre><h3>After Change</h3><pre><code class='java'>
        Args:
            chunk_ids (List[int]): the chunks to be placed on CUDA
        
        <a id="change">for </a>chunk_id in chunk_ids<a id="change">:
            </a><a id="change">if </a>self._chunk_in_cuda(chunk_id):
                <a id="change">continue</a>

            if self._find_free_cuda_slot() == -1:
                self._evict()
            self._admit(chunk_id)</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 4</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/hpcaitech/cachedembedding/commit/5b9941f31e2adcbcd7a8bdb9aec48f65382feb52#diff-36b3f4838511b570b842a69043e333802b2b42d06cce152bd7fd883bdf01bd56L78' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 77993948</div><div id='project'> Project Name: hpcaitech/cachedembedding</div><div id='commit'> Commit Name: 5b9941f31e2adcbcd7a8bdb9aec48f65382feb52</div><div id='time'> Time: 2022-07-19</div><div id='author'> Author: fangjiarui123@gmail.com</div><div id='file'> File Name: recsys/modules/embeddings/freq_aware_embedding.py</div><div id='m_class'> M Class Name: ChunkCUDAWeightMgr</div><div id='n_method'> N Class Name: ChunkCUDAWeightMgr</div><div id='m_method'> M Method Name: _prepare_cuda_chunks(2)</div><div id='n_method'> N Method Name: _prepare_cuda_chunks(2)</div><div id='m_parent_class'> M Parent Class: object</div><div id='n_parent_class'> N Parent Class: object</div><div id='m_file'> M File Name: recsys/modules/embeddings/freq_aware_embedding.py</div><div id='n_file'> N File Name: recsys/modules/embeddings/freq_aware_embedding.py</div><div id='m_start'> M Start Line: 78</div><div id='m_end'> M End Line: 78</div><div id='n_start'> N Start Line: 91</div><div id='n_end'> N End Line: 99</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        Args:
            chunk_ids (List[int]): the chunks to be placed on CUDA
        
        <a id="change">pass</a>

    def _evict(self, evit_chunk_num: int):
        
        evict evit_chunk_num chunks from cuda to cpu.</code></pre><h3>After Change</h3><pre><code class='java'>
        Args:
            chunk_ids (List[int]): the chunks to be placed on CUDA
        
        <a id="change">for </a><a id="change">chunk_id</a> in chunk_ids<a id="change">:
            </a><a id="change">if </a>self._chunk_in_cuda(chunk_id):
                <a id="change">continue</a>

            if self._find_free_cuda_slot() == -1:
                self._evict()
            self._admit(chunk_id)</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/hpcaitech/freqcacheembedding/commit/5b9941f31e2adcbcd7a8bdb9aec48f65382feb52#diff-36b3f4838511b570b842a69043e333802b2b42d06cce152bd7fd883bdf01bd56L73' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 77993949</div><div id='project'> Project Name: hpcaitech/freqcacheembedding</div><div id='commit'> Commit Name: 5b9941f31e2adcbcd7a8bdb9aec48f65382feb52</div><div id='time'> Time: 2022-07-19</div><div id='author'> Author: fangjiarui123@gmail.com</div><div id='file'> File Name: recsys/modules/embeddings/freq_aware_embedding.py</div><div id='m_class'> M Class Name: ChunkCUDAWeightMgr</div><div id='n_method'> N Class Name: ChunkCUDAWeightMgr</div><div id='m_method'> M Method Name: _prepare_cuda_chunks(2)</div><div id='n_method'> N Method Name: _prepare_cuda_chunks(2)</div><div id='m_parent_class'> M Parent Class: object</div><div id='n_parent_class'> N Parent Class: object</div><div id='m_file'> M File Name: recsys/modules/embeddings/freq_aware_embedding.py</div><div id='n_file'> N File Name: recsys/modules/embeddings/freq_aware_embedding.py</div><div id='m_start'> M Start Line: 78</div><div id='m_end'> M End Line: 78</div><div id='n_start'> N Start Line: 91</div><div id='n_end'> N End Line: 99</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>

@click.group()
def main():
    <a id="change">pass</a>


@main.command()
def api():</code></pre><h3>After Change</h3><pre><code class='java'>
    rest_api = RestAPI()
    fast_api = FastAPI()

    <a id="change">for </a><a id="change">key</a> in dir(rest_api)<a id="change">:
        </a><a id="change">if </a>key.startswith(&quot_&quot) or key.endswith(&quot_&quot):
            <a id="change">continue</a>
        fn = getattr(rest_api, key)
        fast_api.post(&quot/&quot + key, response_model=typing.get_type_hints(fn)["return"])(fn)

    uvicorn.run(fast_api, host=&quot0.0.0.0&quot, port=62220, log_level=&quotinfo&quot, workers=1)</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/homebrewnlp/homebrewnlp-jax/commit/deda7fdef87e5e2c8e30e948f376fc86ad1d8cf7#diff-6bb87854f62182076b9d47e5a3fa17d5fb46826b979e3292b7ae7bef07022cf4L194' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 77993946</div><div id='project'> Project Name: homebrewnlp/homebrewnlp-jax</div><div id='commit'> Commit Name: deda7fdef87e5e2c8e30e948f376fc86ad1d8cf7</div><div id='time'> Time: 2022-05-15</div><div id='author'> Author: 39779310+ClashLuke@users.noreply.github.com</div><div id='file'> File Name: inference.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: main(0)</div><div id='n_method'> N Method Name: main(0)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: inference.py</div><div id='n_file'> N File Name: inference.py</div><div id='m_start'> M Start Line: 195</div><div id='m_end'> M End Line: 195</div><div id='n_start'> N Start Line: 198</div><div id='n_end'> N End Line: 207</div><BR>