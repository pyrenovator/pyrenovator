<html><h3>Pattern ID :10000
</h3><img src='35682656.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
        predictions = predictions[section_frame_index][start_index:end_index]

        prev_word_id = 0
        word<a id="change"> = </a>TokenizedWord()
        word.id2label = self.config.id2label
        all_words = []
        for i, word_id in enumerate(frame_word_ids):
            if word_id is not None:
                if word_id != prev_word_id:
                    word.decoded<a id="change"> = </a><a id="change">self.tokeniser.decode(</a>word.token_ids<a id="change">)</a>
                    &#47&#47 new word
                    all_words.append(word)
                    word = TokenizedWord()
                    word.id2label = self.config.id2label
                word.token_ids.append(frame_input_ids[i])
                word.word_offsets.append(frame_offsets[i])
                word.word_confidences.append(predictions[i])
                word.tokens.append(frame_tokens[i])
                prev_word_id = word_id

        word.decoded<a id="change"> = </a>self.tokeniser.decode(word.token_ids)
        all_words.append(word)

        logger.debug(</code></pre><h3>After Change</h3><pre><code class='java'>
                    )
                )

            _<a id="change">, offset_end</a> = frame_offsets[i]
            prev_word_id = word_id

        frame_word_ids_excluding_nones = set(frame_word_ids)</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 5</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/astrazeneca/kazu/commit/d2644d07218f2a87a9216442bf553d80a6737ee3#diff-4f70f364a824447b60bf464f7b67ae2d963527c6e03e36a792bdf2ad67949174L127' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 35682656</div><div id='project'> Project Name: astrazeneca/kazu</div><div id='commit'> Commit Name: d2644d07218f2a87a9216442bf553d80a6737ee3</div><div id='time'> Time: 2022-11-30</div><div id='author'> Author: richard.jackson4@astrazeneca.com</div><div id='file'> File Name: kazu/steps/ner/hf_token_classification.py</div><div id='m_class'> M Class Name: TransformersModelForTokenClassificationNerStep</div><div id='n_method'> N Class Name: TransformersModelForTokenClassificationNerStep</div><div id='m_method'> M Method Name: frame_to_tok_word(6)</div><div id='n_method'> N Method Name: frame_to_tok_word(6)</div><div id='m_parent_class'> M Parent Class: BaseStep</div><div id='n_parent_class'> N Parent Class: BaseStep</div><div id='m_file'> M File Name: kazu/steps/ner/hf_token_classification.py</div><div id='n_file'> N File Name: kazu/steps/ner/hf_token_classification.py</div><div id='m_start'> M Start Line: 127</div><div id='m_end'> M End Line: 154</div><div id='n_start'> N Start Line: 130</div><div id='n_end'> N End Line: 178</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
                pl_module.eval()
                logits = pl_module(text, x)
                img_logits = logits[:, -pl_module.image_seq_len:].long()
                img_seq<a id="change"> = </a>torch.argmax(img_logits, dim = -1)
                img_seq<a id="change"> -= </a>pl_module.num_text_tokens              
                x_rec<a id="change"> = </a><a id="change">pl_module.vae.decode(</a>img_seq<a id="change">, feed_seq=True)</a>     


            x_grid = torchvision.utils.make_grid(</code></pre><h3>After Change</h3><pre><code class='java'>
            sample_text = text[:1]
            token_list = sample_text.masked_select(sample_text != 0).tolist()
            decoded_text = self.tokenizer.decode(token_list)       
            x<a id="change">, _</a> = batch
            x = x[:1]
            x_rec = outputs[&quotxrec&quot][:1]
            &quot&quot&quot</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/tgisaturday/dalle-lightning/commit/9c1458557eb1d1a37d11b52079ef40d614175f86#diff-a83484d4c7b7ebe0b0e0ade59c8557937a9e940ae331d28b6debb50cefd16ffcL426' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 35682661</div><div id='project'> Project Name: tgisaturday/dalle-lightning</div><div id='commit'> Commit Name: 9c1458557eb1d1a37d11b52079ef40d614175f86</div><div id='time'> Time: 2021-07-29</div><div id='author'> Author: jamesk1228@gmail.com</div><div id='file'> File Name: pl_dalle/callbacks.py</div><div id='m_class'> M Class Name: DalleSimpleImageSampler</div><div id='n_method'> N Class Name: DalleSimpleImageSampler</div><div id='m_method'> M Method Name: on_validation_batch_end(7)</div><div id='n_method'> N Method Name: on_validation_batch_end(7)</div><div id='m_parent_class'> M Parent Class: Callback</div><div id='n_parent_class'> N Parent Class: Callback</div><div id='m_file'> M File Name: pl_dalle/callbacks.py</div><div id='n_file'> N File Name: pl_dalle/callbacks.py</div><div id='m_start'> M Start Line: 441</div><div id='m_end'> M End Line: 452</div><div id='n_start'> N Start Line: 445</div><div id='n_end'> N End Line: 447</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
            with torch.no_grad():
                pl_module.eval()
                logits = pl_module(text, x)
                img_logits<a id="change"> = </a>logits[:, -pl_module.image_seq_len:].long()
                img_seq = torch.argmax(img_logits, dim = -1)
                img_seq<a id="change"> -= </a>pl_module.num_text_tokens           
                x_rec<a id="change"> = </a><a id="change">pl_module.vae.decode(</a>img_seq<a id="change">, feed_seq=True)</a>                

                pl_module.train()  
</code></pre><h3>After Change</h3><pre><code class='java'>
            sample_text = text[:1]
            token_list = sample_text.masked_select(sample_text != 0).tolist()
            decoded_text = self.tokenizer.decode(token_list)   
            x<a id="change">, _</a> = batch
            x = x[:1]
            x_rec = outputs[&quotxrec&quot][:1]
            &quot&quot&quot</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/tgisaturday/dalle-lightning/commit/9c1458557eb1d1a37d11b52079ef40d614175f86#diff-a83484d4c7b7ebe0b0e0ade59c8557937a9e940ae331d28b6debb50cefd16ffcL370' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 35682670</div><div id='project'> Project Name: tgisaturday/dalle-lightning</div><div id='commit'> Commit Name: 9c1458557eb1d1a37d11b52079ef40d614175f86</div><div id='time'> Time: 2021-07-29</div><div id='author'> Author: jamesk1228@gmail.com</div><div id='file'> File Name: pl_dalle/callbacks.py</div><div id='m_class'> M Class Name: DalleSimpleImageSampler</div><div id='n_method'> N Class Name: DalleSimpleImageSampler</div><div id='m_method'> M Method Name: on_train_batch_end(7)</div><div id='n_method'> N Method Name: on_train_batch_end(7)</div><div id='m_parent_class'> M Parent Class: Callback</div><div id='n_parent_class'> N Parent Class: Callback</div><div id='m_file'> M File Name: pl_dalle/callbacks.py</div><div id='n_file'> N File Name: pl_dalle/callbacks.py</div><div id='m_start'> M Start Line: 385</div><div id='m_end'> M End Line: 398</div><div id='n_start'> N Start Line: 385</div><div id='n_end'> N End Line: 387</div><BR>