<html><h3>Pattern ID :12888
</h3><img src='43567864.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
                            f"increased to {self._config[&quotmeasurement-interval&quot]} ms."
                        )
                    else:
                        <a id="change">raise </a><a id="change">TritonModelAnalyzerException(
                            f"Running perf_analyzer with {e.cmd} failed with"
                            f" exit status {e.returncode} : {e.output}"</a><a id="change">)</a>

            raise TritonModelAnalyzerException(
                f"Ran perf_analyzer {MAX_INTERVAL_CHANGES} times, "
                "but no valid requests recorded in max time interval"</code></pre><h3>After Change</h3><pre><code class='java'>
                    &#47&#47 perf_analyzer using too much CPU?
                    cpu_util = process_util.cpu_percent(interval_sleep_time)
                    if cpu_util &gt; self._max_cpu_util:
                        <a id="change">logging.info(f&quotperf_analyzer used significant amount of CPU resources ({cpu_util}%), killing perf_analyzer...&quot</a><a id="change">)</a>
                        self._output = process.stdout.read()
                        process.kill()

                        &#47&#47 Failure</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 5</div><BR><div id='size'>Non-data size: 3</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/triton-inference-server/model_analyzer/commit/ee6f71044943c0f52500e6993d5f6f5921216bb8#diff-3c377baf9ce7f40855eb531a92e26ae662409e887f3e1d7fc3444a02669baf98L78' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 43567864</div><div id='project'> Project Name: triton-inference-server/model_analyzer</div><div id='commit'> Commit Name: ee6f71044943c0f52500e6993d5f6f5921216bb8</div><div id='time'> Time: 2021-03-10</div><div id='author'> Author: itabrizian@nvidia.com</div><div id='file'> File Name: model_analyzer/perf_analyzer/perf_analyzer.py</div><div id='m_class'> M Class Name: PerfAnalyzer</div><div id='n_method'> N Class Name: PerfAnalyzer</div><div id='m_method'> M Method Name: run(2)</div><div id='n_method'> N Method Name: run(2)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: model_analyzer/perf_analyzer/perf_analyzer.py</div><div id='n_file'> N File Name: model_analyzer/perf_analyzer/perf_analyzer.py</div><div id='m_start'> M Start Line: 78</div><div id='m_end'> M End Line: 104</div><div id='n_start'> N Start Line: 87</div><div id='n_end'> N End Line: 151</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
            self._client.load_model(model_name)
            logger.info(f&quotModel {model_name} loaded.&quot)
        except Exception as e:
            <a id="change">raise </a><a id="change">TritonModelAnalyzerException(
                f"Unable to load the model : {e}"</a><a id="change">)</a>

    def unload_model(self, model_name):
        
        Request the inference server to unload</code></pre><h3>After Change</h3><pre><code class='java'>
            self._client.load_model(model_name)
            logger.info(f&quotModel {model_name} loaded.&quot)
        except Exception as e:
            <a id="change">logger.info(f&quotModel {model_name} load failed: {e}&quot</a><a id="change">)</a>
            return -1

    def unload_model(self, model_name):
        </code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/triton-inference-server/model_analyzer/commit/ee6f71044943c0f52500e6993d5f6f5921216bb8#diff-b4e5aedc48a41e0c5ca0a4773ad550136d8456a4af7982cc06a0b9303389e252L61' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 43567859</div><div id='project'> Project Name: triton-inference-server/model_analyzer</div><div id='commit'> Commit Name: ee6f71044943c0f52500e6993d5f6f5921216bb8</div><div id='time'> Time: 2021-03-10</div><div id='author'> Author: itabrizian@nvidia.com</div><div id='file'> File Name: model_analyzer/triton/client/client.py</div><div id='m_class'> M Class Name: TritonClient</div><div id='n_method'> N Class Name: TritonClient</div><div id='m_method'> M Method Name: load_model(2)</div><div id='n_method'> N Method Name: load_model(2)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: model_analyzer/triton/client/client.py</div><div id='n_file'> N File Name: model_analyzer/triton/client/client.py</div><div id='m_start'> M Start Line: 82</div><div id='m_end'> M End Line: 83</div><div id='n_start'> N Start Line: 82</div><div id='n_end'> N End Line: 83</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
            self._client.unload_model(model_name)
            logger.info(f&quotModel {model_name} unloaded.&quot)
        except Exception as e:
            <a id="change">raise </a><a id="change">TritonModelAnalyzerException(
                f"Unable to unload the model : {e}"</a><a id="change">)</a>

    def wait_for_model_ready(self, model_name, num_retries):
        
        Returns when model is ready.</code></pre><h3>After Change</h3><pre><code class='java'>
            self._client.unload_model(model_name)
            logger.info(f&quotModel {model_name} unloaded.&quot)
        except Exception as e:
            <a id="change">logger.info(f&quotModel {model_name} unload failed: {e}&quot</a><a id="change">)</a>
            return -1

    def wait_for_model_ready(self, model_name, num_retries):
        </code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/triton-inference-server/model_analyzer/commit/ee6f71044943c0f52500e6993d5f6f5921216bb8#diff-b4e5aedc48a41e0c5ca0a4773ad550136d8456a4af7982cc06a0b9303389e252L85' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 43567861</div><div id='project'> Project Name: triton-inference-server/model_analyzer</div><div id='commit'> Commit Name: ee6f71044943c0f52500e6993d5f6f5921216bb8</div><div id='time'> Time: 2021-03-10</div><div id='author'> Author: itabrizian@nvidia.com</div><div id='file'> File Name: model_analyzer/triton/client/client.py</div><div id='m_class'> M Class Name: TritonClient</div><div id='n_method'> N Class Name: TritonClient</div><div id='m_method'> M Method Name: unload_model(2)</div><div id='n_method'> N Method Name: unload_model(2)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: model_analyzer/triton/client/client.py</div><div id='n_file'> N File Name: model_analyzer/triton/client/client.py</div><div id='m_start'> M Start Line: 106</div><div id='m_end'> M End Line: 107</div><div id='n_start'> N Start Line: 106</div><div id='n_end'> N End Line: 107</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>

        if self._output:
            return self._output
        <a id="change">raise </a><a id="change">TritonModelAnalyzerException(
            "Attempted to get perf_analyzer output"
            "without calling run first."</a><a id="change">)</a>

    def get_records(self):
        
        Returns</code></pre><h3>After Change</h3><pre><code class='java'>

        if self._output:
            return self._output
        <a id="change">logger.info(&quotperf_analyzer did not produce any output.&quot</a><a id="change">)</a>

    def get_records(self):
        
        Returns</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/triton-inference-server/model_analyzer/commit/228af769ba71341145820f72275e7db9375d97fe#diff-3c377baf9ce7f40855eb531a92e26ae662409e887f3e1d7fc3444a02669baf98L262' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 43567862</div><div id='project'> Project Name: triton-inference-server/model_analyzer</div><div id='commit'> Commit Name: 228af769ba71341145820f72275e7db9375d97fe</div><div id='time'> Time: 2022-01-07</div><div id='author'> Author: matthew.r.kotila@gmail.com</div><div id='file'> File Name: model_analyzer/perf_analyzer/perf_analyzer.py</div><div id='m_class'> M Class Name: PerfAnalyzer</div><div id='n_method'> N Class Name: PerfAnalyzer</div><div id='m_method'> M Method Name: output(1)</div><div id='n_method'> N Method Name: output(1)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: model_analyzer/perf_analyzer/perf_analyzer.py</div><div id='n_file'> N File Name: model_analyzer/perf_analyzer/perf_analyzer.py</div><div id='m_start'> M Start Line: 272</div><div id='m_end'> M End Line: 274</div><div id='n_start'> N Start Line: 272</div><div id='n_end'> N End Line: 272</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
                retries -= 1
                if retries == 0:
                    raise TritonModelAnalyzerException(e)
        <a id="change">raise </a><a id="change">TritonModelAnalyzerException(
            "Could not determine model readiness. "
            "Number of retries exceeded."</a><a id="change">)</a>

    def get_model_config(self, model_name, num_retries):
        
        Model name to get the config for.</code></pre><h3>After Change</h3><pre><code class='java'>
                time.sleep(0.05)
                retries -= 1

        <a id="change">logger.info(
            f&quotModel readiness failed for model {model_name}. Error {error}&quot</a><a id="change">)</a>
        return -1

    def get_model_config(self, model_name, num_retries):
        </code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/triton-inference-server/model_analyzer/commit/ee6f71044943c0f52500e6993d5f6f5921216bb8#diff-b4e5aedc48a41e0c5ca0a4773ad550136d8456a4af7982cc06a0b9303389e252L109' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 43567863</div><div id='project'> Project Name: triton-inference-server/model_analyzer</div><div id='commit'> Commit Name: ee6f71044943c0f52500e6993d5f6f5921216bb8</div><div id='time'> Time: 2021-03-10</div><div id='author'> Author: itabrizian@nvidia.com</div><div id='file'> File Name: model_analyzer/triton/client/client.py</div><div id='m_class'> M Class Name: TritonClient</div><div id='n_method'> N Class Name: TritonClient</div><div id='m_method'> M Method Name: wait_for_model_ready(3)</div><div id='n_method'> N Method Name: wait_for_model_ready(3)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: model_analyzer/triton/client/client.py</div><div id='n_file'> N File Name: model_analyzer/triton/client/client.py</div><div id='m_start'> M Start Line: 140</div><div id='m_end'> M End Line: 144</div><div id='n_start'> N Start Line: 130</div><div id='n_end'> N End Line: 145</div><BR>