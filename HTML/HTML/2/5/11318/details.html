<html><h3>Pattern ID :11318
</h3><img src='38476043.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
        real_label = torch.ones_like(real_y, dtype=torch.int64)[:, 0].long() &#47&#47 [1,1,1]
        fake_label = torch.zeros_like(fake_y, dtype=torch.int64)[:, 0].long() &#47&#47 [0,0,0]

        real_loss<a id="change"> = </a><a id="change">F.cross_entropy(</a>real_y, real_label<a id="change">)</a> &#47&#47 mean loss
        fake_loss = F.cross_entropy(fake_y, fake_label) &#47&#47 mean loss
        loss = (real_loss + fake_loss) / 2 + self.l2_reg_lambda * (self.W_O.weight.norm() + self.W_O.bias.norm())

        <a id="change">return </a>loss
</code></pre><h3>After Change</h3><pre><code class='java'>

        loss = loss + self.l2_reg_lambda * (torch.norm(self.W_O.weight, 2) + torch.norm(self.W_O.bias, 2))

        pred = torch.cat(<a id="change">[</a>real_y, fake_y<a id="change"></a>], dim=0) &#47&#47 bs*2
        target = torch.cat([real_label, fake_label],dim=0) &#47&#47 bs
        acc<a id="change"> = </a>torch.sum((pred.argmax(dim=-1) == target)).item()
        acc = acc / pred.size()[0]
        return loss, acc
</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 5</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/rucaibox/textbox/commit/f78c75cd5c890e60a063e95617768f9402a1d553#diff-3f4eb2cfd4550c608bec6a57bd7a3cf00efb08f162ee2b3d6781abad831913a0L84' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 38476043</div><div id='project'> Project Name: rucaibox/textbox</div><div id='commit'> Commit Name: f78c75cd5c890e60a063e95617768f9402a1d553</div><div id='time'> Time: 2020-12-14</div><div id='author'> Author: 1318829605@qq.com</div><div id='file'> File Name: textbox/module/Discriminator/LeakGANDiscriminator.py</div><div id='m_class'> M Class Name: LeakGANDiscriminator</div><div id='n_method'> N Class Name: LeakGANDiscriminator</div><div id='m_method'> M Method Name: calculate_loss(3)</div><div id='n_method'> N Method Name: calculate_loss(3)</div><div id='m_parent_class'> M Parent Class: UnconditionalGenerator</div><div id='n_parent_class'> N Parent Class: UnconditionalGenerator</div><div id='m_file'> M File Name: textbox/module/Discriminator/LeakGANDiscriminator.py</div><div id='n_file'> N File Name: textbox/module/Discriminator/LeakGANDiscriminator.py</div><div id='m_start'> M Start Line: 84</div><div id='m_end'> M End Line: 93</div><div id='n_start'> N Start Line: 86</div><div id='n_end'> N End Line: 101</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        real_label = torch.ones_like(real_y, dtype=torch.int64)[:, 0].long() &#47&#47 [1,1,1]
        fake_label = torch.zeros_like(fake_y, dtype=torch.int64)[:, 0].long() &#47&#47 [0,0,0]

        real_loss<a id="change"> = </a><a id="change">F.cross_entropy(</a>real_y, real_label<a id="change">)</a> &#47&#47 mean loss
        fake_loss = F.cross_entropy(fake_y, fake_label) &#47&#47 mean loss
        loss = (real_loss + fake_loss) / 2 + self.l2_reg_lambda * (self.W_O.weight.norm() + self.W_O.bias.norm())

        <a id="change">return </a>loss
</code></pre><h3>After Change</h3><pre><code class='java'>

        loss = loss + self.l2_reg_lambda * (torch.norm(self.W_O.weight, 2) + torch.norm(self.W_O.bias, 2))

        pred = torch.cat(<a id="change">[</a>real_y, fake_y<a id="change"></a>], dim=0) &#47&#47 bs*2
        target = torch.cat([real_label, fake_label],dim=0) &#47&#47 bs
        acc<a id="change"> = </a>torch.sum((pred.argmax(dim=-1) == target)).item()
        acc = acc / pred.size()[0]
        return loss, acc
</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/rucaibox/textbox/commit/9b5a6ec4e4a248b42892f4a8b7efc8a9a25630f7#diff-3f4eb2cfd4550c608bec6a57bd7a3cf00efb08f162ee2b3d6781abad831913a0L83' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 38476047</div><div id='project'> Project Name: rucaibox/textbox</div><div id='commit'> Commit Name: 9b5a6ec4e4a248b42892f4a8b7efc8a9a25630f7</div><div id='time'> Time: 2020-12-14</div><div id='author'> Author: 1318829605@qq.com</div><div id='file'> File Name: textbox/module/Discriminator/LeakGANDiscriminator.py</div><div id='m_class'> M Class Name: LeakGANDiscriminator</div><div id='n_method'> N Class Name: LeakGANDiscriminator</div><div id='m_method'> M Method Name: calculate_loss(3)</div><div id='n_method'> N Method Name: calculate_loss(3)</div><div id='m_parent_class'> M Parent Class: UnconditionalGenerator</div><div id='n_parent_class'> N Parent Class: UnconditionalGenerator</div><div id='m_file'> M File Name: textbox/module/Discriminator/LeakGANDiscriminator.py</div><div id='n_file'> N File Name: textbox/module/Discriminator/LeakGANDiscriminator.py</div><div id='m_start'> M Start Line: 84</div><div id='m_end'> M End Line: 93</div><div id='n_start'> N Start Line: 86</div><div id='n_end'> N End Line: 101</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        &#47&#47 ------- classification loss -------
        logits = torch.cat((logits1, logits2))
        target = target.repeat(2)
        class_loss = <a id="change">F.cross_entropy(</a>logits, target<a id="change">, ignore_index=-1)</a>

        &#47&#47 just add together the losses to do only one backward()
        &#47&#47 we have stop gradients on the output y of the model
        loss<a id="change"> = </a>neg_cos_sim + class_loss

        &#47&#47 ------- metrics -------
        acc1, acc5 = accuracy_at_k(logits, target, top_k=(1, 5))

        z_std = F.normalize(torch.cat((z1, z2), dim=0), dim=1).std(dim=0).mean()

        metrics = {
            "train_neg_cos_sim": neg_cos_sim,
            "train_class_loss": class_loss,
            "train_z_std": z_std,
            "train_acc1": acc1,
            "train_acc5": acc5,
        }
        self.log_dict(metrics, on_epoch=True, sync_dist=True)
        <a id="change">return </a>loss
</code></pre><h3>After Change</h3><pre><code class='java'>

        z_std = F.normalize(torch.cat((z1, z2), dim=0), dim=1).std(dim=0).mean()

        metrics<a id="change"> = </a><a id="change">{
            </a>"train_neg_cos_sim": neg_cos_sim,
            "train_z_std": z_std<a id="change">,
        }</a>
        self.log_dict(metrics, on_epoch=True, sync_dist=True)

        return neg_cos_sim + class_loss
</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/vturrisi/contrastive-learning/commit/a47bb52eeeb836a919c105a9dcd27930c9124ec4#diff-3c50cc918974fd83c58658dc83c9b5037d538cf08e0020da3b5ba05e1613a91fL63' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 38476034</div><div id='project'> Project Name: vturrisi/contrastive-learning</div><div id='commit'> Commit Name: a47bb52eeeb836a919c105a9dcd27930c9124ec4</div><div id='time'> Time: 2021-06-14</div><div id='author'> Author: vt.turrisi@gmail.com</div><div id='file'> File Name: solo/methods/simsiam.py</div><div id='m_class'> M Class Name: SimSiam</div><div id='n_method'> N Class Name: SimSiam</div><div id='m_method'> M Method Name: training_step(3)</div><div id='n_method'> N Method Name: training_step(3)</div><div id='m_parent_class'> M Parent Class: BaseModel</div><div id='n_parent_class'> N Parent Class: BaseModel</div><div id='m_file'> M File Name: solo/methods/simsiam.py</div><div id='n_file'> N File Name: solo/methods/simsiam.py</div><div id='m_start'> M Start Line: 64</div><div id='m_end'> M End Line: 101</div><div id='n_start'> N Start Line: 62</div><div id='n_end'> N End Line: 83</div><BR>