<html><h3>Pattern ID :10429
</h3><img src='36430955.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
    env.ri.attachments = attachments

    if j is not None:
        <a id="change">env.ri.setj(</a>j<a id="change">)</a>
        c = mercury.geometry.Coordinate(*env.ri.get_pose("tipLink"))
        c.translate([0, 0, 0.2], wrt="world")
        j = env.ri.solve_ik(c.pose, n_init=1)
        obstacles = env.bg_objects + env.object_ids</code></pre><h3>After Change</h3><pre><code class='java'>
        before_return()
        return result

    <a id="change">env.ri.setj(result["j_grasp"]</a><a id="change">)</a>
    ee_af_to_world = env.ri.get_pose("tipLink")

    obj_to_world = pp.get_pose(env.fg_object_id)
    obj_to_ee = pp.multiply(pp.invert(ee_af_to_world), obj_to_world)</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 8</div><BR><div id='size'>Non-data size: 4</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/wkentaro/reorientbot/commit/11b473346a4a01cede8f0a946a6a0a1b4b0c87d1#diff-dc2a031cb3a124599a23223a0afdc91b250b0af2af46f300d054169112452082L145' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 36430955</div><div id='project'> Project Name: wkentaro/reorientbot</div><div id='commit'> Commit Name: 11b473346a4a01cede8f0a946a6a0a1b4b0c87d1</div><div id='time'> Time: 2021-09-22</div><div id='author'> Author: www.kentaro.wada@gmail.com</div><div id='file'> File Name: examples/reorient/_reorient.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: plan_reorient(3)</div><div id='n_method'> N Method Name: plan_reorient(3)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: examples/reorient/_reorient.py</div><div id='n_file'> N File Name: examples/reorient/_reorient.py</div><div id='m_start'> M Start Line: 153</div><div id='m_end'> M End Line: 199</div><div id='n_start'> N Start Line: 145</div><div id='n_end'> N End Line: 209</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
    env.ri.attachments = attachments

    if j is not None:
        <a id="change">env.ri.setj(</a>j<a id="change">)</a>
        c = mercury.geometry.Coordinate(*env.ri.get_pose("tipLink"))
        c.translate([0, 0, 0.2], wrt="world")
        j = env.ri.solve_ik(c.pose, n_init=1)
        obstacles = env.bg_objects + env.object_ids</code></pre><h3>After Change</h3><pre><code class='java'>
        pp.remove_body(obj_af)
        &#47&#47 lock_renderer.restore()

    <a id="change">result["j_init"]</a> = env.ri.getj()

    bg_object_ids = env.bg_objects + env.object_ids
    bg_object_ids.remove(env.fg_object_id)

    ee_af_to_world = np.hsplit(grasp_pose, [3])
    obj_af_to_world = np.hsplit(reorient_pose, [3])

    if env._robot_model == "franka_panda/panda_suction":
        dgs = [0]
        rotation_axis = "z"
    else:
        dgs = np.random.uniform(-np.pi, np.pi, size=(3,))
        rotation_axis = True

    for dg in dgs:
        c = mercury.geometry.Coordinate(*ee_af_to_world)
        c.rotate([0, 0, dg])

        &#47&#47 solve j_grasp
        j = env.ri.solve_ik(c.pose, rotation_axis=rotation_axis)
        if j is not None:
            if not env.ri.validatej(j, obstacles=bg_object_ids):
                logger.warning("j_grasp is invalid")
                j = None
        else:
            logger.warning("j_grasp is not found")
        if j is not None:
            result["j_grasp"] = j
            break
    else:
        logger.error("j_grasp is not found")
        before_return()
        return result

    <a id="change">env.ri.setj(result["j_grasp"]</a><a id="change">)</a>
    ee_af_to_world = env.ri.get_pose("tipLink")

    obj_to_world = pp.get_pose(env.fg_object_id)
    obj_to_ee = pp.multiply(pp.invert(ee_af_to_world), obj_to_world)</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/wkentaro/reorientbot/commit/11b473346a4a01cede8f0a946a6a0a1b4b0c87d1#diff-dc2a031cb3a124599a23223a0afdc91b250b0af2af46f300d054169112452082L125' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 36430954</div><div id='project'> Project Name: wkentaro/reorientbot</div><div id='commit'> Commit Name: 11b473346a4a01cede8f0a946a6a0a1b4b0c87d1</div><div id='time'> Time: 2021-09-22</div><div id='author'> Author: www.kentaro.wada@gmail.com</div><div id='file'> File Name: examples/reorient/_reorient.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: plan_reorient(3)</div><div id='n_method'> N Method Name: plan_reorient(3)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: examples/reorient/_reorient.py</div><div id='n_file'> N File Name: examples/reorient/_reorient.py</div><div id='m_start'> M Start Line: 153</div><div id='m_end'> M End Line: 199</div><div id='n_start'> N Start Line: 145</div><div id='n_end'> N End Line: 209</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
                )
            ]

            <a id="change">env.ri.setj(</a>env.ri.homej<a id="change">)</a>
            &#47&#47 env.ri.attachments[0].assign()

            with env.ri.enabling_attachments():
                j = env.ri.solve_ik(</code></pre><h3>After Change</h3><pre><code class='java'>
            world_saver.restore()
            env.ri.attachments = []
            continue
        <a id="change">result["js_pre_grasp"]</a> = js

        <a id="change">env.ri.setj(result["j_pre_grasp"]</a><a id="change">)</a>

        obstacles = env.bg_objects + env.object_ids
        obstacles.remove(env.fg_object_id)
</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/wkentaro/reorientbot/commit/b77e1c2ca1e78f7af06c3b2772f5047b482b6af6#diff-dc2a031cb3a124599a23223a0afdc91b250b0af2af46f300d054169112452082L435' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 36430953</div><div id='project'> Project Name: wkentaro/reorientbot</div><div id='commit'> Commit Name: b77e1c2ca1e78f7af06c3b2772f5047b482b6af6</div><div id='time'> Time: 2021-09-22</div><div id='author'> Author: www.kentaro.wada@gmail.com</div><div id='file'> File Name: examples/reorient/_reorient.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: plan_place(2)</div><div id='n_method'> N Method Name: plan_place(2)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: examples/reorient/_reorient.py</div><div id='n_file'> N File Name: examples/reorient/_reorient.py</div><div id='m_start'> M Start Line: 484</div><div id='m_end'> M End Line: 569</div><div id='n_start'> N Start Line: 510</div><div id='n_end'> N End Line: 568</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        ]

        j = self.ri.homej
        <a id="change">self.ri.setj(</a>j<a id="change">)</a>
        self.ri.attachments[0].assign()

        with self.ri.enabling_attachments():
            j = self.ri.solve_ik(</code></pre><h3>After Change</h3><pre><code class='java'>
            logger.error(f"Failed to solve placing IK: {act_result.action}")
            before_return()
            return False, result
        <a id="change">result["j_place"]</a> = j

        obstacles = self.bg_objects + self.object_ids
        obstacles.remove(self.fg_object_id)

        if not self.ri.validatej(result["j_place"], obstacles=obstacles):
            logger.error(f"j_place is invalid: {act_result.action}")
            before_return()
            return False, result

        assert self.ri.attachments[0].child == self.fg_object_id

        <a id="change">self.ri.setj(result["j_grasp"]</a><a id="change">)</a>
        self.ri.attachments[0].assign()

        js = self.ri.planj(
            self.ri.homej,</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/wkentaro/safepicking/commit/6eb72947614ef04718cf8643e351975eb9d1851f#diff-6c696880ace606a780a1ead59a04d0d860e745088814268d5d8939c66a93f761L251' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 36430961</div><div id='project'> Project Name: wkentaro/safepicking</div><div id='commit'> Commit Name: 6eb72947614ef04718cf8643e351975eb9d1851f</div><div id='time'> Time: 2021-07-02</div><div id='author'> Author: www.kentaro.wada@gmail.com</div><div id='file'> File Name: examples/reorient/_env.py</div><div id='m_class'> M Class Name: Env</div><div id='n_method'> N Class Name: Env</div><div id='m_method'> M Method Name: validate_action(2)</div><div id='n_method'> N Method Name: validate_action(2)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: examples/reorient/_env.py</div><div id='n_file'> N File Name: examples/reorient/_env.py</div><div id='m_start'> M Start Line: 375</div><div id='m_end'> M End Line: 376</div><div id='n_start'> N Start Line: 371</div><div id='n_end'> N End Line: 434</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
                continue
            result["js_place"] = js

            <a id="change">env.ri.setj(</a>j<a id="change">)</a>
            env.ri.attachments[0].assign()
        before_return()
        break
    success = "js_place" in result</code></pre><h3>After Change</h3><pre><code class='java'>
            before_return()
            continue
        result["js_grasp"] = js
        <a id="change">result["j_pre_grasp"]</a> = js[0]

        &#47&#47 solve js_pre_grasp
        <a id="change">env.ri.setj(result["j_init"]</a><a id="change">)</a>
        js = env.ri.planj(
            result["j_pre_grasp"],
            obstacles=[env.plane, env.bin] + env.object_ids,
        )</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/wkentaro/reorientbot/commit/0a491494f52743e9d480d59e6c0bc0b34f25beb4#diff-9efd7f8b76dba1d647250db9b1de1a62736e9fe3e3dc021b88d2181695b322a8L138' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 36430967</div><div id='project'> Project Name: wkentaro/reorientbot</div><div id='commit'> Commit Name: 0a491494f52743e9d480d59e6c0bc0b34f25beb4</div><div id='time'> Time: 2021-05-10</div><div id='author'> Author: www.kentaro.wada@gmail.com</div><div id='file'> File Name: examples/grasp_with_intent/reorient.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: plan_reorient(3)</div><div id='n_method'> N Method Name: plan_reorient(2)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: examples/grasp_with_intent/reorient.py</div><div id='n_file'> N File Name: examples/grasp_with_intent/reorient.py</div><div id='m_start'> M Start Line: 159</div><div id='m_end'> M End Line: 253</div><div id='n_start'> N Start Line: 139</div><div id='n_end'> N End Line: 269</div><BR>