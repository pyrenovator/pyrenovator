<html><h3>Pattern ID :34868
</h3><img src='99915424.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
        )

        dense_optim = KeyedOptimizerWrapper(
            <a id="change">dict(local_model.named_parameters()</a><a id="change">)</a>,
            lambda params: torch.optim.SGD(params, lr=0.1),
        )
        local_opt = CombinedOptimizer([local_model.fused_optimizer, dense_optim])</code></pre><h3>After Change</h3><pre><code class='java'>
        )

        dense_optim = KeyedOptimizerWrapper(
            <a id="change">dict(</a><a id="change">in_backward_optimizer_filter(local_model.named_parameters()</a><a id="change">))</a>,
            lambda params: torch.optim.SGD(params, lr=0.1),
        )
        local_opt = CombinedOptimizer([local_model.fused_optimizer, dense_optim])</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 6</div><BR><div id='size'>Non-data size: 5</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/facebookresearch/torchrec/commit/d9cc3e0157b55134be65f9aea85d3215f341b385#diff-554d861775897849029c947811bd4ffb2820208f006340e2458d10d52d4f91e6L346' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 99915424</div><div id='project'> Project Name: facebookresearch/torchrec</div><div id='commit'> Commit Name: d9cc3e0157b55134be65f9aea85d3215f341b385</div><div id='time'> Time: 2022-12-15</div><div id='author'> Author: colin2328@meta.com</div><div id='file'> File Name: torchrec/distributed/test_utils/test_sharding.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: sharding_single_rank_test(16)</div><div id='n_method'> N Method Name: sharding_single_rank_test(16)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: torchrec/distributed/test_utils/test_sharding.py</div><div id='n_file'> N File Name: torchrec/distributed/test_utils/test_sharding.py</div><div id='m_start'> M Start Line: 346</div><div id='m_end'> M End Line: 346</div><div id='n_start'> N Start Line: 347</div><div id='n_end'> N End Line: 347</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>

    &#47&#47 Overlap comm/compute/device transfer during training through train_pipeline
    non_fused_optimizer = KeyedOptimizerWrapper(
        <a id="change">dict(model.named_parameters()</a><a id="change">)</a>,
        lambda params: torch.optim.Adagrad(params, lr=learning_rate),
    )
    train_pipeline = TrainPipelineSparseDist(</code></pre><h3>After Change</h3><pre><code class='java'>

    &#47&#47 Overlap comm/compute/device transfer during training through train_pipeline
    non_fused_optimizer = KeyedOptimizerWrapper(
        <a id="change">dict(</a><a id="change">in_backward_optimizer_filter(model.named_parameters()</a><a id="change">))</a>,
        lambda params: torch.optim.Adagrad(params, lr=learning_rate),
    )
    train_pipeline = TrainPipelineSparseDist(</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/facebookresearch/torchrec/commit/d9cc3e0157b55134be65f9aea85d3215f341b385#diff-4cca5908f25acc7dfddb8c3d6e46dba409843f9ae9bad4c89effdefb0b931cb7L48' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 99915425</div><div id='project'> Project Name: facebookresearch/torchrec</div><div id='commit'> Commit Name: d9cc3e0157b55134be65f9aea85d3215f341b385</div><div id='time'> Time: 2022-12-15</div><div id='author'> Author: colin2328@meta.com</div><div id='file'> File Name: examples/ray/train_torchrec.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: train(5)</div><div id='n_method'> N Method Name: train(5)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: examples/ray/train_torchrec.py</div><div id='n_file'> N File Name: examples/ray/train_torchrec.py</div><div id='m_start'> M Start Line: 113</div><div id='m_end'> M End Line: 113</div><div id='n_start'> N Start Line: 114</div><div id='n_end'> N End Line: 114</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        device=device,
    )
    optimizer = KeyedOptimizerWrapper(
        <a id="change">dict(model.named_parameters()</a><a id="change">)</a>,
        lambda params: torch.optim.SGD(params, lr=0.01),
    )
</code></pre><h3>After Change</h3><pre><code class='java'>
        device=device,
    )
    optimizer = KeyedOptimizerWrapper(
        <a id="change">dict(</a><a id="change">in_backward_optimizer_filter(model.named_parameters()</a><a id="change">))</a>,
        lambda params: torch.optim.SGD(params, lr=0.01),
    )
</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/facebookresearch/torchrec/commit/d9cc3e0157b55134be65f9aea85d3215f341b385#diff-b9525a21e9e42fdb4b81e0b9532efff05dd0c82b6a7fee1de67c2d49028ef659L74' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 99915420</div><div id='project'> Project Name: facebookresearch/torchrec</div><div id='commit'> Commit Name: d9cc3e0157b55134be65f9aea85d3215f341b385</div><div id='time'> Time: 2022-12-15</div><div id='author'> Author: colin2328@meta.com</div><div id='file'> File Name: test_installation.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: main(1)</div><div id='n_method'> N Method Name: main(1)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: test_installation.py</div><div id='n_file'> N File Name: test_installation.py</div><div id='m_start'> M Start Line: 121</div><div id='m_end'> M End Line: 121</div><div id='n_start'> N Start Line: 122</div><div id='n_end'> N End Line: 122</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        copy_state_dict(unsharded_model.state_dict(), distributed_model.state_dict())
        optimizer_cpu = optim.SGD(unsharded_model.parameters(), lr=0.1)
        optimizer_distributed = KeyedOptimizerWrapper(
            <a id="change">dict(distributed_model.named_parameters()</a><a id="change">)</a>,
            lambda params: optim.SGD(params, lr=0.1),
        )
        pipeline = TrainPipelineSparseDist(</code></pre><h3>After Change</h3><pre><code class='java'>
        copy_state_dict(unsharded_model.state_dict(), distributed_model.state_dict())
        optimizer_cpu = optim.SGD(unsharded_model.parameters(), lr=0.1)
        optimizer_distributed = KeyedOptimizerWrapper(
            <a id="change">dict(</a><a id="change">in_backward_optimizer_filter(distributed_model.named_parameters()</a><a id="change">))</a>,
            lambda params: optim.SGD(params, lr=0.1),
        )
        pipeline = TrainPipelineSparseDist(</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/facebookresearch/torchrec/commit/d9cc3e0157b55134be65f9aea85d3215f341b385#diff-644fafc4ad8fe3301bf91d179b5b09b9cc19afa1bfc9497208b8ae2f52b4b167L191' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 99915421</div><div id='project'> Project Name: facebookresearch/torchrec</div><div id='commit'> Commit Name: d9cc3e0157b55134be65f9aea85d3215f341b385</div><div id='time'> Time: 2022-12-15</div><div id='author'> Author: colin2328@meta.com</div><div id='file'> File Name: torchrec/distributed/tests/test_train_pipeline.py</div><div id='m_class'> M Class Name: TrainPipelineSparseDistTest</div><div id='n_method'> N Class Name: TrainPipelineSparseDistTest</div><div id='m_method'> M Method Name: _test_feature_processor_helper(4)</div><div id='n_method'> N Method Name: _test_feature_processor_helper(4)</div><div id='m_parent_class'> M Parent Class: unittest.TestCase</div><div id='n_parent_class'> N Parent Class: unittest.TestCase</div><div id='m_file'> M File Name: torchrec/distributed/tests/test_train_pipeline.py</div><div id='n_file'> N File Name: torchrec/distributed/tests/test_train_pipeline.py</div><div id='m_start'> M Start Line: 200</div><div id='m_end'> M End Line: 200</div><div id='n_start'> N Start Line: 201</div><div id='n_end'> N End Line: 201</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        )
        optimizer_cpu = optim.SGD(model_cpu.parameters(), lr=0.1)
        optimizer_distributed = KeyedOptimizerWrapper(
            <a id="change">dict(distributed_model.named_parameters()</a><a id="change">)</a>,
            lambda params: optim.SGD(params, lr=0.1),
        )
        pipeline = TrainPipelineSparseDist(</code></pre><h3>After Change</h3><pre><code class='java'>
        )
        optimizer_cpu = optim.SGD(model_cpu.parameters(), lr=0.1)
        optimizer_distributed = KeyedOptimizerWrapper(
            <a id="change">dict(</a><a id="change">in_backward_optimizer_filter(distributed_model.named_parameters()</a><a id="change">))</a>,
            lambda params: optim.SGD(params, lr=0.1),
        )
        pipeline = TrainPipelineSparseDist(</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/facebookresearch/torchrec/commit/d9cc3e0157b55134be65f9aea85d3215f341b385#diff-644fafc4ad8fe3301bf91d179b5b09b9cc19afa1bfc9497208b8ae2f52b4b167L284' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 99915422</div><div id='project'> Project Name: facebookresearch/torchrec</div><div id='commit'> Commit Name: d9cc3e0157b55134be65f9aea85d3215f341b385</div><div id='time'> Time: 2022-12-15</div><div id='author'> Author: colin2328@meta.com</div><div id='file'> File Name: torchrec/distributed/tests/test_train_pipeline.py</div><div id='m_class'> M Class Name: TrainPipelineSparseDistTest</div><div id='n_method'> N Class Name: TrainPipelineSparseDistTest</div><div id='m_method'> M Method Name: _test_move_cpu_gpu_helper(2)</div><div id='n_method'> N Method Name: _test_move_cpu_gpu_helper(2)</div><div id='m_parent_class'> M Parent Class: unittest.TestCase</div><div id='n_parent_class'> N Parent Class: unittest.TestCase</div><div id='m_file'> M File Name: torchrec/distributed/tests/test_train_pipeline.py</div><div id='n_file'> N File Name: torchrec/distributed/tests/test_train_pipeline.py</div><div id='m_start'> M Start Line: 292</div><div id='m_end'> M End Line: 292</div><div id='n_start'> N Start Line: 293</div><div id='n_end'> N End Line: 293</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
    )

    optimizer = KeyedOptimizerWrapper(
        <a id="change">dict(model.named_parameters()</a><a id="change">)</a>,
        lambda params: torch.optim.SGD(params, lr=0.01),
    )
</code></pre><h3>After Change</h3><pre><code class='java'>
    )

    optimizer = KeyedOptimizerWrapper(
        <a id="change">dict(</a><a id="change">in_backward_optimizer_filter(model.named_parameters()</a><a id="change">))</a>,
        lambda params: torch.optim.SGD(params, lr=0.01),
    )
</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/facebookresearch/torchrec/commit/d9cc3e0157b55134be65f9aea85d3215f341b385#diff-dd2fe2df7b2dc349f800762c132814b38188bf2be3122f8b27d264645022c526L31' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 99915423</div><div id='project'> Project Name: facebookresearch/torchrec</div><div id='commit'> Commit Name: d9cc3e0157b55134be65f9aea85d3215f341b385</div><div id='time'> Time: 2022-12-15</div><div id='author'> Author: colin2328@meta.com</div><div id='file'> File Name: examples/torcharrow/run.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: main(4)</div><div id='n_method'> N Method Name: main(4)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: examples/torcharrow/run.py</div><div id='n_file'> N File Name: examples/torcharrow/run.py</div><div id='m_start'> M Start Line: 97</div><div id='m_end'> M End Line: 97</div><div id='n_start'> N Start Line: 98</div><div id='n_end'> N End Line: 98</div><BR>