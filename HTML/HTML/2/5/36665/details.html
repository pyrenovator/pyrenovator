<html><h3>Pattern ID :36665
</h3><img src='104724697.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
                    for batch_features, batch_labels in load_preprocess_training_batch(batch_i, batch_size):
                        self.train_neural_network(sess, optimizer, keep_probability, batch_features, batch_labels)
                            
                        <a id="change">print(</a><a id="change">&quotEpoch {:&gt;2}, CIFAR-10 Batch {}:  &quot.format(</a>epoch<a id="change"> + </a>1, batch_i<a id="change">), end=&quot&quot)</a>
                        self.print_stats(sess, batch_features, batch_labels, cost, accuracy)
    
    def train_neural_network(self, session, optimizer, keep_probability, feature_batch, label_batch):
        session.run(optimizer, </code></pre><h3>After Change</h3><pre><code class='java'>
        self.init = tf.global_variables_initializer()
        &#47&#47 saver = tf.train.Saver(tf.trainable_variables())
        
        <a id="change">self.train(</a>X_train, Y_train, sess, epochs, dropout, batch_size, learning_rate<a id="change">)</a>

    def train(self, X_train, Y_train, sess, epochs, dropout=0.75, batch_size=128, learning_rate=0.001):
        display_step = 50 &#47&#47显示间隔
        sess.run(self.init)</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 4</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/skylark0924/machine-learning-is-all-you-need/commit/f91f2780d4fd91d4d9e8bee96bed181857bb450f#diff-8e3717ea91418153c77560bb595488a6f8fb3b179a0109f17a930014848fcb2bL269' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 104724697</div><div id='project'> Project Name: skylark0924/machine-learning-is-all-you-need</div><div id='commit'> Commit Name: f91f2780d4fd91d4d9e8bee96bed181857bb450f</div><div id='time'> Time: 2020-04-23</div><div id='author'> Author: l.syj@163.com</div><div id='file'> File Name: 10CNN/CNN_models.py</div><div id='m_class'> M Class Name: TF_CNN</div><div id='n_method'> N Class Name: TF_CNN</div><div id='m_method'> M Method Name: fit(8)</div><div id='n_method'> N Method Name: fit(6)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: 10CNN/CNN_models.py</div><div id='n_file'> N File Name: 10CNN/CNN_models.py</div><div id='m_start'> M Start Line: 269</div><div id='m_end'> M End Line: 301</div><div id='n_start'> N Start Line: 272</div><div id='n_end'> N End Line: 293</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
            optimizer.step()
        print(y_hat)
        print(y)
        <a id="change">print(</a><a id="change">&quotepoch {},avg_loss={:.4f}&quot.format(</a>e,all_lose/(train_df.shape[0]<a id="change">//</a>batchSize)<a id="change">))</a>

        &#47&#47 &#47&#47评估模型
        &#47&#47 if e % eva_per_epochs == 0:
        &#47&#47     p, r, acc = doEva(net, x_train, y_train)</code></pre><h3>After Change</h3><pre><code class='java'>
    net = Linear_Reg(train_df.shape[1]-1) &#47&#47 初始化线性回归模型
    criterion = torch.nn.MSELoss() &#47&#47平方差损失函数
    optimizer = torch.optim.SGD( net.parameters(), lr=lr) &#47&#47随机梯度下降
    <a id="change">net.train()</a>
    for e in range(epochs):
        for datas in DataLoader(train_df.values, batch_size = batchSize, shuffle = True):
            optimizer.zero_grad() &#47&#47梯度归0
            X = datas[:,:-1] &#47&#47 获取X</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/rexrex9/basic_neural_networks_pytorch/commit/fca99667bfbb814e5225d4b9a45fa378e00f27a6#diff-acc632749c405a8f1c0c6f86f68931df7d11a347b07220e1a17d27c9477faca5L24' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 104724693</div><div id='project'> Project Name: rexrex9/basic_neural_networks_pytorch</div><div id='commit'> Commit Name: fca99667bfbb814e5225d4b9a45fa378e00f27a6</div><div id='time'> Time: 2022-03-09</div><div id='author'> Author: 547102444@qq.com</div><div id='file'> File Name: chapter1/s5_boston_price_predict.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: train(3)</div><div id='n_method'> N Method Name: train(3)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: chapter1/s5_boston_price_predict.py</div><div id='n_file'> N File Name: chapter1/s5_boston_price_predict.py</div><div id='m_start'> M Start Line: 26</div><div id='m_end'> M End Line: 45</div><div id='n_start'> N Start Line: 46</div><div id='n_end'> N End Line: 63</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>

                loss_sum += loss.detach().item()

            <a id="change">print(</a><a id="change">"Client[{}] Traning. Epoch {}/{}, Loss {:.4f}, Time {:.2f}s".
                  format(</a>id, epoch + 1, epochs, loss_sum,
                         time()<a id="change"> - </a>time_begin<a id="change">))</a>
        return SerializationTool.serialize_model(model)

    def train(self, model_parameters, epochs, lr, batch_size, id_list, cuda):
        Train local model with different dataset according to id in id_list.</code></pre><h3>After Change</h3><pre><code class='java'>
        epochs = 5
        criterion = torch.nn.CrossEntropyLoss()
        optimizer = torch.optim.SGD(self._model.parameters(), lr=0.1)
        <a id="change">self._model.train()</a>

        for _ in range(epochs):

            for data, target in data_loader:</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/smilelab-fl/fedlab/commit/16befdf9173a4b4f4430f456b5353765c6d4d3e3#diff-e01aa4d5e3a24cb22ed367c39c0994beb14dac9396433f905576a6531ad38c42L102' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 104724695</div><div id='project'> Project Name: smilelab-fl/fedlab</div><div id='commit'> Commit Name: 16befdf9173a4b4f4430f456b5353765c6d4d3e3</div><div id='time'> Time: 2021-08-08</div><div id='author'> Author: 928255708@qq.com</div><div id='file'> File Name: fedlab/core/client/serial_trainer.py</div><div id='m_class'> M Class Name: SerialTrainer</div><div id='n_method'> N Class Name: SerialTrainer</div><div id='m_method'> M Method Name: _train_alone(4)</div><div id='n_method'> N Method Name: _train_alone(8)</div><div id='m_parent_class'> M Parent Class: ClientTrainer</div><div id='n_parent_class'> N Parent Class: ClientTrainer</div><div id='m_file'> M File Name: fedlab/core/client/serial_trainer.py</div><div id='n_file'> N File Name: fedlab/core/client/serial_trainer.py</div><div id='m_start'> M Start Line: 102</div><div id='m_end'> M End Line: 137</div><div id='n_start'> N Start Line: 98</div><div id='n_end'> N End Line: 119</div><BR>