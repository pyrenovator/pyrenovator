<html><h3>Pattern ID :20725
</h3><img src='66843807.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
        raise Exception("Inverse CDF is not defined for categorical distributions.")

    def sample(self, sample_shape=torch.Size()):
        <a id="change">return </a><a id="change">super().sample(</a>sample_shape<a id="change">)</a>.unsqueeze(-1)

    def log_probs(self, actions: torch.LongTensor) -&gt; torch.FloatTensor:
        return super().log_prob(actions.squeeze(-1)).unsqueeze(-1)</code></pre><h3>After Change</h3><pre><code class='java'>
        raise Exception("Inverse CDF is not defined for categorical distributions.")

    def sample(self, sample_shape=torch.Size()):
        res<a id="change"> = </a><a id="change">super().sample(</a>sample_shape<a id="change">)</a>
        <a id="change">return </a>res.view(*res.shape[:2], -1)  &#47&#47 return [steps, sampler, flattened]

    def log_probs(self, actions: torch.LongTensor) -&gt; torch.FloatTensor:
        res = super().log_prob(actions.squeeze(-1))</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 5</div><BR><div id='size'>Non-data size: 5</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/allenai/allenact/commit/5f513534369e109fb2cc076d67a70e3d59b08213#diff-bb20a946bff892e37f59d93295d1dd0e3e981138b70ede9f68fd59b17215693cL36' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 66843807</div><div id='project'> Project Name: allenai/allenact</div><div id='commit'> Commit Name: 5f513534369e109fb2cc076d67a70e3d59b08213</div><div id='time'> Time: 2020-12-23</div><div id='author'> Author: jordis@allenai.org</div><div id='file'> File Name: core/base_abstractions/distributions.py</div><div id='m_class'> M Class Name: CategoricalDistr</div><div id='n_method'> N Class Name: CategoricalDistr</div><div id='m_method'> M Method Name: sample(2)</div><div id='n_method'> N Method Name: sample(2)</div><div id='m_parent_class'> M Parent Class: Distr</div><div id='n_parent_class'> N Parent Class: Distr</div><div id='m_file'> M File Name: core/base_abstractions/distributions.py</div><div id='n_file'> N File Name: core/base_abstractions/distributions.py</div><div id='m_start'> M Start Line: 36</div><div id='m_end'> M End Line: 36</div><div id='n_start'> N Start Line: 36</div><div id='n_end'> N End Line: 37</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>

    def _get_initial_weights(self) -&gt; Weights:
        Get initial weights from one of the available clients
        <a id="change">return </a><a id="change">self._client_manager.sample(</a>1<a id="change">)</a>[0].get_weights()


def fit_clients(clients: List[Client], weights: Weights) -&gt; List[Tuple[Weights, int]]:</code></pre><h3>After Change</h3><pre><code class='java'>

    def _get_initial_weights(self) -&gt; Weights:
        Get initial weights from one of the available clients
        random_client<a id="change"> = </a><a id="change">self._client_manager.sample(</a>1<a id="change">)</a>[0]
        <a id="change">return </a>random_client.get_weights()


def fit_clients(clients: List[Client], weights: Weights) -&gt; List[Tuple[Weights, int]]:</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/adap/flower/commit/147541d3d4c0ddb4f215fef57f8adf57f8c126b1#diff-6913b1cd6f3c4c0c93337eb1b3952776d5ef7b65fff79f401b5cd75f6b08f992L78' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 66843806</div><div id='project'> Project Name: adap/flower</div><div id='commit'> Commit Name: 147541d3d4c0ddb4f215fef57f8adf57f8c126b1</div><div id='time'> Time: 2020-03-05</div><div id='author'> Author: daniel@adap.com</div><div id='file'> File Name: src/flower/server.py</div><div id='m_class'> M Class Name: Server</div><div id='n_method'> N Class Name: Server</div><div id='m_method'> M Method Name: _get_initial_weights(1)</div><div id='n_method'> N Method Name: _get_initial_weights(1)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: src/flower/server.py</div><div id='n_file'> N File Name: src/flower/server.py</div><div id='m_start'> M Start Line: 80</div><div id='m_end'> M End Line: 80</div><div id='n_start'> N Start Line: 93</div><div id='n_end'> N End Line: 94</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        distributed = self.accelerator.num_processes &gt; 1
        base_decoder = self.accelerator.unwrap_model(self.decoder)
        if kwargs.pop(&quotuse_non_ema&quot, False) or not self.use_ema:
            <a id="change">return </a><a id="change">base_decoder.sample(</a>*<a id="change">args, **kwargs, distributed = distributed)</a>

        trainable_unets = self.accelerator.unwrap_model(self.decoder).unets
        base_decoder.unets = self.unets                  &#47&#47 swap in exponential moving averaged unets for sampling
</code></pre><h3>After Change</h3><pre><code class='java'>
        base_decoder.eval()

        if kwargs.pop(&quotuse_non_ema&quot, False) or not self.use_ema:
            out<a id="change"> = </a><a id="change">base_decoder.sample(</a>*<a id="change">args, **kwargs, distributed = distributed)</a>
            base_decoder.train(was_training)
            <a id="change">return </a>out

        trainable_unets = self.accelerator.unwrap_model(self.decoder).unets
        base_decoder.unets = self.unets                  &#47&#47 swap in exponential moving averaged unets for sampling</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/lucidrains/dalle2-pytorch/commit/b2073219f066a1ac9c7f73c9797e639194a48f24#diff-617450527162fa367141dbf45e8b201673573479820af0ffc56ba93b7f70947fL673' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 66843805</div><div id='project'> Project Name: lucidrains/dalle2-pytorch</div><div id='commit'> Commit Name: b2073219f066a1ac9c7f73c9797e639194a48f24</div><div id='time'> Time: 2022-07-13</div><div id='author'> Author: lucidrains@gmail.com</div><div id='file'> File Name: dalle2_pytorch/trainer.py</div><div id='m_class'> M Class Name: DecoderTrainer</div><div id='n_method'> N Class Name: DecoderTrainer</div><div id='m_method'> M Method Name: sample(1)</div><div id='n_method'> N Method Name: sample(1)</div><div id='m_parent_class'> M Parent Class: nn.Module</div><div id='n_parent_class'> N Parent Class: nn.Module</div><div id='m_file'> M File Name: dalle2_pytorch/trainer.py</div><div id='n_file'> N File Name: dalle2_pytorch/trainer.py</div><div id='m_start'> M Start Line: 677</div><div id='m_end'> M End Line: 677</div><div id='n_start'> N Start Line: 675</div><div id='n_end'> N End Line: 696</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        return q1_loss_value, q2_loss_value, v_loss_value, policy_loss_value, alpha_loss_value, alpha_value

    def select_action(self, state):
        <a id="change">return </a><a id="change">self.policy_network.sample(</a>state<a id="change">)</a>

</code></pre><h3>After Change</h3><pre><code class='java'>
    def select_action(self, state):
        if type(state) != torch.tensor:
            state = torch.FloatTensor([state]).to(device)
        action_sample<a id="change"> = </a><a id="change">self.policy_network.sample(</a>state<a id="change">)</a>
        print("action_sample", action_sample)
        <a id="change">return </a>action_sample.detach().cpu().numpy()[0]

</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/x35f/unstable_baselines/commit/c76f47e0859e534f850cd3af12082f126c2df1a2#diff-5db644cd5bd54e3d73a4e86c3b2e245fd8f43751389307d15efbb99043bc1b0fL128' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 66843804</div><div id='project'> Project Name: x35f/unstable_baselines</div><div id='commit'> Commit Name: c76f47e0859e534f850cd3af12082f126c2df1a2</div><div id='time'> Time: 2021-03-09</div><div id='author'> Author: 1621322691@qq.com</div><div id='file'> File Name: sac/models.py</div><div id='m_class'> M Class Name: SACAgent</div><div id='n_method'> N Class Name: SACAgent</div><div id='m_method'> M Method Name: select_action(2)</div><div id='n_method'> N Method Name: select_action(2)</div><div id='m_parent_class'> M Parent Class: BaseAgent,torch.nn.Module</div><div id='n_parent_class'> N Parent Class: BaseAgent,torch.nn.Module</div><div id='m_file'> M File Name: sac/models.py</div><div id='n_file'> N File Name: sac/models.py</div><div id='m_start'> M Start Line: 129</div><div id='m_end'> M End Line: 129</div><div id='n_start'> N Start Line: 126</div><div id='n_end'> N End Line: 130</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
            torch.Tensor: tensor with samples  (shape batch_size x n_timesteps x n_samples)
        
        dist = self.map_x_to_distribution(y_pred)
        <a id="change">return </a><a id="change">dist.sample(</a>(n_samples,)<a id="change">)</a>.permute(1, 2, 0)

    def to_quantiles(self, y_pred: torch.Tensor, quantiles: List[float] = None) -&gt; torch.Tensor:
        </code></pre><h3>After Change</h3><pre><code class='java'>
            torch.Tensor: tensor with samples  (shape batch_size x n_timesteps x n_samples)
        
        dist = self.map_x_to_distribution(y_pred)
        samples<a id="change"> = </a><a id="change">dist.sample(</a>(n_samples,)<a id="change">)</a>
        if samples.ndim == 3:
            samples = samples.permute(1, 2, 0)
        elif samples.ndim == 2:
            samples = samples.transpose(0, 1)
        <a id="change">return </a>samples

    def to_quantiles(self, y_pred: torch.Tensor, quantiles: List[float] = None) -&gt; torch.Tensor:
        </code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/jdb78/pytorch-forecasting/commit/a99bbc98d445cd446a469f6f5a891a48a40b36bb#diff-b33317714bfa742fe554f4cce1ee1221e7d5182714f10cfd995f89f71ab1dac1L910' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 66843808</div><div id='project'> Project Name: jdb78/pytorch-forecasting</div><div id='commit'> Commit Name: a99bbc98d445cd446a469f6f5a891a48a40b36bb</div><div id='time'> Time: 2021-01-03</div><div id='author'> Author: beitner.jan@bcg.com</div><div id='file'> File Name: pytorch_forecasting/metrics.py</div><div id='m_class'> M Class Name: DistributionLoss</div><div id='n_method'> N Class Name: DistributionLoss</div><div id='m_method'> M Method Name: sample(3)</div><div id='n_method'> N Method Name: sample(3)</div><div id='m_parent_class'> M Parent Class: MultiHorizonMetric</div><div id='n_parent_class'> N Parent Class: MultiHorizonMetric</div><div id='m_file'> M File Name: pytorch_forecasting/metrics.py</div><div id='n_file'> N File Name: pytorch_forecasting/metrics.py</div><div id='m_start'> M Start Line: 922</div><div id='m_end'> M End Line: 922</div><div id='n_start'> N Start Line: 922</div><div id='n_end'> N End Line: 927</div><BR>