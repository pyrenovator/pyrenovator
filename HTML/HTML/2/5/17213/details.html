<html><h3>Pattern ID :17213
</h3><img src='57360841.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>

        is_list = isinstance(input_text, list)

        encoded_input = <a id="change">tokenizer.encode(</a>input_text<a id="change">, return_tensors=&quotpt&quot)</a>
        encoded_input = encoded_input.to(device)

        output = model.generate(input_ids=encoded_input, num_return_sequences=1)

        if is_list:
            return [tokenizer.decode(tokens, skip_special_tokens=True) for tokens in output]
        else:
            <a id="change">return tokenizer</a><a id="change">.decode(</a>output[0]<a id="change">, skip_special_tokens=True)</a>
    else:
        raise ValueError(&quotNon-local inference is not currently implemented&quot)

</code></pre><h3>After Change</h3><pre><code class='java'>
                model_name = DEFAULT_MODEL
            else:
                &#47&#47 Get from predefined list or try to find remotely
                model_name = <a id="change">MODELS.get(model_name) or model_name</a>
                model = AutoModelForPreTraining.from_pretrained(model_name)
            model.to(device)
        
        &#47&#47 Initialise tokenizer, allow switching if new one is provided.</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 4</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/kiri-ai/kiri/commit/300da0a21087ca27863518a5c2056c2d4b5791cd#diff-8d4fcf69b31fb67e2949ebbffde17c41a1b73e39ef4b80a862e0a7c426b506beL10' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 57360841</div><div id='project'> Project Name: kiri-ai/kiri</div><div id='commit'> Commit Name: 300da0a21087ca27863518a5c2056c2d4b5791cd</div><div id='time'> Time: 2021-01-20</div><div id='author'> Author: ojasaarkristo@gmail.com</div><div id='file'> File Name: kiri/models/generation.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: generate(6)</div><div id='n_method'> N Method Name: generate(5)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: kiri/models/generation.py</div><div id='n_file'> N File Name: kiri/models/generation.py</div><div id='m_start'> M Start Line: 10</div><div id='m_end'> M End Line: 51</div><div id='n_start'> N Start Line: 78</div><div id='n_end'> N End Line: 133</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>

        is_list = isinstance(input_text, list)

        encoded_input = <a id="change">tokenizer.encode(</a>input_text<a id="change">, return_tensors=&quotpt&quot)</a>
        encoded_input = encoded_input.to(device)

        output = model.generate(input_ids=encoded_input, num_return_sequences=1)

        if is_list:
            <a id="change">return </a>[<a id="change">tokenizer.decode(</a>tokens<a id="change">, skip_special_tokens=True)</a> for tokens in output]
        else:
            return tokenizer.decode(output[0], skip_special_tokens=True)
    else:</code></pre><h3>After Change</h3><pre><code class='java'>
                model_name = DEFAULT_MODEL
            else:
                &#47&#47 Get from predefined list or try to find remotely
                model_name = <a id="change">MODELS.get(model_name) or model_name</a>
                model = AutoModelForPreTraining.from_pretrained(model_name)
            model.to(device)
        
        &#47&#47 Initialise tokenizer, allow switching if new one is provided.</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/kiri-ai/kiri/commit/300da0a21087ca27863518a5c2056c2d4b5791cd#diff-8d4fcf69b31fb67e2949ebbffde17c41a1b73e39ef4b80a862e0a7c426b506beL10' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 57360840</div><div id='project'> Project Name: kiri-ai/kiri</div><div id='commit'> Commit Name: 300da0a21087ca27863518a5c2056c2d4b5791cd</div><div id='time'> Time: 2021-01-20</div><div id='author'> Author: ojasaarkristo@gmail.com</div><div id='file'> File Name: kiri/models/generation.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: generate(6)</div><div id='n_method'> N Method Name: generate(5)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: kiri/models/generation.py</div><div id='n_file'> N File Name: kiri/models/generation.py</div><div id='m_start'> M Start Line: 10</div><div id='m_end'> M End Line: 51</div><div id='n_start'> N Start Line: 78</div><div id='n_end'> N End Line: 133</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        enc_output, i_mask = None, None
        if self.has_inputs:
            i_mask = utils.create_pad_mask(inputs, self.src_pad_idx)
            enc_output = <a id="change">self.encode(</a>inputs, i_mask<a id="change">)</a>

        t_mask = utils.create_pad_mask(targets, self.trg_pad_idx)
        target_size = targets.size()[1]
        t_self_mask = utils.create_trg_self_mask(target_size,
                                                 device=targets.device)
        <a id="change">return </a><a id="change">self.decode(</a>targets, enc_output, i_mask, t_self_mask, t_mask<a id="change">)</a>

    def initialize(self):
        &#47&#47 weight init
        for p in self.parameters():</code></pre><h3>After Change</h3><pre><code class='java'>
        self.initialize()

    def forward(self, padded_input, input_lengths, padded_target):
        if <a id="change">self.feat_extractor == &quotemb_cnn&quot or self.feat_extractor == &quotvgg_cnn&quot</a>:
            padded_input = self.conv(padded_input)

        &#47&#47 Reshaping features</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/qute012/kosr/commit/b7d24b0d835254fd425224eba3421a3b7224e55f#diff-c6b6e8084627536e70fdb6e8be5c81f8520937c01028e9bb6ea65a82014b023eL18' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 57360839</div><div id='project'> Project Name: qute012/kosr</div><div id='commit'> Commit Name: b7d24b0d835254fd425224eba3421a3b7224e55f</div><div id='time'> Time: 2021-01-12</div><div id='author'> Author: ejrwls012@gmail.com</div><div id='file'> File Name: model/transformer/transformer.py</div><div id='m_class'> M Class Name: Transformer</div><div id='n_method'> N Class Name: Transformer</div><div id='m_method'> M Method Name: forward(4)</div><div id='n_method'> N Method Name: forward(3)</div><div id='m_parent_class'> M Parent Class: nn.Module</div><div id='n_parent_class'> N Parent Class: nn.Module</div><div id='m_file'> M File Name: model/transformer/transformer.py</div><div id='n_file'> N File Name: model/transformer/transformer.py</div><div id='m_start'> M Start Line: 19</div><div id='m_end'> M End Line: 28</div><div id='n_start'> N Start Line: 18</div><div id='n_end'> N End Line: 34</div><BR>