<html><h3>Pattern ID :11097
</h3><img src='38175942.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
                    for csp_port in var_port.csp_ports:
                        if isinstance(csp_port, CspRecvPort):
                            channel_actions.append((csp_port, lambda: var_port))
            elif <a id="change"></a>enum_equal(phase, PyLoihiProcessModel.Phase.HOST):
                channel_actions.append((self.service_to_process_req,
                                        lambda: &quotreq&quot))
            action = selector.select(*channel_actions)</code></pre><h3>After Change</h3><pre><code class='java'>
                    elif enum_equal(cmd, PyLoihiProcessModel.Phase.HOST):
                        phase = PyLoihiProcessModel.Phase.HOST
                        pass
                    elif <a id="change">enum_equal(cmd</a>, MGMT_COMMAND.GET_DATA<a id="change">)</a> and \
                            enum_equal(phase, PyLoihiProcessModel.Phase.HOST):
                        &#47&#47 Handle get/set Var requests from runtime service
                        self._handle_get_var()
                    elif <a id="change">enum_equal(cmd</a>,
                                    MGMT_COMMAND.SET_DATA<a id="change">)</a> and \
                            enum_equal(phase, PyLoihiProcessModel.Phase.HOST):
                        &#47&#47 Handle get/set Var requests from runtime service
                        self._handle_set_var()</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 4</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/lava-nc/lava/commit/62b2f0780c42beb4063695fb881b4fc8b5adede5#diff-7139b79a62cfae58ae9c7223148b62c98773436033c5e0938e2fc7aac075e3a4L111' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 38175942</div><div id='project'> Project Name: lava-nc/lava</div><div id='commit'> Commit Name: 62b2f0780c42beb4063695fb881b4fc8b5adede5</div><div id='time'> Time: 2022-01-05</div><div id='author'> Author: yashwardhan.singh@intel.com</div><div id='file'> File Name: src/lava/magma/core/model/py/model.py</div><div id='m_class'> M Class Name: PyLoihiProcessModel</div><div id='n_method'> N Class Name: PyLoihiProcessModel</div><div id='m_method'> M Method Name: run(1)</div><div id='n_method'> N Method Name: run(1)</div><div id='m_parent_class'> M Parent Class: AbstractPyProcessModel</div><div id='n_parent_class'> N Parent Class: AbstractPyProcessModel</div><div id='m_file'> M File Name: src/lava/magma/core/model/py/model.py</div><div id='n_file'> N File Name: src/lava/magma/core/model/py/model.py</div><div id='m_start'> M Start Line: 120</div><div id='m_end'> M End Line: 179</div><div id='n_start'> N Start Line: 111</div><div id='n_end'> N End Line: 173</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
                    self._send_pm_cmd(command)
                    rsps = self._get_pm_resp()
                    for rsp in rsps:
                        <a id="change">if </a>not enum_equal(rsp, MGMT_RESPONSE.TERMINATED):
                            raise ValueError(f"Wrong Response Received : {rsp}")
                    &#47&#47 Inform the runtime about successful termination
                    self.service_to_runtime.send(MGMT_RESPONSE.TERMINATED)</code></pre><h3>After Change</h3><pre><code class='java'>
                        &#47&#47 TODO: Do we actualy need to wait for PMs to be in
                        &#47&#47 HOST or MGMT phase to stop or pause them?
                        if self.runtime_to_service.probe():
                            <a id="change">cmd</a> = self.runtime_to_service.peek()
                            <a id="change">if </a><a id="change">enum_equal(</a>cmd, MGMT_COMMAND.STOP<a id="change">)</a>:
                                self.runtime_to_service.recv()
                                self._handle_stop()
                                return
                            if <a id="change">enum_equal(</a>cmd, MGMT_COMMAND.PAUSE<a id="change">)</a>:
                                self.runtime_to_service.recv()
                                self._handle_pause()
                                self.paused = True</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/lava-nc/lava/commit/4956db0191ef2d0b51c026fb9c1bb50ea57e6c90#diff-92a2d9166185e8fd9185c65d0c6ed303a14113cdb72e19495a3a2f4fe32d2978L190' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 38176004</div><div id='project'> Project Name: lava-nc/lava</div><div id='commit'> Commit Name: 4956db0191ef2d0b51c026fb9c1bb50ea57e6c90</div><div id='time'> Time: 2022-02-17</div><div id='author'> Author: yashwardhan.singh@intel.com</div><div id='file'> File Name: src/lava/magma/runtime/runtime_service.py</div><div id='m_class'> M Class Name: LoihiPyRuntimeService</div><div id='n_method'> N Class Name: LoihiPyRuntimeService</div><div id='m_method'> M Method Name: run(1)</div><div id='n_method'> N Method Name: run(1)</div><div id='m_parent_class'> M Parent Class: PyRuntimeService</div><div id='n_parent_class'> N Parent Class: PyRuntimeService</div><div id='m_file'> M File Name: src/lava/magma/runtime/runtime_service.py</div><div id='n_file'> N File Name: src/lava/magma/runtime/runtime_service.py</div><div id='m_start'> M Start Line: 207</div><div id='m_end'> M End Line: 266</div><div id='n_start'> N Start Line: 296</div><div id='n_end'> N End Line: 360</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
                    for csp_port in var_port.csp_ports:
                        if isinstance(csp_port, CspRecvPort):
                            channel_actions.append((csp_port, lambda: var_port))
            elif <a id="change"></a>enum_equal(phase, PyLoihiProcessModel.Phase.HOST):
                channel_actions.append((self.service_to_process_req,
                                        lambda: &quotreq&quot))
            action = selector.select(*channel_actions)</code></pre><h3>After Change</h3><pre><code class='java'>
        phase = PyLoihiProcessModel.Phase.SPK
        while True:
            if action == &quotcmd&quot:
                <a id="change">cmd</a> = self.service_to_process.recv()
                if enum_equal(cmd, MGMT_COMMAND.STOP):
                    self.process_to_service.send(MGMT_RESPONSE.TERMINATED)
                    self.join()
                    return
                try:
                    &#47&#47 Spiking phase - increase time step
                    if enum_equal(cmd, PyLoihiProcessModel.Phase.SPK):
                        self.current_ts += 1
                        phase = PyLoihiProcessModel.Phase.SPK
                        self.run_spk()
                        self.process_to_service.send(MGMT_RESPONSE.DONE)
                    &#47&#47 Pre-management phase
                    elif enum_equal(cmd,
                                    PyLoihiProcessModel.Phase.PRE_MGMT):
                        &#47&#47 Enable via guard method
                        phase = PyLoihiProcessModel.Phase.PRE_MGMT
                        if self.pre_guard():
                            self.run_pre_mgmt()
                        self.process_to_service.send(MGMT_RESPONSE.DONE)
                    &#47&#47 Learning phase
                    elif enum_equal(cmd, PyLoihiProcessModel.Phase.LRN):
                        &#47&#47 Enable via guard method
                        phase = PyLoihiProcessModel.Phase.LRN
                        if self.lrn_guard():
                            self.run_lrn()
                        self.process_to_service.send(MGMT_RESPONSE.DONE)
                    &#47&#47 Post-management phase
                    elif enum_equal(cmd,
                                    PyLoihiProcessModel.Phase.POST_MGMT):
                        &#47&#47 Enable via guard method
                        phase = PyLoihiProcessModel.Phase.POST_MGMT
                        if self.post_guard():
                            self.run_post_mgmt()
                        self.process_to_service.send(MGMT_RESPONSE.DONE)
                    &#47&#47 Host phase - called at the last time step before STOP
                    elif enum_equal(cmd, PyLoihiProcessModel.Phase.HOST):
                        phase = PyLoihiProcessModel.Phase.HOST
                        pass
                    elif <a id="change">enum_equal(</a>cmd, MGMT_COMMAND.GET_DATA<a id="change">)</a> and \
                            enum_equal(phase, PyLoihiProcessModel.Phase.HOST):
                        &#47&#47 Handle get/set Var requests from runtime service
                        self._handle_get_var()
                    elif <a id="change">enum_equal(</a>cmd,
                                    MGMT_COMMAND.SET_DATA<a id="change">)</a> and \
                            enum_equal(phase, PyLoihiProcessModel.Phase.HOST):
                        &#47&#47 Handle get/set Var requests from runtime service
                        self._handle_set_var()</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/lava-nc/lava/commit/62b2f0780c42beb4063695fb881b4fc8b5adede5#diff-7139b79a62cfae58ae9c7223148b62c98773436033c5e0938e2fc7aac075e3a4L112' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 38175924</div><div id='project'> Project Name: lava-nc/lava</div><div id='commit'> Commit Name: 62b2f0780c42beb4063695fb881b4fc8b5adede5</div><div id='time'> Time: 2022-01-05</div><div id='author'> Author: yashwardhan.singh@intel.com</div><div id='file'> File Name: src/lava/magma/core/model/py/model.py</div><div id='m_class'> M Class Name: PyLoihiProcessModel</div><div id='n_method'> N Class Name: PyLoihiProcessModel</div><div id='m_method'> M Method Name: run(1)</div><div id='n_method'> N Method Name: run(1)</div><div id='m_parent_class'> M Parent Class: AbstractPyProcessModel</div><div id='n_parent_class'> N Parent Class: AbstractPyProcessModel</div><div id='m_file'> M File Name: src/lava/magma/core/model/py/model.py</div><div id='n_file'> N File Name: src/lava/magma/core/model/py/model.py</div><div id='m_start'> M Start Line: 120</div><div id='m_end'> M End Line: 179</div><div id='n_start'> N Start Line: 111</div><div id='n_end'> N End Line: 173</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
                        self.run_post_mgmt()
                    self.process_to_service_ack.send(MGMT_RESPONSE.DONE)
                    &#47&#47 Handle VarPort requests from RefPorts
                    <a id="change">if </a>len(self.var_ports) &gt; 0:
                        self._handle_var_ports()
                &#47&#47 Host phase - called at the last time step before STOP
                elif np.array_equal(phase, PyLoihiProcessModel.Phase.HOST):</code></pre><h3>After Change</h3><pre><code class='java'>
                self._handle_var_port(action)

            channel_actions = [(self.service_to_process_cmd, lambda: &quotcmd&quot)]
            <a id="change">if </a><a id="change">enum_equal(</a>phase, PyLoihiProcessModel.Phase.PRE_MGMT<a id="change">)</a> or \
                    enum_equal(phase, PyLoihiProcessModel.Phase.POST_MGMT):
                for var_port in self.var_ports:
                    for csp_port in var_port.csp_ports:
                        if isinstance(csp_port, CspRecvPort):
                            channel_actions.append((csp_port, lambda: var_port))
            elif <a id="change">enum_equal(</a>phase, PyLoihiProcessModel.Phase.HOST<a id="change">)</a>:
                channel_actions.append((self.service_to_process_req,
                                        lambda: &quotreq&quot))
            action = selector.select(*channel_actions)</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/lava-nc/lava/commit/38e14d5b53c075923760faeff19781a3ae9ea4da#diff-7139b79a62cfae58ae9c7223148b62c98773436033c5e0938e2fc7aac075e3a4L109' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 38175968</div><div id='project'> Project Name: lava-nc/lava</div><div id='commit'> Commit Name: 38e14d5b53c075923760faeff19781a3ae9ea4da</div><div id='time'> Time: 2021-11-22</div><div id='author'> Author: 87097499+harryliu-intel@users.noreply.github.com</div><div id='file'> File Name: src/lava/magma/core/model/py/model.py</div><div id='m_class'> M Class Name: PyLoihiProcessModel</div><div id='n_method'> N Class Name: PyLoihiProcessModel</div><div id='m_method'> M Method Name: run(1)</div><div id='n_method'> N Method Name: run(1)</div><div id='m_parent_class'> M Parent Class: AbstractPyProcessModel</div><div id='n_parent_class'> N Parent Class: AbstractPyProcessModel</div><div id='m_file'> M File Name: src/lava/magma/core/model/py/model.py</div><div id='n_file'> N File Name: src/lava/magma/core/model/py/model.py</div><div id='m_start'> M Start Line: 116</div><div id='m_end'> M End Line: 161</div><div id='n_start'> N Start Line: 118</div><div id='n_end'> N End Line: 175</div><BR>