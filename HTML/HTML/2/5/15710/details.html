<html><h3>Pattern ID :15710
</h3><img src='53045741.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
    &#47&#47 print("initialize")

    &#47&#47 select device
    device<a id="change"> = </a><a id="change">torch.device("cpu"</a><a id="change">)</a>
    &#47&#47 print("device: %s" % device)

    &#47&#47 load network
    model = Net(model_path)</code></pre><h3>After Change</h3><pre><code class='java'>
    target_height, target_width = int(round(img.shape[0] * scale)), int(round(img.shape[1] * scale))
    img_input = utils.resize_image(img)
    &#47&#47 print(img_input.shape)
    <a id="change">if </a>torch.cuda.is_available() and not f:
        img_input<a id="change"> = </a>img_input.cuda()
    &#47&#47 compute
    with torch.no_grad():
        out = model.forward(img_input)</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 4</div><BR><div id='size'>Non-data size: 4</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/kritiksoman/gimp-ml/commit/001b95d59db583a31816d6a84771c6eca3831014#diff-6bc284d7aee4a584f1c1627a18853ea29d4cab63194d0c61e88c6752f9922722L14' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 53045741</div><div id='project'> Project Name: kritiksoman/gimp-ml</div><div id='commit'> Commit Name: 001b95d59db583a31816d6a84771c6eca3831014</div><div id='time'> Time: 2020-09-20</div><div id='author'> Author: kritiksoman@Kritiks-MacBook-Air.local</div><div id='file'> File Name: gimp-plugins/MiDaS/run.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: run_depth(6)</div><div id='n_method'> N Method Name: run_depth(5)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: gimp-plugins/MiDaS/run.py</div><div id='n_file'> N File Name: gimp-plugins/MiDaS/run.py</div><div id='m_start'> M Start Line: 25</div><div id='m_end'> M End Line: 53</div><div id='n_start'> N Start Line: 14</div><div id='n_end'> N End Line: 57</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
            if torch.cuda.is_available():
                self.device = torch.device("cuda")
            elif torch.backends.mps.is_available() and torch.backends.mps.is_built():
                self.device<a id="change"> = </a><a id="change">torch.device("mps"</a><a id="change">)</a>
            else:
                self.device = torch.device("cpu")
        else:
            self.device = device</code></pre><h3>After Change</h3><pre><code class='java'>
            )
        elif isinstance(raw_count, pd.DataFrame):
            pass
        elif <a id="change"></a>isinstance(raw_count, ad.AnnData):
            &#47&#47 get ambient profile from AnnData.uns
            if (ambient_profile is None) and ("ambient_profile_all" in raw_count.uns):
                print("Found ambient profile in AnnData.uns[&quotambient_profile_all&quot]")
                ambient_profile<a id="change"> = </a>raw_count.uns["ambient_profile_all"]
            elif (ambient_profile is None) and (
                "ambient_profile_all" not in raw_count.uns
            ):</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/novartis/scar/commit/3e665696fca90371c5571580921855503805bab5#diff-b2119d621ad5c6fc5288c4bfa993ce5cad3d34819006f0b28539e184b025101bL187' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 53045743</div><div id='project'> Project Name: novartis/scar</div><div id='commit'> Commit Name: 3e665696fca90371c5571580921855503805bab5</div><div id='time'> Time: 2023-03-02</div><div id='author'> Author: 43896555+CaibinSh@users.noreply.github.com</div><div id='file'> File Name: scar/main/_scar.py</div><div id='m_class'> M Class Name: model</div><div id='n_method'> N Class Name: model</div><div id='m_method'> M Method Name: __init__(11)</div><div id='n_method'> N Method Name: __init__(11)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: scar/main/_scar.py</div><div id='n_file'> N File Name: scar/main/_scar.py</div><div id='m_start'> M Start Line: 205</div><div id='m_end'> M End Line: 261</div><div id='n_start'> N Start Line: 206</div><div id='n_end'> N End Line: 278</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
    if torch.cuda.is_available():
        device = torch.device("cuda")
    else:
        device<a id="change"> = </a><a id="change">torch.device("cpu"</a><a id="change">)</a>

    config = get_config()

    &#47&#47 create model</code></pre><h3>After Change</h3><pre><code class='java'>

    &#47&#47 send model to device
    model = model.to(device)
    <a id="change">if </a>len(device_ids) &gt; 1:
        model<a id="change"> = </a>torch.nn.DataParallel(model, device_ids=device_ids)

    &#47&#47 create dataloader
    data_loader = eval("{}DataLoader".format(config.dataset))(</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/asyml/vision-transformer-pytorch/commit/47389698af0c1a8faf273479b5dc20585411c08a#diff-7c33c37dd2ca3f92b111b25d2c1168f5c98f308c1f2d0e2add9e4b8b240e5918L11' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 53045749</div><div id='project'> Project Name: asyml/vision-transformer-pytorch</div><div id='commit'> Commit Name: 47389698af0c1a8faf273479b5dc20585411c08a</div><div id='time'> Time: 2020-11-15</div><div id='author'> Author: haoc3@andrew.cmu.edu</div><div id='file'> File Name: src/eval.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: main(0)</div><div id='n_method'> N Method Name: main(0)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: src/eval.py</div><div id='n_file'> N File Name: src/eval.py</div><div id='m_start'> M Start Line: 13</div><div id='m_end'> M End Line: 39</div><div id='n_start'> N Start Line: 13</div><div id='n_end'> N End Line: 42</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
    &#47&#47 device = torch.device(f"cuda:{args.local_rank}")
    &#47&#47 device = torch.device(f"cuda:{0}")
    &#47&#47 torch.cuda.set_device(device)
    device<a id="change"> = </a><a id="change">torch.device(&quotcpu&quot</a><a id="change">)</a>
    &#47&#47 train_dl, test_dl = simplified_get_train_test_dl_from_args(args, verbose=False)

    is_last_partition = args.local_rank == len(configs) - 1  &#47&#47 FIXME
    is_first_partition = args.local_rank == 0  &#47&#47 FIXME:</code></pre><h3>After Change</h3><pre><code class='java'>
    device = torch.device(&quotcpu&quot if args.cpu else f"cuda:{args.local_rank}")  

    dl_kw = dict()
    <a id="change">if </a>args.cpu:
        dl_kw[&quotpin_memory&quot]<a id="change"> = </a>False
    &#47&#47 TODO: num workers.
    dl_kw[&quotnum_workers&quot] = args.num_data_workers
</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/saareliad/ftpipe/commit/643587659b515bb2181236f614f8361bda6efbb3#diff-b10564ab7d2c520cdd0243874879fb0a782862c3c902ab535faabe57d5a505e1L292' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 53045748</div><div id='project'> Project Name: saareliad/ftpipe</div><div id='commit'> Commit Name: 643587659b515bb2181236f614f8361bda6efbb3</div><div id='time'> Time: 2019-12-01</div><div id='author'> Author: saareliad@campus.technion.ac.il</div><div id='file'> File Name: main.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: main(0)</div><div id='n_method'> N Method Name: main(0)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: main.py</div><div id='n_file'> N File Name: main.py</div><div id='m_start'> M Start Line: 332</div><div id='m_end'> M End Line: 378</div><div id='n_start'> N Start Line: 291</div><div id='n_end'> N End Line: 333</div><BR>