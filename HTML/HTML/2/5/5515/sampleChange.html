<link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
        &#47&#47 could randomize -- even better would be to randomize in dataloader
        &#47&#47 might be expensive though
        note_ons = [(n.start, n.pitch, n.velocity, program) for n in inst.notes]
        note_offs = <a id="change">[(n.end, n.pitch, 0, program) for n in inst.notes]</a>
        <a id="change">inst_events.extend(</a>note_ons+note_offs<a id="change">)</a>
    if len(inst_events) &lt; 64:
        return
    time, pitch, vel, prog = zip(*sorted(inst_events))
    delta = torch.FloatTensor([0, *time]).diff(1)</code></pre><h3>After Change</h3><pre><code class='java'>
            
        &#47&#47 shorten all notes so they end 2*$margin before next (within pitch)
        for seq in nbp.values():
            <a id="change">for </a>i,n in <a id="change">enumerate(</a>seq[:-1]<a id="change">):
                </a>max_end = seq[i+1].start-2*time_margin
                if n.end &gt; max_end:
                    n.end = max_end
                &#47&#47 and flatten again</code></pre>