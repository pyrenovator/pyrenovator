<html><h3>Pattern ID :21131
</h3><img src='67778376.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
        if not hasattr(self, &quotinterp_func&quot):
            self.get_interpolator()

        <a id="change">return </a>interpolate_reg_grid(self.interp_func, pos)
</code></pre><h3>After Change</h3><pre><code class='java'>
            self.nshells, dim=0)
        print(&quot___bas &quot, time()-t0)

        t0<a id="change"> = </a><a id="change">time()</a>
        xyz = (pos.view(-1, self.nelec, 1, self.ndim) -
               bas_coords[None, ...]).detach().numpy()
        print(&quot___ xyz&quot, <a id="change">time()</a><a id="change">-</a>t0)

        t0 = time()
        data = np.array([self.interp_func[ibas](xyz[:, :, ibas, :])</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 5</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/nlesc-jcer/qmctorch/commit/7cfb514524df67f6b1b553207580f79b5dbf21a9#diff-bad3c792754fd96b2dee59984eaff2493e621fdbd0e370e59f5382da6feb3c0dL298' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 67778376</div><div id='project'> Project Name: nlesc-jcer/qmctorch</div><div id='commit'> Commit Name: 7cfb514524df67f6b1b553207580f79b5dbf21a9</div><div id='time'> Time: 2020-05-13</div><div id='author'> Author: nicolas.gm.renaud@gmail.com</div><div id='file'> File Name: qmctorch/wavefunction/atomic_orbitals.py</div><div id='m_class'> M Class Name: AtomicOrbitals</div><div id='n_method'> N Class Name: AtomicOrbitals</div><div id='m_method'> M Method Name: interpolate(2)</div><div id='n_method'> N Method Name: interpolate(2)</div><div id='m_parent_class'> M Parent Class: nn.Module</div><div id='n_parent_class'> N Parent Class: nn.Module</div><div id='m_file'> M File Name: qmctorch/wavefunction/atomic_orbitals.py</div><div id='n_file'> N File Name: qmctorch/wavefunction/atomic_orbitals.py</div><div id='m_start'> M Start Line: 298</div><div id='m_end'> M End Line: 298</div><div id='n_start'> N Start Line: 323</div><div id='n_end'> N End Line: 342</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>

    secs = end - start

    <a id="change">return </a>size, secs


def test_p2p(comm=None, src=0, target=1):</code></pre><h3>After Change</h3><pre><code class='java'>
    size = 4 * np.prod(arr.shape, dtype=int)
    duration = 0
    for _ in range(iterations):
        start<a id="change"> = </a><a id="change">time()</a>
        comm.dlarrayNcclAllReduce(
            arr, arr, ncclDataType_t.ncclFloat32, ncclRedOp_t.ncclSum, stream)
        stream.sync()
        duration += (<a id="change">time()</a><a id="change"> - </a>start)

    local_duration = ht.array(np.array([duration, ]), ht.cpu())
    comm.dlarrayNcclReduce(local_duration, local_duration,</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/hsword/hetu/commit/de6a6b170885def9398eb2b8685f574fa3420140#diff-63344e3302f81dfa6c21fa37dce22cd3d62ca359935db1af0ce3b797b66ebad0L7' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 67778360</div><div id='project'> Project Name: hsword/hetu</div><div id='commit'> Commit Name: de6a6b170885def9398eb2b8685f574fa3420140</div><div id='time'> Time: 2021-10-11</div><div id='author'> Author: 657671989@qq.com</div><div id='file'> File Name: tests/test_nccl_bandwidth.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: test_allreduce(4)</div><div id='n_method'> N Method Name: test_allreduce(1)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: tests/test_nccl_bandwidth.py</div><div id='n_file'> N File Name: tests/test_nccl_bandwidth.py</div><div id='m_start'> M Start Line: 7</div><div id='m_end'> M End Line: 23</div><div id='n_start'> N Start Line: 9</div><div id='n_end'> N End Line: 27</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
    secs = end - start
    &#47&#47 size: /Bytes
    &#47&#47 dur_time: /s
    <a id="change">return </a>size, secs


&#47&#47 mpirun --allow-run-as-root --tag-output -np 2 python test_nccl_bandwidth.py</code></pre><h3>After Change</h3><pre><code class='java'>
    size = 4 * np.prod(arr.shape, dtype=int)
    duration = 0
    for _ in range(iterations):
        start<a id="change"> = </a><a id="change">time()</a>
        if comm.rank == 0:
            comm.dlarraySend(arr, ncclDataType_t.ncclFloat32, 1, stream)
        else:
            comm.dlarrayRecv(arr, ncclDataType_t.ncclFloat32, 0, stream)
        stream.sync()
        duration += (<a id="change">time()</a><a id="change"> - </a>start)

    print("Algorithm bandwidth: %f GB/s" %
          (size * iterations / duration / (2 ** 30)))</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/hsword/hetu/commit/de6a6b170885def9398eb2b8685f574fa3420140#diff-63344e3302f81dfa6c21fa37dce22cd3d62ca359935db1af0ce3b797b66ebad0L26' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 67778361</div><div id='project'> Project Name: hsword/hetu</div><div id='commit'> Commit Name: de6a6b170885def9398eb2b8685f574fa3420140</div><div id='time'> Time: 2021-10-11</div><div id='author'> Author: 657671989@qq.com</div><div id='file'> File Name: tests/test_nccl_bandwidth.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: test_p2p(4)</div><div id='n_method'> N Method Name: test_p2p(3)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: tests/test_nccl_bandwidth.py</div><div id='n_file'> N File Name: tests/test_nccl_bandwidth.py</div><div id='m_start'> M Start Line: 26</div><div id='m_end'> M End Line: 45</div><div id='n_start'> N Start Line: 28</div><div id='n_end'> N End Line: 41</div><BR>