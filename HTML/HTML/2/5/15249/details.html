<html><h3>Pattern ID :15249
</h3><img src='51438417.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
    m.add_future_regressor("A")
    m.add_lagged_regressor("B")
    config_normalization = configure.Normalization("auto", False, True, False)
    df_dict = {"df1": <a id="change">df1.copy()</a>, "df2": df2.copy()}
    config_normalization.init_data_params(df_dict, m.config_covar, m.regressors_config, m.events_config)
    m.config_normalization = config_normalization
    df_dict = m._normalize(df_dict)</code></pre><h3>After Change</h3><pre><code class='java'>
    df["A"] = np.arange(len(df))
    df["B"] = np.arange(len(df)) * 0.1
    df1 = df[:50]
    df1["ID"]<a id="change"> = </a>"df1"
    df2 = df[50:]
    df2["ID"] = "df2"
    m = NeuralProphet(
        yearly_seasonality=True,
        weekly_seasonality=True,
        daily_seasonality=True,
        n_lags=3,
        n_forecasts=2,
        learning_rate=LR,
    )
    m.add_future_regressor("A")
    m.add_lagged_regressor("B")
    config_normalization = configure.Normalization("auto", False, True, False)
    df_global<a id="change"> = </a><a id="change">pd.concat(</a>(df1<a id="change">, df2</a>)<a id="change">)</a>
    df_global.loc[:, "ds"] = pd.to_datetime(df_global.loc[:, "ds"])
    config_normalization.init_data_params(df_global, m.config_covar, m.regressors_config, m.events_config)
    m.config_normalization = config_normalization
    df_global = m._normalize(df_global)</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 5</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/ourownstory/neural_prophet/commit/7fcf23557cb5b30885a8a07387d411c61a50a05e#diff-6e0c7d0043d4ff88ba528ad3efafdbf7e9e84d544215cc80b30307c1142cd9b0L631' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 51438417</div><div id='project'> Project Name: ourownstory/neural_prophet</div><div id='commit'> Commit Name: 7fcf23557cb5b30885a8a07387d411c61a50a05e</div><div id='time'> Time: 2022-06-21</div><div id='author'> Author: mgheorghecr@gmail.com</div><div id='file'> File Name: tests/test_unit.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: test_loader(0)</div><div id='n_method'> N Method Name: test_loader(0)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: tests/test_unit.py</div><div id='n_file'> N File Name: tests/test_unit.py</div><div id='m_start'> M Start Line: 631</div><div id='m_end'> M End Line: 644</div><div id='n_start'> N Start Line: 684</div><div id='n_end'> N End Line: 700</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
    &#47&#47 TODO m3.add_country_holidays("US")
    config_normalization = configure.Normalization("auto", False, True, False)
    for m in [m1, m2, m3]:
        df_dict = {"df1": df1.copy(), "df2": <a id="change">df2.copy()</a>}
        config_normalization.init_data_params(df_dict, m.config_covar, m.regressors_config, m.events_config)
        m.config_normalization = config_normalization
        df_dict = m._normalize(df_dict)</code></pre><h3>After Change</h3><pre><code class='java'>
    df1 = df[:50]
    df1["ID"] = "df1"
    df2 = df[50:]
    df2["ID"]<a id="change"> = </a>"df2"
    m1 = NeuralProphet(
        yearly_seasonality=True,
        weekly_seasonality=True,
        daily_seasonality=True,
        learning_rate=LR,
    )
    m2 = NeuralProphet(
        n_lags=3,
        n_forecasts=2,
        learning_rate=LR,
    )
    m3 = NeuralProphet(learning_rate=LR)
    &#47&#47 TODO m3.add_country_holidays("US")
    config_normalization = configure.Normalization("auto", False, True, False)
    for m in [m1, m2, m3]:
        df_global = <a id="change">pd.concat(</a>(df1<a id="change">, df2</a>)<a id="change">)</a>
        df_global.loc[:, "ds"]<a id="change"> = </a>pd.to_datetime(df_global.loc[:, "ds"])
        config_normalization.init_data_params(df_global, m.config_covar, m.regressors_config, m.events_config)
        m.config_normalization = config_normalization
        df_global = m._normalize(df_global)</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/ourownstory/neural_prophet/commit/7fcf23557cb5b30885a8a07387d411c61a50a05e#diff-6e0c7d0043d4ff88ba528ad3efafdbf7e9e84d544215cc80b30307c1142cd9b0L581' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 51438419</div><div id='project'> Project Name: ourownstory/neural_prophet</div><div id='commit'> Commit Name: 7fcf23557cb5b30885a8a07387d411c61a50a05e</div><div id='time'> Time: 2022-06-21</div><div id='author'> Author: mgheorghecr@gmail.com</div><div id='file'> File Name: tests/test_unit.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: test_globaltimedataset(0)</div><div id='n_method'> N Method Name: test_globaltimedataset(0)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: tests/test_unit.py</div><div id='n_file'> N File Name: tests/test_unit.py</div><div id='m_start'> M Start Line: 583</div><div id='m_end'> M End Line: 626</div><div id='n_start'> N Start Line: 631</div><div id='n_end'> N End Line: 679</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        df_joint = df_joint[:split_idx].reset_index(drop=True)
        threshold_time_stamp = df_joint["ds"].iloc[-1]
        for key in df_fold:
            df = <a id="change">df_fold[key].copy(deep=True)</a>
            df_fold[key] = (
                df.copy(deep=True).iloc[: len(df[df["ds"] &lt; threshold_time_stamp]) + 1].reset_index(drop=True)
            )
    folds = folds[::-1]</code></pre><h3>After Change</h3><pre><code class='java'>
        split_idx = len(df_merged) - samples_fold + samples_overlap
        df_merged = df_merged[:split_idx].reset_index(drop=True)
        threshold_time_stamp = df_merged["ds"].iloc[-1]
        df_fold_aux<a id="change"> = </a>pd.DataFrame()
        for df_name, df_i in df_fold.groupby("ID"):
            df_aux = (
                df_i.copy(deep=True).iloc[: len(df_i[df_i["ds"] &lt; threshold_time_stamp]) + 1].reset_index(drop=True)
            )
            df_fold_aux = <a id="change">pd.concat(</a>(df_fold_aux<a id="change">, df_aux</a>)<a id="change">, ignore_index=True)</a>
        df_fold<a id="change"> = </a>df_fold_aux.copy(deep=True)
    folds = folds[::-1]
    return folds
</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/ourownstory/neural_prophet/commit/7fcf23557cb5b30885a8a07387d411c61a50a05e#diff-cb8ae2d50e5d5d245ed6fcc8cadf2baf7294fa9ac5c63e819fbfe34f0e4c2552L617' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 51438422</div><div id='project'> Project Name: ourownstory/neural_prophet</div><div id='commit'> Commit Name: 7fcf23557cb5b30885a8a07387d411c61a50a05e</div><div id='time'> Time: 2022-06-21</div><div id='author'> Author: mgheorghecr@gmail.com</div><div id='file'> File Name: neuralprophet/df_utils.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: _crossvalidation_with_time_threshold(6)</div><div id='n_method'> N Method Name: _crossvalidation_with_time_threshold(6)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: neuralprophet/df_utils.py</div><div id='n_file'> N File Name: neuralprophet/df_utils.py</div><div id='m_start'> M Start Line: 643</div><div id='m_end'> M End Line: 664</div><div id='n_start'> N Start Line: 634</div><div id='n_end'> N End Line: 658</div><BR>