<html><h3>Pattern ID :1356
</h3><img src='6506656.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
    &#47&#47 "Follow" mode is implemented as a loop in the CLI. We assume that
    &#47&#47 newer log messages have a numerically larger ID than older log
    &#47&#47 messages, so we keep track of the max ID seen so far.
    <a id="change">if </a>args.follow:
        change_time = time.time()
        try:
            while True:
                &#47&#47 Poll for new logs at most every 100 ms.
                <a id="change">time.sleep(0.1</a><a id="change">)</a>

                &#47&#47 The `tail` parameter only makes sense the first time we fetch logs.
                resp = logs_query(greater_than_id=latest_log_id).send()
                latest_log_id, changes = process_response(resp.trial_logs, latest_log_id)</code></pre><h3>After Change</h3><pre><code class='java'>
            offset, state = log["id"], log["state"]

    print_logs(args.tail)
    <a id="change">if not args.follow</a>:
        return

    try:</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 4</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/determined-ai/determined/commit/3da2ccbfa9a48a61c87488858d89fe84f1997978#diff-b549d9d2981432c1a4e328824134439d732b4d601165d2eb7c26da1d582bda4aL99' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 6506656</div><div id='project'> Project Name: determined-ai/determined</div><div id='commit'> Commit Name: 3da2ccbfa9a48a61c87488858d89fe84f1997978</div><div id='time'> Time: 2020-04-30</div><div id='author'> Author: yoni@determined.ai</div><div id='file'> File Name: cli/determined_cli/trial.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: logs(1)</div><div id='n_method'> N Method Name: logs(1)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: cli/determined_cli/trial.py</div><div id='n_file'> N File Name: cli/determined_cli/trial.py</div><div id='m_start'> M Start Line: 128</div><div id='m_end'> M End Line: 168</div><div id='n_start'> N Start Line: 99</div><div id='n_end'> N End Line: 131</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>

    device = torch.device("cuda")

    <a id="change">if </a>local_rank == 0:
        train_dataset = datasets.MNIST(data_path, train=True, download=True,
                       transform=transforms.Compose([
                           transforms.ToTensor(),
                           transforms.Normalize((0.1307,), (0.3081,))
                       ]))
    else:
        <a id="change">time.sleep(8</a><a id="change">)</a>
        train_dataset = datasets.MNIST(data_path, train=True, download=False,
                       transform=transforms.Compose([
                           transforms.ToTensor(),
                           transforms.Normalize((0.1307,), (0.3081,))</code></pre><h3>After Change</h3><pre><code class='java'>
                                                                (0.3081, ))
                                       ]))
    dist.barrier()  &#47&#47 prevent other ranks from accessing the data early
    <a id="change">if not is_first_local_rank</a>:
        train_dataset = datasets.MNIST(data_path,
                                       train=True,
                                       download=False,</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/aws/deep-learning-containers/commit/931a46bf26ad26f8760548cbb8151a57a4e2bb98#diff-9df816df2ec0be2962f4810faeec31153c210bfbe42d38b0865cf666a03d8715L97' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 6506654</div><div id='project'> Project Name: aws/deep-learning-containers</div><div id='commit'> Commit Name: 931a46bf26ad26f8760548cbb8151a57a4e2bb98</div><div id='time'> Time: 2021-03-29</div><div id='author'> Author: liu.yu5@outlook.com</div><div id='file'> File Name: test/sagemaker_tests/pytorch/training/resources/mnist/smdataparallel_mnist.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: main(0)</div><div id='n_method'> N Method Name: main(0)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: test/sagemaker_tests/pytorch/training/resources/mnist/smdataparallel_mnist.py</div><div id='n_file'> N File Name: test/sagemaker_tests/pytorch/training/resources/mnist/smdataparallel_mnist.py</div><div id='m_start'> M Start Line: 124</div><div id='m_end'> M End Line: 155</div><div id='n_start'> N Start Line: 133</div><div id='n_end'> N End Line: 171</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        _snat_rules = nat_client.list_nat_gateway_snat_rules(
            ListNatGatewaySnatRulesRequest(nat_gateway_id=[nat_gateway.id])
        ).snat_rules
        <a id="change">if </a>not _snat_rules:
            break
        for _rule in _snat_rules:
            nat_client.delete_nat_gateway_snat_rule(
                DeleteNatGatewaySnatRuleRequest(
                    nat_gateway_id=nat_gateway.id,
                    snat_rule_id=_rule.id)
            )
        <a id="change">time.sleep(1</a><a id="change">)</a>


def _get_workspace_nat(nat_client, workspace_name=None, nat_id=None):
    _nat_name = HWC_WORKSPACE_NAT_NAME.format(</code></pre><h3>After Change</h3><pre><code class='java'>
def _check_and_delete_snat_rules(config, workspace_name):
    nat_client = make_nat_client(config)
    nat_gateways = _get_workspace_nat(nat_client, workspace_name)
    <a id="change">if not nat_gateways</a>:
        cli_logger.print(
            "No NAT gateway found for workspace: {}. Skip deletion.".format(
                workspace_name))</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/oap-project/cloudtik/commit/51af6454f902712603554374df4e60d405ad34e3#diff-c03adc5267db814cacc84fe2731fe9a60446d7f29a1d327cf1adf027e5f8411bL896' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 6506653</div><div id='project'> Project Name: oap-project/cloudtik</div><div id='commit'> Commit Name: 51af6454f902712603554374df4e60d405ad34e3</div><div id='time'> Time: 2023-03-01</div><div id='author'> Author: haifeng.chen@intel.com</div><div id='file'> File Name: python/cloudtik/providers/_private/huaweicloud/config.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: _check_and_delete_snat_rules(2)</div><div id='n_method'> N Method Name: _check_and_delete_snat_rules(2)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: python/cloudtik/providers/_private/huaweicloud/config.py</div><div id='n_file'> N File Name: python/cloudtik/providers/_private/huaweicloud/config.py</div><div id='m_start'> M Start Line: 898</div><div id='m_end'> M End Line: 912</div><div id='n_start'> N Start Line: 980</div><div id='n_end'> N End Line: 991</div><BR>