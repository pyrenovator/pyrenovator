<html><h3>Pattern ID :24306
</h3><img src='75521304.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>

        &#47&#47 checks
        print("check results")
        <a id="change">for </a>(theirs, <a id="change">ours</a>) in <a id="change">zip(</a>[their_out, their_next_h], [our_out, our_next_h]<a id="change">):
            </a>theirs = theirs.detach().cpu().numpy()
            ours<a id="change"> = </a>ours.detach().cpu().numpy()
            if theirs.shape != ours.shape:
                raise AssertionError(f"Prediction shapes are not equal. "
                                     f"Theirs: {theirs.shape}, ours: {ours.shape}")</code></pre><h3>After Change</h3><pre><code class='java'>
        &#47&#47 checks
        print("check results")
        theirs = their_out.detach().cpu().numpy()
        ours = <a id="change">our_out.detach()</a>.cpu().numpy()
        if theirs.shape != ours.shape:
            raise AssertionError(f"Prediction shapes are not equal. "
                                 f"Theirs: {theirs.shape}, ours: {ours.shape}")</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 4</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/ais-bonn/vp-suite/commit/a71498d763c84e72029c5921e390f8dff48fd61d#diff-45a2ebc11f3cb475f5c3614c22590e9db9f054ca016d790066f5e3bbf162cb0aL31' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 75521304</div><div id='project'> Project Name: ais-bonn/vp-suite</div><div id='commit'> Commit Name: a71498d763c84e72029c5921e390f8dff48fd61d</div><div id='time'> Time: 2022-02-11</div><div id='author'> Author: boltres@ais.uni-bonn.de</div><div id='file'> File Name: vp_suite/models/precipitation_nowcasting/_test_impl_match.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: compare_implementations(0)</div><div id='n_method'> N Method Name: compare_implementations(0)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: vp_suite/models/precipitation_nowcasting/_test_impl_match.py</div><div id='n_file'> N File Name: vp_suite/models/precipitation_nowcasting/_test_impl_match.py</div><div id='m_start'> M Start Line: 31</div><div id='m_end'> M End Line: 88</div><div id='n_start'> N Start Line: 31</div><div id='n_end'> N End Line: 89</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        with torch.no_grad():
            start = 0
            if self.iteration &gt; 0:
                <a id="change">for </a>P, <a id="change">V</a> in <a id="change">zip(</a>self.model.parameter_order, self.model.parameter_vector_len<a id="change">):
                    </a>start<a id="change"> += </a>V
            self.current_Y = self.model.full_sample(self.current_state + h).view(-1)
            if self.model.target.has_mask: &#47&#47 fixme something to do with the mask is a problem
                loss = torch.sum(((self.Y - self.current_Y)**2 if self.W is None else ((self.Y - self.current_Y)**2 * self.W))[torch.logical_not(self.mask)]) / self.ndf</code></pre><h3>After Change</h3><pre><code class='java'>
        &#47&#47         self.L = self.L_history[-6:][np.argmax(np.abs(self.rho_history[-6:]))] * np.exp(np.random.normal(loc = 0, scale = 1))
        h = self.update_h_v2()
        if self.verbose &gt; 1:
            print("h: ", <a id="change">h.detach()</a>.cpu().numpy())
        
        with torch.no_grad():
            self.current_Y = self.model.full_sample(self.current_state + h).view(-1)</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/connorstoneastro/autoprof/commit/e7f256bf984d720d18daababa4852f2f7a2f4ac1#diff-52615ad08cfc1cfad1befd14d3c383d34ae33d73e933e1359265221e8731fb61L75' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 75521305</div><div id='project'> Project Name: connorstoneastro/autoprof</div><div id='commit'> Commit Name: e7f256bf984d720d18daababa4852f2f7a2f4ac1</div><div id='time'> Time: 2022-12-13</div><div id='author'> Author: connorstone628@gmail.com</div><div id='file'> File Name: autoprof/fit/lm.py</div><div id='m_class'> M Class Name: LM</div><div id='n_method'> N Class Name: LM</div><div id='m_method'> M Method Name: step_method1(2)</div><div id='n_method'> N Method Name: step_method1(2)</div><div id='m_parent_class'> M Parent Class: BaseOptimizer</div><div id='n_parent_class'> N Parent Class: BaseOptimizer</div><div id='m_file'> M File Name: autoprof/fit/lm.py</div><div id='n_file'> N File Name: autoprof/fit/lm.py</div><div id='m_start'> M Start Line: 91</div><div id='m_end'> M End Line: 161</div><div id='n_start'> N Start Line: 89</div><div id='n_end'> N End Line: 162</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        &#47&#47 get metrics
        metric_dict = {}
        result_list = self._calculate_metrics(trues, preds)
        <a id="change">for </a>metric, <a id="change">value</a> in <a id="change">zip(</a>self.metrics, result_list<a id="change">):
            </a>key = &quot{}&quot.format(metric)
            metric_dict[key]<a id="change"> = </a>round(value, 4)
        return metric_dict

    def _check_args(self):</code></pre><h3>After Change</h3><pre><code class='java'>
        
        true_scores = interaction[self.label_field].to(pred_scores.device)
        assert len(true_scores) == len(pred_scores)
        return torch.stack((true_scores, <a id="change">pred_scores.detach()</a>), dim=1)

    def evaluate(self, batch_matrix_list, *args):
        calculate the metrics of all batches</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/rucaibox/recbole/commit/df66b6285fec567d1f3ca0d6ee9d9ceb71f792b6#diff-2de768da55ecc8221cdf897645992ab100a6e27a2d0302d65e0cf68e552cfd6aL53' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 75521306</div><div id='project'> Project Name: rucaibox/recbole</div><div id='commit'> Commit Name: df66b6285fec567d1f3ca0d6ee9d9ceb71f792b6</div><div id='time'> Time: 2020-10-20</div><div id='author'> Author: 1337990880@qq.com</div><div id='file'> File Name: recbole/evaluator/loss_evaluator.py</div><div id='m_class'> M Class Name: LossEvaluator</div><div id='n_method'> N Class Name: LossEvaluator</div><div id='m_method'> M Method Name: collect(3)</div><div id='n_method'> N Method Name: collect(2)</div><div id='m_parent_class'> M Parent Class: AbstractEvaluator</div><div id='n_parent_class'> N Parent Class: AbstractEvaluator</div><div id='m_file'> M File Name: recbole/evaluator/loss_evaluator.py</div><div id='n_file'> N File Name: recbole/evaluator/loss_evaluator.py</div><div id='m_start'> M Start Line: 63</div><div id='m_end'> M End Line: 74</div><div id='n_start'> N Start Line: 49</div><div id='n_end'> N End Line: 51</div><BR>