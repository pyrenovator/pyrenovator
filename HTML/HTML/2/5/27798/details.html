<html><h3>Pattern ID :27798
</h3><img src='82656108.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
                        
            &#47&#47set decoder input
            index = index % self.voc.num_words
            decoder_input = <a id="change">index.unsqueeze_(1).permute(2</a>,<a id="change">1</a>,<a id="change">0</a><a id="change">)</a>.to(self.device)
        final_captions = final_captions % self.voc.num_words
        caps_text = []
        captions = vfunc(final_captions.cpu().numpy())</code></pre><h3>After Change</h3><pre><code class='java'>
                    
                &#47&#47 add log prob 
                &#47&#47print(decoder_output.size())
                decoder_output = <a id="change">F.softmax(</a>decoder_output<a id="change">,dim=2)</a>
                &#47&#47print(&quotnew size &quot,decoder_output.size())
                tmp = np.log(decoder_output.squeeze(0).cpu().numpy()) + tmp_scores[:,i].view(batch_size,1).cpu().numpy()
                beam_output.append(tmp)
                </code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 4</div><BR><div id='size'>Non-data size: 2</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/nasib104/video-captioning-models-in-pytorch/commit/41c7a23067b54653abc772c3730f2ca3da2bad18#diff-64d5774c7e17bfa41fc7e4d66597ff893917a6a84eced55608c1c89841bb3d13L273' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 82656108</div><div id='project'> Project Name: nasib104/video-captioning-models-in-pytorch</div><div id='commit'> Commit Name: 41c7a23067b54653abc772c3730f2ca3da2bad18</div><div id='time'> Time: 2021-03-22</div><div id='author'> Author: 41543508+nasib104@users.noreply.github.com</div><div id='file'> File Name: models/mean_pooling/model.py</div><div id='m_class'> M Class Name: MeanPooling</div><div id='n_method'> N Class Name: MeanPooling</div><div id='m_method'> M Method Name: BeamDecoding(5)</div><div id='n_method'> N Method Name: BeamDecoding(5)</div><div id='m_parent_class'> M Parent Class: nn.Module</div><div id='n_parent_class'> N Parent Class: nn.Module</div><div id='m_file'> M File Name: models/mean_pooling/model.py</div><div id='n_file'> N File Name: models/mean_pooling/model.py</div><div id='m_start'> M Start Line: 277</div><div id='m_end'> M End Line: 324</div><div id='n_start'> N Start Line: 273</div><div id='n_end'> N End Line: 331</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        b, c, h, w = conv.size()
        assert h == 1, "the height of conv must be 1"
        conv = conv.squeeze(2)
        conv = <a id="change">conv.permute(2</a>, <a id="change">0</a>, <a id="change">1</a><a id="change">)</a>  &#47&#47 [w, b, c]

        &#47&#47 rnn features
        output = self.rnn(conv)</code></pre><h3>After Change</h3><pre><code class='java'>
        &#47&#47 add log_softmax to converge output
        output = F.log_softmax(cls, dim=2)
        if self.return_cls:
            return output, <a id="change">F.softmax(</a>cls, 2<a id="change">)</a>

        return output

</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/pooya-mohammadi/crnn-pytorch/commit/3f16fcac9f51e991f8412b1e1e9b2338f28c8ae7#diff-6a07fa4a58c92e5d1172d4a0ace95b54649fea1a9488be1d9d8cd38b6b7028adL50' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 82656092</div><div id='project'> Project Name: pooya-mohammadi/crnn-pytorch</div><div id='commit'> Commit Name: 3f16fcac9f51e991f8412b1e1e9b2338f28c8ae7</div><div id='time'> Time: 2022-05-10</div><div id='author'> Author: pooyamohammadikazaj@gmail.com</div><div id='file'> File Name: models/crnn.py</div><div id='m_class'> M Class Name: CRNN</div><div id='n_method'> N Class Name: CRNN</div><div id='m_method'> M Method Name: forward(2)</div><div id='n_method'> N Method Name: forward(2)</div><div id='m_parent_class'> M Parent Class: nn.Module</div><div id='n_parent_class'> N Parent Class: nn.Module</div><div id='m_file'> M File Name: models/crnn.py</div><div id='n_file'> N File Name: models/crnn.py</div><div id='m_start'> M Start Line: 52</div><div id='m_end'> M End Line: 62</div><div id='n_start'> N Start Line: 33</div><div id='n_end'> N End Line: 40</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
            &#47&#47 p_cls = F.softmax(p_cls, 2) * p_conf  &#47&#47 SSD-like conf
            p_cls = torch.exp(p_cls).permute((2, 1, 0))
            p_cls = p_cls / p_cls.sum(0).unsqueeze(0) * p_conf.permute((2, 1, 0))  &#47&#47 F.softmax() equivalent
            p_cls = <a id="change">p_cls.permute(2</a>, <a id="change">1</a>, <a id="change">0</a><a id="change">)</a>
            return torch.cat((xy / ngu, wh, p_conf, p_cls), 2).squeeze().t()

        else:  &#47&#47 inference
            &#47&#47 s = 1.5  &#47&#47 scale_xy  (pxy = pxy * s - (s - 1) / 2)</code></pre><h3>After Change</h3><pre><code class='java'>
            xy = torch.sigmoid(p[..., 0:2]) + grid_xy[0]  &#47&#47 x, y
            wh = torch.exp(p[..., 2:4]) * anchor_wh[0]  &#47&#47 width, height
            p_conf = torch.sigmoid(p[:, 4:5])  &#47&#47 Conf
            p_cls = <a id="change">F.softmax(</a>p[:, 5:85], 1<a id="change">)</a> * p_conf  &#47&#47 SSD-like conf
            return torch.cat((xy / ngu[0], wh, p_conf, p_cls), 1).t()

            &#47&#47 p = p.view(1, -1, 5 + self.nc)</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/nightsnack/yolobile/commit/636c1cff7a91c0b54c996ef48b36274b08e4a8b8#diff-dcfeaa5ac3dffd54264034760914588d92fc7395c81eaa9274715840dc28100bL110' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 82656110</div><div id='project'> Project Name: nightsnack/yolobile</div><div id='commit'> Commit Name: 636c1cff7a91c0b54c996ef48b36274b08e4a8b8</div><div id='time'> Time: 2019-08-11</div><div id='author'> Author: glenn.jocher@ultralytics.com</div><div id='file'> File Name: models.py</div><div id='m_class'> M Class Name: YOLOLayer</div><div id='n_method'> N Class Name: YOLOLayer</div><div id='m_method'> M Method Name: forward(4)</div><div id='n_method'> N Method Name: forward(4)</div><div id='m_parent_class'> M Parent Class: nn.Module</div><div id='n_parent_class'> N Parent Class: nn.Module</div><div id='m_file'> M File Name: models.py</div><div id='n_file'> N File Name: models.py</div><div id='m_start'> M Start Line: 126</div><div id='m_end'> M End Line: 147</div><div id='n_start'> N Start Line: 126</div><div id='n_end'> N End Line: 135</div><BR>