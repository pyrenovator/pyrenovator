<html><h3>Pattern ID :41490
</h3><img src='116620146.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
        device = torch.device(&quotcuda:0&quot if cuda else &quotcpu&quot)

        if torch.cuda.device_count() &gt; 1:
            device<a id="change"> = </a><a id="change">torch.device(</a>&quotcuda&quot if cuda else &quotcpu&quot<a id="change">)</a>
            print(&quotFound %g GPUs&quot % torch.cuda.device_count())
            &#47&#47 print(&quotMulti-GPU Issue: https://github.com/ultralytics/yolov3/issues/21&quot)
            &#47&#47 torch.cuda.set_device(0)  &#47&#47 OPTIONAL: Set your GPU if multiple available
            &#47&#47 print(&quotUsing &quot, torch.cuda.device_count(), &quot GPUs&quot)</code></pre><h3>After Change</h3><pre><code class='java'>
    cuda = False if force_cpu else torch.cuda.is_available()
    device = torch.device(&quotcuda:0&quot if cuda else &quotcpu&quot)

    <a id="change">if </a>not cuda:
        <a id="change">print(&quotUsing CPU&quot</a><a id="change">)</a>
    if cuda:
        c = 1024 ** 2  &#47&#47 bytes to MB
        ng = torch.cuda.device_count()
        x = [torch.cuda.get_device_properties(i) for i in range(ng)]</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 4</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/nightsnack/yolobile/commit/3825e99ee36bd237d11f702af93a2acba4496c9b#diff-a4cd44fa2e00ba300e04c8799657a2329509edef8e79a488ccfb3464e7dc4394L11' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 116620146</div><div id='project'> Project Name: nightsnack/yolobile</div><div id='commit'> Commit Name: 3825e99ee36bd237d11f702af93a2acba4496c9b</div><div id='time'> Time: 2019-04-08</div><div id='author'> Author: glenn.jocher@ultralytics.com</div><div id='file'> File Name: utils/torch_utils.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: select_device(1)</div><div id='n_method'> N Method Name: select_device(1)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: utils/torch_utils.py</div><div id='n_file'> N File Name: utils/torch_utils.py</div><div id='m_start'> M Start Line: 11</div><div id='m_end'> M End Line: 25</div><div id='n_start'> N Start Line: 11</div><div id='n_end'> N End Line: 28</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
            if torch.cuda.is_available():
                self.device = torch.device("cuda")
            elif torch.backends.mps.is_available() and torch.backends.mps.is_built():
                self.device<a id="change"> = </a><a id="change">torch.device(</a>"mps"<a id="change">)</a>
            else:
                self.device = torch.device("cpu")
        else:
            self.device = device</code></pre><h3>After Change</h3><pre><code class='java'>
            pass
        elif isinstance(raw_count, ad.AnnData):
            &#47&#47 get ambient profile from AnnData.uns
            <a id="change">if </a>(ambient_profile is None) and ("ambient_profile_all" in raw_count.uns):
                print("Found ambient profile in AnnData.uns[&quotambient_profile_all&quot]")
                ambient_profile = raw_count.uns["ambient_profile_all"]
            elif (ambient_profile is None) and (
                "ambient_profile_all" not in raw_count.uns
            ):
                <a id="change">print(
                    "Ambient profile not found in AnnData.uns[&quotambient_profile&quot], estimating it by averaging pooled cells..."</a><a id="change">
                )</a>
            &#47&#47 convert AnnData to pd.DataFrame
            raw_count = raw_count.to_df()
        else:
            raise TypeError(</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/novartis/scar/commit/3e665696fca90371c5571580921855503805bab5#diff-b2119d621ad5c6fc5288c4bfa993ce5cad3d34819006f0b28539e184b025101bL187' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 116620144</div><div id='project'> Project Name: novartis/scar</div><div id='commit'> Commit Name: 3e665696fca90371c5571580921855503805bab5</div><div id='time'> Time: 2023-03-02</div><div id='author'> Author: 43896555+CaibinSh@users.noreply.github.com</div><div id='file'> File Name: scar/main/_scar.py</div><div id='m_class'> M Class Name: model</div><div id='n_method'> N Class Name: model</div><div id='m_method'> M Method Name: __init__(11)</div><div id='n_method'> N Method Name: __init__(11)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: scar/main/_scar.py</div><div id='n_file'> N File Name: scar/main/_scar.py</div><div id='m_start'> M Start Line: 205</div><div id='m_end'> M End Line: 261</div><div id='n_start'> N Start Line: 206</div><div id='n_end'> N End Line: 278</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
            if torch.cuda.is_available():
                self.device = torch.device("cuda")
            elif torch.backends.mps.is_available() and torch.backends.mps.is_built():
                self.device<a id="change"> = </a><a id="change">torch.device(</a>"mps"<a id="change">)</a>
            else:
                self.device = torch.device("cpu")
        else:
            self.device = device</code></pre><h3>After Change</h3><pre><code class='java'>
            if (ambient_profile is None) and ("ambient_profile_all" in raw_count.uns):
                print("Found ambient profile in AnnData.uns[&quotambient_profile_all&quot]")
                ambient_profile = raw_count.uns["ambient_profile_all"]
            elif <a id="change"></a>(ambient_profile is None) and (
                "ambient_profile_all" not in raw_count.uns
            ):
                <a id="change">print(
                    "Ambient profile not found in AnnData.uns[&quotambient_profile&quot], estimating it by averaging pooled cells..."</a><a id="change">
                )</a>
            &#47&#47 convert AnnData to pd.DataFrame
            raw_count = raw_count.to_df()
        else:
            raise TypeError(</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/novartis/scar/commit/4f5e05fa5bf6aa413287fb2be73d6ad01a3fc9b3#diff-b2119d621ad5c6fc5288c4bfa993ce5cad3d34819006f0b28539e184b025101bL188' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 116620149</div><div id='project'> Project Name: novartis/scar</div><div id='commit'> Commit Name: 4f5e05fa5bf6aa413287fb2be73d6ad01a3fc9b3</div><div id='time'> Time: 2023-03-02</div><div id='author'> Author: caibin.sheng.res@gmail.com</div><div id='file'> File Name: scar/main/_scar.py</div><div id='m_class'> M Class Name: model</div><div id='n_method'> N Class Name: model</div><div id='m_method'> M Method Name: __init__(11)</div><div id='n_method'> N Method Name: __init__(11)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: scar/main/_scar.py</div><div id='n_file'> N File Name: scar/main/_scar.py</div><div id='m_start'> M Start Line: 206</div><div id='m_end'> M End Line: 206</div><div id='n_start'> N Start Line: 206</div><div id='n_end'> N End Line: 272</div><BR>