<html><h3>Pattern ID :12257
</h3><img src='41564799.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
            )

        onnx_runner = OnnxrtRunner(
            SessionFromOnnx(<a id="change">exported_model_path.as_posix()</a>, providers=[self.runtime_provider.value])
        )

        return onnx_runner</code></pre><h3>After Change</h3><pre><code class='java'>
            onnx_model_path = (
                get_package_path(workdir, model_name) / ExportPYT2ONNX().get_output_relative_path()
            ).as_posix()
        elif <a id="change">framework == Framework.TF2</a>:
            from model_navigator.framework_api.commands.convert.tf import ConvertSavedModel2ONNX

            onnx_model_path = (
                get_package_path(workdir, model_name) / ConvertSavedModel2ONNX().get_output_relative_path()
            ).as_posix()
        elif <a id="change"></a>framework == Framework.ONNX:
            &#47&#47 pytype: disable=attribute-error
            onnx_model_path = model.as_posix()
            &#47&#47 pytype: enable=attribute-error
        else:
            <a id="change">raise </a>UserError(f"Unknown framework: {framework.value}")

        onnx_runner = OnnxrtRunner(SessionFromOnnx(onnx_model_path, providers=[self.runtime_provider.value]))
</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 5</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/triton-inference-server/model_navigator/commit/7ac1a1b6dedca92c428c29c9f408625b44d00b70#diff-8864e03cfc8e0b7526f164aad2ad15179bdee9a05be51d9330290b7071e39f76L38' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 41564799</div><div id='project'> Project Name: triton-inference-server/model_navigator</div><div id='commit'> Commit Name: 7ac1a1b6dedca92c428c29c9f408625b44d00b70</div><div id='time'> Time: 2022-04-07</div><div id='author'> Author: kkleczewski@nvidia.com</div><div id='file'> File Name: model_navigator/framework_api/commands/performance/onnx.py</div><div id='m_class'> M Class Name: PerformanceONNX</div><div id='n_method'> N Class Name: PerformanceONNX</div><div id='m_method'> M Method Name: _get_runner(6)</div><div id='n_method'> N Method Name: _get_runner(5)</div><div id='m_parent_class'> M Parent Class: PerformanceBase</div><div id='n_parent_class'> N Parent Class: PerformanceBase</div><div id='m_file'> M File Name: model_navigator/framework_api/commands/performance/onnx.py</div><div id='n_file'> N File Name: model_navigator/framework_api/commands/performance/onnx.py</div><div id='m_start'> M Start Line: 46</div><div id='m_end'> M End Line: 55</div><div id='n_start'> N Start Line: 38</div><div id='n_end'> N End Line: 64</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        converted_model_path.parent.mkdir(parents=True, exist_ok=True)

        with UserErrorContext():
            onnx_runner = OnnxrtRunner(SessionFromOnnx(<a id="change">exported_model_path.as_posix()</a>, providers=[target_device]))
            with onnx_runner:
                onnx_input_metadata = onnx_runner.get_input_metadata()
</code></pre><h3>After Change</h3><pre><code class='java'>
            input_model_path = (
                get_package_path(workdir, model_name) / ExportPYT2ONNX().get_output_relative_path()
            ).as_posix()
        elif <a id="change">framework == Framework.TF2</a>:
            from model_navigator.framework_api.commands.convert.tf import ConvertSavedModel2ONNX

            input_model_path = (
                get_package_path(workdir, model_name) / ConvertSavedModel2ONNX().get_output_relative_path()
            ).as_posix()
        elif <a id="change"></a>framework == Framework.ONNX:  &#47&#47 ONNX
            &#47&#47 pytype: disable=attribute-error
            input_model_path = model.as_posix()
            &#47&#47 pytype: enable=attribute-error
        else:
            <a id="change">raise </a>UserError(f"Unknown framework: {framework.value}")
        converted_model_path = get_package_path(workdir, model_name) / self.get_output_relative_path()

        if converted_model_path.is_file() or converted_model_path.is_dir():</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/triton-inference-server/model_navigator/commit/7ac1a1b6dedca92c428c29c9f408625b44d00b70#diff-f1d2411e6c7d4c1bf29d62db0574fa2c92ac491252386daa22a36a8bf548f868L52' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 41564802</div><div id='project'> Project Name: triton-inference-server/model_navigator</div><div id='commit'> Commit Name: 7ac1a1b6dedca92c428c29c9f408625b44d00b70</div><div id='time'> Time: 2022-04-07</div><div id='author'> Author: kkleczewski@nvidia.com</div><div id='file'> File Name: model_navigator/framework_api/commands/convert/onnx.py</div><div id='m_class'> M Class Name: ConvertONNX2TRT</div><div id='n_method'> N Class Name: ConvertONNX2TRT</div><div id='m_method'> M Method Name: __call__(10)</div><div id='n_method'> N Method Name: __call__(9)</div><div id='m_parent_class'> M Parent Class: Command</div><div id='n_parent_class'> N Parent Class: Command</div><div id='m_file'> M File Name: model_navigator/framework_api/commands/convert/onnx.py</div><div id='n_file'> N File Name: model_navigator/framework_api/commands/convert/onnx.py</div><div id='m_start'> M Start Line: 68</div><div id='m_end'> M End Line: 86</div><div id='n_start'> N Start Line: 59</div><div id='n_end'> N End Line: 95</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
            fs.open(Path(dest_dataset_dict_path, config.DATASETDICT_JSON_FILENAME).as_posix(), "w", encoding="utf-8"),
        )
        for k, dataset in self.items():
            dataset.save_to_disk(<a id="change">Path(dest_dataset_dict_path, k).as_posix()</a>, fs)

    @staticmethod
    def load_from_disk(dataset_dict_path: str, fs=None, keep_in_memory: Optional[bool] = None) -&gt; "DatasetDict":</code></pre><h3>After Change</h3><pre><code class='java'>
        is_local = not is_remote_filesystem(fs)
        path_join = os.path.join if is_local else posixpath.join

        <a id="change">if num_shards is None</a>:
            num_shards = {k: None for k in self}
        elif <a id="change"></a>not isinstance(num_shards, dict):
            <a id="change">raise </a>ValueError(
                "Please provide one `num_shards` per dataset in the dataset dictionary, e.g. {{&quottrain&quot: 128, &quottest&quot: 4}}"
            )
</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/huggingface/datasets/commit/232a43943e87dfedcc328a9a3d3b4d89ea5c6627#diff-a03fe8c218f22c8b26cc51f588cf5466c27f433373033d8724f66f996c2beda8L1099' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 41564804</div><div id='project'> Project Name: huggingface/datasets</div><div id='commit'> Commit Name: 232a43943e87dfedcc328a9a3d3b4d89ea5c6627</div><div id='time'> Time: 2022-12-14</div><div id='author'> Author: 42851186+lhoestq@users.noreply.github.com</div><div id='file'> File Name: src/datasets/dataset_dict.py</div><div id='m_class'> M Class Name: DatasetDict</div><div id='n_method'> N Class Name: DatasetDict</div><div id='m_method'> M Method Name: save_to_disk(7)</div><div id='n_method'> N Method Name: save_to_disk(3)</div><div id='m_parent_class'> M Parent Class: dict</div><div id='n_parent_class'> N Parent Class: dict</div><div id='m_file'> M File Name: src/datasets/dataset_dict.py</div><div id='n_file'> N File Name: src/datasets/dataset_dict.py</div><div id='m_start'> M Start Line: 1099</div><div id='m_end'> M End Line: 1146</div><div id='n_start'> N Start Line: 1101</div><div id='n_end'> N End Line: 1194</div><BR>