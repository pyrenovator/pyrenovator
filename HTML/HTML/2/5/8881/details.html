<html><h3>Pattern ID :8881
</h3><img src='32595651.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
                if isinstance(memory_allocation.dtype, ch.dtype):
                    result = []
                    for _ in range(final_shape[0]):
                        partial = ch.empty(*<a id="change">final_shape[1:]</a>,
                                          dtype=memory_allocation.dtype,
                                          device=memory_allocation.device)
                        try:</code></pre><h3>After Change</h3><pre><code class='java'>
                                                            batch_size,
                                                            batches_ahead)
            elif isinstance(memory_allocation, Sequence):
                allocated_buffer<a id="change"> = </a><a id="change">tuple(
                    </a>self<a id="change">.allocate_query(q, batch_size, batches_ahead) for q in memory_allocation
                )</a>

            memory_buffers[op_id] = allocated_buffer

</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 4</div><BR><div id='size'>Non-data size: 4</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/libffcv/ffcv/commit/1e28d9884436db64131ee02d545d2c5374f19dc9#diff-e775b66b9cf24bfa0524d7edbf465b5ca12846f195123573855b4d62e63670e3L70' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 32595651</div><div id='project'> Project Name: libffcv/ffcv</div><div id='commit'> Commit Name: 1e28d9884436db64131ee02d545d2c5374f19dc9</div><div id='time'> Time: 2021-11-13</div><div id='author'> Author: leclerc@mit.edu</div><div id='file'> File Name: ffcv/pipeline/pipeline.py</div><div id='m_class'> M Class Name: Pipeline</div><div id='n_method'> N Class Name: Pipeline</div><div id='m_method'> M Method Name: allocate_memory(3)</div><div id='n_method'> N Method Name: allocate_memory(3)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: ffcv/pipeline/pipeline.py</div><div id='n_file'> N File Name: ffcv/pipeline/pipeline.py</div><div id='m_start'> M Start Line: 70</div><div id='m_end'> M End Line: 105</div><div id='n_start'> N Start Line: 100</div><div id='n_end'> N End Line: 112</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
            context = tuple(parts[1:-2])
            token = parts[-2]
            backoff = float(parts[-1])
        elif len(<a id="change">parts[1:]</a>) == order:
            context = tuple(parts[1:-1])
            token = parts[-1]
            backoff = 0.0</code></pre><h3>After Change</h3><pre><code class='java'>
        line = line.strip()
        if not line:
            break
        all_parts<a id="change"> = </a><a id="change">tuple(</a>line.split()<a id="change">)</a>
        prob = float(all_parts[0])
        if len(all_parts) == backoff_line_length:
            context = all_parts[1:-2]
            token = all_parts[-2]</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/speechbrain/speechbrain/commit/b4a9d07f14534ca3812650fbac6daddbab24e11c#diff-7b78e922f706b37671c299e8e1131f995e7827812005a64717b8d1485b574cf3L75' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 32595653</div><div id='project'> Project Name: speechbrain/speechbrain</div><div id='commit'> Commit Name: b4a9d07f14534ca3812650fbac6daddbab24e11c</div><div id='time'> Time: 2020-05-26</div><div id='author'> Author: aku.rouhe@aalto.fi</div><div id='file'> File Name: speechbrain/lm/arpa.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: read_ngrams_section(2)</div><div id='n_method'> N Method Name: read_ngrams_section(2)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: speechbrain/lm/arpa.py</div><div id='n_file'> N File Name: speechbrain/lm/arpa.py</div><div id='m_start'> M Start Line: 79</div><div id='m_end'> M End Line: 99</div><div id='n_start'> N Start Line: 180</div><div id='n_end'> N End Line: 200</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
            ngram = tuple(parts[1:-1])
            backoff = float(parts[-1])
        elif len(parts[1:]) == order:
            ngram = tuple(<a id="change">parts[1:]</a>)
            backoff = 0.0
        else:
            raise ValueError("Not a properly formatted ARPA file")</code></pre><h3>After Change</h3><pre><code class='java'>
        parts = line.strip().split()
        prob = float(parts[0])
        if len(parts[1:]) == order + 1:
            context<a id="change"> = </a><a id="change">tuple(</a>parts[1:-2]<a id="change">)</a>
            token = parts[-2]
            backoff = float(parts[-1])
        elif len(parts[1:]) == order:
            context = tuple(parts[1:-1])</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/speechbrain/speechbrain/commit/4bf0b4e0a864cf1beeb97bf43633deffd3b359fc#diff-7b78e922f706b37671c299e8e1131f995e7827812005a64717b8d1485b574cf3L69' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 32595657</div><div id='project'> Project Name: speechbrain/speechbrain</div><div id='commit'> Commit Name: 4bf0b4e0a864cf1beeb97bf43633deffd3b359fc</div><div id='time'> Time: 2020-05-15</div><div id='author'> Author: aku.rouhe@aalto.fi</div><div id='file'> File Name: speechbrain/lm/arpa.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: read_ngrams_section(2)</div><div id='n_method'> N Method Name: read_ngrams_section(2)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: speechbrain/lm/arpa.py</div><div id='n_file'> N File Name: speechbrain/lm/arpa.py</div><div id='m_start'> M Start Line: 73</div><div id='m_end'> M End Line: 88</div><div id='n_start'> N Start Line: 75</div><div id='n_end'> N End Line: 95</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
      global_size = [C.bs*C.cout, C.oy, C.ox]
      assert bufs[0][0] == "input" and bufs[1][0] == "weight"
      assert bufs[0][1].st.contiguous and bufs[1][1].st.contiguous
      ewbufs = <a id="change">bufs[2:]</a>   &#47&#47 input and weight are consumed by the convs
      kernel_name = "conv"
      conv_src = 
      int B = gid/(groups*rcout);  // range 0-bs</code></pre><h3>After Change</h3><pre><code class='java'>
      global_size = [C.bs*C.cout, C.oy, C.ox]

      &#47&#47 now input and weight can be anywhere in bufs
      convbufs_contig<a id="change"> = </a><a id="change">tuple(</a>x<a id="change">[1].st.contiguous for x in bufs if x[0] in ["input", "weight"])</a>
      assert convbufs_contig == (True, True), "input and weight missing or not contiguous"
      ewbufs = [x for x in bufs if x[0] not in ["input", "weight"]]

      kernel_name = "conv"</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/geohot/tinygrad/commit/a61a4d09ad05e8256c777119bfde627a53b46f31#diff-305e94e84668440e8f8a2a4e17d5796e43233474510c7af082ab29c9aa824eeeL150' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 32595658</div><div id='project'> Project Name: geohot/tinygrad</div><div id='commit'> Commit Name: a61a4d09ad05e8256c777119bfde627a53b46f31</div><div id='time'> Time: 2022-07-06</div><div id='author'> Author: geohot@gmail.com</div><div id='file'> File Name: tinygrad/llops/ops_gpu.py</div><div id='m_class'> M Class Name: GPUBuffer</div><div id='n_method'> N Class Name: GPUBuffer</div><div id='m_method'> M Method Name: _processing_op(4)</div><div id='n_method'> N Method Name: _processing_op(4)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: tinygrad/llops/ops_gpu.py</div><div id='n_file'> N File Name: tinygrad/llops/ops_gpu.py</div><div id='m_start'> M Start Line: 155</div><div id='m_end'> M End Line: 157</div><div id='n_start'> N Start Line: 157</div><div id='n_end'> N End Line: 159</div><BR>