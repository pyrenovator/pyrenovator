<html><h3>Pattern ID :19804
</h3><img src='64507821.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>


def get_command(id: str) -&gt; Any:
    <a id="change">auth.initialize_session(</a><a id="change">conf.make_master_url(), try_reauth=True)</a>
    r = api.get(conf.make_master_url(), "api/v1/commands/" + id)
    assert r.status_code == requests.codes.ok, r.text
    return r.json()["command"]
</code></pre><h3>After Change</h3><pre><code class='java'>


def get_command(id: str) -&gt; Any:
    authentication.cli_auth<a id="change"> = authentication.Authentication(</a><a id="change">conf.make_master_url(), try_reauth=True)</a>
    r = api.get(conf.make_master_url(), "api/v1/commands/" + id)
    assert r.status_code == requests.codes.ok, r.text
    return r.json()["command"]
</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 6</div><BR><div id='size'>Non-data size: 5</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/determined-ai/determined/commit/ccdcaa8b4716714f231c79aa7e6ba7ea6dcfcd54#diff-97155e1c2b541c17dc3ad2548d8fdb276230a59583de5493f9932e7d7b752168L92' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 64507821</div><div id='project'> Project Name: determined-ai/determined</div><div id='commit'> Commit Name: ccdcaa8b4716714f231c79aa7e6ba7ea6dcfcd54</div><div id='time'> Time: 2021-06-08</div><div id='author'> Author: rb@determined.ai</div><div id='file'> File Name: e2e_tests/tests/command/command.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: get_command(1)</div><div id='n_method'> N Method Name: get_command(1)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: e2e_tests/tests/command/command.py</div><div id='n_file'> N File Name: e2e_tests/tests/command/command.py</div><div id='m_start'> M Start Line: 92</div><div id='m_end'> M End Line: 92</div><div id='n_start'> N Start Line: 92</div><div id='n_end'> N End Line: 92</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
@pytest.mark.e2e_cpu  &#47&#47 type: ignore
@pytest.mark.timeout(600)  &#47&#47 type: ignore
def test_streaming_metrics_api() -&gt; None:
    <a id="change">auth.initialize_session(</a><a id="change">conf.make_master_url(), try_reauth=True)</a>

    pool = mp.pool.ThreadPool(processes=7)

    experiment_id = exp.create_experiment(</code></pre><h3>After Change</h3><pre><code class='java'>
@pytest.mark.e2e_cpu  &#47&#47 type: ignore
@pytest.mark.timeout(600)  &#47&#47 type: ignore
def test_streaming_metrics_api() -&gt; None:
    authentication.cli_auth<a id="change"> = authentication.Authentication(</a><a id="change">conf.make_master_url(), try_reauth=True)</a>

    pool = mp.pool.ThreadPool(processes=7)

    experiment_id = exp.create_experiment(</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/determined-ai/determined/commit/ccdcaa8b4716714f231c79aa7e6ba7ea6dcfcd54#diff-c6ff236167803d57bd5d7f775e73afa3da5cced78506545558296eecde29eb2cL15' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 64507822</div><div id='project'> Project Name: determined-ai/determined</div><div id='commit'> Commit Name: ccdcaa8b4716714f231c79aa7e6ba7ea6dcfcd54</div><div id='time'> Time: 2021-06-08</div><div id='author'> Author: rb@determined.ai</div><div id='file'> File Name: e2e_tests/tests/experiment/test_metrics.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: test_streaming_metrics_api(0)</div><div id='n_method'> N Method Name: test_streaming_metrics_api(0)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: e2e_tests/tests/experiment/test_metrics.py</div><div id='n_file'> N File Name: e2e_tests/tests/experiment/test_metrics.py</div><div id='m_start'> M Start Line: 16</div><div id='m_end'> M End Line: 16</div><div id='n_start'> N Start Line: 16</div><div id='n_end'> N End Line: 16</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
@pytest.mark.distributed  &#47&#47 type: ignore
@pytest.mark.timeout(1800)  &#47&#47 type: ignore
def test_hp_importance_api() -&gt; None:
    <a id="change">auth.initialize_session(</a><a id="change">conf.make_master_url(), try_reauth=True)</a>

    pool = mp.pool.ThreadPool(processes=1)

    experiment_id = exp.create_experiment(</code></pre><h3>After Change</h3><pre><code class='java'>
@pytest.mark.distributed  &#47&#47 type: ignore
@pytest.mark.timeout(1800)  &#47&#47 type: ignore
def test_hp_importance_api() -&gt; None:
    authentication.cli_auth<a id="change"> = authentication.Authentication(</a><a id="change">conf.make_master_url(), try_reauth=True)</a>

    pool = mp.pool.ThreadPool(processes=1)

    experiment_id = exp.create_experiment(</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/determined-ai/determined/commit/ccdcaa8b4716714f231c79aa7e6ba7ea6dcfcd54#diff-c6ff236167803d57bd5d7f775e73afa3da5cced78506545558296eecde29eb2cL65' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 64507823</div><div id='project'> Project Name: determined-ai/determined</div><div id='commit'> Commit Name: ccdcaa8b4716714f231c79aa7e6ba7ea6dcfcd54</div><div id='time'> Time: 2021-06-08</div><div id='author'> Author: rb@determined.ai</div><div id='file'> File Name: e2e_tests/tests/experiment/test_metrics.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: test_hp_importance_api(0)</div><div id='n_method'> N Method Name: test_hp_importance_api(0)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: e2e_tests/tests/experiment/test_metrics.py</div><div id='n_file'> N File Name: e2e_tests/tests/experiment/test_metrics.py</div><div id='m_start'> M Start Line: 66</div><div id='m_end'> M End Line: 66</div><div id='n_start'> N Start Line: 66</div><div id='n_end'> N End Line: 66</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>


def get_num_running_commands() -&gt; int:
    <a id="change">auth.initialize_session(</a><a id="change">conf.make_master_url(), try_reauth=True)</a>
    r = api.get(conf.make_master_url(), "api/v1/commands")
    assert r.status_code == requests.codes.ok, r.text

    return len([command for command in r.json()["commands"] if command["state"] == "STATE_RUNNING"])</code></pre><h3>After Change</h3><pre><code class='java'>


def get_num_running_commands() -&gt; int:
    authentication.cli_auth<a id="change"> = authentication.Authentication(</a><a id="change">conf.make_master_url(), try_reauth=True)</a>
    r = api.get(conf.make_master_url(), "api/v1/commands")
    assert r.status_code == requests.codes.ok, r.text

    return len([command for command in r.json()["commands"] if command["state"] == "STATE_RUNNING"])</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/determined-ai/determined/commit/ccdcaa8b4716714f231c79aa7e6ba7ea6dcfcd54#diff-97155e1c2b541c17dc3ad2548d8fdb276230a59583de5493f9932e7d7b752168L83' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 64507824</div><div id='project'> Project Name: determined-ai/determined</div><div id='commit'> Commit Name: ccdcaa8b4716714f231c79aa7e6ba7ea6dcfcd54</div><div id='time'> Time: 2021-06-08</div><div id='author'> Author: rb@determined.ai</div><div id='file'> File Name: e2e_tests/tests/command/command.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: get_num_running_commands(0)</div><div id='n_method'> N Method Name: get_num_running_commands(0)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: e2e_tests/tests/command/command.py</div><div id='n_file'> N File Name: e2e_tests/tests/command/command.py</div><div id='m_start'> M Start Line: 84</div><div id='m_end'> M End Line: 84</div><div id='n_start'> N Start Line: 84</div><div id='n_end'> N End Line: 84</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>


def num_agents() -&gt; int:
    <a id="change">auth.initialize_session(</a><a id="change">conf.make_master_url(), try_reauth=True)</a>
    r = api.get(conf.make_master_url(), "agents")
    assert r.status_code == requests.codes.ok, r.text

    return len(r.json())</code></pre><h3>After Change</h3><pre><code class='java'>


def num_agents() -&gt; int:
    authentication.cli_auth<a id="change"> = authentication.Authentication(</a><a id="change">conf.make_master_url(), try_reauth=True)</a>
    r = api.get(conf.make_master_url(), "agents")
    assert r.status_code == requests.codes.ok, r.text

    return len(r.json())</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/determined-ai/determined/commit/ccdcaa8b4716714f231c79aa7e6ba7ea6dcfcd54#diff-1ee0525e1aa8a783853c942824287dc0da4889cf357468f20e89eedeaf93ee45L69' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 64507825</div><div id='project'> Project Name: determined-ai/determined</div><div id='commit'> Commit Name: ccdcaa8b4716714f231c79aa7e6ba7ea6dcfcd54</div><div id='time'> Time: 2021-06-08</div><div id='author'> Author: rb@determined.ai</div><div id='file'> File Name: e2e_tests/tests/cluster/cluster.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: num_agents(0)</div><div id='n_method'> N Method Name: num_agents(0)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: e2e_tests/tests/cluster/cluster.py</div><div id='n_file'> N File Name: e2e_tests/tests/cluster/cluster.py</div><div id='m_start'> M Start Line: 70</div><div id='m_end'> M End Line: 70</div><div id='n_start'> N Start Line: 70</div><div id='n_end'> N End Line: 70</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
    cluster_slots returns a dict of slots that each agent has.
    :return:  Dict[AgentID, List[Slot]]
    
    <a id="change">auth.initialize_session(</a><a id="change">conf.make_master_url(), try_reauth=True)</a>
    r = api.get(conf.make_master_url(), "agents")
    assert r.status_code == requests.codes.ok, r.text
    json = r.json()  &#47&#47 type: Dict[str, Any]
    return {agent["id"]: agent["slots"].values() for agent in json.values()}</code></pre><h3>After Change</h3><pre><code class='java'>
    cluster_slots returns a dict of slots that each agent has.
    :return:  Dict[AgentID, List[Slot]]
    
    authentication.cli_auth<a id="change"> = authentication.Authentication(</a><a id="change">conf.make_master_url(), try_reauth=True)</a>
    r = api.get(conf.make_master_url(), "agents")
    assert r.status_code == requests.codes.ok, r.text
    json = r.json()  &#47&#47 type: Dict[str, Any]
    return {agent["id"]: agent["slots"].values() for agent in json.values()}</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/determined-ai/determined/commit/ccdcaa8b4716714f231c79aa7e6ba7ea6dcfcd54#diff-1ee0525e1aa8a783853c942824287dc0da4889cf357468f20e89eedeaf93ee45L17' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 64507826</div><div id='project'> Project Name: determined-ai/determined</div><div id='commit'> Commit Name: ccdcaa8b4716714f231c79aa7e6ba7ea6dcfcd54</div><div id='time'> Time: 2021-06-08</div><div id='author'> Author: rb@determined.ai</div><div id='file'> File Name: e2e_tests/tests/cluster/cluster.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: cluster_slots(0)</div><div id='n_method'> N Method Name: cluster_slots(0)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: e2e_tests/tests/cluster/cluster.py</div><div id='n_file'> N File Name: e2e_tests/tests/cluster/cluster.py</div><div id='m_start'> M Start Line: 22</div><div id='m_end'> M End Line: 22</div><div id='n_start'> N Start Line: 22</div><div id='n_end'> N End Line: 22</div><BR>