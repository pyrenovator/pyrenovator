<html><h3>Pattern ID :29841
</h3><img src='88338115.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
                    f&quotconnected to {self.args.host}:{self.args.port_expose}&quot
                )

                <a id="change">if self.show_progress</a>:
                    <a id="change">cm1</a><a id="change">, cm2</a> = <a id="change">ProgressBar(), TimeContext(&quot&quot)</a>
                else:
                    <a id="change">cm1</a><a id="change">, cm2</a> = <a id="change">nullcontext(), nullcontext()</a>

                with cm1 as p_bar, <a id="change">cm2</a>:
                    async for resp in stub.Call(req_iter):
                        resp.as_typed_request(resp.request_type)
                        resp = resp.as_response()</code></pre><h3>After Change</h3><pre><code class='java'>
                    f&quotconnected to {self.args.host}:{self.args.port_expose}&quot
                )

                cm1 = <a id="change">ProgressBar() if </a><a id="change">self.show_progress else nullcontext()</a>

                with cm1 as p_bar:
                    async for resp in stub.Call(req_iter):
                        resp.as_typed_request(resp.request_type)</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 13</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/jina-ai/jina/commit/454037855c2bce4ffe14d18f043ce113edadfd7f#diff-1707ed37aa62d701b2eb3af22a4ae2385f8d1e9806f4642b0de1026ceb9691ecL48' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 88338115</div><div id='project'> Project Name: jina-ai/jina</div><div id='commit'> Commit Name: 454037855c2bce4ffe14d18f043ce113edadfd7f</div><div id='time'> Time: 2021-06-25</div><div id='author'> Author: artex.xh@gmail.com</div><div id='file'> File Name: jina/clients/base/grpc.py</div><div id='m_class'> M Class Name: GRPCBaseClient</div><div id='n_method'> N Class Name: GRPCBaseClient</div><div id='m_method'> M Method Name: _get_results(5)</div><div id='n_method'> N Method Name: _get_results(5)</div><div id='m_parent_class'> M Parent Class: BaseClient</div><div id='n_parent_class'> N Parent Class: BaseClient</div><div id='m_file'> M File Name: jina/clients/base/grpc.py</div><div id='n_file'> N File Name: jina/clients/base/grpc.py</div><div id='m_start'> M Start Line: 48</div><div id='m_end'> M End Line: 68</div><div id='n_start'> N Start Line: 48</div><div id='n_end'> N End Line: 65</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
                    f&quotconnected to {self.args.host}:{self.args.port_expose}&quot
                )

                <a id="change">if self.show_progress</a>:
                    cm1<a id="change">, cm2</a> = <a id="change">ProgressBar(), TimeContext(&quot&quot)</a>
                else:
                    cm1<a id="change">, cm2</a> = <a id="change">nullcontext(), nullcontext()</a>

                with cm1 as p_bar, <a id="change">cm2</a>:
                    async for resp in stub.Call(req_iter):
                        resp.as_typed_request(resp.request_type)
                        resp = resp.as_response()</code></pre><h3>After Change</h3><pre><code class='java'>
                    f&quotconnected to {self.args.host}:{self.args.port_expose}&quot
                )

                cm1 = <a id="change">ProgressBar() if </a><a id="change">self.show_progress else nullcontext()</a>

                with cm1 as p_bar:
                    async for resp in stub.Call(req_iter):
                        resp.as_typed_request(resp.request_type)</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/jina-ai/jina/commit/454037855c2bce4ffe14d18f043ce113edadfd7f#diff-1707ed37aa62d701b2eb3af22a4ae2385f8d1e9806f4642b0de1026ceb9691ecL25' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 88338114</div><div id='project'> Project Name: jina-ai/jina</div><div id='commit'> Commit Name: 454037855c2bce4ffe14d18f043ce113edadfd7f</div><div id='time'> Time: 2021-06-25</div><div id='author'> Author: artex.xh@gmail.com</div><div id='file'> File Name: jina/clients/base/grpc.py</div><div id='m_class'> M Class Name: GRPCBaseClient</div><div id='n_method'> N Class Name: GRPCBaseClient</div><div id='m_method'> M Method Name: _get_results(5)</div><div id='n_method'> N Method Name: _get_results(5)</div><div id='m_parent_class'> M Parent Class: BaseClient</div><div id='n_parent_class'> N Parent Class: BaseClient</div><div id='m_file'> M File Name: jina/clients/base/grpc.py</div><div id='n_file'> N File Name: jina/clients/base/grpc.py</div><div id='m_start'> M Start Line: 48</div><div id='m_end'> M End Line: 68</div><div id='n_start'> N Start Line: 48</div><div id='n_end'> N End Line: 65</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
                        &#47&#47 There is nothing to send, disconnect gracefully
                        await websocket.close(reason=&quotNo data to send&quot)

                <a id="change">if self.show_progress</a>:
                    cm1<a id="change">, cm2</a> = <a id="change">ProgressBar(), TimeContext(&quot&quot)</a>
                else:
                    cm1<a id="change">, cm2</a> = <a id="change">nullcontext(), nullcontext()</a>

                with cm1 as p_bar, <a id="change">cm2</a>:
                    &#47&#47 Unlike gRPC, any arbitrary function (generator) cannot be passed via websockets.
                    &#47&#47 Simply iterating through the `req_iter` makes the request-response sequential.
                    &#47&#47 To make client unblocking, :func:`send_requests` and `recv_responses` are separate tasks</code></pre><h3>After Change</h3><pre><code class='java'>
                        &#47&#47 There is nothing to send, disconnect gracefully
                        await websocket.close(reason=&quotNo data to send&quot)

                cm1 = <a id="change">ProgressBar() if </a><a id="change">self.show_progress else nullcontext()</a>

                with cm1 as p_bar:
                    &#47&#47 Unlike gRPC, any arbitrary function (generator) cannot be passed via websockets.
                    &#47&#47 Simply iterating through the `req_iter` makes the request-response sequential.</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/jina-ai/jina/commit/454037855c2bce4ffe14d18f043ce113edadfd7f#diff-1e76e0aa58b7b7e1ccdef9138cf231d322a78c200f7e274c9efc6585362591b5L16' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 88338113</div><div id='project'> Project Name: jina-ai/jina</div><div id='commit'> Commit Name: 454037855c2bce4ffe14d18f043ce113edadfd7f</div><div id='time'> Time: 2021-06-25</div><div id='author'> Author: artex.xh@gmail.com</div><div id='file'> File Name: jina/clients/base/websocket.py</div><div id='m_class'> M Class Name: WebSocketBaseClient</div><div id='n_method'> N Class Name: WebSocketBaseClient</div><div id='m_method'> M Method Name: _get_results(5)</div><div id='n_method'> N Method Name: _get_results(5)</div><div id='m_parent_class'> M Parent Class: BaseClient</div><div id='n_parent_class'> N Parent Class: BaseClient</div><div id='m_file'> M File Name: jina/clients/base/websocket.py</div><div id='n_file'> N File Name: jina/clients/base/websocket.py</div><div id='m_start'> M Start Line: 70</div><div id='m_end'> M End Line: 103</div><div id='n_start'> N Start Line: 70</div><div id='n_end'> N End Line: 100</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>

        req_iter = self._get_requests(**kwargs)
        async with aiohttp.ClientSession() as session:
            <a id="change">if self.show_progress</a>:
                cm1<a id="change">, cm2</a> = <a id="change">ProgressBar(), TimeContext(&quot&quot)</a>
            else:
                cm1<a id="change">, cm2</a> = <a id="change">nullcontext(), nullcontext()</a>
            try:
                with cm1 as p_bar, <a id="change">cm2</a>:
                    all_responses = []
                    for req in req_iter:
                        &#47&#47 fix the mismatch between pydantic model and Protobuf model</code></pre><h3>After Change</h3><pre><code class='java'>
        async with aiohttp.ClientSession() as session:

            try:
                cm1 = <a id="change">ProgressBar() if </a><a id="change">self.show_progress else nullcontext()</a>

                with cm1 as p_bar:
                    all_responses = []
                    for req in req_iter:</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/jina-ai/jina/commit/454037855c2bce4ffe14d18f043ce113edadfd7f#diff-85f0eb5c63717161fc010675143a538088c294c1f332471fa9509c4a12616aebL24' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 88338117</div><div id='project'> Project Name: jina-ai/jina</div><div id='commit'> Commit Name: 454037855c2bce4ffe14d18f043ce113edadfd7f</div><div id='time'> Time: 2021-06-25</div><div id='author'> Author: artex.xh@gmail.com</div><div id='file'> File Name: jina/clients/base/http.py</div><div id='m_class'> M Class Name: HTTPBaseClient</div><div id='n_method'> N Class Name: HTTPBaseClient</div><div id='m_method'> M Method Name: _get_results(5)</div><div id='n_method'> N Method Name: _get_results(5)</div><div id='m_parent_class'> M Parent Class: BaseClient</div><div id='n_parent_class'> N Parent Class: BaseClient</div><div id='m_file'> M File Name: jina/clients/base/http.py</div><div id='n_file'> N File Name: jina/clients/base/http.py</div><div id='m_start'> M Start Line: 60</div><div id='m_end'> M End Line: 103</div><div id='n_start'> N Start Line: 62</div><div id='n_end'> N End Line: 102</div><BR>