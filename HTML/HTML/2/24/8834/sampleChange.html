<link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
        crop_img = np.array(letterbox_image(image, self.image_size))
        photo = np.array(crop_img,dtype = np.float32)
        photo = np.transpose(preprocess_input(photo), (2, 0, 1))
        <a id="change">images</a><a id="change"> = </a><a id="change">[]</a>
        <a id="change">images.append(</a>photo<a id="change">)</a>
        images<a id="change"> = </a><a id="change">np.asarray(images</a><a id="change">)</a>

        <a id="change">with torch</a><a id="change">.no_grad():
            </a>images<a id="change"> = </a>torch.from_numpy(images)
            <a id="change">if </a>self.cuda:
                images = images.cuda()
            _<a id="change">, regression, classification, anchors = </a>self.net(images)
            
            regression<a id="change"> = </a>decodebox(regression, anchors, images)
            detection<a id="change"> = </a>torch.cat([regression,classification],axis=-1)
            batch_detections<a id="change"> = </a>non_max_suppression(detection, len(self.class_names),
                                                    conf_thres=self.confidence,
                                                    nms_thres=self.iou)
        try:</code></pre><h3>After Change</h3><pre><code class='java'>
        photo = np.array(crop_img,dtype = np.float32)
        photo = np.transpose(preprocess_input(photo), (2, 0, 1))

        <a id="change">with torch</a><a id="change">.no_grad():
            </a>images<a id="change"> = </a>torch.from_numpy(<a id="change">np.asarray([</a>photo<a id="change"></a>]<a id="change">)</a>)
            <a id="change">if </a>self.cuda:
                images = images.cuda()

            &#47&#47---------------------------------------------------------&#47&#47
            &#47&#47   传入网络当中进行预测
            &#47&#47---------------------------------------------------------&#47&#47
            _<a id="change">, regression, classification, anchors = </a>self.net(images)
            
            &#47&#47-----------------------------------------------------------&#47&#47
            &#47&#47   将预测结果进行解码
            &#47&#47-----------------------------------------------------------&#47&#47
            regression<a id="change"> = </a>decodebox(regression, anchors, images)
            detection<a id="change"> = </a>torch.cat([regression,classification],axis=-1)
            batch_detections<a id="change"> = </a>non_max_suppression(detection, len(self.class_names),
                                                    conf_thres=self.confidence,
                                                    nms_thres=self.iou)
            &#47&#47--------------------------------------&#47&#47</code></pre>