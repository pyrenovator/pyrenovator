<link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
        cont, attn = net(query, value, last_attn)

        assert cont.shape == (batch_size, 1, enc_d)
        <a id="change">assert </a>attn.shape == (batch_size, seq_len)
</code></pre><h3>After Change</h3><pre><code class='java'>
        context.set_context(mode=context.GRAPH_MODE)
        batch_size, seq_len, hidden_dim = 2, 40, 20
        &#47&#47 [2, 1, 20]
        q_test = <a id="change">np.random.random(</a>(<a id="change">batch_size</a><a id="change">, 1, hidden_dim</a>)<a id="change">)</a>.astype(np.float32)
        &#47&#47 [2, 40, 20]
        v_test = <a id="change">np.random.random(</a>(<a id="change">batch_size</a><a id="change">, seq_len, hidden_dim</a>)<a id="change">)</a>.astype(np.float32)
        &#47&#47 [2, 40]
        last_attn_test = <a id="change">np.random.random(</a>(<a id="change">batch_size</a><a id="change">, seq_len</a>)<a id="change">)</a>.astype(np.float32)

        q_ms = Tensor(q_test, mindspore.float32)
        v_ms = <a id="change">Tensor(</a>v_test, mindspore.float32<a id="change">)</a>
        last_attn_ms = <a id="change">Tensor(</a>last_attn_test, mindspore.float32<a id="change">)</a>
        ms_net = LocationAwareAttention(hidden_dim=20, smoothing=True)

        result_ms<a id="change"> =  ms_net(</a>q_ms, v_ms, last_attn_ms<a id="change">)</a>

        &#47&#47 test shape
        assert result_ms[0].shape == (2, 1, 20) &#47&#47[batch, 1, hidden_dims]</code></pre>