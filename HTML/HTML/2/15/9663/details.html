<html><h3>Pattern ID :9663
</h3><img src='34804401.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
                loss, logits = outputs[0], outputs[1]
                
                valid_losses.append(loss)
                <a id="change">valid_ppls.append(torch.exp(</a>loss<a id="change">)</a><a id="change">)</a>
            
            valid_losses = [loss.item() for loss in valid_losses]
            valid_ppls = [ppl.item() for ppl in valid_ppls]
            valid_loss = np.mean(valid_losses)</code></pre><h3>After Change</h3><pre><code class='java'>
        self.model.eval()
              
        valid_losses = []
        <a id="change">valid_ppls</a> = []
        with torch.no_grad():
            for i, batch in enumerate(tqdm(self.valid_loader)):
                input_ids, token_type_ids, lm_labels = batch
                input_ids, token_type_ids, lm_labels = \
                    input_ids.to(self.args.device), token_type_ids.to(self.args.device), lm_labels.to(self.args.device)
                
                outputs = self.model(
                    input_ids=input_ids,
                    token_type_ids = token_type_ids,
                    labels = lm_labels
                )
                
                loss, logits = outputs[0], outputs[1]
                
                valid_losses.append(<a id="change">loss.detach()</a>)
                <a id="change">ppl = </a><a id="change">torch.exp(loss.detach()</a><a id="change">)</a>
                <a id="change">if math.isnan(ppl</a><a id="change">)</a>:
                    <a id="change">valid_ppls.append(1e+8</a><a id="change">)</a>
                else:
                    <a id="change">valid_ppls.append(ppl</a><a id="change">)</a>
            
            valid_losses = [loss.item() for loss in valid_losses]
            valid_ppls = [ppl.item() for ppl in valid_ppls]
            valid_loss = np.mean(valid_losses)</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 4</div><BR><div id='size'>Non-data size: 10</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/devjwsong/gpt2-dialogue-generation-pytorch/commit/ceaf73967de21573fe4e5ee31ccb602af88a902b#diff-2e5ad92c43aa96cc3a9cef6c6aec998b216f1379c43b1f651013d25e55989312L168' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 34804401</div><div id='project'> Project Name: devjwsong/gpt2-dialogue-generation-pytorch</div><div id='commit'> Commit Name: ceaf73967de21573fe4e5ee31ccb602af88a902b</div><div id='time'> Time: 2021-11-28</div><div id='author'> Author: devjwsong@gmail.com</div><div id='file'> File Name: src/main.py</div><div id='m_class'> M Class Name: Manager</div><div id='n_method'> N Class Name: Manager</div><div id='m_method'> M Method Name: validation(1)</div><div id='n_method'> N Method Name: validation(1)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: src/main.py</div><div id='n_file'> N File Name: src/main.py</div><div id='m_start'> M Start Line: 168</div><div id='m_end'> M End Line: 184</div><div id='n_start'> N Start Line: 186</div><div id='n_end'> N End Line: 208</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        self.model.eval()
              
        valid_losses = []
        <a id="change">valid_ppls</a> = []
        with torch.no_grad():
            for i, batch in enumerate(tqdm(self.valid_loader)):
                input_ids, token_type_ids, lm_labels = batch
                input_ids, token_type_ids, lm_labels = \
                    input_ids.to(self.args.device), token_type_ids.to(self.args.device), lm_labels.to(self.args.device)
                
                outputs = self.model(
                    input_ids=input_ids,
                    token_type_ids = token_type_ids,
                    labels = lm_labels
                )
                
                loss, logits = outputs[0], outputs[1]
                
                valid_losses.append(loss)
                <a id="change">valid_ppls.append(torch.exp(</a>loss<a id="change">)</a><a id="change">)</a>
            
            valid_losses = [loss.item() for loss in valid_losses]
            valid_ppls = [ppl.item() for ppl in valid_ppls]
            valid_loss = np.mean(valid_losses)</code></pre><h3>After Change</h3><pre><code class='java'>
        self.model.eval()
              
        valid_losses = []
        <a id="change">valid_ppls</a> = []
        with torch.no_grad():
            for i, batch in enumerate(tqdm(self.valid_loader)):
                input_ids, token_type_ids, lm_labels = batch
                input_ids, token_type_ids, lm_labels = \
                    input_ids.to(self.args.device), token_type_ids.to(self.args.device), lm_labels.to(self.args.device)
                
                outputs = self.model(
                    input_ids=input_ids,
                    token_type_ids = token_type_ids,
                    labels = lm_labels
                )
                
                loss, logits = outputs[0], outputs[1]
                
                valid_losses.append(<a id="change">loss.detach()</a>)
                <a id="change">ppl = </a><a id="change">torch.exp(loss.detach()</a><a id="change">)</a>
                <a id="change">if math.isnan(</a>ppl<a id="change">)</a>:
                    <a id="change">valid_ppls.append(1e+8</a><a id="change">)</a>
                else:
                    <a id="change">valid_ppls.append(</a>ppl<a id="change">)</a>
            
            valid_losses = [loss.item() for loss in valid_losses]
            valid_ppls = [ppl.item() for ppl in valid_ppls]
            valid_loss = np.mean(valid_losses)</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/devjwsong/gpt2-chatbot-pytorch/commit/ceaf73967de21573fe4e5ee31ccb602af88a902b#diff-2e5ad92c43aa96cc3a9cef6c6aec998b216f1379c43b1f651013d25e55989312L163' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 34804400</div><div id='project'> Project Name: devjwsong/gpt2-chatbot-pytorch</div><div id='commit'> Commit Name: ceaf73967de21573fe4e5ee31ccb602af88a902b</div><div id='time'> Time: 2021-11-28</div><div id='author'> Author: devjwsong@gmail.com</div><div id='file'> File Name: src/main.py</div><div id='m_class'> M Class Name: Manager</div><div id='n_method'> N Class Name: Manager</div><div id='m_method'> M Method Name: validation(1)</div><div id='n_method'> N Method Name: validation(1)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: src/main.py</div><div id='n_file'> N File Name: src/main.py</div><div id='m_start'> M Start Line: 168</div><div id='m_end'> M End Line: 184</div><div id='n_start'> N Start Line: 186</div><div id='n_end'> N End Line: 208</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
            
            print(f"&#47&#47"*50 + f"Epoch: {epoch}" + "&#47&#47"*50)
            train_losses = []
            <a id="change">train_ppls</a> = []
            for i, batch in enumerate(tqdm(self.train_loader)):
                input_ids, token_type_ids, lm_labels = batch
                input_ids, token_type_ids, lm_labels = \
                    input_ids.to(self.args.device), token_type_ids.to(self.args.device), lm_labels.to(self.args.device)
                
                outputs = self.model(
                    input_ids=input_ids,
                    token_type_ids = token_type_ids,
                    labels = lm_labels
                )
                
                loss, logits = outputs[0], outputs[1]
                
                self.optim.zero_grad()
                loss.backward()
                self.optim.step()
                
                train_losses.append(loss)
                <a id="change">train_ppls.append(torch.exp(</a>loss<a id="change">)</a><a id="change">)</a>
            
            train_losses = [loss.item() for loss in train_losses]
            train_ppls = [ppl.item() for ppl in train_ppls]
            train_loss = np.mean(train_losses)</code></pre><h3>After Change</h3><pre><code class='java'>
            
            print(f"&#47&#47"*50 + f"Epoch: {epoch}" + "&#47&#47"*50)
            train_losses = []
            <a id="change">train_ppls</a> = []
            for i, batch in enumerate(tqdm(self.train_loader)):
                input_ids, token_type_ids, lm_labels = batch
                input_ids, token_type_ids, lm_labels = \
                    input_ids.to(self.args.device), token_type_ids.to(self.args.device), lm_labels.to(self.args.device)
                
                outputs = self.model(
                    input_ids=input_ids,
                    token_type_ids = token_type_ids,
                    labels = lm_labels
                )
                
                loss, logits = outputs[0], outputs[1]
                
                self.optim.zero_grad()
                loss.backward()
                self.optim.step()
                self.sched.step()
                
                train_losses.append(<a id="change">loss.detach()</a>)
                <a id="change">ppl = </a><a id="change">torch.exp(loss.detach()</a><a id="change">)</a>
                <a id="change">if math.isnan(</a>ppl<a id="change">)</a>:
                    <a id="change">train_ppls.append(1e+8</a><a id="change">)</a>
                else:
                    <a id="change">train_ppls.append(</a>ppl<a id="change">)</a>
            
            train_losses = [loss.item() for loss in train_losses]
            train_ppls = [ppl.item() for ppl in train_ppls]
            train_loss = np.mean(train_losses)</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/devjwsong/gpt2-chatbot-pytorch/commit/ceaf73967de21573fe4e5ee31ccb602af88a902b#diff-2e5ad92c43aa96cc3a9cef6c6aec998b216f1379c43b1f651013d25e55989312L105' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 34804399</div><div id='project'> Project Name: devjwsong/gpt2-chatbot-pytorch</div><div id='commit'> Commit Name: ceaf73967de21573fe4e5ee31ccb602af88a902b</div><div id='time'> Time: 2021-11-28</div><div id='author'> Author: devjwsong@gmail.com</div><div id='file'> File Name: src/main.py</div><div id='m_class'> M Class Name: Manager</div><div id='n_method'> N Class Name: Manager</div><div id='m_method'> M Method Name: train(1)</div><div id='n_method'> N Method Name: train(1)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: src/main.py</div><div id='n_file'> N File Name: src/main.py</div><div id='m_start'> M Start Line: 114</div><div id='m_end'> M End Line: 133</div><div id='n_start'> N Start Line: 118</div><div id='n_end'> N End Line: 153</div><BR>