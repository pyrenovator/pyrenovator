<html><h3>Pattern ID :8487
</h3><img src='29462624.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
            j = np.argmax(s)
            _ref.append(rest[j])
            _hypo.append(h)
    <a id="change">print(&quotref avg oracle BLEU (leave-one-out): %.2f&quot</a><a id="change"> % </a><a id="change">corpus_bleu(</a>_ref, _hypo<a id="change">))</a>

if __name__ == &quot__main__&quot:
    if args.sys:
        src, tgt, hypos, log_probs = load_sys(args.sys)</code></pre><h3>After Change</h3><pre><code class='java'>

def intra_ref(refs):
    print(&quotref pairwise BLEU: %.2f&quot % pairwise(refs))
    refs = <a id="change">list(zip(</a>*<a id="change">refs)</a><a id="change">)</a>
    <a id="change">m</a> = len(refs)
    concat_h<a id="change"> = </a><a id="change">[]</a>
    <a id="change">concat_rest = </a><a id="change">[[] for j in range(m - 1)]</a>
    for i, h in enumerate(refs):
        rest = refs[:i] + refs[i+1:]
        concat_h.append(h)
        for j in <a id="change">range(m</a><a id="change"> - 1)</a>:
            <a id="change">concat_rest[j]</a>.extend(rest[j])
    concat_h<a id="change"> = </a><a id="change">list(chain.from_iterable(</a>concat_h<a id="change">)</a><a id="change">)</a>
    bleu<a id="change"> = </a><a id="change">corpus_bleu(</a>concat_h, <a id="change">concat_rest</a><a id="change">)</a>
    <a id="change">print(&quotmulti-reference BLEU (leave-one-out): %.2f&quot</a><a id="change"> % </a>bleu<a id="change">)</a>


if __name__ == &quot__main__&quot:
    main()</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 4</div><BR><div id='size'>Non-data size: 23</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/neulab/retomaton/commit/f305086031fc31a838d5b6c06eec35fd5cd16038#diff-4a4a572bb984a4e7ace1a8b230cd114d96e08db54521a803c96e985c10c2cf1dL132' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 29462624</div><div id='project'> Project Name: neulab/retomaton</div><div id='commit'> Commit Name: f305086031fc31a838d5b6c06eec35fd5cd16038</div><div id='time'> Time: 2019-03-19</div><div id='author'> Author: myleott@fb.com</div><div id='file'> File Name: scripts/score_moe.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: intra_ref(1)</div><div id='n_method'> N Method Name: intra_ref(1)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: scripts/score_moe.py</div><div id='n_file'> N File Name: scripts/score_moe.py</div><div id='m_start'> M Start Line: 132</div><div id='m_end'> M End Line: 140</div><div id='n_start'> N Start Line: 174</div><div id='n_end'> N End Line: 185</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
            best = [k for k in range(len(rs)) if s[k] == s[j]]
            a.add(random.choice(best))
        ref_cnt += len(a)
    <a id="change">print(&quotavg oracle BLEU: %.2f&quot</a><a id="change"> % </a><a id="change">corpus_bleu(</a>_ref, _hypo<a id="change">))</a>
    print(&quot&#47&#47refs covered: %.2f&quot % (ref_cnt / len(refs)))

def intra_ref(refs):
    print(&quotref pairwise BLEU: %.2f&quot % pairwise(refs))</code></pre><h3>After Change</h3><pre><code class='java'>
    print(&quot&#47&#47refs covered: %.2f&quot % (ref_cnt / len(refs)))

    &#47&#47 transpose refs and hypos
    refs = <a id="change">list(zip(</a>*<a id="change">refs)</a><a id="change">)</a>
    hypos = list(zip(*hypos))

    &#47&#47 compute average corpus BLEU
    k = len(hypos)
    <a id="change">m</a> = len(refs)
    concat_hypos<a id="change"> = </a><a id="change">[]</a>
    <a id="change">concat_refs = </a><a id="change">[[] for j in range(m - 1)]</a>
    for i in range(m):
        concat_hypos.append([h for hs in hypos for h in hs])
        rest = refs[:i] + refs[i+1:]
        for j in <a id="change">range(</a>m<a id="change"> - 1)</a>:
            <a id="change">concat_refs[j]</a>.extend(rest[j] * k)
    concat_hypos<a id="change"> = </a><a id="change">list(chain.from_iterable(</a>concat_hypos<a id="change">)</a><a id="change">)</a>
    bleu<a id="change"> = </a><a id="change">corpus_bleu(</a>concat_hypos, concat_refs<a id="change">)</a>
    <a id="change">print(&quotmulti-reference BLEU (leave-one-out): %.2f&quot</a><a id="change"> % </a>bleu<a id="change">)</a>


def intra_ref(refs):
    print(&quotref pairwise BLEU: %.2f&quot % pairwise(refs))</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/neulab/retomaton/commit/f305086031fc31a838d5b6c06eec35fd5cd16038#diff-4a4a572bb984a4e7ace1a8b230cd114d96e08db54521a803c96e985c10c2cf1dL114' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 29462626</div><div id='project'> Project Name: neulab/retomaton</div><div id='commit'> Commit Name: f305086031fc31a838d5b6c06eec35fd5cd16038</div><div id='time'> Time: 2019-03-19</div><div id='author'> Author: myleott@fb.com</div><div id='file'> File Name: scripts/score_moe.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: multi_ref(2)</div><div id='n_method'> N Method Name: multi_ref(2)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: scripts/score_moe.py</div><div id='n_file'> N File Name: scripts/score_moe.py</div><div id='m_start'> M Start Line: 119</div><div id='m_end'> M End Line: 127</div><div id='n_start'> N Start Line: 138</div><div id='n_end'> N End Line: 169</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
            j = np.argmax(s)
            _ref.append(rest[j])
            _hypo.append(h)
    <a id="change">print(&quotref avg oracle BLEU (leave-one-out): %.2f&quot</a><a id="change"> % </a><a id="change">corpus_bleu(</a>_ref, _hypo<a id="change">))</a>

if __name__ == &quot__main__&quot:
    if args.sys:
        src, tgt, hypos, log_probs = load_sys(args.sys)</code></pre><h3>After Change</h3><pre><code class='java'>

def intra_ref(refs):
    print(&quotref pairwise BLEU: %.2f&quot % pairwise(refs))
    refs = <a id="change">list(zip(</a>*<a id="change">refs)</a><a id="change">)</a>
    <a id="change">m</a> = len(refs)
    concat_h<a id="change"> = </a><a id="change">[]</a>
    <a id="change">concat_rest = </a><a id="change">[[] for j in range(m - 1)]</a>
    for i, h in enumerate(refs):
        rest = refs[:i] + refs[i+1:]
        concat_h.append(h)
        for j in <a id="change">range(</a>m<a id="change"> - 1)</a>:
            <a id="change">concat_rest[j]</a>.extend(rest[j])
    concat_h<a id="change"> = </a><a id="change">list(chain.from_iterable(</a>concat_h<a id="change">)</a><a id="change">)</a>
    bleu<a id="change"> = </a><a id="change">corpus_bleu(</a>concat_h, concat_rest<a id="change">)</a>
    <a id="change">print(&quotmulti-reference BLEU (leave-one-out): %.2f&quot</a><a id="change"> % </a>bleu<a id="change">)</a>


if __name__ == &quot__main__&quot:
    main()</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/kssteven418/i-bert/commit/f305086031fc31a838d5b6c06eec35fd5cd16038#diff-4a4a572bb984a4e7ace1a8b230cd114d96e08db54521a803c96e985c10c2cf1dL130' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 29462621</div><div id='project'> Project Name: kssteven418/i-bert</div><div id='commit'> Commit Name: f305086031fc31a838d5b6c06eec35fd5cd16038</div><div id='time'> Time: 2019-03-19</div><div id='author'> Author: myleott@fb.com</div><div id='file'> File Name: scripts/score_moe.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: intra_ref(1)</div><div id='n_method'> N Method Name: intra_ref(1)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: scripts/score_moe.py</div><div id='n_file'> N File Name: scripts/score_moe.py</div><div id='m_start'> M Start Line: 132</div><div id='m_end'> M End Line: 140</div><div id='n_start'> N Start Line: 174</div><div id='n_end'> N End Line: 185</div><BR>