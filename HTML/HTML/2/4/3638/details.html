<html><h3>Pattern ID :3638
</h3><img src='13666354.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
        fig, axes = plt.subplots(1, 3, figsize=(base_size * 3, base_size * 1))
        axes[0].imshow(self.pos_emb_h)
        axes[1].imshow(self.pos_emb_w)
        hh_sum = <a id="change">tf.ones([1</a>, self.pos_emb_h.shape[0]<a id="change"></a>]<a id="change">)</a> @ self.pos_emb_h
        ww_sum = tf.ones([1, self.pos_emb_w.shape[0]]) @ self.pos_emb_w
        axes[2].imshow(tf.transpose(hh_sum) + ww_sum)
        titles = ["pos_emb_h", "pos_emb_w", "sum"]</code></pre><h3>After Change</h3><pre><code class='java'>
        import matplotlib.pyplot as plt

        pos_emb_h = self.pos_emb_h.detach().numpy() if hasattr(self.pos_emb_h, "detach") else self.pos_emb_h.numpy()
        pos_emb_w = self.pos_emb_w.detach().numpy()<a id="change"> if </a>hasattr(self.pos_emb_w, "detach")<a id="change"> else </a>self.pos_emb_w.numpy()

        fig, axes = plt.subplots(1, 3, figsize=(base_size * 3, base_size * 1))
        axes[0].imshow(pos_emb_h)</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 3</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/leondgarse/keras_cv_attention_models/commit/e05e233f369a1d58f912872b1581a80d15cacc3f#diff-4163380308eb60d4185b09d8359be777af3cee4f5ffc9acbf77fc54a76f12e5bL129' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 13666354</div><div id='project'> Project Name: leondgarse/keras_cv_attention_models</div><div id='commit'> Commit Name: e05e233f369a1d58f912872b1581a80d15cacc3f</div><div id='time'> Time: 2023-02-07</div><div id='author'> Author: leondgarse@gmail.com</div><div id='file'> File Name: keras_cv_attention_models/botnet/botnet.py</div><div id='m_class'> M Class Name: RelativePositionalEmbedding</div><div id='n_method'> N Class Name: RelativePositionalEmbedding</div><div id='m_method'> M Method Name: show_pos_emb(2)</div><div id='n_method'> N Method Name: show_pos_emb(2)</div><div id='m_parent_class'> M Parent Class: layers.Layer</div><div id='n_parent_class'> N Parent Class: keras.layers.Layer</div><div id='m_file'> M File Name: keras_cv_attention_models/botnet/botnet.py</div><div id='n_file'> N File Name: keras_cv_attention_models/botnet/botnet.py</div><div id='m_start'> M Start Line: 132</div><div id='m_end'> M End Line: 135</div><div id='n_start'> N Start Line: 129</div><div id='n_end'> N End Line: 136</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>

    def test_sbiobert_embedding(self, monkeypatch, fake_sqlalchemy_engine, test_parameters, metadata_path):
        torch_model = MagicMock(spec=torch.nn.Module)
        torch_model.return_value = (torch.ones([1, 8, 768]), <a id="change">torch.ones([</a>1, <a id="change">768</a>]<a id="change">)</a>)

        auto_model = Mock()
        auto_model.from_pretrained().bert.to.return_value = torch_model</code></pre><h3>After Change</h3><pre><code class='java'>
        if n_sentences != 1:
            dummy_sentence = n_sentences * [dummy_sentence]

        preprocess_method = getattr(sbiobert, &quotpreprocess&quot<a id="change"> if </a>n_sentences == 1<a id="change"> else </a>&quotpreprocess_many&quot)
        embed_method = getattr(sbiobert, &quotembed&quot if n_sentences == 1 else &quotembed_many&quot)

        preprocess_sentence = preprocess_method(dummy_sentence)</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/bluebrain/search/commit/6eb30c8b3e77791ee4e407dd19d7a5e08fe5e132#diff-ec98dd07dcbff5d2e64387519674a8df106b0f18d22b23c53c9064f769e9cc29L36' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 13666355</div><div id='project'> Project Name: bluebrain/search</div><div id='commit'> Commit Name: 6eb30c8b3e77791ee4e407dd19d7a5e08fe5e132</div><div id='time'> Time: 2020-09-04</div><div id='author'> Author: jankrepl@yahoo.com</div><div id='file'> File Name: tests/test_embedding_models.py</div><div id='m_class'> M Class Name: TestEmbeddingModels</div><div id='n_method'> N Class Name: TestEmbeddingModels</div><div id='m_method'> M Method Name: test_sbiobert_embedding(3)</div><div id='n_method'> N Method Name: test_sbiobert_embedding(5)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: tests/test_embedding_models.py</div><div id='n_file'> N File Name: tests/test_embedding_models.py</div><div id='m_start'> M Start Line: 36</div><div id='m_end'> M End Line: 69</div><div id='n_start'> N Start Line: 40</div><div id='n_end'> N End Line: 76</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        level_high = level_high.to(y_zero_point.device)
        y_zero_point = min(max(level_low, (y_zero_point.to(torch.int8))), level_high)
    else:
        level_low = <a id="change">torch.ones([1</a>]<a id="change">)</a>.to(torch.uint8) * level_low
        level_high = torch.ones([1]).to(torch.uint8) * level_high
        level_low = level_low.to(y_zero_point.device)
        level_high = level_high.to(y_zero_point.device)</code></pre><h3>After Change</h3><pre><code class='java'>
    y_scale = (input_high - input_low) / (level_high - level_low)
    y_zero_point = (level_low * input_high - level_high * input_low) / (input_high - input_low)

    type_ = torch.int8<a id="change"> if </a>level_low &lt; 0<a id="change"> else </a>torch.uint8
    level_low *= torch.ones_like(y_zero_point).to(type_)
    level_high *= torch.ones_like(y_zero_point).to(type_)
    level_low = level_low.to(y_zero_point.device)</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/openvinotoolkit/nncf/commit/23610df53be6cb3c36a8f5ec6aaf7ab8f4fc757e#diff-79eba4eaba4a6497a26f88dd22fb2c4ca247d8745f0763dbe56801ee3188ce1aL149' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 13666357</div><div id='project'> Project Name: openvinotoolkit/nncf</div><div id='commit'> Commit Name: 23610df53be6cb3c36a8f5ec6aaf7ab8f4fc757e</div><div id='time'> Time: 2020-11-06</div><div id='author'> Author: aleksei.kashapov@intel.com</div><div id='file'> File Name: nncf/quantization/quantize_functions.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: get_scale_zp_from_input_low_input_high(4)</div><div id='n_method'> N Method Name: get_scale_zp_from_input_low_input_high(4)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: nncf/quantization/quantize_functions.py</div><div id='n_file'> N File Name: nncf/quantization/quantize_functions.py</div><div id='m_start'> M Start Line: 154</div><div id='m_end'> M End Line: 169</div><div id='n_start'> N Start Line: 153</div><div id='n_end'> N End Line: 164</div><BR>