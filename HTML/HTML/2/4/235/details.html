<html><h3>Pattern ID :235
</h3><img src='1915037.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
        mmr = np.zeros((1, SFS.mmr))

        &#47&#47 TODO: implment it
        units_buildings<a id="change"> = </a><a id="change">np.zeros(</a>(1<a id="change">, SFS.units_buildings</a>)<a id="change">)</a>

        &#47&#47 implement the effects
        effects = np.zeros((1, SFS.effects))</code></pre><h3>After Change</h3><pre><code class='java'>
            if test:
                available_actions_tensor = torch.tensor(available_actions)
                available_action_type = torch.nonzero(available_actions_tensor.long(), as_tuple=True)[-1].unsqueeze(dim=1)
                <a id="change">print(</a>&quotavailable_action_type&quot, available_action_type<a id="change">)</a> if 1 else None

        &#47&#47 implement the unit_counts_bow
        unit_counts_bow = L.calculate_unit_counts_bow_numpy(obs)</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 4</div><BR><div id='size'>Non-data size: 4</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/liuruoze/mini-alphastar/commit/a6921de3d6e7725416f4d7df3e0c2442b00063ab#diff-0d619f31edb62c5fde62f56a22dd01adc61d252719c8234eb7209817850e1b50L168' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 1915037</div><div id='project'> Project Name: liuruoze/mini-alphastar</div><div id='commit'> Commit Name: a6921de3d6e7725416f4d7df3e0c2442b00063ab</div><div id='time'> Time: 2021-12-14</div><div id='author'> Author: liuruoze@163.com</div><div id='file'> File Name: alphastarmini/core/arch/scalar_encoder.py</div><div id='m_class'> M Class Name: ScalarEncoder</div><div id='n_method'> N Class Name: ScalarEncoder</div><div id='m_method'> M Method Name: preprocess_numpy(4)</div><div id='n_method'> N Method Name: preprocess_numpy(4)</div><div id='m_parent_class'> M Parent Class: nn.Module</div><div id='n_parent_class'> N Parent Class: nn.Module</div><div id='m_file'> M File Name: alphastarmini/core/arch/scalar_encoder.py</div><div id='n_file'> N File Name: alphastarmini/core/arch/scalar_encoder.py</div><div id='m_start'> M Start Line: 192</div><div id='m_end'> M End Line: 192</div><div id='n_start'> N Start Line: 168</div><div id='n_end'> N End Line: 205</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>

            batches_seen += 1

            batch_one_hot = <a id="change">torch.zeros(</a>(1<a id="change">, 1, config.label_dim</a>)<a id="change">)</a>
            for y_i in y:
                y_i_enc = onehot_encoder(y_i.item())
                y_i_enc = y_i_enc.reshape((1, 1, config.label_dim))
                batch_one_hot = torch.cat((batch_one_hot, y_i_enc), dim=0)

            batch_one_hot<a id="change"> = </a>batch_one_hot[1:, :, :]
            y = batch_one_hot.to(config.device)

            if i_batch == 0:</code></pre><h3>After Change</h3><pre><code class='java'>
            J_alpha.backward()
            optimizer.step()

            <a id="change">print(</a>model.weight.grad<a id="change">)</a>
            optimizer.zero_grad()

            total_loss += J_alpha.item()
</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/bioshape-lab/pirounet/commit/2395bd9085fa3929d3adeb37efc1191b4480e81c#diff-c88070e715f56cda68eea658068045ecb0b03c5f63313f182ed6801aef1a79a7L23' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 1915039</div><div id='project'> Project Name: bioshape-lab/pirounet</div><div id='commit'> Commit Name: 2395bd9085fa3929d3adeb37efc1191b4480e81c</div><div id='time'> Time: 2022-06-16</div><div id='author'> Author: papillon@umail.ucsb.edu</div><div id='file'> File Name: move/fid_train.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: run_train_classifier(7)</div><div id='n_method'> N Method Name: run_train_classifier(7)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: move/fid_train.py</div><div id='n_file'> N File Name: move/fid_train.py</div><div id='m_start'> M Start Line: 58</div><div id='m_end'> M End Line: 148</div><div id='n_start'> N Start Line: 58</div><div id='n_end'> N End Line: 139</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
    def fools_gold_score(grad_list):
        n_clients = len(grad_list)
        grads = [utils.vectorize_weight(grad) for grad in grad_list]
        cs = <a id="change">np.zeros(</a>(n_clients<a id="change">, n_clients</a>)<a id="change">)</a>
        for i in range(n_clients):
            for j in range(n_clients):
                cs[i][j] = 1 - spatial.distance.cosine(
                    grads[i].tolist(), grads[j].tolist()
                )
        cs<a id="change"> -= </a>np.eye(n_clients)
        maxcs = np.max(cs, axis=1)
        &#47&#47 pardoning
        for i in range(n_clients):</code></pre><h3>After Change</h3><pre><code class='java'>
            for j in range(n_clients):
                if i != j and maxcs[i] &lt; maxcs[j]:
                    cs[i][j] = cs[i][j] * maxcs[i] / maxcs[j]
        <a id="change">print(</a>"cs = {}".format(cs)<a id="change">)</a>
        alpha = 1 - (np.max(cs, axis=1))
        print("alpha = {}".format(cs))
        alpha[alpha &gt; 1] = 1
        alpha[alpha &lt; 0] = 0</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/fedml-ai/fedml/commit/7a9a87eb07ec4ad218af6a18663cb93b061d735a#diff-cb204bfb0c88c24d3e499caee204b4c6a0211a1555fed09b011e6bafa335da86L66' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 1915033</div><div id='project'> Project Name: fedml-ai/fedml</div><div id='commit'> Commit Name: 7a9a87eb07ec4ad218af6a18663cb93b061d735a</div><div id='time'> Time: 2022-09-22</div><div id='author'> Author: chaoyanghe.com@gmail.com</div><div id='file'> File Name: python/fedml/core/security/defense/foolsgold_defense.py</div><div id='m_class'> M Class Name: FoolsGoldDefense</div><div id='n_method'> N Class Name: FoolsGoldDefense</div><div id='m_method'> M Method Name: fools_gold_score(1)</div><div id='n_method'> N Method Name: fools_gold_score(1)</div><div id='m_parent_class'> M Parent Class: BaseDefenseMethod</div><div id='n_parent_class'> N Parent Class: BaseDefenseMethod</div><div id='m_file'> M File Name: python/fedml/core/security/defense/foolsgold_defense.py</div><div id='n_file'> N File Name: python/fedml/core/security/defense/foolsgold_defense.py</div><div id='m_start'> M Start Line: 67</div><div id='m_end'> M End Line: 75</div><div id='n_start'> N Start Line: 70</div><div id='n_end'> N End Line: 99</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
            preprocessed_sentence = model.preprocess(sentence_text)
            embedding = model.embed(preprocessed_sentence)
        except IndexError:
            embedding<a id="change"> = </a><a id="change">np.zeros(</a>(model.dim<a id="change"></a>,)<a id="change">)</a>
            num_errors += 1
        all_ids.append(sentence_id)
        all_embeddings.append(embedding)
        if i_sentence % 1000 == 0:</code></pre><h3>After Change</h3><pre><code class='java'>
    final_embeddings = np.array(all_embeddings)
    retrieved_indices = np.array(all_ids)

    <a id="change">print(</a>f&quotEmbedded {i_sentence} with {num_errors} errors&quot<a id="change">)</a>

    return final_embeddings, retrieved_indices
</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/bluebrain/search/commit/cc7283c8f8440aeec4d04d6b259ab898c78a3cc1#diff-6a370a606e89902d9cea7c7edf876b91c643d1c115291d5912b04e3bd88cf446L266' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 1915035</div><div id='project'> Project Name: bluebrain/search</div><div id='commit'> Commit Name: cc7283c8f8440aeec4d04d6b259ab898c78a3cc1</div><div id='time'> Time: 2020-07-29</div><div id='author'> Author: jankrepl@yahoo.com</div><div id='file'> File Name: src/bbsearch/embedding_models.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: compute_database_embeddings(3)</div><div id='n_method'> N Method Name: compute_database_embeddings(2)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: src/bbsearch/embedding_models.py</div><div id='n_file'> N File Name: src/bbsearch/embedding_models.py</div><div id='m_start'> M Start Line: 283</div><div id='m_end'> M End Line: 317</div><div id='n_start'> N Start Line: 266</div><div id='n_end'> N End Line: 321</div><BR>