<html><h3>Pattern ID :969
</h3><img src='4611280.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>

                &#47&#47 TODO vectorize more?
                for single_slot, single_center in single_class:
                    dists<a id="change"> = </a>((m_cluster_centers - single_center) ** 2).sum(dim=-1)

                    if (torch.any(dists &lt; (self.config[&quotdiff_cluster_threshold&quot] * 0.5))):  
                        new_slot = single_slot   &#47&#47 TODO check if there is a place to move to
                        label_id = dists.argmin()
        
                        &#47&#47 Update
                        try:
                            permutation = self._swap_slots(permutation, labels, non_empty_ids_per_slot, label_id, current_slot, new_slot)
                        except ValueError as e:
                            if self.debug_prints:
                                print(e)
                            continue

                        if self.debug_prints:
                            print(
                                f&quotUsing single {current_slot}-&gt;{new_slot} with dist {dists[label_id]:.2f}&quot
                                f&quot by cc {m_cluster_centers[label_id]} with &quot
                                f&quotoriginal cc {single_center}&quot)
                        
                        &#47&#47 Logging Info
                        swapped_quality_levels.append(curr_quality)
                        assigned.add(current_slot)
                        <a id="change">break</a>
        
        &#47&#47 check if others could be assigned to the same class as earlier
        for current_slot in multiple_classes:
            if current_slot not in assigned:</code></pre><h3>After Change</h3><pre><code class='java'>
        &#47&#47 Logging
        swapped_quality_levels = []
        single_slots = [elem[0] for elem in single_class]
        single_centers = <a id="change">(elem[1] for elem in single_class)</a>
        single_centers = torch.stack(tuple(single_centers)) if len(single_class) else []

        &#47&#47 check all elements for singles
        &#47&#47 NOTE: using single-cluster slots as predicted, not as </code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 4</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/maria-korosteleva/garment-pattern-estimation/commit/4f0a08b91c9d5e37a8b529fb523bd47047507750#diff-66aae7ec57f079963bb4847ebb79bfda4004ba832ee23e11911a14908193967cL1126' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 4611280</div><div id='project'> Project Name: maria-korosteleva/garment-pattern-estimation</div><div id='commit'> Commit Name: 4f0a08b91c9d5e37a8b529fb523bd47047507750</div><div id='time'> Time: 2021-07-26</div><div id='author'> Author: mariako@kaist.ac.kr</div><div id='file'> File Name: nn/metrics.py</div><div id='m_class'> M Class Name: ComposedPatternLoss</div><div id='n_method'> N Class Name: ComposedPatternLoss</div><div id='m_method'> M Method Name: _distribute_clusters(6)</div><div id='n_method'> N Method Name: _distribute_clusters(6)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: nn/metrics.py</div><div id='n_file'> N File Name: nn/metrics.py</div><div id='m_start'> M Start Line: 1134</div><div id='m_end'> M End Line: 1166</div><div id='n_start'> N Start Line: 1126</div><div id='n_end'> N End Line: 1182</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
    
    get_latest_version_command = f"{docker_exec_cmd} yolk -M {package} -f version "
    for attempt in range(num_tries):
        run_out<a id="change"> = </a>run(get_latest_version_command, warn=True, hide=True)
        if run_out.failed or run_out.stdout:
            <a id="change">break</a>
        LOGGER.info(f"Failed {attempt}: &quot{get_latest_version_command}&quot returned &quot{run_out.stdout}&quot")
    assert run_out.failed or run_out.stdout, f"&quot{get_latest_version_command}&quot returned &quot{run_out.stdout}&quot"
    return run_out.ok, run_out.stdout.strip("\n")
</code></pre><h3>After Change</h3><pre><code class='java'>
    pypi_package_info = requests.get(f"https://pypi.org/pypi/{package}/json")
    data = json.loads(pypi_package_info.text)
    versions = data["releases"].keys()
    return str(max(<a id="change">Version</a>(v) <a id="change">for</a> v in versions))


@pytest.mark.model("N/A")</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/aws/deep-learning-containers/commit/6d858dd378025f9a13ab5e63596ec44249ffbe79#diff-8ce7c16e1cb38f87691246af2827b12119cbad82caa889a4ca646e81600520e1L84' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 4611276</div><div id='project'> Project Name: aws/deep-learning-containers</div><div id='commit'> Commit Name: 6d858dd378025f9a13ab5e63596ec44249ffbe79</div><div id='time'> Time: 2020-12-23</div><div id='author'> Author: 54188298+saimidu@users.noreply.github.com</div><div id='file'> File Name: test/dlc_tests/sanity/test_safety_check.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: _get_latest_package_version(1)</div><div id='n_method'> N Method Name: _get_latest_package_version(3)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: test/dlc_tests/sanity/test_safety_check.py</div><div id='n_file'> N File Name: test/dlc_tests/sanity/test_safety_check.py</div><div id='m_start'> M Start Line: 84</div><div id='m_end'> M End Line: 101</div><div id='n_start'> N Start Line: 85</div><div id='n_end'> N End Line: 96</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
                    continue
                if self.ignore_high_conf:
                    &#47&#47 check every parser namespace has a high conf hit
                    hits_by_parser_name<a id="change"> = </a>itertools.groupby(
                        sorted(ent.hits, key=lambda x: x.parser_name), key=lambda x: x.parser_name
                    )
                    needs_sapbert = False
                    for parser_name, hits_iter in hits_by_parser_name:
                        if not any(hit.confidence == SearchRanks.EXACT_MATCH for hit in hits_iter):
                            needs_sapbert = True
                            <a id="change">break</a>
                    if needs_sapbert:
                        entities_to_process.append(ent)

            self.process_entities(entities_to_process)</code></pre><h3>After Change</h3><pre><code class='java'>
                    &#47&#47 that never gets used because it isn&quott in the list of entities and ontologies
                    &#47&#47 but I&quotm unclear here - unimportant enough to delay until later
                    if not all(
                        <a id="change">parser_has_high_conf_hit</a>[index.parser.name] <a id="change">for</a> index in self.indices
                    ):
                        entities_to_process.append(ent)
</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/astrazeneca/kazu/commit/1fc805988a2f90a87dc1025c0b3b572855fef154#diff-5d0b0ded5b343b5692f05ff69dc8f3b4f8d860427b9eb29f6b3cbe52194fa86cL96' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 4611277</div><div id='project'> Project Name: astrazeneca/kazu</div><div id='commit'> Commit Name: 1fc805988a2f90a87dc1025c0b3b572855fef154</div><div id='time'> Time: 2022-11-30</div><div id='author'> Author: elliot.ford@astrazeneca.com</div><div id='file'> File Name: kazu/steps/linking/sapbert.py</div><div id='m_class'> M Class Name: SapBertForEntityLinkingStep</div><div id='n_method'> N Class Name: SapBertForEntityLinkingStep</div><div id='m_method'> M Method Name: _run(2)</div><div id='n_method'> N Method Name: _run(2)</div><div id='m_parent_class'> M Parent Class: BaseStep</div><div id='n_parent_class'> N Parent Class: BaseStep</div><div id='m_file'> M File Name: kazu/steps/linking/sapbert.py</div><div id='n_file'> N File Name: kazu/steps/linking/sapbert.py</div><div id='m_start'> M Start Line: 111</div><div id='m_end'> M End Line: 124</div><div id='n_start'> N Start Line: 110</div><div id='n_end'> N End Line: 127</div><BR>