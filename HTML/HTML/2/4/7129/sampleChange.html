<link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
      int idx = get_global_id(0);
      c[idx] = atan2(a[idx], b[idx]);
    }, global_size=[prod(ret.shape)]).build(GPUBuffer.spec.runtime).exec([ret, a.contiguous(), b.contiguous()])
  <a id="change">return </a>ret

def atan2_cpu(a:CPUBuffer, b:CPUBuffer) -&gt; CPUBuffer:
  return CPUBuffer(np.arctan2(a._buf, b._buf))</code></pre><h3>After Change</h3><pre><code class='java'>
def atan2_gpu(ret:LazyBuffer, a:LazyBuffer, b:LazyBuffer):
  assert a.device == "GPU" and b.device == "GPU", "gpu function requires GPUBuffers"
  assert a.dtype == b.dtype and a.dtype == dtypes.float32, "gpu function only supports float32"
  ret.realized<a id="change"> = </a><a id="change">Device[ret.device].buffer(</a>prod(ret.shape), ret.dtype<a id="change">)</a>
  ASTRunner("atan2", 
    __kernel void atan2(global float *c, global float *a, global float *b) {
      int idx = get_global_id(0);
      c[idx] = atan2(a[idx], b[idx]);
    }, global_size=[prod(ret.shape)]).build(Device[ret.device].runtime).exec([ret, a, b])
  <a id="change">return </a>ret.realized

def atan2_cpu(ret:LazyBuffer, a:LazyBuffer, b:LazyBuffer):
  return Device[ret.device].buffer(np.arctan2(a.realized._buf, b.realized._buf))</code></pre>