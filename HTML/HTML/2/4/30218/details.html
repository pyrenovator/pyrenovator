<html><h3>Pattern ID :30218
</h3><img src='89667152.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
    if simplify:
        model_opt, check_ok = onnx_simplify(onnx_model, input_shape)
        if check_ok:
            <a id="change">print(&quotsave onnx&quot</a><a id="change">)</a>
            onnx.save(model_opt, onnx_file)


def load_onnx(onnx_file):</code></pre><h3>After Change</h3><pre><code class='java'>
    
    if type(input_shape[0]) == tuple:
        if check_model_is_cuda(model):
            dummy_input<a id="change"> = </a>tuple([<a id="change">torch.randn(</a>ishape<a id="change">, device="cuda")</a> for ishape in input_shape])
        else:
            dummy_input = tuple([torch.randn(ishape, device="cpu") for ishape in input_shape])
    elif type(input_shape) == tuple:</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 4</div><BR><div id='size'>Non-data size: 3</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/kuroko1t/nne/commit/a00ac8516ac6f9381d377673bd5eeb6db0c7961c#diff-fce3963ac4e3974ea4e6e8994066ae3c32f6cdfbbc4b09613cda6b754b521f7fL30' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 89667152</div><div id='project'> Project Name: kuroko1t/nne</div><div id='commit'> Commit Name: a00ac8516ac6f9381d377673bd5eeb6db0c7961c</div><div id='time'> Time: 2021-05-18</div><div id='author'> Author: kurosawa.yk@gmail.com</div><div id='file'> File Name: nne/onnx.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: cv2onnx(4)</div><div id='n_method'> N Method Name: cv2onnx(4)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: nne/onnx.py</div><div id='n_file'> N File Name: nne/onnx.py</div><div id='m_start'> M Start Line: 30</div><div id='m_end'> M End Line: 57</div><div id='n_start'> N Start Line: 30</div><div id='n_end'> N End Line: 50</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>

class Dense:
	def __init__(self):
		<a id="change">print("Working..."</a><a id="change">)</a></code></pre><h3>After Change</h3><pre><code class='java'>

class Dense:
	def __init__(self, n_inputs, n_nodes):
		self.__weights<a id="change"> = </a><a id="change">np.random.randn(</a>n_inputs, n_nodes<a id="change">)</a>
		self.__bias = np.zeros((1, n_nodes), dtype=np.float)
	
	def forward(self, x):
		self.output = np.dot(x, self.__weights) + self.__bias</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/imdeepmind/neuralpy/commit/9e42afd2a38a79b3eff96fbb924ce022354dc361#diff-334c4da6263804379ae0ca57109a377704c70b9f59552291084a875146d66b91L4' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 89667146</div><div id='project'> Project Name: imdeepmind/neuralpy</div><div id='commit'> Commit Name: 9e42afd2a38a79b3eff96fbb924ce022354dc361</div><div id='time'> Time: 2020-05-03</div><div id='author'> Author: abhishekchatterjeejit@gmail.com</div><div id='file'> File Name: neuralpy/layers/dense.py</div><div id='m_class'> M Class Name: Dense</div><div id='n_method'> N Class Name: Dense</div><div id='m_method'> M Method Name: __init__(3)</div><div id='n_method'> N Method Name: __init__(1)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: neuralpy/layers/dense.py</div><div id='n_file'> N File Name: neuralpy/layers/dense.py</div><div id='m_start'> M Start Line: 4</div><div id='m_end'> M End Line: 5</div><div id='n_start'> N Start Line: 4</div><div id='n_end'> N End Line: 6</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
            run_embedding_bag(&quotcpu&quot, 10000, 2048, 4)
    print(&quotcpu time &quot, cpu_timer.elapsed)

    <a id="change">print(f&quotbatch_size {batch_size} embedding_dim {embedding_dim} cuda/cpu {cuda_timer.elapsed / cpu_timer.elapsed}&quot</a><a id="change">)</a>

if __name__ == &quot__main__&quot:
    for batch_size in [4, 16, 32]:
        for embedding_dim in [128, 1024, 2048]:</code></pre><h3>After Change</h3><pre><code class='java'>
    device = &quotcuda&quot
    embedding_sum = nn.EmbeddingBag(num_embeddings, embedding_dim, mode=&quotsum&quot).to(device)
    input_ids = torch.randint(low = 0, high = num_embeddings - 1, size = (batch_size, embedding_dim)).to(device)
    output_grad<a id="change"> = </a><a id="change">torch.randn(</a>batch_size, embedding_dim<a id="change">)</a>.to(device)

    with Timer() as cuda_timer:
        for i in range(10):</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/hpcaitech/cachedembedding/commit/4faf53ac52494564f1a1f3f2ef78ad6e0318b417#diff-99fd8b184a62004082075bff425f1f2aa4715da53127c5ef892357e76daefc04L14' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 89667153</div><div id='project'> Project Name: hpcaitech/cachedembedding</div><div id='commit'> Commit Name: 4faf53ac52494564f1a1f3f2ef78ad6e0318b417</div><div id='time'> Time: 2022-07-17</div><div id='author'> Author: fangjiarui123@gmail.com</div><div id='file'> File Name: benchmark/benchmark_embedding_bag.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: benchmark(3)</div><div id='n_method'> N Method Name: benchmark(3)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: benchmark/benchmark_embedding_bag.py</div><div id='n_file'> N File Name: benchmark/benchmark_embedding_bag.py</div><div id='m_start'> M Start Line: 15</div><div id='m_end'> M End Line: 26</div><div id='n_start'> N Start Line: 12</div><div id='n_end'> N End Line: 29</div><BR>