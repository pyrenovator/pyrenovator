<link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
    &#47&#47 This can change the size of the picture and put the face in the approximate center
    img = img.transform(img.size, Image.AFFINE, (1, 0, t[0] - w0/2, 0, 1, h0/2 - t[1]))
    if mask is not None:
        mask = <a id="change">mask.transform(</a>mask.size, Image.AFFINE, (1, 0, t[0]-w0/2, 0, 1, h0/2 - t[1])<a id="change">)</a>
    
    w = (w0/s*102).astype(np.int32)
    h = (h0/s*102).astype(np.int32)
    
    &#47&#47 crop the image to 224*224 from image center
    left = (w/2 - 112).astype(np.int32) 
    right = left + 224
    up = (h/2 - 112).astype(np.int32)
    below = up + 224

    left_c = round(w0/w * left)
    right_c = round(w0/w * right)
    up_c = round(h0/h * up)
    below_c = round(h0/h * below)
    cropped_img = img.crop((left_c,up_c,right_c,below_c)).resize((render_size, render_size), resample=Image.BILINEAR)
    &#47&#47 cropped_img = np.array(cropped_img)[:,:,::-1]
    &#47&#47 cropped_img = np.expand_dims(cropped_img, 0)
    
    img = img.resize((w,h),resample = Image.BILINEAR)
    if mask is not None:
        mask = mask.resize((w,h), resample = Image.BILINEAR)
    lm = np.stack([lm[:,0] - t[0] + w0/2,lm[:,1] - t[1] + h0/2],axis = 1)/s*102 

    img = img.crop((left,up,right,below))
    if mask is not None:
        mask = mask.crop((left,up,right,below))
    
    img = np.array(img)
    if len(img.shape)==2:
        img = np.expand_dims(img,-1)
        img = np.repeat(img, 3, axis=-1)
    else:
        img = img[:,:,::-1] &#47&#47 Became BGR
    img = np.expand_dims(img,0)
    if mask is not None:
        mask = np.expand_dims(mask,0)
    lm = lm - np.reshape(np.array([(w/2 - 112),(h/2-112)]),[1,2])

    <a id="change">return </a>img<a id="change">, lm, mask, cropped_img, [left_c, right_c, up_c, below_c]</a>


&#47&#47 resize and crop input images before sending to the R-Net
def Preprocess(img, lm, lm3D, mask=None, render_size=224):</code></pre><h3>After Change</h3><pre><code class='java'>
    img = np.expand_dims(img,0)
    lm = lm - np.reshape(np.array([(w/2 - 112),(h/2-112)]),[1,2])

    <a id="change">return </a>img, lm, cropped_img, [left_c, right_c, up_c, below_c, render_size, t[0]-w0/2, h0/2-t[1]]


def Preprocess(img, lm, lm3D, render_size=224, box=False):</code></pre>