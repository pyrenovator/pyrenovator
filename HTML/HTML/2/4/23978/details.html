<html><h3>Pattern ID :23978
</h3><img src='74546513.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
        if stage != "train":

            ind2lab = params.train_loader.label_dict["phn"]["index2lab"]
            sequence = <a id="change">ctc_greedy_decode(</a>pout, pout_lens<a id="change">, blank_id=-1)</a>
            &#47&#47 convert sequence back to 1 state per phoneme style
            sequence = [[x // 3 for x in utt] for utt in sequence]
            sequence = convert_index_to_lab(sequence, ind2lab)
</code></pre><h3>After Change</h3><pre><code class='java'>
            )
            loss = -sum_alpha_T.sum()

        elif <a id="change">params.training_type == "ctc"</a>:
            loss = params.compute_cost_ctc(pout, phns, pout_lens, phn_lens)
        elif params.training_type == "viterbi":
            prev_alignments<a id="change"> = </a>params.aligner.get_prev_alignments(
                ids, pout, pout_lens, phns, phn_lens
            )
            prev_alignments = prev_alignments.to(params.device)</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 4</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/speechbrain/speechbrain/commit/7e8e3d58f3eb8d6e92cc58ee74cd8d0104374026#diff-25148d5a446dc1c3c57b3caa4054b83d1e1616b39a92400a7b383331f560dbb5L53' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 74546513</div><div id='project'> Project Name: speechbrain/speechbrain</div><div id='commit'> Commit Name: 7e8e3d58f3eb8d6e92cc58ee74cd8d0104374026</div><div id='time'> Time: 2020-06-17</div><div id='author'> Author: elenaras@yahoo.co.uk</div><div id='file'> File Name: recipes/TIMIT/ASR_alignment/experiment.py</div><div id='m_class'> M Class Name: ASR</div><div id='n_method'> N Class Name: ASR</div><div id='m_method'> M Method Name: compute_objectives(4)</div><div id='n_method'> N Method Name: compute_objectives(4)</div><div id='m_parent_class'> M Parent Class: sb.core.Brain</div><div id='n_parent_class'> N Parent Class: sb.core.Brain</div><div id='m_file'> M File Name: recipes/TIMIT/ASR_alignment/experiment.py</div><div id='n_file'> N File Name: recipes/TIMIT/ASR_alignment/experiment.py</div><div id='m_start'> M Start Line: 55</div><div id='m_end'> M End Line: 72</div><div id='n_start'> N Start Line: 53</div><div id='n_end'> N End Line: 85</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>

        stats = {}
        if stage != "train":
            seq = <a id="change">ctc_greedy_decode(</a>predictions, lens<a id="change">, blank_id=-1)</a>
            phns = undo_padding(phns, phn_lens)
            stats["PER"] = wer_details_for_batch(ids, phns, seq)

        return loss, stats</code></pre><h3>After Change</h3><pre><code class='java'>
        predictions, lens = predictions
        ids, phns, phn_lens = targets

        <a id="change">if </a>(
            self.flat_start_training or <a id="change">stage == "test"</a>
        ):  &#47&#47 TODO: unsure about stage == &quottest&quot
            (
                flat_start_batch,
                flat_start_lens,
            ) = viterbi_aligner.get_flat_start_batch(phns, phn_lens, lens)
            loss = params.compute_cost(
                predictions, flat_start_batch, flat_start_lens
            )

        else:
            viterbi_batch<a id="change"> = </a>viterbi_aligner.get_viterbi_batch(lens)
            loss = params.compute_cost(predictions, viterbi_batch, lens)

        alignments = viterbi_aligner.calc_viterbi_alignments(phns, phn_lens)</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/speechbrain/speechbrain/commit/cc600a8d98ce0d7f63e3ceef4dce88dbd7928a63#diff-e07d8ff1c0328df32f2f137fbbffc786be68160474666073d0ce5baa18e83865L32' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 74546515</div><div id='project'> Project Name: speechbrain/speechbrain</div><div id='commit'> Commit Name: cc600a8d98ce0d7f63e3ceef4dce88dbd7928a63</div><div id='time'> Time: 2020-06-01</div><div id='author'> Author: rastorge@eos18.server.mila.quebec</div><div id='file'> File Name: recipes/minimal_examples/neural_networks/ASR_alignment/example_asr_alignment_experiment.py</div><div id='m_class'> M Class Name: AlignBrain</div><div id='n_method'> N Class Name: AlignBrain</div><div id='m_method'> M Method Name: compute_objectives(4)</div><div id='n_method'> N Method Name: compute_objectives(4)</div><div id='m_parent_class'> M Parent Class: sb.core.Brain</div><div id='n_parent_class'> N Parent Class: sb.core.Brain</div><div id='m_file'> M File Name: recipes/minimal_examples/neural_networks/ASR_alignment/example_asr_alignment_experiment.py</div><div id='n_file'> N File Name: recipes/minimal_examples/neural_networks/ASR_alignment/example_asr_alignment_experiment.py</div><div id='m_start'> M Start Line: 35</div><div id='m_end'> M End Line: 45</div><div id='n_start'> N Start Line: 41</div><div id='n_end'> N End Line: 62</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        stats = {}
        if stage != "train":
            ind2lab = params.train_loader.label_dict["char"]["index2lab"]
            sequence = <a id="change">ctc_greedy_decode(</a>pout, pout_lens<a id="change">, blank_id=-1)</a>
            sequence = convert_index_to_lab(sequence, ind2lab)
            chars = undo_padding(chars, char_lens)
            chars = convert_index_to_lab(chars, ind2lab)
            cer_stats = edit_distance.wer_details_for_batch(</code></pre><h3>After Change</h3><pre><code class='java'>
        chars, char_lens = chars.to(self.device), char_lens.to(self.device)
        loss = self.hparams.compute_cost(pout, chars, pout_lens, char_lens)

        <a id="change">if stage != sb.Stage.TRAIN</a>:
            pred_chars<a id="change"> = </a>sb.decoders.ctc_greedy_decode(pout, pout_lens)
            self.cer_metrics.append(
                ids, pred_chars, chars, None, char_lens, self.hparams.ind2lab
            )</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/speechbrain/speechbrain/commit/0b05205f7431990513e6a4c0a9dbb4559690d15d#diff-38deb249e35da30e03f8c0a4275d07b1110019c75a5e8c5221a9031c5d23395bL45' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 74546526</div><div id='project'> Project Name: speechbrain/speechbrain</div><div id='commit'> Commit Name: 0b05205f7431990513e6a4c0a9dbb4559690d15d</div><div id='time'> Time: 2020-10-01</div><div id='author'> Author: plantinga.peter@protonmail.com</div><div id='file'> File Name: recipes/Voicebank/ASR/CTC/experiment.py</div><div id='m_class'> M Class Name: ASR</div><div id='n_method'> N Class Name: ASR</div><div id='m_method'> M Method Name: compute_objectives(4)</div><div id='n_method'> N Method Name: compute_objectives(4)</div><div id='m_parent_class'> M Parent Class: sb.Brain</div><div id='n_parent_class'> N Parent Class: sb.core.Brain</div><div id='m_file'> M File Name: recipes/Voicebank/ASR/CTC/experiment.py</div><div id='n_file'> N File Name: recipes/Voicebank/ASR/CTC/experiment.py</div><div id='m_start'> M Start Line: 49</div><div id='m_end'> M End Line: 63</div><div id='n_start'> N Start Line: 28</div><div id='n_end'> N End Line: 36</div><BR>