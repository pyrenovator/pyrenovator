<html><h3>Pattern ID :8880
</h3><img src='32595312.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>

        &#47&#47&#47&#47&#47&#47&#47&#47&#47&#47 Performing TTA &#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47

        post_trans<a id="change"> = </a>Compose(<a id="change">[
          </a>Activations(sigmoid=True),
          AsDiscrete(threshold_values=True)<a id="change"></a>,
        ])

        &#47&#47 Inferer function used in the TTA</code></pre><h3>After Change</h3><pre><code class='java'>
        ds_tta = monai.data.Dataset(data=data_dicts)
        loader_tta = DataLoader(ds_tta, batch_size=1, num_workers=0, collate_fn=list_data_collate)

        device<a id="change"> = </a><a id="change">torch.device(</a>request.get("device", "cuda:0")<a id="change">)</a>
        logger.info(f"Using device: {device}")
        model = self.get_model(device)

        &#47&#47 Performing TTA</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 5</div><BR><div id='size'>Non-data size: 4</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/project-monai/monailabel/commit/287d4c1eafd3ab1e364e89a4bf9f6e650c68ac77#diff-ea82921658292b6f740a47382a045cd5947ba988d6d941d3ef95dcc3e7827130L65' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 32595312</div><div id='project'> Project Name: project-monai/monailabel</div><div id='commit'> Commit Name: 287d4c1eafd3ab1e364e89a4bf9f6e650c68ac77</div><div id='time'> Time: 2021-04-29</div><div id='author'> Author: salle@nvidia.com</div><div id='file'> File Name: sample-apps/segmentation_heart/lib/activelearning.py</div><div id='m_class'> M Class Name: MyActiveLearning</div><div id='n_method'> N Class Name: MyActiveLearning</div><div id='m_method'> M Method Name: __call__(3)</div><div id='n_method'> N Method Name: __call__(2)</div><div id='m_parent_class'> M Parent Class: ActiveLearning</div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: sample-apps/segmentation_heart/lib/activelearning.py</div><div id='n_file'> N File Name: sample-apps/segmentation_heart/lib/activelearning.py</div><div id='m_start'> M Start Line: 65</div><div id='m_end'> M End Line: 106</div><div id='n_start'> N Start Line: 77</div><div id='n_end'> N End Line: 120</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
                for x, y in zip(out, data):
                    assert x is y

    data<a id="change"> = </a><a id="change">[</a>Tensor(&quotcpu&quot), Tensor(&quotcpu&quot)<a id="change"></a>]
    for x, y in zip(hardware.to_device(data, &quotcpu&quot), data):
        assert x is y
    assert all(x.device == &quotcuda&quot for x in hardware.to_device(data, &quotcuda&quot))</code></pre><h3>After Change</h3><pre><code class='java'>
def test_to_device():
    t = lambda x: torch.tensor(0, device=x)  &#47&#47 noqa
    cpu = torch.device(&quotcpu&quot)
    cuda<a id="change"> = </a><a id="change">torch.device(</a>&quotcuda&quot, 0<a id="change">)</a>

    for x in cpu, cuda:
        data = t(x)
        assert hardware.to_device(data, x) is data</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/yura52/zero/commit/0708afabdbb20ff2442b5e95a989e9e2c8f4cf73#diff-cb80af72bc0296acd16fe35bb5dd47444d4067883631c2ebdec239d609e4c057L128' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 32595314</div><div id='project'> Project Name: yura52/zero</div><div id='commit'> Commit Name: 0708afabdbb20ff2442b5e95a989e9e2c8f4cf73</div><div id='time'> Time: 2020-06-10</div><div id='author'> Author: strausmg@gmail.com</div><div id='file'> File Name: zero/tests/test_hardware.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: test_to_device(0)</div><div id='n_method'> N Method Name: test_to_device(0)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: zero/tests/test_hardware.py</div><div id='n_file'> N File Name: zero/tests/test_hardware.py</div><div id='m_start'> M Start Line: 129</div><div id='m_end'> M End Line: 156</div><div id='n_start'> N Start Line: 122</div><div id='n_end'> N End Line: 154</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>

    &#47&#47 Load data
    dataset = MNIST(root=&quot./data&quot, download=True)
    DATA_SPLIT<a id="change"> = </a><a id="change">[</a>50000, 10000<a id="change"></a>]
    train_data, test_data = random_split(dataset.data.float().unsqueeze(dim=1), DATA_SPLIT)
    train_label, test_label = random_split(dataset.targets, DATA_SPLIT)
    train_loader = DataLoader(dataset=MNISTDataset(train_data, train_label),</code></pre><h3>After Change</h3><pre><code class='java'>


def main():
    device<a id="change"> = </a><a id="change">torch.device(</a>&quotcuda&quot if torch.cuda.is_available() else &quotcpu&quot<a id="change">)</a>
    &#47&#47 Load model
    model = CapsNet().to(device)
    criterion = CapsuleLoss()
    optimizer = optim.Adam(model.parameters())</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/riroaki/capsnet/commit/408b1e77f4e40589def9c313c0b11beaa88f2108#diff-b10564ab7d2c520cdd0243874879fb0a782862c3c902ab535faabe57d5a505e1L24' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 32595317</div><div id='project'> Project Name: riroaki/capsnet</div><div id='commit'> Commit Name: 408b1e77f4e40589def9c313c0b11beaa88f2108</div><div id='time'> Time: 2020-03-08</div><div id='author'> Author: aki@akideMacBook-Pro.local</div><div id='file'> File Name: main.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: main(0)</div><div id='n_method'> N Method Name: main(0)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: main.py</div><div id='n_file'> N File Name: main.py</div><div id='m_start'> M Start Line: 25</div><div id='m_end'> M End Line: 75</div><div id='n_start'> N Start Line: 12</div><div id='n_end'> N End Line: 75</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
    vocab_size = config.vocab_size

    dataloader = DataLoader4Glue(task_name=task_name, batch_size = batch_size, datatype=&quotdev&quot)
    data_names<a id="change"> = </a><a id="change">[</a>&quotinput_ids&quot,&quottoken_type_ids&quot,&quotattention_mask&quot,&quotlabel_ids&quot<a id="change"></a>]

    start_model = &quotrandom&quot
</code></pre><h3>After Change</h3><pre><code class='java'>

def validate(args):
    cuda_condition = torch.cuda.is_available()
    device<a id="change"> = </a><a id="change">torch.device(</a>"cuda:%d"%args.gpu_id if cuda_condition else "cpu"<a id="change">)</a>
    task_name = args.task_name
    if task_name in [&quotsst-2&quot,&quotcola&quot, &quotmrpc&quot]:
        num_labels = 2
    elif task_name in [&quotmnli&quot]:</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/hsword/hetu/commit/127e9970d0ad0364767dd1b1946980f58f7b7376#diff-b8af2cc60b2ccc2e812d3904bb6ed86df2566b4abaf047a48f16e5dbdd588f8eL186' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 32595323</div><div id='project'> Project Name: hsword/hetu</div><div id='commit'> Commit Name: 127e9970d0ad0364767dd1b1946980f58f7b7376</div><div id='time'> Time: 2022-01-18</div><div id='author'> Author: 49988457+AFDWang@users.noreply.github.com</div><div id='file'> File Name: examples/nlp/bert/test_glue_pytorch_bert.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: validate(1)</div><div id='n_method'> N Method Name: validate(0)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: examples/nlp/bert/test_glue_pytorch_bert.py</div><div id='n_file'> N File Name: examples/nlp/bert/test_glue_pytorch_bert.py</div><div id='m_start'> M Start Line: 187</div><div id='m_end'> M End Line: 224</div><div id='n_start'> N Start Line: 176</div><div id='n_end'> N End Line: 185</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        print(&quot{} model, anchors, and classes loaded.&quot.format(self.model_path))

        if self.num_classes &lt;= 21:
            self.colors<a id="change"> = </a><a id="change">[</a>(0, 0, 0), (128, 0, 0), (0, 128, 0), (128, 128, 0), (0, 0, 128), (128, 0, 128), (0, 128, 128), 
                    (128, 128, 128), (64, 0, 0), (192, 0, 0), (64, 128, 0), (192, 128, 0), (64, 0, 128), (192, 0, 128), 
                    (64, 128, 128), (192, 128, 128), (0, 64, 0), (128, 64, 0), (0, 192, 0), (128, 192, 0), (0, 64, 128), (128, 64, 12)<a id="change"></a>]
        else:
            &#47&#47 画框设置不同的颜色
            hsv_tuples = [(x / self.num_classes, 1., 1.)</code></pre><h3>After Change</h3><pre><code class='java'>
        &#47&#47-------------------------------&#47&#47
        self.net    = pspnet(num_classes=self.num_classes, downsample_factor=self.downsample_factor, pretrained=False, backbone=self.backbone, aux_branch=False)
        
        device<a id="change">      = </a><a id="change">torch.device(</a>&quotcuda&quot if torch.cuda.is_available() else &quotcpu&quot<a id="change">)</a>
        self.net.load_state_dict(torch.load(self.model_path, map_location=device), strict=False)
        self.net    = self.net.eval()
        print(&quot{} model, and classes loaded.&quot.format(self.model_path))</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/bubbliiiing/pspnet-pytorch/commit/45cb37376cd329f953cb649830de848c0fb0feaf#diff-38a768d1c578b2d27db7acc9725657cc253c28ac0a10247f4d5e51be1b897004L66' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 32595324</div><div id='project'> Project Name: bubbliiiing/pspnet-pytorch</div><div id='commit'> Commit Name: 45cb37376cd329f953cb649830de848c0fb0feaf</div><div id='time'> Time: 2021-11-09</div><div id='author'> Author: 47347516+bubbliiiing@users.noreply.github.com</div><div id='file'> File Name: pspnet.py</div><div id='m_class'> M Class Name: PSPNet</div><div id='n_method'> N Class Name: PSPNet</div><div id='m_method'> M Method Name: generate(1)</div><div id='n_method'> N Method Name: generate(1)</div><div id='m_parent_class'> M Parent Class: object</div><div id='n_parent_class'> N Parent Class: object</div><div id='m_file'> M File Name: pspnet.py</div><div id='n_file'> N File Name: pspnet.py</div><div id='m_start'> M Start Line: 72</div><div id='m_end'> M End Line: 96</div><div id='n_start'> N Start Line: 91</div><div id='n_end'> N End Line: 94</div><BR>