<html><h3>Pattern ID :27282
</h3><img src='81030064.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
            v = updates[module]
            module.weight.grad.data.copy_(v[0])
            module.weight.grad.data.mul_(nu)
            if <a id="change">hasattr(module, &quotbias&quot) and module.bias is not None</a>:
                module.bias.grad.data.copy_(v[1])
                module.bias.grad.data.mul_(nu)
</code></pre><h3>After Change</h3><pre><code class='java'>
        
        vg_sum = 0
        for module in self.layers:
            <a id="change">assert </a>len(updates[module]) == 1
            v = updates[module][0]
            vg_sum += (v[0] * module.weight.grad.data * self.lr ** 2).sum().item()
            if module.bias is not None:</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 5</div><BR><div id='size'>Non-data size: 3</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/gpauloski/kfac_pytorch/commit/08827b57cd169da4019285f008f09874ce64d2e3#diff-f8bd81130d2873ac040fb10d04553ccc9007feaa46af789f709e2f285e3859d2L162' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 81030064</div><div id='project'> Project Name: gpauloski/kfac_pytorch</div><div id='commit'> Commit Name: 08827b57cd169da4019285f008f09874ce64d2e3</div><div id='time'> Time: 2020-05-20</div><div id='author'> Author: gpauloski@yahoo.com</div><div id='file'> File Name: kfac/preconditioner.py</div><div id='m_class'> M Class Name: KFAC</div><div id='n_method'> N Class Name: KFAC</div><div id='m_method'> M Method Name: _update_scale_grad(2)</div><div id='n_method'> N Method Name: _update_scale_grad(2)</div><div id='m_parent_class'> M Parent Class: optim.Optimizer</div><div id='n_parent_class'> N Parent Class: optim.Optimizer</div><div id='m_file'> M File Name: kfac/preconditioner.py</div><div id='n_file'> N File Name: kfac/preconditioner.py</div><div id='m_start'> M Start Line: 162</div><div id='m_end'> M End Line: 173</div><div id='n_start'> N Start Line: 164</div><div id='n_end'> N End Line: 176</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
                &#47&#47 Rescale and perform action
                new_obs, reward, done, _ = env.step(self.max_action * action)

                if <a id="change">hasattr(self.env, &quot_max_episode_steps&quot) and remove_timelimits</a>:
                    done_bool = 0 if episode_timesteps + 1 == env._max_episode_steps else float(done)
                else:
                    done_bool = float(done)</code></pre><h3>After Change</h3><pre><code class='java'>
        episode_rewards = []
        total_timesteps = []

        <a id="change">assert </a>isinstance(env, VecEnv)
        assert env.num_envs == 1

        for _ in range(n_episodes):</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/dlr-rm/stable-baselines3/commit/0e727a5f7263b855bb6b8ebcde47f404fc036f36#diff-809f42ee33a70ea5bb5bec8c668f97ad0b62b632c5f10368759a86ac15aeb126L212' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 81030060</div><div id='project'> Project Name: dlr-rm/stable-baselines3</div><div id='commit'> Commit Name: 0e727a5f7263b855bb6b8ebcde47f404fc036f36</div><div id='time'> Time: 2019-09-20</div><div id='author'> Author: antonin.raffin@dlr.de</div><div id='file'> File Name: torchy_baselines/common/base_class.py</div><div id='m_class'> M Class Name: BaseRLModel</div><div id='n_method'> N Class Name: BaseRLModel</div><div id='m_method'> M Method Name: collect_rollouts(10)</div><div id='n_method'> N Method Name: collect_rollouts(10)</div><div id='m_parent_class'> M Parent Class: object</div><div id='n_parent_class'> N Parent Class: object</div><div id='m_file'> M File Name: torchy_baselines/common/base_class.py</div><div id='n_file'> N File Name: torchy_baselines/common/base_class.py</div><div id='m_start'> M Start Line: 220</div><div id='m_end'> M End Line: 244</div><div id='n_start'> N Start Line: 223</div><div id='n_end'> N End Line: 251</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        biases = module(input)[0, :, module.padding[0], module.padding[1]] if isinstance(module, nn.Conv2d) \
            else module(input)[0, :] &#47&#47 This are the new biases for this module
            
    if <a id="change">hasattr(module, &quotbias&quot) and module.bias is not None</a>:
        module.bias.copy_(biases)

    &#47&#47 Step 2. Propagate output to next module</code></pre><h3>After Change</h3><pre><code class='java'>
        module.bias.data.mul_(~zero_mask)
    
    for output_channel in output[0]:
        <a id="change">assert </a>torch.unique(output_channel).shape[0] == 1

    pass
</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/eidoslab/simplify/commit/0fedfa42be3352fb1a244de2de45ac6e4864009f#diff-c7b0136b5c0f9fa15f6567eb4e996bcb5f2133119a8925b2eb0941f99ca8dbd4L26' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 81030061</div><div id='project'> Project Name: eidoslab/simplify</div><div id='commit'> Commit Name: 0fedfa42be3352fb1a244de2de45ac6e4864009f</div><div id='time'> Time: 2021-05-18</div><div id='author'> Author: carlo.alberto.barbano@outlook.com</div><div id='file'> File Name: simplify.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: propagate_biases_hook(3)</div><div id='n_method'> N Method Name: propagate_biases_hook(3)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: simplify.py</div><div id='n_file'> N File Name: simplify.py</div><div id='m_start'> M Start Line: 38</div><div id='m_end'> M End Line: 45</div><div id='n_start'> N Start Line: 38</div><div id='n_end'> N End Line: 77</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>

    def update(self, model):
        &#47&#47 correct a mismatch in state dict keys
        needs_module = <a id="change">hasattr(model, &quotmodule&quot) and not self.ema_has_module</a>
        with torch.no_grad():
            msd = model.state_dict()
            for k, ema_v in self.ema.state_dict().items():
                if needs_module:</code></pre><h3>After Change</h3><pre><code class='java'>
    def update(self, model):
        with torch.no_grad():
            for ema_v, model_v in zip(self.module.state_dict().values(), model.state_dict().values()):
                <a id="change">assert </a>ema_v.shape == model_v.shape
                if self.device:
                    model_v = model_v.to(device=self.device)
                ema_v.copy_(ema_v * self.decay + (1. - self.decay) * model_v)</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/feng-lab/pytorch-image-models/commit/9214ca071674ce62b0eff36f0a1e3eaaba6ec2e3#diff-5bb6065930f1803057c0b6a81a489e090f005005c5421088867e7c8b6a5ec108L66' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 81030058</div><div id='project'> Project Name: feng-lab/pytorch-image-models</div><div id='commit'> Commit Name: 9214ca071674ce62b0eff36f0a1e3eaaba6ec2e3</div><div id='time'> Time: 2020-11-16</div><div id='author'> Author: rwightman@gmail.com</div><div id='file'> File Name: timm/utils/model_ema.py</div><div id='m_class'> M Class Name: ModelEma</div><div id='n_method'> N Class Name: ModelEma</div><div id='m_method'> M Method Name: update(2)</div><div id='n_method'> N Method Name: update(2)</div><div id='m_parent_class'> M Parent Class: nn.Module</div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: timm/utils/model_ema.py</div><div id='n_file'> N File Name: timm/utils/model_ema.py</div><div id='m_start'> M Start Line: 68</div><div id='m_end'> M End Line: 74</div><div id='n_start'> N Start Line: 44</div><div id='n_end'> N End Line: 45</div><BR>