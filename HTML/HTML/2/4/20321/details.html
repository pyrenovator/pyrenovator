<html><h3>Pattern ID :20321
</h3><img src='66001519.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
            cmd, data = remote.recv()
            if cmd == &quotstep&quot:
                if env.done:
                    <a id="change">env.reset()</a>
                elif data is not None:
                    env.step(data)  &#47&#47 do action
            elif cmd == &quotreset&quot:
                env.reset()</code></pre><h3>After Change</h3><pre><code class='java'>
    lazy_agent = lazy_agent_class(shared_models)
    print("env generated at process ID: {}".format(os.getpid()))

    <a id="change">while </a>not done_event.is_set()<a id="change">:
        </a>env.reset()
        returns = 0
        action<a id="change"> = </a>lazy_agent.act(env.state, env.reward)

        while not env.done:
            with shared_frames.get_lock():
                shared_frames.value<a id="change"> += </a>1
            env.step(action)
            returns += env.reward
            action = lazy_agent.act(env.state, env.reward)</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 4</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/syuntoku14/pytorch-rl-il/commit/44827568e5fb19b2ea99d6b31219a8e82067cab3#diff-bab4baf182865fa63fe1f2a94b02c057f98cc1dc8591b77f5a15aff7a222d37fL15' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 66001519</div><div id='project'> Project Name: syuntoku14/pytorch-rl-il</div><div id='commit'> Commit Name: 44827568e5fb19b2ea99d6b31219a8e82067cab3</div><div id='time'> Time: 2020-04-01</div><div id='author'> Author: syuntoku14@gmail.com</div><div id='file'> File Name: rlil/samplers/sampler.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: worker(9)</div><div id='n_method'> N Method Name: worker(2)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: rlil/samplers/sampler.py</div><div id='n_file'> N File Name: rlil/samplers/sampler.py</div><div id='m_start'> M Start Line: 97</div><div id='m_end'> M End Line: 128</div><div id='n_start'> N Start Line: 15</div><div id='n_end'> N End Line: 50</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        for _ in range(n_episodes):
            done = False
            &#47&#47 Reset environment
            obs = <a id="change">env.reset()</a>
            episode_reward, episode_timesteps = 0.0, 0
            while not done:
                &#47&#47 Select action randomly or according to policy
                if num_timesteps &lt; learning_starts:</code></pre><h3>After Change</h3><pre><code class='java'>
        assert isinstance(env, VecEnv)
        assert env.num_envs == 1

        <a id="change">while </a>total_steps &lt; n_steps or total_episodes &lt; n_episodes<a id="change">:
            </a>done = False
            &#47&#47 Reset environment: not needed for VecEnv
            &#47&#47 obs = env.reset()
            episode_reward, episode_timesteps = 0.0, 0

            while not done:
                &#47&#47 Select action randomly or according to policy
                if num_timesteps &lt; learning_starts:
                    action = [self.action_space.sample()]
                else:
                    action = self.predict(obs, deterministic=deterministic) / self.max_action

                if action_noise_std &gt; 0:
                    &#47&#47 NOTE: in the original implementation of TD3, the noise was applied to the unscaled action
                    action_noise = np.random.normal(0, action_noise_std, size=self.action_space.shape[0])
                    action = (action + action_noise).clip(-1, 1)

                &#47&#47 Rescale and perform action
                &#47&#47 TODO: better rescale
                new_obs, reward, done, _ = env.step(self.max_action * action)

                done_bool = [float(done[0])]
                episode_reward += reward

                &#47&#47 Store data in replay buffer
                if replay_buffer is not None:
                    replay_buffer.add(obs, new_obs, action, reward, done_bool)

                obs = new_obs

                num_timesteps += 1
                episode_timesteps += 1
                total_steps<a id="change"> += </a>1
                if n_steps &gt; 0 and total_steps &gt;= n_steps:
                    break

            if done:
                total_episodes<a id="change"> += </a>1
                episode_rewards.append(episode_reward)
                total_timesteps.append(episode_timesteps)
</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/dlr-rm/stable-baselines3/commit/322399e8fefc9dceed5a13bb389ef374168e32c5#diff-809f42ee33a70ea5bb5bec8c668f97ad0b62b632c5f10368759a86ac15aeb126L218' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 66001551</div><div id='project'> Project Name: dlr-rm/stable-baselines3</div><div id='commit'> Commit Name: 322399e8fefc9dceed5a13bb389ef374168e32c5</div><div id='time'> Time: 2019-09-25</div><div id='author'> Author: antonin.raffin@dlr.de</div><div id='file'> File Name: torchy_baselines/common/base_class.py</div><div id='m_class'> M Class Name: BaseRLModel</div><div id='n_method'> N Class Name: BaseRLModel</div><div id='m_method'> M Method Name: collect_rollouts(11)</div><div id='n_method'> N Method Name: collect_rollouts(9)</div><div id='m_parent_class'> M Parent Class: object</div><div id='n_parent_class'> N Parent Class: object</div><div id='m_file'> M File Name: torchy_baselines/common/base_class.py</div><div id='n_file'> N File Name: torchy_baselines/common/base_class.py</div><div id='m_start'> M Start Line: 222</div><div id='m_end'> M End Line: 262</div><div id='n_start'> N Start Line: 218</div><div id='n_end'> N End Line: 273</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
                    train_traj_returns.append(traj_return)
                    train_traj_lengths.append(traj_length)
                    &#47&#47 reset env and pointer
                    obs = <a id="change">self.train_env.reset()</a>
                    traj_return = 0
                    traj_length = 0
                self.post_step(tot_env_steps)
            sample_used_time = time() - sample_start_time</code></pre><h3>After Change</h3><pre><code class='java'>
            sample_start_time = time()
            env_steps = 0
            num_sampled_trajs = 0
            <a id="change">while </a>env_steps &lt; self.num_env_steps_per_epoch<a id="change">:
                </a>obs<a id="change">, info = </a>self.train_env.reset()
                traj_return = 0
                for traj_step in range(self.max_trajectory_length):
                    &#47&#47 get action
                    action = itemgetter("action")(self.agent.select_action(obs, deterministic=False))
                    next_obs, reward, done, truncated, _ = self.train_env.step(action)

                    traj_return += reward
                    tot_env_steps += 1
                    env_steps<a id="change"> += </a>1

                    truncated = traj_step == self.max_trajectory_length - 1 or truncated
</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/x35f/unstable_baselines/commit/4f0036392d4f35e65516efa47407b0cfbe05eb81#diff-084f54cf4c9712a3f85d6eb7311649aae3804690c3692160d12c8fa0b3fb9579L25' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 66001576</div><div id='project'> Project Name: x35f/unstable_baselines</div><div id='commit'> Commit Name: 4f0036392d4f35e65516efa47407b0cfbe05eb81</div><div id='time'> Time: 2023-01-16</div><div id='author'> Author: 1621322691@qq.com</div><div id='file'> File Name: unstable_baselines/baselines/ppo/trainer.py</div><div id='m_class'> M Class Name: PPOTrainer</div><div id='n_method'> N Class Name: PPOTrainer</div><div id='m_method'> M Method Name: train(1)</div><div id='n_method'> N Method Name: train(1)</div><div id='m_parent_class'> M Parent Class: BaseTrainer</div><div id='n_parent_class'> N Parent Class: BaseTrainer</div><div id='m_file'> M File Name: unstable_baselines/baselines/ppo/trainer.py</div><div id='n_file'> N File Name: unstable_baselines/baselines/ppo/trainer.py</div><div id='m_start'> M Start Line: 26</div><div id='m_end'> M End Line: 72</div><div id='n_start'> N Start Line: 27</div><div id='n_end'> N End Line: 80</div><BR>