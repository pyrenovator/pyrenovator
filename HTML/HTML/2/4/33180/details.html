<html><h3>Pattern ID :33180
</h3><img src='95882551.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
            out = HloTuple((out,))

        &#47&#47 Solve
        cluster_env = <a id="change">ClusterEnvironment(num_devices=4, memory_per_device=1 * 1024**2)</a>
        objective = solve_auto_sharding(computation, cluster_env)

        expected = cluster_env.all_reduce_cost(dim_0 * dim_0 * 4)
        print("Objective:", objective)</code></pre><h3>After Change</h3><pre><code class='java'>
            out = HloTuple((out,))

        &#47&#47 Solve
        mesh_shape = <a id="change">[4</a>, <a id="change">1</a>]
        objective, cluster_env = solve_without_all_gather(computation, mesh_shape)

        expected = cluster_env.all_reduce_cost(dim_0 * dim_0 * 4, 0)</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 6</div><BR><div id='size'>Non-data size: 2</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/alpa-projects/alpa/commit/5c0350d7e7129afbc15ad4a555ea64ff3d332d65#diff-4e9d044d741f1f81e5fb303a450ed24428b7f2330088a976d453570c6a09def2L117' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 95882551</div><div id='project'> Project Name: alpa-projects/alpa</div><div id='commit'> Commit Name: 5c0350d7e7129afbc15ad4a555ea64ff3d332d65</div><div id='time'> Time: 2021-05-04</div><div id='author'> Author: lianminzheng@gmail.com</div><div id='file'> File Name: playground/auto_sharding_solver/test_solver_attention.py</div><div id='m_class'> M Class Name: AttentionSolverTest</div><div id='n_method'> N Class Name: AttentionSolverTest</div><div id='m_method'> M Method Name: test_mulit_reshape(1)</div><div id='n_method'> N Method Name: test_mulit_reshape(1)</div><div id='m_parent_class'> M Parent Class: unittest.TestCase</div><div id='n_parent_class'> N Parent Class: unittest.TestCase</div><div id='m_file'> M File Name: playground/auto_sharding_solver/test_solver_attention.py</div><div id='n_file'> N File Name: playground/auto_sharding_solver/test_solver_attention.py</div><div id='m_start'> M Start Line: 117</div><div id='m_end'> M End Line: 118</div><div id='n_start'> N Start Line: 240</div><div id='n_end'> N End Line: 261</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
            out = HloTuple((out,))

        &#47&#47 Solve
        cluster_env = <a id="change">ClusterEnvironment(num_devices=4, memory_per_device=1 * 1024**2)</a>
        objective = solve_auto_sharding(computation, cluster_env)

        expected = cluster_env.all_reduce_cost(dim_0 * dim_0 * 4)
        print("Objective:", objective)</code></pre><h3>After Change</h3><pre><code class='java'>
            out = HloTuple((out,))

        &#47&#47 Solve
        mesh_shape = <a id="change">[1</a>, <a id="change">4</a>]
        objective, cluster_env = solve_without_all_gather(computation, mesh_shape)

        expected = cluster_env.all_reduce_cost(dim_0 * dim_0 * 4, 1)</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/alpa-projects/alpa/commit/5c0350d7e7129afbc15ad4a555ea64ff3d332d65#diff-4e9d044d741f1f81e5fb303a450ed24428b7f2330088a976d453570c6a09def2L21' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 95882550</div><div id='project'> Project Name: alpa-projects/alpa</div><div id='commit'> Commit Name: 5c0350d7e7129afbc15ad4a555ea64ff3d332d65</div><div id='time'> Time: 2021-05-04</div><div id='author'> Author: lianminzheng@gmail.com</div><div id='file'> File Name: playground/auto_sharding_solver/test_solver_attention.py</div><div id='m_class'> M Class Name: AttentionSolverTest</div><div id='n_method'> N Class Name: AttentionSolverTest</div><div id='m_method'> M Method Name: test_tranpose(1)</div><div id='n_method'> N Method Name: test_tranpose(1)</div><div id='m_parent_class'> M Parent Class: unittest.TestCase</div><div id='n_parent_class'> N Parent Class: unittest.TestCase</div><div id='m_file'> M File Name: playground/auto_sharding_solver/test_solver_attention.py</div><div id='n_file'> N File Name: playground/auto_sharding_solver/test_solver_attention.py</div><div id='m_start'> M Start Line: 37</div><div id='m_end'> M End Line: 38</div><div id='n_start'> N Start Line: 168</div><div id='n_end'> N End Line: 177</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
            out = HloTuple((out,))

        &#47&#47 Solve
        cluster_env = <a id="change">ClusterEnvironment(num_devices=4, memory_per_device=1 * 1024**2)</a>
        objective = solve_auto_sharding(computation, cluster_env)

        expected = cluster_env.all_reduce_cost(dim_0 * dim_0 * 4)
        print("Objective:", objective)</code></pre><h3>After Change</h3><pre><code class='java'>
            out = HloTuple((out,))

        &#47&#47 Solve
        mesh_shape = <a id="change">[1</a>, <a id="change">4</a>]
        objective, cluster_env = solve_without_all_gather(computation, mesh_shape)

        expected = 2 * cluster_env.all_reduce_cost(dim_0 * dim_0 * 4, 1)</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/alpa-projects/alpa/commit/5c0350d7e7129afbc15ad4a555ea64ff3d332d65#diff-4e9d044d741f1f81e5fb303a450ed24428b7f2330088a976d453570c6a09def2L125' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 95882548</div><div id='project'> Project Name: alpa-projects/alpa</div><div id='commit'> Commit Name: 5c0350d7e7129afbc15ad4a555ea64ff3d332d65</div><div id='time'> Time: 2021-05-04</div><div id='author'> Author: lianminzheng@gmail.com</div><div id='file'> File Name: playground/auto_sharding_solver/test_solver_attention.py</div><div id='m_class'> M Class Name: AttentionSolverTest</div><div id='n_method'> N Class Name: AttentionSolverTest</div><div id='m_method'> M Method Name: test_allreduce_simplification(1)</div><div id='n_method'> N Method Name: test_allreduce_simplification(1)</div><div id='m_parent_class'> M Parent Class: unittest.TestCase</div><div id='n_parent_class'> N Parent Class: unittest.TestCase</div><div id='m_file'> M File Name: playground/auto_sharding_solver/test_solver_attention.py</div><div id='n_file'> N File Name: playground/auto_sharding_solver/test_solver_attention.py</div><div id='m_start'> M Start Line: 141</div><div id='m_end'> M End Line: 144</div><div id='n_start'> N Start Line: 282</div><div id='n_end'> N End Line: 285</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
            out = HloTuple((out,))

        &#47&#47 Solve
        cluster_env = <a id="change">ClusterEnvironment(num_devices=4, memory_per_device=1 * 1024**2)</a>
        objective = solve_auto_sharding(computation, cluster_env)

        expected = cluster_env.all_reduce_cost(dim_0 * dim_0 * 4)
        print("Objective:", objective)</code></pre><h3>After Change</h3><pre><code class='java'>
            out = HloTuple((out,))

        &#47&#47 Solve
        mesh_shape = <a id="change">[4</a>, <a id="change">1</a>]
        objective, cluster_env = solve_without_all_gather(computation, mesh_shape)

        expected = cluster_env.all_reduce_cost(dim_0 * dim_0 * 4, 0)</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/alpa-projects/alpa/commit/5c0350d7e7129afbc15ad4a555ea64ff3d332d65#diff-4e9d044d741f1f81e5fb303a450ed24428b7f2330088a976d453570c6a09def2L45' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 95882546</div><div id='project'> Project Name: alpa-projects/alpa</div><div id='commit'> Commit Name: 5c0350d7e7129afbc15ad4a555ea64ff3d332d65</div><div id='time'> Time: 2021-05-04</div><div id='author'> Author: lianminzheng@gmail.com</div><div id='file'> File Name: playground/auto_sharding_solver/test_solver_attention.py</div><div id='m_class'> M Class Name: AttentionSolverTest</div><div id='n_method'> N Class Name: AttentionSolverTest</div><div id='m_method'> M Method Name: test_mulit_tranpose(1)</div><div id='n_method'> N Method Name: test_mulit_tranpose(1)</div><div id='m_parent_class'> M Parent Class: unittest.TestCase</div><div id='n_parent_class'> N Parent Class: unittest.TestCase</div><div id='m_file'> M File Name: playground/auto_sharding_solver/test_solver_attention.py</div><div id='n_file'> N File Name: playground/auto_sharding_solver/test_solver_attention.py</div><div id='m_start'> M Start Line: 65</div><div id='m_end'> M End Line: 66</div><div id='n_start'> N Start Line: 197</div><div id='n_end'> N End Line: 207</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
            out = HloTuple((out,))

        &#47&#47 Solve
        cluster_env = <a id="change">ClusterEnvironment(num_devices=4, memory_per_device=1 * 1024**2)</a>
        objective = solve_auto_sharding(computation, cluster_env)

        expected = cluster_env.all_reduce_cost(dim_0 * dim_0 * 4)
        print("Objective:", objective)</code></pre><h3>After Change</h3><pre><code class='java'>
            out = HloTuple((out,))

        &#47&#47 Solve
        mesh_shape = <a id="change">[1</a>, <a id="change">4</a>]
        objective, cluster_env = solve_without_all_gather(computation, mesh_shape)

        expected = cluster_env.all_reduce_cost(dim_0 * dim_0 * 4, 1)</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/alpa-projects/alpa/commit/5c0350d7e7129afbc15ad4a555ea64ff3d332d65#diff-4e9d044d741f1f81e5fb303a450ed24428b7f2330088a976d453570c6a09def2L73' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 95882541</div><div id='project'> Project Name: alpa-projects/alpa</div><div id='commit'> Commit Name: 5c0350d7e7129afbc15ad4a555ea64ff3d332d65</div><div id='time'> Time: 2021-05-04</div><div id='author'> Author: lianminzheng@gmail.com</div><div id='file'> File Name: playground/auto_sharding_solver/test_solver_attention.py</div><div id='m_class'> M Class Name: AttentionSolverTest</div><div id='n_method'> N Class Name: AttentionSolverTest</div><div id='m_method'> M Method Name: test_reshape(1)</div><div id='n_method'> N Method Name: test_reshape(1)</div><div id='m_parent_class'> M Parent Class: unittest.TestCase</div><div id='n_parent_class'> N Parent Class: unittest.TestCase</div><div id='m_file'> M File Name: playground/auto_sharding_solver/test_solver_attention.py</div><div id='n_file'> N File Name: playground/auto_sharding_solver/test_solver_attention.py</div><div id='m_start'> M Start Line: 89</div><div id='m_end'> M End Line: 90</div><div id='n_start'> N Start Line: 229</div><div id='n_end'> N End Line: 232</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
            out = HloTuple((b1, b2, b3, b4, b5, b6))

        &#47&#47 Solve
        cluster_env = <a id="change">ClusterEnvironment(num_devices=4, memory_per_device=1 * 1024**2)</a>
        objective = solve_auto_sharding(computation, cluster_env)

        expected = cluster_env.all_reduce_cost(dim_0 * dim_0 * 4)
        print("Objective:", objective)</code></pre><h3>After Change</h3><pre><code class='java'>
            out = HloTuple((b1, b2, b3, b4, b5, b6, b7))

        &#47&#47 Solve
        mesh_shape = <a id="change">[1</a>, <a id="change">4</a>]
        objective, cluster_env = solve_without_all_gather(computation, mesh_shape)

        expected = 3 * cluster_env.all_reduce_cost(dim_0 * dim_0 * 4, 1)</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/alpa-projects/alpa/commit/5c0350d7e7129afbc15ad4a555ea64ff3d332d65#diff-4e9d044d741f1f81e5fb303a450ed24428b7f2330088a976d453570c6a09def2L149' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 95882553</div><div id='project'> Project Name: alpa-projects/alpa</div><div id='commit'> Commit Name: 5c0350d7e7129afbc15ad4a555ea64ff3d332d65</div><div id='time'> Time: 2021-05-04</div><div id='author'> Author: lianminzheng@gmail.com</div><div id='file'> File Name: playground/auto_sharding_solver/test_solver_attention.py</div><div id='m_class'> M Class Name: AttentionSolverTest</div><div id='n_method'> N Class Name: AttentionSolverTest</div><div id='m_method'> M Method Name: test_allreduce_simplification_out_reuse(1)</div><div id='n_method'> N Method Name: test_allreduce_simplification_out_reuse(1)</div><div id='m_parent_class'> M Parent Class: unittest.TestCase</div><div id='n_parent_class'> N Parent Class: unittest.TestCase</div><div id='m_file'> M File Name: playground/auto_sharding_solver/test_solver_attention.py</div><div id='n_file'> N File Name: playground/auto_sharding_solver/test_solver_attention.py</div><div id='m_start'> M Start Line: 169</div><div id='m_end'> M End Line: 181</div><div id='n_start'> N Start Line: 310</div><div id='n_end'> N End Line: 323</div><BR>