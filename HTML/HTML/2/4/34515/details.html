<html><h3>Pattern ID :34515
</h3><img src='99296411.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
    if ctx.is_initializing:
        src = step(ctx)(0, src)
    else:
        name_cache<a id="change"> = </a><a id="change">copy.deepcopy(</a>ctx.name_cache<a id="change">)</a>
        for i in range(ctx.dims.sizes.depth):
            src = step(ctx)(i, src)
            ctx.name_cache<a id="change"> = </a>name_cache
    return output_embed(ctx, revnet_out(src))

</code></pre><h3>After Change</h3><pre><code class='java'>
def body_ctx(ctx: Context, src: jnp.ndarray) -&gt; typing.Union[typing.Tuple[jnp.ndarray, jnp.ndarray], jnp.ndarray]:
    src = input_embed(ctx, src)
    zero = shard(jnp.zeros_like(src))
    src = 0<a id="change">, (src, zero, src, zero)</a>
    if ctx.is_initializing:
        src = step(ctx)(src, None)
    else:
        src = lax.scan(step(ctx), src, None, ctx.dims.sizes.depth, unroll=ctx.model.scan_unroll)</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 4</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/homebrewnlp/homebrewnlp-jax/commit/247d60be4be494ee9e6f76e59a597a20ebee0dd3#diff-6159e4e86b1b15ffd250a78dbdf29a41b004b4963154e49f8b96609b8ea977ceL279' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 99296411</div><div id='project'> Project Name: homebrewnlp/homebrewnlp-jax</div><div id='commit'> Commit Name: 247d60be4be494ee9e6f76e59a597a20ebee0dd3</div><div id='time'> Time: 2021-09-18</div><div id='author'> Author: 39779310+ClashLuke@users.noreply.github.com</div><div id='file'> File Name: src/model.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: body_ctx(2)</div><div id='n_method'> N Method Name: body_ctx(2)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: src/model.py</div><div id='n_file'> N File Name: src/model.py</div><div id='m_start'> M Start Line: 279</div><div id='m_end'> M End Line: 289</div><div id='n_start'> N Start Line: 283</div><div id='n_end'> N End Line: 290</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
    rng = np.random.RandomState()

    &#47&#47 copy config so that we don&quott mutate in-place
    tune_config_updates<a id="change"> = </a><a id="change">copy.deepcopy(</a>config<a id="change">)</a>
    del config  &#47&#47 I want a new name for it

    &#47&#47 Run representation learning
    tune_config_updates[&quotrepresentation_learning&quot].update({
        &quotseed&quot: rng.randint(1 &lt;&lt; 31),
    })
    pretrain_result = run_single_exp(rep_ex_config, benchmark_config,
                                     tune_config_updates, log_dir,
                                     &quotrepresentation_learning&quot)

    &#47&#47 Run il train
    tune_config_updates[&quotil_train&quot].update({
        &quotencoder_path&quot: pretrain_result[&quotencoder_path&quot],
        &quotseed&quot: rng.randint(1 &lt;&lt; 31),
    })
    il_train_result = run_single_exp(il_train_ex_config, benchmark_config,
                                     tune_config_updates, log_dir, &quotil_train&quot)

    &#47&#47 Run il test
    tune_config_updates[&quotil_test&quot].update({
        &quotpolicy_path&quot: il_train_result[&quotmodel_path&quot],
        &quotseed&quot: rng.randint(1 &lt;&lt; 31),
    })
    il_test_result = run_single_exp(il_test_ex_config, benchmark_config,
                                    tune_config_updates, log_dir, &quotil_test&quot)
    filtered_result<a id="change"> = </a>{
        k: v
        for k, v in il_test_result.items() if isinstance(v, (int, float))
    }</code></pre><h3>After Change</h3><pre><code class='java'>
        config: The config generated by Ray tune for hyperparameter tuning
        log_dir: The log directory of current chain experiment.
    
    rng<a id="change">, tune_config_updates</a> = setup_run(config)
    del config  &#47&#47 I want a new name for it

    &#47&#47 Run representation learning</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/humancompatibleai/eirli/commit/eff338e14c230a8462ad5a5c29523dedf865a9c5#diff-ac0180ce63420dc2ca54be789611665df0da7f4c04d1cba1b30d255501b86c38L68' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 99296408</div><div id='project'> Project Name: humancompatibleai/eirli</div><div id='commit'> Commit Name: eff338e14c230a8462ad5a5c29523dedf865a9c5</div><div id='time'> Time: 2020-09-04</div><div id='author'> Author: sam@qxcv.net</div><div id='file'> File Name: src/il_representations/scripts/pretrain_n_adapt.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: run_end2end_exp(6)</div><div id='n_method'> N Method Name: run_end2end_exp(6)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: src/il_representations/scripts/pretrain_n_adapt.py</div><div id='n_file'> N File Name: src/il_representations/scripts/pretrain_n_adapt.py</div><div id='m_start'> M Start Line: 87</div><div id='m_end'> M End Line: 121</div><div id='n_start'> N Start Line: 133</div><div id='n_end'> N End Line: 160</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
    rng = np.random.RandomState()

    &#47&#47 copy config so that we don&quott mutate in-place
    tune_config_updates<a id="change"> = </a><a id="change">copy.deepcopy(</a>config<a id="change">)</a>
    del config  &#47&#47 I want a new name for it

    &#47&#47 Run representation learning
    tune_config_updates[&quotrepresentation_learning&quot].update({
        &quotseed&quot: rng.randint(1 &lt;&lt; 31),
    })
    pretrain_result = run_single_exp(rep_ex_config, benchmark_config,
                                     tune_config_updates, log_dir,
                                     &quotrepresentation_learning&quot)

    &#47&#47 Run il train
    tune_config_updates[&quotil_train&quot].update({
        &quotencoder_path&quot: pretrain_result[&quotencoder_path&quot],
        &quotseed&quot: rng.randint(1 &lt;&lt; 31),
    })
    il_train_result = run_single_exp(il_train_ex_config, benchmark_config,
                                     tune_config_updates, log_dir, &quotil_train&quot)

    &#47&#47 Run il test
    tune_config_updates[&quotil_test&quot].update({
        &quotpolicy_path&quot: il_train_result[&quotmodel_path&quot],
        &quotseed&quot: rng.randint(1 &lt;&lt; 31),
    })
    il_test_result = run_single_exp(il_test_ex_config, benchmark_config,
                                    tune_config_updates, log_dir, &quotil_test&quot)
    filtered_result<a id="change"> = </a>{
        k: v
        for k, v in il_test_result.items() if isinstance(v, (int, float))
    }</code></pre><h3>After Change</h3><pre><code class='java'>
        config: The config generated by Ray tune for hyperparameter tuning
        log_dir: The log directory of current chain experiment.
    
    rng<a id="change">, tune_config_updates</a> = setup_run(config)
    del config  &#47&#47 I want a new name for it

    &#47&#47 Run representation learning</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/humancompatibleai/eirli/commit/06a86e0ca2fcf40acd6629d80c26fdf8a6ea92a8#diff-ac0180ce63420dc2ca54be789611665df0da7f4c04d1cba1b30d255501b86c38L68' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 99296413</div><div id='project'> Project Name: humancompatibleai/eirli</div><div id='commit'> Commit Name: 06a86e0ca2fcf40acd6629d80c26fdf8a6ea92a8</div><div id='time'> Time: 2020-09-04</div><div id='author'> Author: sam@qxcv.net</div><div id='file'> File Name: src/il_representations/scripts/pretrain_n_adapt.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: run_end2end_exp(6)</div><div id='n_method'> N Method Name: run_end2end_exp(6)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: src/il_representations/scripts/pretrain_n_adapt.py</div><div id='n_file'> N File Name: src/il_representations/scripts/pretrain_n_adapt.py</div><div id='m_start'> M Start Line: 87</div><div id='m_end'> M End Line: 121</div><div id='n_start'> N Start Line: 133</div><div id='n_end'> N End Line: 160</div><BR>