<html><h3>Pattern ID :2890
</h3><img src='11338829.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
                pass
            elif isinstance(i, (list, tuple, np.ndarray)) and add_btz_dim:
                i = torch.tensor([i], device=self.device)
            elif <a id="change">isinstance(i, (list, tuple, np.ndarray)) and not add_btz_dim</a>:
                i = torch.tensor(i, device=self.device)
            else:
                raise ValueError(&quotBeam search inputs ele only support tensor、array、list、tuple&quot)</code></pre><h3>After Change</h3><pre><code class='java'>
        :param min_ends:
        :return: n个解码序列组成的list。
        
        inputs = <a id="change">self.process_inputs(</a>inputs_raw, add_btz_dim<a id="change">)</a>  &#47&#47 对输入进行处理
        output_ids = self.first_output_ids
        results = []
        for step in range(self.maxlen):</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 4</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/tongjilibo/bert4torch/commit/6de25472f1b96c90835119403579fe5a8250f7bb#diff-5f2128d290e7d03d38af8d6583c7a89df1e6996b620f9ef79c90b549090b467eL404' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 11338829</div><div id='project'> Project Name: tongjilibo/bert4torch</div><div id='commit'> Commit Name: 6de25472f1b96c90835119403579fe5a8250f7bb</div><div id='time'> Time: 2023-03-26</div><div id='author'> Author: tongjilibo@163.com</div><div id='file'> File Name: bert4torch/snippets.py</div><div id='m_class'> M Class Name: AutoRegressiveDecoder</div><div id='n_method'> N Class Name: AutoRegressiveDecoder</div><div id='m_method'> M Method Name: random_sample(9)</div><div id='n_method'> N Method Name: random_sample(9)</div><div id='m_parent_class'> M Parent Class: object</div><div id='n_parent_class'> N Parent Class: object</div><div id='m_file'> M File Name: bert4torch/snippets.py</div><div id='n_file'> N File Name: bert4torch/snippets.py</div><div id='m_start'> M Start Line: 404</div><div id='m_end'> M End Line: 416</div><div id='n_start'> N Start Line: 418</div><div id='n_end'> N End Line: 418</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        self.engine = self._initialize_engine()

    def __call__(self, *args, **kwargs) -&gt; Union[BaseModel, Future]:
        _default_key_val = ("_DEFAULT"<a id="change"></a>,)
        executor = kwargs.get("executor", _default_key_val)

        if executor is _default_key_val:  &#47&#47 do not use ==
            &#47&#47 use executor created during initialization
            executor = self.executor
        else:
            &#47&#47 use passed in executor
            executor = kwargs.pop("executor")

        return (
            executor.submit(self._run, *args, **kwargs)  &#47&#47 Non-Blocking call
            if <a id="change">executor and not self.use_dynamic_batch()</a>
            else self._run(*args, **kwargs)  &#47&#47 Blocking call
        )

    @staticmethod</code></pre><h3>After Change</h3><pre><code class='java'>
            )

        &#47&#47 batch size of the inputs may be `&gt; self._batch_size` at this point
        engine_inputs: List[numpy.ndarray] = <a id="change">self.process_inputs(</a>pipeline_inputs<a id="change">)</a>
        if isinstance(engine_inputs, tuple):
            engine_inputs, postprocess_kwargs = engine_inputs
        else:
            postprocess_kwargs = {}</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/neuralmagic/deepsparse/commit/51a99e18329a82cfff93b9cda06eb4f6983c64e2#diff-bab8a867c64069e2efe49cfb9a3ada579e3058fa48bdafcc743f1cca24bcd147L179' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 11338831</div><div id='project'> Project Name: neuralmagic/deepsparse</div><div id='commit'> Commit Name: 51a99e18329a82cfff93b9cda06eb4f6983c64e2</div><div id='time'> Time: 2022-08-30</div><div id='author'> Author: 109536191+corey-nm@users.noreply.github.com</div><div id='file'> File Name: src/deepsparse/pipeline.py</div><div id='m_class'> M Class Name: Pipeline</div><div id='n_method'> N Class Name: Pipeline</div><div id='m_method'> M Method Name: __call__(1)</div><div id='n_method'> N Method Name: __call__(1)</div><div id='m_parent_class'> M Parent Class: ABC</div><div id='n_parent_class'> N Parent Class: ABC</div><div id='m_file'> M File Name: src/deepsparse/pipeline.py</div><div id='n_file'> N File Name: src/deepsparse/pipeline.py</div><div id='m_start'> M Start Line: 180</div><div id='m_end'> M End Line: 194</div><div id='n_start'> N Start Line: 180</div><div id='n_end'> N End Line: 224</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
                pass
            elif isinstance(i, (list, tuple, np.ndarray)) and add_btz_dim:
                i = torch.tensor([i], device=self.device)
            elif <a id="change">isinstance(i, (list, tuple, np.ndarray)) and not add_btz_dim</a>:
                i = torch.tensor(i, device=self.device)
            else:
                raise ValueError(&quotBeam search inputs ele only support tensor、array、list、tuple&quot)</code></pre><h3>After Change</h3><pre><code class='java'>
        :param add_btz_dim: bool, 是否保留btz维度, 默认为True
        :return: 最优解码序列。
        
        inputs = <a id="change">self.process_inputs(</a>inputs_raw, add_btz_dim<a id="change">)</a>  &#47&#47 对输入进行处理
        output_ids, output_scores = self.first_output_ids, torch.zeros(1, device=self.device)
        for step in range(self.maxlen):
            scores, states = self.predict(inputs, output_ids, states, temperature, &quotlogits&quot)  &#47&#47 计算当前得分</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/tongjilibo/bert4torch/commit/6de25472f1b96c90835119403579fe5a8250f7bb#diff-5f2128d290e7d03d38af8d6583c7a89df1e6996b620f9ef79c90b549090b467eL341' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 11338830</div><div id='project'> Project Name: tongjilibo/bert4torch</div><div id='commit'> Commit Name: 6de25472f1b96c90835119403579fe5a8250f7bb</div><div id='time'> Time: 2023-03-26</div><div id='author'> Author: tongjilibo@163.com</div><div id='file'> File Name: bert4torch/snippets.py</div><div id='m_class'> M Class Name: AutoRegressiveDecoder</div><div id='n_method'> N Class Name: AutoRegressiveDecoder</div><div id='m_method'> M Method Name: beam_search(7)</div><div id='n_method'> N Method Name: beam_search(7)</div><div id='m_parent_class'> M Parent Class: object</div><div id='n_parent_class'> N Parent Class: object</div><div id='m_file'> M File Name: bert4torch/snippets.py</div><div id='n_file'> N File Name: bert4torch/snippets.py</div><div id='m_start'> M Start Line: 352</div><div id='m_end'> M End Line: 364</div><div id='n_start'> N Start Line: 377</div><div id='n_end'> N End Line: 377</div><BR>