<html><h3>Pattern ID :22053
</h3><img src='69877450.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
    h, w = img.shape[2:]
    s = (int(h * ratio), int(w * ratio))  &#47&#47 new size
    img = F.interpolate(img, size=s, mode=&quotbilinear&quot, align_corners=False)  &#47&#47 resize
    p = h<a id="change"> - </a>s[0], w - s[1]
    if not same_shape:  &#47&#47 pad/crop img
        p = [<a id="change">int(</a>math.fmod(x, 64)<a id="change">)</a> for x in p]  &#47&#47 pad to 64 grid size
    return F.pad(img, [0, p[1], 0, p[0]], value=0.447)  &#47&#47 value = imagenet mean

</code></pre><h3>After Change</h3><pre><code class='java'>
    img = F.interpolate(img, size=s, mode=&quotbilinear&quot, align_corners=False)  &#47&#47 resize
    if not same_shape:  &#47&#47 pad/crop img
        gs = 64  &#47&#47 (pixels) grid size
        h, w = [<a id="change">math.ceil(</a>x<a id="change"> * ratio / </a>gs<a id="change">)</a> * gs for x in (h, w)]
    return F.pad(img, [0, w - s[1], 0, h - s[0]], value=0.447)  &#47&#47 value = imagenet mean

</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 4</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/nightsnack/yolobile/commit/b9b14bef590141c201b5aad74147e82b0fb18903#diff-a4cd44fa2e00ba300e04c8799657a2329509edef8e79a488ccfb3464e7dc4394L121' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 69877450</div><div id='project'> Project Name: nightsnack/yolobile</div><div id='commit'> Commit Name: b9b14bef590141c201b5aad74147e82b0fb18903</div><div id='time'> Time: 2020-04-07</div><div id='author'> Author: glenn.jocher@ultralytics.com</div><div id='file'> File Name: utils/torch_utils.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: scale_img(3)</div><div id='n_method'> N Method Name: scale_img(3)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: utils/torch_utils.py</div><div id='n_file'> N File Name: utils/torch_utils.py</div><div id='m_start'> M Start Line: 121</div><div id='m_end'> M End Line: 126</div><div id='n_start'> N Start Line: 121</div><div id='n_end'> N End Line: 126</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        if norm_layer is None:
            norm_layer = nn.BatchNorm2d

        hidden_dim = <a id="change">int(</a>round(inp<a id="change"> / </a>expand_ratio)<a id="change">)</a>
        self.use_res_connect = self.stride == 1 and inp == oup

        layers = []
        &#47&#47 dw</code></pre><h3>After Change</h3><pre><code class='java'>

        hidden_dim = inp // expand_ratio
        if hidden_dim &lt; oup /6.:
            hidden_dim = <a id="change">math.ceil(</a>oup<a id="change"> / </a>6.<a id="change">)</a>
            hidden_dim = _make_divisible(hidden_dim, 16)

        self.use_res_connect = self.stride == 1 and inp == oup
</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/rangilyu/mobilenext/commit/bc5773f58943aff347c17356af4e671cfe11fe1b#diff-73413f940c0f3a8d6d16c811fd256cb7be48915d6bd50d24e1ae1227b6467c60L48' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 69877405</div><div id='project'> Project Name: rangilyu/mobilenext</div><div id='commit'> Commit Name: bc5773f58943aff347c17356af4e671cfe11fe1b</div><div id='time'> Time: 2020-08-09</div><div id='author'> Author: lyuchqi@gmail.com</div><div id='file'> File Name: mobilenext.py</div><div id='m_class'> M Class Name: SandGlass</div><div id='n_method'> N Class Name: SandGlass</div><div id='m_method'> M Method Name: __init__(7)</div><div id='n_method'> N Method Name: __init__(7)</div><div id='m_parent_class'> M Parent Class: nn.Module</div><div id='n_parent_class'> N Parent Class: nn.Module</div><div id='m_file'> M File Name: mobilenext.py</div><div id='n_file'> N File Name: mobilenext.py</div><div id='m_start'> M Start Line: 58</div><div id='m_end'> M End Line: 58</div><div id='n_start'> N Start Line: 63</div><div id='n_end'> N End Line: 68</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
    if exists(mask):
        logits = logits.masked_fill(~mask, -torch.finfo(logits.dtype).max)

    num_keep = max(1,  <a id="change">int(</a>(1 - dropout)<a id="change"> * </a>n<a id="change">)</a>)
    keep_indices = logits.topk(num_keep, dim = 1).indices

    batch_indices = torch.arange(b, device = device)</code></pre><h3>After Change</h3><pre><code class='java'>

    if exists(mask):
        seq_counts = mask.sum(dim = -1)
        seq_keep_counts = <a id="change">torch.ceil(</a>seq_counts<a id="change"> * </a>keep_prob<a id="change">)</a>.int()
        keep_mask = torch.arange(num_keep, device = device) &lt; rearrange(seq_keep_counts, &quotb -&gt; b 1&quot)

        mask = mask[batch_indices, keep_indices] & keep_mask</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/lucidrains/perceiver-pytorch/commit/c8c5f5721520460369a66b8a0e9c5147df4a883e#diff-d109c4942e7a2f6d51cd8e55cbab114efc5eb0b0ce37d8e682449385df84ec13L33' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 69877462</div><div id='project'> Project Name: lucidrains/perceiver-pytorch</div><div id='commit'> Commit Name: c8c5f5721520460369a66b8a0e9c5147df4a883e</div><div id='time'> Time: 2022-12-04</div><div id='author'> Author: lucidrains@gmail.com</div><div id='file'> File Name: perceiver_pytorch/perceiver_io.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: dropout_seq(3)</div><div id='n_method'> N Method Name: dropout_seq(3)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: perceiver_pytorch/perceiver_io.py</div><div id='n_file'> N File Name: perceiver_pytorch/perceiver_io.py</div><div id='m_start'> M Start Line: 40</div><div id='m_end'> M End Line: 51</div><div id='n_start'> N Start Line: 40</div><div id='n_end'> N End Line: 56</div><BR>