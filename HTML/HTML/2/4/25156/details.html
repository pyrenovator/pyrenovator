<html><h3>Pattern ID :25156
</h3><img src='76955654.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
    dsets = [hparams["train_data"], hparams["valid_data"], hparams["test_data"]]
    for dset in dsets:
        encoder.update_from_didataset(dset, "phn", sequence_input=True)
    <a id="change">for </a>dset in dsets<a id="change">:
        </a>dset.add_dynamic_item("phn_enc", encoder.encode_sequence_torch, "phn")
        dset.set_output_keys(<a id="change">[</a>"id", "wav", "phn_enc"<a id="change"></a>])

    align_brain = AlignBrain(hparams["modules"], hparams["opt_class"], hparams)
    align_brain.fit(</code></pre><h3>After Change</h3><pre><code class='java'>
        **hparams["dataloader_options"],
    )
    &#47&#47 Evaluation is run separately (now just evaluating on valid data)
    <a id="change">ali_brain.evaluate(</a>valid_data<a id="change">)</a>

    &#47&#47 Check if model overfits for integration test
    assert ali_brain.train_loss &lt; 2.0
</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 3</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/speechbrain/speechbrain/commit/c9b83509f0a07e61ef75f23e359eec163c98ad12#diff-622d5df03e625bb4d8694f7dfc1d3452f0520a0433e22aacc87ade0d4f2d80cfL46' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 76955654</div><div id='project'> Project Name: speechbrain/speechbrain</div><div id='commit'> Commit Name: c9b83509f0a07e61ef75f23e359eec163c98ad12</div><div id='time'> Time: 2020-12-26</div><div id='author'> Author: mirco.ravabelli@gmail.com</div><div id='file'> File Name: recipes/minimal_examples/neural_networks/ASR_alignment_viterbi/example_asr_alignment_viterbi_experiment.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: main(0)</div><div id='n_method'> N Method Name: main(0)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: recipes/minimal_examples/neural_networks/ASR_alignment_viterbi/example_asr_alignment_viterbi_experiment.py</div><div id='n_file'> N File Name: recipes/minimal_examples/neural_networks/ASR_alignment_viterbi/example_asr_alignment_viterbi_experiment.py</div><div id='m_start'> M Start Line: 46</div><div id='m_end'> M End Line: 72</div><div id='n_start'> N Start Line: 106</div><div id='n_end'> N End Line: 132</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
    dsets = [hparams["train_data"], hparams["valid_data"], hparams["test_data"]]
    for dset in dsets:
        encoder.update_from_didataset(dset, "phn", sequence_input=True)
    <a id="change">for dset</a> in dsets<a id="change">:
        </a>dset.add_dynamic_item("phn_enc", encoder.encode_sequence_torch, "phn")
        dset.set_output_keys(<a id="change">[</a>"id", "wav", "phn_enc"<a id="change"></a>])

    align_brain = AlignBrain(hparams["modules"], hparams["opt_class"], hparams)
    align_brain.fit(</code></pre><h3>After Change</h3><pre><code class='java'>
        **hparams["dataloader_options"],
    )
    &#47&#47 Evaluation is run separately (now just evaluating on valid data)
    <a id="change">ali_brain.evaluate(</a>valid_data<a id="change">)</a>

    &#47&#47 Check if model overfits for integration test
    assert ali_brain.train_loss &lt; 350
</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/speechbrain/speechbrain/commit/c9b83509f0a07e61ef75f23e359eec163c98ad12#diff-e20298faf3b32decf3c2d27c9372cc7a32c2fd78d98522d95b42bbf3c2db0a15L43' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 76955655</div><div id='project'> Project Name: speechbrain/speechbrain</div><div id='commit'> Commit Name: c9b83509f0a07e61ef75f23e359eec163c98ad12</div><div id='time'> Time: 2020-12-26</div><div id='author'> Author: mirco.ravabelli@gmail.com</div><div id='file'> File Name: recipes/minimal_examples/neural_networks/ASR_alignment_forward/example_asr_alignment_forward_experiment.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: main(0)</div><div id='n_method'> N Method Name: main(0)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: recipes/minimal_examples/neural_networks/ASR_alignment_forward/example_asr_alignment_forward_experiment.py</div><div id='n_file'> N File Name: recipes/minimal_examples/neural_networks/ASR_alignment_forward/example_asr_alignment_forward_experiment.py</div><div id='m_start'> M Start Line: 44</div><div id='m_end'> M End Line: 70</div><div id='n_start'> N Start Line: 100</div><div id='n_end'> N End Line: 126</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
    def _valid_epoch(self, valid_data):
        self.model.eval()
        batch_result_list, batch_size_list = [], []
        <a id="change">for </a>batch_idx, <a id="change">interaction</a> in enumerate(valid_data)<a id="change">:
            </a>users = interaction[&quotuser_id&quot].to(self.device)
            items = interaction[&quotitem_id&quot].to(self.device)
            scores = self.model.predict(users, items)
            batch_size = users.size()[0]
            users = users.cpu().numpy()
            items = items.cpu().numpy()
            scores = scores.detach().cpu().numpy()
            batch_result = self.evaluator.evaluate(<a id="change">[</a>users, items, scores<a id="change"></a>], valid_data)
            batch_result_list.append(batch_result)
            batch_size_list.append(batch_size)
        valid_result = self.evaluator.collect(batch_result_list, batch_size_list)</code></pre><h3>After Change</h3><pre><code class='java'>

    def _valid_epoch(self, valid_data):
        self.model.eval()
        valid_result = <a id="change">self.evaluate(</a>valid_data<a id="change">)</a>
        valid_score = calculate_valid_score(valid_result)
        return valid_score, valid_result
</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/rucaibox/recbole/commit/5cdb3f2f291c452e0242da319cebf5bb84f1d30e#diff-0564ece5aadc13d5923043addc422a8058c6d96026493e84652cedc2f1bdca99L59' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 76955653</div><div id='project'> Project Name: rucaibox/recbole</div><div id='commit'> Commit Name: 5cdb3f2f291c452e0242da319cebf5bb84f1d30e</div><div id='time'> Time: 2020-06-29</div><div id='author'> Author: 2015201909@ruc.edu.cn</div><div id='file'> File Name: trainer/trainer.py</div><div id='m_class'> M Class Name: Trainer</div><div id='n_method'> N Class Name: Trainer</div><div id='m_method'> M Method Name: _valid_epoch(2)</div><div id='n_method'> N Method Name: _valid_epoch(2)</div><div id='m_parent_class'> M Parent Class: object</div><div id='n_parent_class'> N Parent Class: object</div><div id='m_file'> M File Name: trainer/trainer.py</div><div id='n_file'> N File Name: trainer/trainer.py</div><div id='m_start'> M Start Line: 61</div><div id='m_end'> M End Line: 73</div><div id='n_start'> N Start Line: 67</div><div id='n_end'> N End Line: 67</div><BR>