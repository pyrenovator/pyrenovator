<html><h3>Pattern ID :15583
</h3><img src='52804117.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>

        if arg.dtype == torch.float64:
            print(&quot[Warning] Auto convert float64 to float32, this could lead to extra memory usage.&quot)
            arg<a id="change"> = </a><a id="change">arg.float()</a>
        elif arg.dtype == torch.int32:
            print(&quot[Warning] Auto convert int32 to int64, this could lead to extra memory usage.&quot)
            arg = arg.long()
</code></pre><h3>After Change</h3><pre><code class='java'>
        return _to_tensor_leaf(arg)

def to_tensor(*args):
    rt = <a id="change">[_deep_to_tensor(arg) for arg in args]</a>            
    return rt[0] if len(rt) == 1 else tuple(rt)

</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 4</div><BR><div id='size'>Non-data size: 4</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/blueloveth/keras4torch/commit/f334e243f1c1df92c245d7f2da9f6a859b63f45c#diff-2b21f9d85f1765f614ca6ed1055626d6054ca33047b21db8aeec538566ca9387L6' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 52804117</div><div id='project'> Project Name: blueloveth/keras4torch</div><div id='commit'> Commit Name: f334e243f1c1df92c245d7f2da9f6a859b63f45c</div><div id='time'> Time: 2020-12-30</div><div id='author'> Author: blueloveTH@qq.com</div><div id='file'> File Name: keras4torch/utils.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: to_tensor(0)</div><div id='n_method'> N Method Name: to_tensor(0)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: keras4torch/utils.py</div><div id='n_file'> N File Name: keras4torch/utils.py</div><div id='m_start'> M Start Line: 6</div><div id='m_end'> M End Line: 22</div><div id='n_start'> N Start Line: 26</div><div id='n_end'> N End Line: 26</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
            x = self.torch_transform(x)
            y_heatmap = draw_keypoints(y, x.shape[-2], x.shape[-1], self.output_shape, sigma = 5)
            label_heatmaps.append(y_heatmap)
        self.label_heatmaps = <a id="change">torch.from_numpy(np.asarray(label_heatmaps)).float()</a>
        self.label_heatmaps<a id="change"> = </a>self.label_heatmaps.permute(0, 3, 1, 2)
        &#47&#47check that nan keypoints are producing heatmaps of zeros
        &#47&#47check that max of heatmaps look good
        self.transform = transform</code></pre><h3>After Change</h3><pre><code class='java'>
        &#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47
        self.fully_labeled_idxs = self.get_fully_labeled_idxs()
        print(self.fully_labeled_idxs)
        self.image_names = <a id="change">[self.image_names[idx] for idx in self.fully_labeled_idxs]</a>
        self.labels = [self.labels[idx] for idx in self.fully_labeled_idxs]
        print(len(self.image_names), len(self.labels))
        &#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47&#47
</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/danbider/lightning-pose/commit/545a2f0293f923aca78924357ba161baf71f2982#diff-0779795c0a8a233449cfa9c0bd55d45453213457b10fa40da3e5a32966494943L58' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 52804119</div><div id='project'> Project Name: danbider/lightning-pose</div><div id='commit'> Commit Name: 545a2f0293f923aca78924357ba161baf71f2982</div><div id='time'> Time: 2021-07-15</div><div id='author'> Author: ubuntu@ip-172-31-72-121.ec2.internal</div><div id='file'> File Name: pose_est_nets/datasets/datasets.py</div><div id='m_class'> M Class Name: DLCHeatmapDataset</div><div id='n_method'> N Class Name: DLCHeatmapDataset</div><div id='m_method'> M Method Name: __init__(5)</div><div id='n_method'> N Method Name: __init__(5)</div><div id='m_parent_class'> M Parent Class: torch.utils.data.Dataset</div><div id='n_parent_class'> N Parent Class: torch.utils.data.Dataset</div><div id='m_file'> M File Name: pose_est_nets/datasets/datasets.py</div><div id='n_file'> N File Name: pose_est_nets/datasets/datasets.py</div><div id='m_start'> M Start Line: 80</div><div id='m_end'> M End Line: 137</div><div id='n_start'> N Start Line: 80</div><div id='n_end'> N End Line: 114</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        &#47&#47 for k in topk:
        &#47&#47     correct_k = correct[:k].reshape(-1).float().sum(0, keepdim=True)
        &#47&#47     res.append(correct_k.mul_(100.0 / batch_size))
        correct_k<a id="change"> = </a><a id="change">correct[:topk].reshape(-1).float()</a>.sum(0, keepdim=True)
        res = correct_k.mul_(100.0 / batch_size).item()
        return res
</code></pre><h3>After Change</h3><pre><code class='java'>
    _, pred = output.topk(maxk, 1, True, True)
    pred = pred.t()
    correct = pred.eq(target.reshape(1, -1).expand_as(pred))
    return <a id="change">[
        (correct[: min(k, maxk)].reshape(-1).float().sum(0) * 100.0 / batch_size).item()
        for k in topk
    ]</a>


class ClsEvaluator(DatasetEvaluator):
    def __init__(self, cfg):</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/oneflow-inc/libai/commit/371360b9b903675607d2f92544962eb8b2330a17#diff-97abbafe7759c5aefa52f03808bfda50cfe14f401be4ede27bce57a8eef0f929L29' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 52804108</div><div id='project'> Project Name: oneflow-inc/libai</div><div id='commit'> Commit Name: 371360b9b903675607d2f92544962eb8b2330a17</div><div id='time'> Time: 2022-02-13</div><div id='author'> Author: 48727989+rentainhe@users.noreply.github.com</div><div id='file'> File Name: libai/evaluation/cls_evaluator.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: accuracy(3)</div><div id='n_method'> N Method Name: accuracy(3)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: libai/evaluation/cls_evaluator.py</div><div id='n_file'> N File Name: libai/evaluation/cls_evaluator.py</div><div id='m_start'> M Start Line: 31</div><div id='m_end'> M End Line: 49</div><div id='n_start'> N Start Line: 28</div><div id='n_end'> N End Line: 36</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        if self.proj is not None and self.pre_proj:
            x = self.proj(x)

        x<a id="change"> = </a>x.mean(-2) / <a id="change">x_len.float()</a>.unsqueeze(-1)

        if self.proj is not None and not self.pre_proj:
            x = self.proj(x)</code></pre><h3>After Change</h3><pre><code class='java'>
            x = self.pre_proj(x)

        if x_len is not None:
            x = <a id="change">[x[b, : x_len[b]].mean(0) for b in range(len(x))]</a>
            x = torch.stack(x, dim=0)
        else:
            x = x.mean(1)
</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/atosystem/speechclip/commit/b2d7d1450922b5f68626bcc7751faf4feca14ed5#diff-36cf0d2ba2e002faba923e96cac943aa23122917b021c2258ac13f6f611ab652L21' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 52804107</div><div id='project'> Project Name: atosystem/speechclip</div><div id='commit'> Commit Name: b2d7d1450922b5f68626bcc7751faf4feca14ed5</div><div id='time'> Time: 2022-03-19</div><div id='author'> Author: b06901020@ntu.edu.tw</div><div id='file'> File Name: avssl/module/pooling.py</div><div id='m_class'> M Class Name: MeanPoolingLayer</div><div id='n_method'> N Class Name: MeanPoolingLayer</div><div id='m_method'> M Method Name: forward(3)</div><div id='n_method'> N Method Name: forward(3)</div><div id='m_parent_class'> M Parent Class: nn.Module</div><div id='n_parent_class'> N Parent Class: nn.Module</div><div id='m_file'> M File Name: avssl/module/pooling.py</div><div id='n_file'> N File Name: avssl/module/pooling.py</div><div id='m_start'> M Start Line: 22</div><div id='m_end'> M End Line: 28</div><div id='n_start'> N Start Line: 46</div><div id='n_end'> N End Line: 58</div><BR>