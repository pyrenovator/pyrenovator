<link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
        self.evict_backlist.clear()
        &#47&#47 new ids chunk_offset + offset_in_chunk
        with record_function("(zhg) embed idx -&gt; cache chunk id"):
            mapped_ids = <a id="change">torch.tensor(</a>[self._id_to_cached_cuda_id(id) for id in ids.view(-1)]<a id="change">,
                                      device=ids.device,
                                      dtype=ids.dtype)</a>.view(ids.shape)

        return mapped_ids
</code></pre><h3>After Change</h3><pre><code class='java'>
            &#47&#47 self.IMT_Embedding(ids)

            chunk_id_set = torch.unique(self.IMP_chunkid_Embedding(ids))
            chunk_id_set<a id="change"> = </a>set(<a id="change">chunk_id_set.cpu().numpy()</a>)

            assert len(chunk_id_set) &lt;= self.cuda_chunk_num, \
                f"the input indices pull {len(chunk_id_set)} chunks, " \</code></pre>