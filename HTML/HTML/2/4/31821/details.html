<html><h3>Pattern ID :31821
</h3><img src='93048491.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
        bar0.insert(0, tempo, ignoreSort=True)
        ic(list(bar0))
        idx = bar0.index(tempo)
        <a id="change">ic(</a>idx<a id="change">)</a>
        ic(bar0.isSorted)

        for bar in part[m21.stream.Measure]:
            tempos = bar[m21.tempo.MetronomeMark]</code></pre><h3>After Change</h3><pre><code class='java'>
        ic(scr.metadata.composer)
        title = scr.metadata.title
        if title.endswith(&quot.mxl&quot):
            title<a id="change"> = title[:-4]</a>

        if exp == &quotstream&quot:
            fnm = f&quot{title}, bar with max pitch.mxl&quot
            &#47&#47 ic(os.path.join(PATH_BASE, DIR_DSET, config(f&quot{DIR_DSET}.MXL_EG.dir_nm&quot)))</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 4</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/stefanheng/symbolic-music-generation/commit/30a8207cd105223f3d0c073913fddd41937f1c22#diff-9bddc1ec410935c3b7e65a0e53b587a68e1dda58d8f63e4abcaf788573ad9f27L309' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 93048491</div><div id='project'> Project Name: stefanheng/symbolic-music-generation</div><div id='commit'> Commit Name: 30a8207cd105223f3d0c073913fddd41937f1c22</div><div id='time'> Time: 2021-11-25</div><div id='author'> Author: 43276957+SpongeBobBang@users.noreply.github.com</div><div id='file'> File Name: melody_extractor.py</div><div id='m_class'> M Class Name: MxlMelodyExtractor</div><div id='n_method'> N Class Name: MxlMelodyExtractor</div><div id='m_method'> M Method Name: bar_with_max_pitch(2)</div><div id='n_method'> N Method Name: bar_with_max_pitch(2)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: melody_extractor.py</div><div id='n_file'> N File Name: melody_extractor.py</div><div id='m_start'> M Start Line: 322</div><div id='m_end'> M End Line: 370</div><div id='n_start'> N Start Line: 309</div><div id='n_end'> N End Line: 361</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        time_sig, tempo = time_sigs[0], tempos[0]

        toks = [self.vocab(time_sig), self.vocab(tempo)]
        <a id="change">ic(</a>toks<a id="change">)</a>

        for bar in bars:
            assert all(not isinstance(e, m21.stream.Voice) for e in bar), f&quotInvalid Bar: Expect no voice - {warn}&quot
            &#47&#47 ic(bar, list(bar))</code></pre><h3>After Change</h3><pre><code class='java'>
        &#47&#47 TODO: since melody only for now
        assert len(parts) == 1, f&quotInvalid &#47&#47Parts: Expect only 1 part from the extracted score - {warn}&quot
        part = parts[0]
        <a id="change">bars</a> = list(part[Measure])
        bar_nums = np.array([bar.number for bar in bars])
        assert np.array_equal(bar_nums, np.arange(0, len(bars))), \
            f&quotInvalid Bar numbers: Bar numbers should be consecutive integers starting from 0 - {warn}&quot
        bar0 = bars[0]
        time_sigs, tempos = bar0[TimeSignature], bar0[MetronomeMark]
        assert len(time_sigs) == 1, f&quotInvalid &#47&#47Time Signatures: Expect only 1 time signature - {warn}&quot
        assert len(tempos) == 1, f&quotInvalid &#47&#47Tempo: Expect only 1 tempo - {warn}&quot
        time_sig, tempo = time_sigs[0], tempos[0]
        toks = [self.vocab(time_sig), self.vocab(tempo)]

        for_gen = n_bar is not None
        if for_gen:
            assert n_bar &gt; 0, f&quotInvalid {logi("n_bar")}: Expects positive integer&quot
            bars<a id="change"> = </a><a id="change">bars[:min(n_bar, len(bars))]</a>
        for bar in bars:
            assert all(not isinstance(e, m21.stream.Voice) for e in bar), f&quotInvalid Bar: Expect no voice - {warn}&quot
            toks.extend([self.vocab(e) for e in self._bar2grouped_bar(bar)])
        &#47&#47 ic(toks)</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/stefanheng/symbolic-music-generation/commit/b5a651532993905e278eb0d242cf773e47f86078#diff-e552dfb32db814167cece91cd239e95a2391d9449f1f7a1fe7e8d6d5391af5c5L68' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 93048490</div><div id='project'> Project Name: stefanheng/symbolic-music-generation</div><div id='commit'> Commit Name: b5a651532993905e278eb0d242cf773e47f86078</div><div id='time'> Time: 2022-04-02</div><div id='author'> Author: 43276957+SpongeBobBang@users.noreply.github.com</div><div id='file'> File Name: musicnlp/postprocess/music_converter.py</div><div id='m_class'> M Class Name: MusicConverter</div><div id='n_method'> N Class Name: MusicConverter</div><div id='m_method'> M Method Name: mxl2str(4)</div><div id='n_method'> N Method Name: mxl2str(3)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: musicnlp/postprocess/music_converter.py</div><div id='n_file'> N File Name: musicnlp/postprocess/music_converter.py</div><div id='m_start'> M Start Line: 91</div><div id='m_end'> M End Line: 107</div><div id='n_start'> N Start Line: 52</div><div id='n_end'> N End Line: 93</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
            try:
                eig_vals, eig_vecs = torch.linalg.eigh(L_sym)
            except Exception as e:
                <a id="change">ic(</a>e<a id="change">)</a>
                ic(A)
                ic(D)
                ic(sparse)
            idx = eig_vals.argsort()[0: self.num_freq]  &#47&#47 Keep up to the maximum desired number of frequencies</code></pre><h3>After Change</h3><pre><code class='java'>
        if idx in self.pos_enc:
            return self.pos_enc[idx]
        else:
            <a id="change">graph_info</a> = self.graphs[idx]
            edge_index = graph_info[&quotedge_index&quot]
            n_atoms<a id="change"> = </a><a id="change">graph_info[&quotnum_nodes&quot]</a>
            sparse = torch.sparse_coo_tensor(edge_index, torch.ones(edge_index.shape[1]),size=(n_atoms,n_atoms), device=self.device)
            A = sparse.to_dense()
            A += torch.eye(n_atoms, device=self.device)
            D = A.sum(dim=0)</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/hannesstark/3dinfomax/commit/a165907548f15c7571758457fe0867a83ad049dc#diff-00c0b7d1372a036461dcac2adc1681c64211ebeb68bfa6e067ed803dafb1b4deL68' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 93048489</div><div id='project'> Project Name: hannesstark/3dinfomax</div><div id='commit'> Commit Name: a165907548f15c7571758457fe0867a83ad049dc</div><div id='time'> Time: 2021-07-03</div><div id='author'> Author: hannes.staerk@gmail.com</div><div id='file'> File Name: datasets/ogbg_dataset_extension.py</div><div id='m_class'> M Class Name: OGBGDatsetExtension</div><div id='n_method'> N Class Name: OGBGDatsetExtension</div><div id='m_method'> M Method Name: get_pos_enc(2)</div><div id='n_method'> N Method Name: get_pos_enc(2)</div><div id='m_parent_class'> M Parent Class: GraphPropPredDataset</div><div id='n_parent_class'> N Parent Class: GraphPropPredDataset</div><div id='m_file'> M File Name: datasets/ogbg_dataset_extension.py</div><div id='n_file'> N File Name: datasets/ogbg_dataset_extension.py</div><div id='m_start'> M Start Line: 72</div><div id='m_end'> M End Line: 88</div><div id='n_start'> N Start Line: 105</div><div id='n_end'> N End Line: 118</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        ic(list(bar0))
        idx = bar0.index(tempo)
        ic(idx)
        <a id="change">ic(</a>bar0.isSorted<a id="change">)</a>

        for bar in part[m21.stream.Measure]:
            tempos = bar[m21.tempo.MetronomeMark]
            if tempos:</code></pre><h3>After Change</h3><pre><code class='java'>
        &#47&#47 assert bar0.isSorted

        ic(scr.metadata.composer)
        <a id="change">title</a> = scr.metadata.title
        if title.endswith(&quot.mxl&quot):
            title<a id="change"> = </a><a id="change">title[:-4]</a>

        if exp == &quotstream&quot:
            fnm = f&quot{title}, bar with max pitch.mxl&quot
            &#47&#47 ic(os.path.join(PATH_BASE, DIR_DSET, config(f&quot{DIR_DSET}.MXL_EG.dir_nm&quot)))</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/stefanheng/symbolic-music-generation/commit/30a8207cd105223f3d0c073913fddd41937f1c22#diff-9bddc1ec410935c3b7e65a0e53b587a68e1dda58d8f63e4abcaf788573ad9f27L310' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 93048488</div><div id='project'> Project Name: stefanheng/symbolic-music-generation</div><div id='commit'> Commit Name: 30a8207cd105223f3d0c073913fddd41937f1c22</div><div id='time'> Time: 2021-11-25</div><div id='author'> Author: 43276957+SpongeBobBang@users.noreply.github.com</div><div id='file'> File Name: melody_extractor.py</div><div id='m_class'> M Class Name: MxlMelodyExtractor</div><div id='n_method'> N Class Name: MxlMelodyExtractor</div><div id='m_method'> M Method Name: bar_with_max_pitch(2)</div><div id='n_method'> N Method Name: bar_with_max_pitch(2)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: melody_extractor.py</div><div id='n_file'> N File Name: melody_extractor.py</div><div id='m_start'> M Start Line: 322</div><div id='m_end'> M End Line: 370</div><div id='n_start'> N Start Line: 309</div><div id='n_end'> N End Line: 361</div><BR>