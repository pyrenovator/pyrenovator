<html><h3>Pattern ID :12261
</h3><img src='41566522.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
        metric += sklearn_metrics.mean_squared_error(y_true_los, y_pred_los)
    elif metrics_strategy == "MAPE":
        metric += sklearn_metrics.mean_absolute_percentage_error(y_true_los, y_pred_los)
    metric<a id="change"> += </a>np.mean(
        <a id="change">np.abs(</a>y_true_outcome - y_pred_outcome<a id="change">)</a>
        * max_visits
        * np.array(list(map(lambda x: sigma_func(x), y_true_los)))
    )
    if verbose:</code></pre><h3>After Change</h3><pre><code class='java'>
    metric = []
    num_records = len(y_pred_outcome)
    for i in range(num_records):
        cur_outcome_pred<a id="change"> = </a><a id="change">y_pred_outcome[i]</a>
        cur_los_pred = y_pred_los[i]
        cur_gt = y_true[i, :]
        cur_outcome_true = cur_gt[0]
        cur_los_true = cur_gt[1]</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 6</div><BR><div id='size'>Non-data size: 4</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/yhzhu99/covid-ehr-benchmarks/commit/fc9fcafdeae37b009acb4acf87682f0d86306e69#diff-60dfaea8db03329c57ab195bf9d2e6d9fe8dccffa334e7da35cedab99db88092L83' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 41566522</div><div id='project'> Project Name: yhzhu99/covid-ehr-benchmarks</div><div id='commit'> Commit Name: fc9fcafdeae37b009acb4acf87682f0d86306e69</div><div id='time'> Time: 2022-06-29</div><div id='author'> Author: yhzhu99@gmail.com</div><div id='file'> File Name: app/core/evaluation/covid_metrics.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: multitask_los_metric(6)</div><div id='n_method'> N Method Name: multitask_los_metric(7)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: app/core/evaluation/covid_metrics.py</div><div id='n_file'> N File Name: app/core/evaluation/covid_metrics.py</div><div id='m_start'> M Start Line: 83</div><div id='m_end'> M End Line: 116</div><div id='n_start'> N Start Line: 119</div><div id='n_end'> N End Line: 142</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
            rel_pos = rearrange(grid, &quoti c -&gt; i 1 c&quot) - rearrange(grid, &quotj c -&gt; 1 j c&quot)

            if self.log_dist:
                rel_pos<a id="change"> = </a>torch.sign(rel_pos) * torch.log(<a id="change">rel_pos.abs()</a> + 1)

            self.register_buffer(&quotrel_pos&quot, rel_pos, persistent = False)
</code></pre><h3>After Change</h3><pre><code class='java'>

        &#47&#47 now select the bias for each unique relative position combination

        bias<a id="change"> = </a><a id="change">bias[rel_dist_indices]</a>
        return rearrange(bias, &quoti j h -&gt; h i j&quot)

&#47&#47 helper classes
</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/lucidrains/make-a-video-pytorch/commit/b6e0a17c5488b923d884272f7e46170352b0f0d5#diff-a7a81e9a1aa252916dd3f29e813ef72db53e9b9a100d00fdf0a022c1823ac77bL107' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 41566504</div><div id='project'> Project Name: lucidrains/make-a-video-pytorch</div><div id='commit'> Commit Name: b6e0a17c5488b923d884272f7e46170352b0f0d5</div><div id='time'> Time: 2023-03-18</div><div id='author'> Author: lucidrains@gmail.com</div><div id='file'> File Name: make_a_video_pytorch/make_a_video.py</div><div id='m_class'> M Class Name: ContinuousPositionBias</div><div id='n_method'> N Class Name: ContinuousPositionBias</div><div id='m_method'> M Method Name: forward(1)</div><div id='n_method'> N Method Name: forward(1)</div><div id='m_parent_class'> M Parent Class: nn.Module</div><div id='n_parent_class'> N Parent Class: nn.Module</div><div id='m_file'> M File Name: make_a_video_pytorch/make_a_video.py</div><div id='n_file'> N File Name: make_a_video_pytorch/make_a_video.py</div><div id='m_start'> M Start Line: 110</div><div id='m_end'> M End Line: 126</div><div id='n_start'> N Start Line: 105</div><div id='n_end'> N End Line: 142</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        
        Xlgmel = librosa.power_to_db(Xmel)

        X_comp<a id="change"> = </a>torch.Tensor(<a id="change">np.abs(</a>Xs<a id="change">)</a>).transpose(1, 2)
        import pdb; pdb.set_trace()

        &#47&#47 test librosa stuff</code></pre><h3>After Change</h3><pre><code class='java'>
        psi_out = self.modules.psi(f_I)  &#47&#47 generate nmf activations

        &#47&#47 cut the length of psi
        psi_out<a id="change"> = </a><a id="change">psi_out[:, :, : X_stft_power.shape[1]]</a>
        &#47&#47 psi_out = psi_out.permute(0, 2, 1)

        reconstructed = self.hparams.nmf(
            psi_out</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/speechbrain/speechbrain/commit/c0348188064f486d48890e95be305ffd87eb2edb#diff-8f3874d114f157f94ccdf7b656a9cc7738dfe21aef4a26c86929a9f19edda806L76' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 41566511</div><div id='project'> Project Name: speechbrain/speechbrain</div><div id='commit'> Commit Name: c0348188064f486d48890e95be305ffd87eb2edb</div><div id='time'> Time: 2022-11-20</div><div id='author'> Author: me@francescopaissan.it</div><div id='file'> File Name: recipes/ESC50/classification/train_interpreter.py</div><div id='m_class'> M Class Name: InterpreterESC50Brain</div><div id='n_method'> N Class Name: InterpreterESC50Brain</div><div id='m_method'> M Method Name: compute_forward(3)</div><div id='n_method'> N Method Name: compute_forward(3)</div><div id='m_parent_class'> M Parent Class: sb.core.Brain</div><div id='n_parent_class'> N Parent Class: sb.core.Brain</div><div id='m_file'> M File Name: recipes/ESC50/classification/train_interpreter.py</div><div id='n_file'> N File Name: recipes/ESC50/classification/train_interpreter.py</div><div id='m_start'> M Start Line: 107</div><div id='m_end'> M End Line: 131</div><div id='n_start'> N Start Line: 107</div><div id='n_end'> N End Line: 138</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
                &#47&#47 Update biased first moment estimate.
                exp_avg.mul_(beta1).add_(grad, alpha=1 - beta1)
                &#47&#47 Update the exponentially weighted infinity norm.
                norm_buf<a id="change"> = </a>torch.cat([
                    exp_inf.mul_(beta2).unsqueeze(0),
                    <a id="change">grad.abs()</a>.add_(eps).unsqueeze_(0)
                ], 0)
                torch.amax(norm_buf, 0, keepdim=False, out=exp_inf)
</code></pre><h3>After Change</h3><pre><code class='java'>
            beta1, beta2 = group[&quotbetas&quot]
            eps = group[&quoteps&quot]
            lr = group[&quotlr&quot]
            weight_decay<a id="change"> = </a><a id="change">group[&quotweight_decay&quot]</a>

            for p in group[&quotparams&quot]:
                if p.grad is None:
                    continue</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/pytorch/pytorch/commit/bb245b6444d3c5b9f586d93121730390985a0bae#diff-148b16d4bd6bab9a518cc1052160cb2dc47f014855087eca0fd3a2a65519e10eL40' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 41566492</div><div id='project'> Project Name: pytorch/pytorch</div><div id='commit'> Commit Name: bb245b6444d3c5b9f586d93121730390985a0bae</div><div id='time'> Time: 2021-04-15</div><div id='author'> Author: wanchaol@fb.com</div><div id='file'> File Name: torch/optim/adamax.py</div><div id='m_class'> M Class Name: Adamax</div><div id='n_method'> N Class Name: Adamax</div><div id='m_method'> M Method Name: step(2)</div><div id='n_method'> N Method Name: step(2)</div><div id='m_parent_class'> M Parent Class: Optimizer</div><div id='n_parent_class'> N Parent Class: Optimizer</div><div id='m_file'> M File Name: torch/optim/adamax.py</div><div id='n_file'> N File Name: torch/optim/adamax.py</div><div id='m_start'> M Start Line: 52</div><div id='m_end'> M End Line: 88</div><div id='n_start'> N Start Line: 53</div><div id='n_end'> N End Line: 96</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
    if per_channel:
        thresholds_per_channel = np.max(np.abs(tensor_data), axis=tuple(axis_not_channel), keepdims=True)
    else:
        thresholds_per_channel<a id="change"> = </a>np.max(<a id="change">np.abs(</a>tensor_data<a id="change">)</a>, keepdims=True)
    thresholds_per_channel = np.power(2.0, np.ceil(np.log2(thresholds_per_channel)))
    tensor_for_kmeans = int_quantization_with_threshold(tensor_data, thresholds_per_channel, MULTIPLIER_N_BITS)
    kmeans.fit(tensor_for_kmeans.reshape(-1, 1))</code></pre><h3>After Change</h3><pre><code class='java'>
    kmeans = KMeans(n_clusters=n_clusters)

    threshold_selection_tensor = symmetric_selection_tensor if is_symmetric else power_of_two_selection_tensor
    thresholds_per_channel<a id="change"> = </a><a id="change">threshold_selection_tensor(tensor_data, p, n_bits, per_channel,
                                                        channel_axis, n_iter, min_threshold,
                                                        qc.QuantizationErrorMethod.NOCLIPPING)[THRESHOLD]</a>

    tensor_for_kmeans = int_quantization_with_threshold(tensor_data, thresholds_per_channel, MULTIPLIER_N_BITS)
    kmeans.fit(tensor_for_kmeans.reshape(-1, 1))
</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/sony/model_optimization/commit/6684273eb930b681f8316af3d81d8e8903e48f67#diff-52d4cc9c31360e266411328df81a4d4dfbffc7e98a3a47da8942c73b7341db5aL27' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 41566508</div><div id='project'> Project Name: sony/model_optimization</div><div id='commit'> Commit Name: 6684273eb930b681f8316af3d81d8e8903e48f67</div><div id='time'> Time: 2022-12-15</div><div id='author'> Author: 78862769+elad-c@users.noreply.github.com</div><div id='file'> File Name: model_compression_toolkit/core/common/quantization/quantization_params_generation/lut_kmeans_params.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: lut_kmeans_tensor(9)</div><div id='n_method'> N Method Name: lut_kmeans_tensor(8)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: model_compression_toolkit/core/common/quantization/quantization_params_generation/lut_kmeans_params.py</div><div id='n_file'> N File Name: model_compression_toolkit/core/common/quantization/quantization_params_generation/lut_kmeans_params.py</div><div id='m_start'> M Start Line: 63</div><div id='m_end'> M End Line: 69</div><div id='n_start'> N Start Line: 40</div><div id='n_end'> N End Line: 74</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
    k = min(k, len(num_col_names))
    num_data = df[num_col_names]
    num_data = num_data.fillna(0)
    abs_corr<a id="change"> = </a><a id="change">num_data.corr()[target].abs()</a>
    top_k = abs_corr.sort_values(ascending = False)[1:k].index.values.tolist()
    return top_k

</code></pre><h3>After Change</h3><pre><code class='java'>
    else:
        select_model = SelectKBest(mutual_info_classif, k=k)
    X = df[num_col_names]
    y<a id="change"> = </a><a id="change">df[target]</a>
    slect_feature_cols = select_model.fit(X, y).get_feature_names_out()
    return slect_feature_cols

</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/jianzhnie/autotabular/commit/c04a58c146a58c659d5df8dc70a02ba8ed007f18#diff-7a63e680e4ef6cd1a5de0e8f61c37fffcb03881d51fafd31759731520bf3bc32L19' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 41566509</div><div id='project'> Project Name: jianzhnie/autotabular</div><div id='commit'> Commit Name: c04a58c146a58c659d5df8dc70a02ba8ed007f18</div><div id='time'> Time: 2021-10-15</div><div id='author'> Author: jianzhnie@126.com</div><div id='file'> File Name: autofe/feature_engineering/groupby.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: get_candidate_numerical_feature(3)</div><div id='n_method'> N Method Name: get_candidate_numerical_feature(3)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: autofe/feature_engineering/groupby.py</div><div id='n_file'> N File Name: autofe/feature_engineering/groupby.py</div><div id='m_start'> M Start Line: 20</div><div id='m_end'> M End Line: 27</div><div id='n_start'> N Start Line: 25</div><div id='n_end'> N End Line: 32</div><BR>