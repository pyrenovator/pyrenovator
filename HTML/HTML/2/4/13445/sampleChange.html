<link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
    train_source_iter = ForeverDataIterator(train_source_loader)
    train_target_iter = ForeverDataIterator(train_target_loader)

    iters_per_epoch<a id="change"> = </a>args.iters_per_epoch

    &#47&#47 create model
    cudnn.benchmark = True
    print("=&gt; using pre-trained model &quot{}&quot".format(args.arch))
    backbone = models.__dict__[args.arch](pretrained=True)
    num_classes = train_source_dataset.num_classes
    classifier = adaptation.afn.Classifier(backbone, num_classes).cuda()

    all_parameters = classifier.get_parameters()
    classifier = torch.nn.DataParallel(classifier).cuda()

    &#47&#47 define optimizer
    optimizer = torch.optim.SGD(all_parameters, args.lr,
                                weight_decay=args.wd)

    &#47&#47 define loss function
    safn = adaptation.afn.StepwiseAdaptiveFeatureNorm(delta_r=args.delta_r)

    &#47&#47 start training
    best_acc1 = 0.
    for epoch in range(args.epochs):
        print("lr={:.5f}".format(optimizer.param_groups[0][&quotlr&quot]))
        &#47&#47 train for one epoch
        <a id="change">train(</a>train_source_iter, train_target_iter, classifier, optimizer, epoch, iters_per_epoch, safn, args<a id="change">)</a>

        &#47&#47 evaluate on validation set
        acc1 = validate(val_loader, classifier, args)
</code></pre><h3>After Change</h3><pre><code class='java'>
    &#47&#47 Data loading code
    normalize = transforms.Normalize(mean=[0.485, 0.456, 0.406], std=[0.229, 0.224, 0.225])
    train_transform = transforms.Compose([
        <a id="change">ResizeImage(256</a><a id="change">)</a>,
        transforms.RandomResizedCrop(224),
        transforms.RandomHorizontalFlip(),
        transforms.ToTensor(),</code></pre>