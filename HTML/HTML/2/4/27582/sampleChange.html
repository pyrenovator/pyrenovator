<link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>

    if causal:
        i, j = q.shape[-2], k.shape[-2]
        causal_mask<a id="change"> = </a><a id="change">torch.ones(i, j, device = q.device, dtype = torch.bool).triu(</a>j - i + 1<a id="change">)</a>
        causal_mask_chunks = causal_mask.split(q_bucket_size, dim = 0)
        causal_mask_chunks = list(map(lambda t: t.split(k_bucket_size, dim = -1), causal_mask_chunks))

    if exists(attn_bias):</code></pre><h3>After Change</h3><pre><code class='java'>
                mask_chunk,
                attn_bias_chunk,
                causal,
                (q_start_index<a id="change">, k_start_index</a>)
            )

            exp_weights.append(exp_weight_chunk)</code></pre>