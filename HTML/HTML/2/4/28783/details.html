<html><h3>Pattern ID :28783
</h3><img src='84676716.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
        )

        hf_datadict[subset_name].to_csv(
            <a id="change">output_path.joinpath(f"{subset_name}.csv"</a><a id="change">)</a>, header=False, index=False
        )

        column_name_map = {</code></pre><h3>After Change</h3><pre><code class='java'>
    def _preprocess_subset(
        self, hf_datadict: datasets.DatasetDict, subset_name: str, output_path: Path
    ) -&gt; CSVClassificationDataset:
        csv_path = <a id="change">output_path.joinpath(f"{subset_name}.csv"</a><a id="change">)</a>
        self._save_to_csv(hf_datadict, subset_name, csv_path)
        column_name_map = {
            hf_datadict[subset_name].column_names.index(self.input_column_name): "text",
            hf_datadict[subset_name].column_names.index(self.target_column_name): "label",</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 8</div><BR><div id='size'>Non-data size: 2</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/clarin-pl/embeddings/commit/68a1c0f3368b324dcefd27033dd0a33ba2f77eba#diff-7edb46924f9e505b20209a162d425d3499c29114a424bda588899ee7f21319faL15' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 84676716</div><div id='project'> Project Name: clarin-pl/embeddings</div><div id='commit'> Commit Name: 68a1c0f3368b324dcefd27033dd0a33ba2f77eba</div><div id='time'> Time: 2021-07-15</div><div id='author'> Author: 34009816+albert097@users.noreply.github.com</div><div id='file'> File Name: embeddings/transformation/flair_transformation/classification_corpus_transformation.py</div><div id='m_class'> M Class Name: ClassificationCorpusTransformation</div><div id='n_method'> N Class Name: ClassificationCorpusTransformation</div><div id='m_method'> M Method Name: _preprocess_subset(4)</div><div id='n_method'> N Method Name: _preprocess_subset(4)</div><div id='m_parent_class'> M Parent Class: CorpusTransformation</div><div id='n_parent_class'> N Parent Class: CorpusTransformation</div><div id='m_file'> M File Name: embeddings/transformation/flair_transformation/classification_corpus_transformation.py</div><div id='n_file'> N File Name: embeddings/transformation/flair_transformation/classification_corpus_transformation.py</div><div id='m_start'> M Start Line: 15</div><div id='m_end'> M End Line: 29</div><div id='n_start'> N Start Line: 15</div><div id='n_end'> N End Line: 21</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
            load_path = (
                self.load_path
                if self.trial.load_backbone_weights()
                else <a id="change">self.load_path.joinpath("checkpoint"</a><a id="change">)</a>
            )
            logging.info(f"Loading model from {load_path}")
            self.session_init = tp.get_model_loader(str(load_path))
</code></pre><h3>After Change</h3><pre><code class='java'>
            if backbone_weights_path:
                self.load_path = pathlib.Path(backbone_weights_path)
        else:
            self.load_path = <a id="change">self.load_path.joinpath("checkpoint"</a><a id="change">)</a>

        if self.load_path is None or not self.is_chief:
            logging.info(f"Not loading model")
            self.session_init = None</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/determined-ai/determined/commit/a069dfaa338be581f03d79575cbe5cf2d42d9046#diff-3d0727ee6d4bddc084405d297339ae66ae2c4ba40245bbbd98010dfad86baa4eL463' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 84676718</div><div id='project'> Project Name: determined-ai/determined</div><div id='commit'> Commit Name: a069dfaa338be581f03d79575cbe5cf2d42d9046</div><div id='time'> Time: 2020-04-27</div><div id='author'> Author: aaron@determined.ai</div><div id='file'> File Name: harness/determined/tensorpack/_tensorpack_trial.py</div><div id='m_class'> M Class Name: TensorpackTrialController</div><div id='n_method'> N Class Name: TensorpackTrialController</div><div id='m_method'> M Method Name: _load(1)</div><div id='n_method'> N Method Name: _load(1)</div><div id='m_parent_class'> M Parent Class: det.LoopTrialController</div><div id='n_parent_class'> N Parent Class: det.LoopTrialController</div><div id='m_file'> M File Name: harness/determined/tensorpack/_tensorpack_trial.py</div><div id='n_file'> N File Name: harness/determined/tensorpack/_tensorpack_trial.py</div><div id='m_start'> M Start Line: 468</div><div id='m_end'> M End Line: 480</div><div id='n_start'> N Start Line: 468</div><div id='n_end'> N End Line: 477</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
            logging.info(f"Not loading model")
            self.session_init = None
        else:
            load_path = <a id="change">self.load_path.joinpath("checkpoint"</a><a id="change">)</a>
            logging.info(f"Loading model from {load_path}")
            self.session_init = tp.get_model_loader(str(load_path))

    def run(self) -&gt; None:</code></pre><h3>After Change</h3><pre><code class='java'>
            load_path = (
                self.load_path
                if self.trial.load_backbone_weights()
                else <a id="change">self.load_path.joinpath("checkpoint"</a><a id="change">)</a>
            )
            logging.info(f"Loading model from {load_path}")
            self.session_init = tp.get_model_loader(str(load_path))
</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/determined-ai/determined/commit/b7b05c21a504a016927d3433bd237d84aed4d156#diff-3d0727ee6d4bddc084405d297339ae66ae2c4ba40245bbbd98010dfad86baa4eL463' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 84676713</div><div id='project'> Project Name: determined-ai/determined</div><div id='commit'> Commit Name: b7b05c21a504a016927d3433bd237d84aed4d156</div><div id='time'> Time: 2020-04-27</div><div id='author'> Author: aaron@determined.ai</div><div id='file'> File Name: harness/determined/tensorpack/_tensorpack_trial.py</div><div id='m_class'> M Class Name: TensorpackTrialController</div><div id='n_method'> N Class Name: TensorpackTrialController</div><div id='m_method'> M Method Name: _load(1)</div><div id='n_method'> N Method Name: _load(1)</div><div id='m_parent_class'> M Parent Class: det.LoopTrialController</div><div id='n_parent_class'> N Parent Class: det.LoopTrialController</div><div id='m_file'> M File Name: harness/determined/tensorpack/_tensorpack_trial.py</div><div id='n_file'> N File Name: harness/determined/tensorpack/_tensorpack_trial.py</div><div id='m_start'> M Start Line: 474</div><div id='m_end'> M End Line: 474</div><div id='n_start'> N Start Line: 468</div><div id='n_end'> N End Line: 478</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>


def load_model(ckpt_dir: pathlib.Path, **kwargs: Any) -&gt; torch.nn.Module:
    code_path = <a id="change">ckpt_dir.joinpath("code"</a><a id="change">)</a>

    &#47&#47 We used MLflow&quots MLmodel checkpoint format in the past. This format
    &#47&#47 nested the checkpoint in data/. Currently, we have the checkpoint at the
    &#47&#47 top level of the checkpoint directory.</code></pre><h3>After Change</h3><pre><code class='java'>

def load_model(ckpt_dir: pathlib.Path, metadata: Dict[str, Any], **kwargs: Any) -&gt; torch.nn.Module:
    trial = _local_trial_from_context(
        <a id="change">ckpt_dir.joinpath("code"</a><a id="change">)</a>,
        config=metadata["experiment_config"],
        hparams=metadata["hparams"],
    )</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/determined-ai/determined/commit/47ec6cc32234d8e797d9ae3c23d70bfb6d3a64a9#diff-90f3e871b5e54da58a3ae07e1fb06d8e642ed76363902f85b3282af52795790fL9' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 84676715</div><div id='project'> Project Name: determined-ai/determined</div><div id='commit'> Commit Name: 47ec6cc32234d8e797d9ae3c23d70bfb6d3a64a9</div><div id='time'> Time: 2020-05-18</div><div id='author'> Author: sidney@determined.ai</div><div id='file'> File Name: common/determined_common/experimental/checkpoint/_torch.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: load_model(2)</div><div id='n_method'> N Method Name: load_model(1)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: common/determined_common/experimental/checkpoint/_torch.py</div><div id='n_file'> N File Name: common/determined_common/experimental/checkpoint/_torch.py</div><div id='m_start'> M Start Line: 10</div><div id='m_end'> M End Line: 28</div><div id='n_start'> N Start Line: 10</div><div id='n_end'> N End Line: 22</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        tokenizer_model_folder_path = wd_path.joinpath(self.tokenizer_folder_name).joinpath("1")
        tokenizer.save_pretrained(str(tokenizer_model_folder_path.absolute()))
        tokenizer_model_path = Path(__file__).absolute().parent.parent.joinpath("utils").joinpath("python_tokenizer.py")
        shutil.copy(str(tokenizer_model_path), str(<a id="change">Path(tokenizer_model_folder_path).joinpath("model.py"</a><a id="change">)</a>))
        model_folder_path = wd_path.joinpath(self.model_folder_name).joinpath("1")
        shutil.copy(model_path, os.path.join(model_folder_path, "model.bin"))
</code></pre><h3>After Change</h3><pre><code class='java'>
        tokenizer_model_folder_path = wd_path.joinpath(self.tokenizer_folder_name).joinpath("1")
        tokenizer.save_pretrained(str(tokenizer_model_folder_path.absolute()))
        source_code: str = inspect.getsource(python_tokenizer)
        <a id="change">Path(tokenizer_model_folder_path).joinpath("model.py"</a><a id="change">)</a>.write_text(source_code)
        model_folder_path = wd_path.joinpath(self.model_folder_name).joinpath("1")
        shutil.copy(model_path, os.path.join(model_folder_path, "model.bin"))
</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/els-rd/triton_transformers/commit/c87a39e006f2e37dcd1831c173be3fa9d59e77b5#diff-df41e0676d328423c1357e9509da7c6d23e6977f39e1a84804b19679dddd244eL253' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 84676709</div><div id='project'> Project Name: els-rd/triton_transformers</div><div id='commit'> Commit Name: c87a39e006f2e37dcd1831c173be3fa9d59e77b5</div><div id='time'> Time: 2022-01-10</div><div id='author'> Author: pommedeterresautee@users.noreply.github.com</div><div id='file'> File Name: src/transformer_deploy/templates/triton.py</div><div id='m_class'> M Class Name: Configuration</div><div id='n_method'> N Class Name: Configuration</div><div id='m_method'> M Method Name: create_folders(3)</div><div id='n_method'> N Method Name: create_folders(3)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: src/transformer_deploy/templates/triton.py</div><div id='n_file'> N File Name: src/transformer_deploy/templates/triton.py</div><div id='m_start'> M Start Line: 275</div><div id='m_end'> M End Line: 276</div><div id='n_start'> N Start Line: 278</div><div id='n_end'> N End Line: 279</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
def load_model(
    ckpt_dir: pathlib.Path, metadata: Dict[str, Any], **kwargs: Any
) -&gt; Union[PyTorchTrial, torch.nn.Module]:
    checkpoint = torch.load(<a id="change">ckpt_dir.joinpath("state_dict.pth"</a><a id="change">)</a>, **kwargs)  &#47&#47 type: ignore

    trial_cls, trial_context = experimental._load_trial_on_local(
        ckpt_dir.joinpath("code"),</code></pre><h3>After Change</h3><pre><code class='java'>
def load_model(
    ckpt_dir: pathlib.Path, metadata: Dict[str, Any], **kwargs: Any
) -&gt; Union[PyTorchTrial, torch.nn.Module]:
    checkpoint = torch.load(str(<a id="change">ckpt_dir.joinpath("state_dict.pth"</a><a id="change">)</a>), **kwargs)  &#47&#47 type: ignore

    trial_cls, trial_context = experimental._load_trial_on_local(
        ckpt_dir.joinpath("code"),</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/determined-ai/determined/commit/64550ef944e1fd78c44a5dc1717d997071a388a6#diff-90f3e871b5e54da58a3ae07e1fb06d8e642ed76363902f85b3282af52795790fL10' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 84676711</div><div id='project'> Project Name: determined-ai/determined</div><div id='commit'> Commit Name: 64550ef944e1fd78c44a5dc1717d997071a388a6</div><div id='time'> Time: 2020-12-04</div><div id='author'> Author: mackrory@determined.ai</div><div id='file'> File Name: common/determined_common/experimental/checkpoint/_torch.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: load_model(2)</div><div id='n_method'> N Method Name: load_model(2)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: common/determined_common/experimental/checkpoint/_torch.py</div><div id='n_file'> N File Name: common/determined_common/experimental/checkpoint/_torch.py</div><div id='m_start'> M Start Line: 13</div><div id='m_end'> M End Line: 13</div><div id='n_start'> N Start Line: 13</div><div id='n_end'> N End Line: 13</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        ],
        config,
    )
    test_setup_path = <a id="change">tests_dir.joinpath(</a>"bin", <a id="change">"createUserAndExperiments.py"</a><a id="change">)</a>
    run(["python", str(test_setup_path)], config)


def _cypress_container_name(config):</code></pre><h3>After Change</h3><pre><code class='java'>
    run_ignore_failure(["rm", "-r", str(tests_dir.joinpath(RESULTS_DIR_NAME))], config)
    &#47&#47 TODO add a check for cluster condition
    run(
        ["python", str(<a id="change">tests_dir.joinpath(</a>"bin", <a id="change">"createUserAndExperiments.py"</a><a id="change">)</a>)],
        config,
    )
</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/determined-ai/determined/commit/3379ecab474dbf871dddba95034b959b58068956#diff-e069dd92bc672fb613b132cff6dfa056324b4e6a46504f957c85a19c06a2cf02L41' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 84676720</div><div id='project'> Project Name: determined-ai/determined</div><div id='commit'> Commit Name: 3379ecab474dbf871dddba95034b959b58068956</div><div id='time'> Time: 2020-06-01</div><div id='author'> Author: hamidzr@users.noreply.github.com</div><div id='file'> File Name: webui/tests/bin/e2e-tests.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: pre_e2e_tests(1)</div><div id='n_method'> N Method Name: pre_e2e_tests(1)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: webui/tests/bin/e2e-tests.py</div><div id='n_file'> N File Name: webui/tests/bin/e2e-tests.py</div><div id='m_start'> M Start Line: 43</div><div id='m_end'> M End Line: 58</div><div id='n_start'> N Start Line: 75</div><div id='n_end'> N End Line: 75</div><BR>