<html><h3>Pattern ID :12080
</h3><img src='40764174.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
    if gallery_ids is None:
        gallery_ids = np.arange(n)
    if query_cams is None:
        query_cams<a id="change"> = </a><a id="change">np.zeros(m).astype(</a>np.int32<a id="change">)</a>
    if gallery_cams is None:
        gallery_cams = np.ones(n).astype(np.int32)
    &#47&#47 Ensure numpy array
    query_ids = np.asarray(query_ids)</code></pre><h3>After Change</h3><pre><code class='java'>


def mean_ap(dist_mat, query_ids, gallery_ids, query_cams, gallery_cams):
    dist_mat = <a id="change">dist_mat.cpu().numpy()</a>
    m, n = dist_mat.shape
    &#47&#47 Ensure numpy array
    query_ids = np.asarray(query_ids)
    gallery_ids = np.asarray(gallery_ids)</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 5</div><BR><div id='size'>Non-data size: 4</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/thuml/transfer-learning-library/commit/f3f63a2322330a2a298fcba86b21ecb04f3667d5#diff-187e0e3bcc19cbac557b152d80bee387d9e6afa9c365789727e8e80c87cf5a03L71' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 40764174</div><div id='project'> Project Name: thuml/transfer-learning-library</div><div id='commit'> Commit Name: f3f63a2322330a2a298fcba86b21ecb04f3667d5</div><div id='time'> Time: 2021-07-29</div><div id='author'> Author: chenbx18@mails.tsinghua.edu.cn</div><div id='file'> File Name: common/utils/metric/reid.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: mean_ap(5)</div><div id='n_method'> N Method Name: mean_ap(5)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: common/utils/metric/reid.py</div><div id='n_file'> N File Name: common/utils/metric/reid.py</div><div id='m_start'> M Start Line: 92</div><div id='m_end'> M End Line: 104</div><div id='n_start'> N Start Line: 71</div><div id='n_end'> N End Line: 71</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
    if query_cams is None:
        query_cams = np.zeros(m).astype(np.int32)
    if gallery_cams is None:
        gallery_cams<a id="change"> = </a><a id="change">np.ones(n).astype(</a>np.int32<a id="change">)</a>
    &#47&#47 Ensure numpy array
    query_ids = np.asarray(query_ids)
    gallery_ids = np.asarray(gallery_ids)
    query_cams = np.asarray(query_cams)</code></pre><h3>After Change</h3><pre><code class='java'>

def cmc(dist_mat, query_ids, gallery_ids, query_cams, gallery_cams, topk=100, separate_camera_set=False,
        single_gallery_shot=False, first_match_break=False):
    dist_mat = <a id="change">dist_mat.cpu().numpy()</a>
    m, n = dist_mat.shape
    &#47&#47 Ensure numpy array
    query_ids = np.asarray(query_ids)
    gallery_ids = np.asarray(gallery_ids)</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/thuml/transfer-learning-library/commit/f3f63a2322330a2a298fcba86b21ecb04f3667d5#diff-187e0e3bcc19cbac557b152d80bee387d9e6afa9c365789727e8e80c87cf5a03L26' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 40764159</div><div id='project'> Project Name: thuml/transfer-learning-library</div><div id='commit'> Commit Name: f3f63a2322330a2a298fcba86b21ecb04f3667d5</div><div id='time'> Time: 2021-07-29</div><div id='author'> Author: chenbx18@mails.tsinghua.edu.cn</div><div id='file'> File Name: common/utils/metric/reid.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: cmc(9)</div><div id='n_method'> N Method Name: cmc(9)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: common/utils/metric/reid.py</div><div id='n_file'> N File Name: common/utils/metric/reid.py</div><div id='m_start'> M Start Line: 31</div><div id='m_end'> M End Line: 43</div><div id='n_start'> N Start Line: 20</div><div id='n_end'> N End Line: 20</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
    fastmarch_time = time.time() - tic

    tic = time.time()
    geodistkraster_output<a id="change"> = </a>geodesic_distance_2d(
        input_image, <a id="change">Seed.astype(</a>np.uint8<a id="change">)</a>, lamb, iterations
    )
    geodistkraster_time = time.time() - tic
</code></pre><h3>After Change</h3><pre><code class='java'>

    tic = time.time()
    toivanenraster_output = np.squeeze(
        <a id="change">FastGeodis.generalised_geodesic2d_toivanen(input_image_pt, seed_image_pt, v, lamb, iterations).cpu().numpy()</a>
    )
    toivanenraster_time = time.time() - tic

    tic = time.time()</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/masadcv/fastgeodis/commit/a1906e989649c1f0b8fdbed147c1d576ac5c41f3#diff-c6567a84a23f27eb1443122b56b63757dea429e19a3d3c58c88e6c34596a2e13L26' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 40764188</div><div id='project'> Project Name: masadcv/fastgeodis</div><div id='commit'> Commit Name: a1906e989649c1f0b8fdbed147c1d576ac5c41f3</div><div id='time'> Time: 2022-07-22</div><div id='author'> Author: muhammad.asad@kcl.ac.uk</div><div id='file'> File Name: samples/demo2d.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: evaluate_geodesic_distance2d(2)</div><div id='n_method'> N Method Name: evaluate_geodesic_distance2d(2)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: samples/demo2d.py</div><div id='n_file'> N File Name: samples/demo2d.py</div><div id='m_start'> M Start Line: 29</div><div id='m_end'> M End Line: 158</div><div id='n_start'> N Start Line: 18</div><div id='n_end'> N End Line: 100</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
    prediction = prediction.reshape(-1).astype(&quotint64&quot)
    target = target.reshape(-1).astype(&quotint64&quot)
    down_pred = down_pred.reshape(-1).astype(&quotint64&quot)
    down_target<a id="change"> = </a><a id="change">down_target.reshape(-1).astype(</a>&quotint64&quot<a id="change">)</a>
    self.evaluator[&quot1&quot].addBatch(prediction, target)
    self.evaluator[&quot8&quot].addBatch(down_pred, down_target)

    return</code></pre><h3>After Change</h3><pre><code class='java'>
    &#47&#47 target[target&gt;0.5] = 1.0
    &#47&#47 target[target&lt;=0.5] = 0.0
    target = target.cpu().numpy()
    scale2_target = <a id="change">scale2_target.cpu().numpy()</a> &#47&#47[6, 1, 7, 128, 128]
    scale4_target = scale4_target.cpu().numpy() &#47&#47[6, 1, 4, 64, 64]
    &#47&#47 print("target", target.shape)
    &#47&#47 print("scale 2 target", scale2_target.shape)</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/coperception/star/commit/6a0409967e276127415af7e0a80fe34de9f445cc#diff-b11e4c7f596e52ceb74442c6f85ece6c7fae4e3b0b88f8139710265cd844122eL145' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 40764155</div><div id='project'> Project Name: coperception/star</div><div id='commit'> Commit Name: 6a0409967e276127415af7e0a80fe34de9f445cc</div><div id='time'> Time: 2022-06-13</div><div id='author'> Author: 954742885@qq.com</div><div id='file'> File Name: coperception/utils/metrics.py</div><div id='m_class'> M Class Name: Metrics</div><div id='n_method'> N Class Name: Metrics</div><div id='m_method'> M Method Name: add_batch(3)</div><div id='n_method'> N Method Name: add_batch(3)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: coperception/utils/metrics.py</div><div id='n_file'> N File Name: coperception/utils/metrics.py</div><div id='m_start'> M Start Line: 152</div><div id='m_end'> M End Line: 178</div><div id='n_start'> N Start Line: 153</div><div id='n_end'> N End Line: 190</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>

def inference(model, device, input_path):
    img = Image.open(input_path)
    img<a id="change"> = </a><a id="change">np.array(img.convert(&quotRGB&quot)).astype(</a>np.float32<a id="change">)</a>
    img = (img - mean) / std
    img = cv2.resize(img, dsize=(448, 448), interpolation=cv2.INTER_LINEAR)
    img = torch.from_numpy(img)
    img = img.permute(2, 0, 1)</code></pre><h3>After Change</h3><pre><code class='java'>


def inference(model, device, img):
    img = <a id="change">img.cpu().numpy()</a>
    img = (img - mean) / std
    img = cv2.resize(img, dsize=(448, 448), interpolation=cv2.INTER_LINEAR)
    img = torch.from_numpy(img)
    img = img.permute(2, 0, 1)</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/modelscope/modelscope/commit/d40cc98994d7c5150b39373d6678f9eb895efb88#diff-6f0e436dec90afa1ab0f767680faeb87b7dbfb4afd0945be945492ee51a27810L62' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 40764160</div><div id='project'> Project Name: modelscope/modelscope</div><div id='commit'> Commit Name: d40cc98994d7c5150b39373d6678f9eb895efb88</div><div id='time'> Time: 2022-10-25</div><div id='author'> Author: tingwei.gtw@alibaba-inc.com</div><div id='file'> File Name: modelscope/models/cv/product_segmentation/seg_infer.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: inference(3)</div><div id='n_method'> N Method Name: inference(3)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: modelscope/models/cv/product_segmentation/seg_infer.py</div><div id='n_file'> N File Name: modelscope/models/cv/product_segmentation/seg_infer.py</div><div id='m_start'> M Start Line: 63</div><div id='m_end'> M End Line: 64</div><div id='n_start'> N Start Line: 63</div><div id='n_end'> N End Line: 63</div><BR>