<link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
        &#47&#47 Calculate the rotation matrix
        M = torch.bmm(objpts_c.transpose(dim0=-1, dim1=-2), objpts_w)
        U, S, V = vmap(torch.svd)(M)
        R<a id="change"> = </a><a id="change">torch.bmm(</a>U, V<a id="change">)</a>

        &#47&#47 if det(R) &lt; 0, make it positive
        negate_mask = torch.linalg.det(R) &lt; 0
        R[negate_mask] = -R[negate_mask]</code></pre><h3>After Change</h3><pre><code class='java'>
        objpts_c = objpts_c - center_c

        &#47&#47 Calculate the rotation matrix
        M = vmap(torch.bmm)(<a id="change">objpts_c[:, :, :, None]</a>, objpts_w[:, :, None, :])
        M = M.sum(dim=1)  &#47&#47 along the point dimension
        U, S, V = vmap(torch.svd)(M)
        R = torch.bmm(U, V.transpose(dim0=-1, dim1=-2))</code></pre>