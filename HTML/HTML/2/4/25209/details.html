<html><h3>Pattern ID :25209
</h3><img src='77115833.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
    else:
        standalone_modules = qconfig_dict.get(&quotstandalone_module_name&quot, [])
        &#47&#47 skipping tracing standalone modules when tracing top level module
        graph_module = GraphModule(model, <a id="change">CustomTracer(</a>standalone_modules<a id="change">)</a>.trace(model))
    graph_module = _fuse_fx(graph_module, inplace)
    quantizer = Quantizer()
    return quantizer.prepare(graph_module, qconfig_dict, inplace=True, is_standalone_module=is_standalone_module)</code></pre><h3>After Change</h3><pre><code class='java'>
        graph_module = symbolic_trace(model)
    else:
        standalone_modules = qconfig_dict.get(&quotstandalone_module_name&quot, [])
        custom_module_config = qconfig_dict.get(&quotcustom_module_class&quot, <a id="change">[]</a>)
        custom_module_classes<a id="change"> = </a>[config[0] for config in custom_module_config]
        &#47&#47 TODO: currently we are registering classes globally,
        &#47&#47 we want to make custom module class mapping local
        _register_custom_module_class(custom_module_config)
        &#47&#47 skipping tracing standalone modules when tracing top level module
        tracer<a id="change"> = </a>CustomTracer(standalone_modules, custom_module_classes)
        graph_module = GraphModule(model, tracer.trace(model))
    graph_module = _fuse_fx(graph_module, inplace)
    quantizer = Quantizer()</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 4</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/pytorch/pytorch/commit/7f6a1b2bd5eca2d25c70afe233f8b6878fec241d#diff-9474902e55a6abf8857e7818e78da5f9f02e54094eee9682232b44fc29a04151L53' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 77115833</div><div id='project'> Project Name: pytorch/pytorch</div><div id='commit'> Commit Name: 7f6a1b2bd5eca2d25c70afe233f8b6878fec241d</div><div id='time'> Time: 2020-10-12</div><div id='author'> Author: jerryzh@fb.com</div><div id='file'> File Name: torch/quantization/quantize_fx.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: _prepare_fx(4)</div><div id='n_method'> N Method Name: _prepare_fx(4)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: torch/quantization/quantize_fx.py</div><div id='n_file'> N File Name: torch/quantization/quantize_fx.py</div><div id='m_start'> M Start Line: 53</div><div id='m_end'> M End Line: 55</div><div id='n_start'> N Start Line: 64</div><div id='n_end'> N End Line: 72</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
            register_observed_custom_module_mapping(CustomModule, ObservedCustomModule)
            register_quantized_custom_module_mapping(CustomModule, QuantizedCustomModule)

            m = torch.fx.GraphModule(original_m, <a id="change">CustomTracer()</a>.trace(original_m))
            qconfig_dict = {&quot&quot: default_qconfig}
            &#47&#47 check prepared model
            m = prepare_fx(m, qconfig_dict)</code></pre><h3>After Change</h3><pre><code class='java'>

        &#47&#47 TODO: add other quant types after mixed mode support
        for quant_type in [QuantType.STATIC]:
            qconfig_dict<a id="change"> = </a><a id="change">{
                </a>&quot&quot: default_qconfig,
                &quotcustom_module_class&quot:
                [(CustomModule, ObservedCustomModule, QuantizedCustomModule)]<a id="change">}</a>
            &#47&#47 check prepared model
            m<a id="change"> = </a>prepare_fx(original_m, qconfig_dict)
            &#47&#47 calibration
            m(data)
            &#47&#47 all activation observers are inserted in the top level module</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/pytorch/pytorch/commit/7f6a1b2bd5eca2d25c70afe233f8b6878fec241d#diff-5868c7c3c63d9056c3b0f3d305b9483cd1bf5434c604007629efe13eba764a07L631' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 77115819</div><div id='project'> Project Name: pytorch/pytorch</div><div id='commit'> Commit Name: 7f6a1b2bd5eca2d25c70afe233f8b6878fec241d</div><div id='time'> Time: 2020-10-12</div><div id='author'> Author: jerryzh@fb.com</div><div id='file'> File Name: test/quantization/test_quantize_fx.py</div><div id='m_class'> M Class Name: TestQuantizeFx</div><div id='n_method'> N Class Name: TestQuantizeFx</div><div id='m_method'> M Method Name: test_custom_module_class(1)</div><div id='n_method'> N Method Name: test_custom_module_class(1)</div><div id='m_parent_class'> M Parent Class: QuantizationTestCase</div><div id='n_parent_class'> N Parent Class: QuantizationTestCase</div><div id='m_file'> M File Name: test/quantization/test_quantize_fx.py</div><div id='n_file'> N File Name: test/quantization/test_quantize_fx.py</div><div id='m_start'> M Start Line: 711</div><div id='m_end'> M End Line: 737</div><div id='n_start'> N Start Line: 708</div><div id='n_end'> N End Line: 722</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        custom_module_config = prepare_custom_config_dict.get(&quotfloat_to_observed_custom_module_class&quot, {})
        custom_module_classes = list(custom_module_config.keys())
        &#47&#47 skipping tracing standalone modules when tracing top level module
        tracer = <a id="change">CustomTracer(</a>standalone_modules, custom_module_classes<a id="change">)</a>
        graph_module = GraphModule(model, tracer.trace(model))
    graph_module = _fuse_fx(graph_module, inplace)
    quantizer = Quantizer()
    return quantizer.prepare(</code></pre><h3>After Change</h3><pre><code class='java'>
    if prepare_custom_config_dict is None:
        prepare_custom_config_dict = {}

    skipped_module_names<a id="change"> = </a>prepare_custom_config_dict.get("non_traceable_module_name", <a id="change">[]</a>)
    skipped_module_classes = prepare_custom_config_dict.get("non_traceable_module_class", [])

    &#47&#47 symbolically trace the model
    if not is_standalone_module:
        &#47&#47 standalone module and custom module config are applied in top level module
        standalone_module_names = prepare_custom_config_dict.get(&quotstandalone_module_name&quot, [])
        skipped_module_names<a id="change"> += </a>standalone_module_names
        custom_module_config = prepare_custom_config_dict.get(&quotfloat_to_observed_custom_module_class&quot, {})
        custom_module_classes = list(custom_module_config.keys())
        skipped_module_classes += custom_module_classes</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/pytorch/pytorch/commit/a06b95b2badc287355d75e43b944b6ebcea4a0ae#diff-9474902e55a6abf8857e7818e78da5f9f02e54094eee9682232b44fc29a04151L39' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 77115824</div><div id='project'> Project Name: pytorch/pytorch</div><div id='commit'> Commit Name: a06b95b2badc287355d75e43b944b6ebcea4a0ae</div><div id='time'> Time: 2020-10-19</div><div id='author'> Author: jerryzh@fb.com</div><div id='file'> File Name: torch/quantization/quantize_fx.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: _prepare_fx(5)</div><div id='n_method'> N Method Name: _prepare_fx(5)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: torch/quantization/quantize_fx.py</div><div id='n_file'> N File Name: torch/quantization/quantize_fx.py</div><div id='m_start'> M Start Line: 54</div><div id='m_end'> M End Line: 63</div><div id='n_start'> N Start Line: 50</div><div id='n_end'> N End Line: 64</div><BR>