<link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
                                     hidden_size, vocab_size,
                                     torch.distributed.get_world_size(),
                                     np.mean(costs), True)
    heads<a id="change"> = </a>["Type", "Model Config", "Parallel Config", "P-mesh shape", "&#47&#47Microbatch",
             "Force DP", "Remat", "Mean Time", "Std Time", "&#47&#47Params", "TFLOPs", "TFLOPs (ckpt)",
              "Peak Mem"]
    values = [model_type, str(benchmark_case[1:6]),
              str((dp_size, tensor_mp_size, pipeline_mp_size)),
              "N/A", str(num_micro_batches), "N/A",
              str(checkpoint_activations), f"{np.mean(costs):.3f}", f"{np.std(costs):.3f}",
              f"{parameter_count/1e9:.3f}", f"{tflops:.2f}", f"{tflops_ckpt:.2f}",
              f"{peak_mem/GB:5.3f}"]
    <a id="change">write_tsv(</a>heads, values, f"{model_type}_megatron_{output_file_name}_rank{rank}.tsv"<a id="change">)</a>
    print("Sleeping for 30 seconds before starting the next case. ")
    time.sleep(30)

</code></pre><h3>After Change</h3><pre><code class='java'>
                                         hidden_size, vocab_size,
                                         torch.distributed.get_world_size(),
                                         np.mean(costs), True)
        heads<a id="change"> = </a>["Type", "Model Config", "Parallel Config", "P-mesh shape", "&#47&#47Microbatch",
                 "Force DP", "Remat", "Mean Time", "Std Time", "&#47&#47Params", "TFLOPs", "TFLOPs (ckpt)",
                  "Peak Mem"]
        values = [model_type, str(benchmark_case[1:6]),
                  str((dp_size, tensor_mp_size, pipeline_mp_size)),
                  "N/A", str(num_micro_batches), "N/A",
                  str(checkpoint_activations), f"{np.mean(costs):.3f}", f"{np.std(costs):.3f}",
                  f"{parameter_count/1e9:.3f}", f"{tflops:.2f}", f"{tflops_ckpt:.2f}",
                  f"{peak_mem/GB:5.3f}"]
        <a id="change">write_tsv(</a>heads, values, f"{model_type}_megatron_{output_file_name}_rank{rank}.tsv"<a id="change">)</a>
        print("Sleeping for 30 seconds before starting the next case. ")
        time.sleep(30)

</code></pre>