<html><h3>Pattern ID :24517
</h3><img src='76237295.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
class SAFEModel(BaseModel):
    def __init__(self, vocab, plm):
        super(SAFEModel, self).__init__()
        self.plm<a id="change"> = </a><a id="change">AutoModel.from_pretrained(</a>plm<a id="change">,return_dict=True,output_hidden_states=True,output_attentions=True)</a>
        self.vocab = vocab
        self.sent_dim = 1024
        &#47&#47 self.fc = nn.Linear(in_features=self.sent_dim,out_features=1)
        &#47&#47 self.fc.weight.data.normal_(mean=0.0,std=0.02)</code></pre><h3>After Change</h3><pre><code class='java'>
                 init_range=0.02, encoder_config=None):
        super().__init__()
        if encoder_config is None:
            encoder_config<a id="change"> = </a><a id="change">{</a>"output_attentions": False<a id="change">}</a>
        self.args = args

        encoder_config = {"output_attention": False}
        self.encoder = TextEncoder(model_name, **encoder_config)</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 6</div><BR><div id='size'>Non-data size: 4</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/cognlp/cogktr/commit/f6b353c2e6ed535601aa335376fd16f7a2cc5004#diff-81ba55c4ed7b308ef5812a981d07842cc58b5372c4e30d5d7530debf2d7a15c1L283' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 76237295</div><div id='project'> Project Name: cognlp/cogktr</div><div id='commit'> Commit Name: f6b353c2e6ed535601aa335376fd16f7a2cc5004</div><div id='time'> Time: 2022-07-15</div><div id='author'> Author: 1208314139@qq.com</div><div id='file'> File Name: cogktr/models/safe_model.py</div><div id='m_class'> M Class Name: SAFEModel</div><div id='n_method'> N Class Name: SAFEModel</div><div id='m_method'> M Method Name: __init__(20)</div><div id='n_method'> N Method Name: __init__(3)</div><div id='m_parent_class'> M Parent Class: nn.Module</div><div id='n_parent_class'> N Parent Class: BaseModel</div><div id='m_file'> M File Name: cogktr/models/safe_model.py</div><div id='n_file'> N File Name: cogktr/models/safe_model.py</div><div id='m_start'> M Start Line: 379</div><div id='m_end'> M End Line: 414</div><div id='n_start'> N Start Line: 283</div><div id='n_end'> N End Line: 301</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
    &#47&#47 set model to evaluation mode
    model.eval()

    tokenizer<a id="change"> = </a><a id="change">BertTokenizer.from_pretrained(</a>config.bert_model<a id="change">, do_lower_case=True, skip_special_tokens=True)</a>
    id2label = config.id2label
    true_tags = []
    pred_tags = []
    sent_data = []</code></pre><h3>After Change</h3><pre><code class='java'>
            batch_output = batch_output.detach().cpu().numpy()
            batch_tags = batch_tags.to(&quotcpu&quot).numpy()
            for i, indices in enumerate(np.argmax(batch_output, axis=2)):
                pred_tag<a id="change"> = </a><a id="change">[]</a>
                for j, idx in enumerate(indices):
                    if label_masks[i][j]:
                        pred_tag.append(id2label.get(idx))
                pred_tags.append(pred_tag)</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/hemingkx/wordseg/commit/148a03a62ebd0fc3dcbd4828b32aabd8ee76dc97#diff-13a1fbaf4d3a9ece7f1a03bc5edee62a33ad0fb1d42ea49968482079914bc388L77' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 76237294</div><div id='project'> Project Name: hemingkx/wordseg</div><div id='commit'> Commit Name: 148a03a62ebd0fc3dcbd4828b32aabd8ee76dc97</div><div id='time'> Time: 2021-05-05</div><div id='author'> Author: hemingkx@gmail.com</div><div id='file'> File Name: BERT-Softmax/train.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: evaluate(3)</div><div id='n_method'> N Method Name: evaluate(3)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: BERT-Softmax/train.py</div><div id='n_file'> N File Name: BERT-Softmax/train.py</div><div id='m_start'> M Start Line: 81</div><div id='m_end'> M End Line: 117</div><div id='n_start'> N Start Line: 80</div><div id='n_end'> N End Line: 125</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>

def main():
    config = load_config()
    tokenizer<a id="change"> = </a><a id="change">BertTokenizer.from_pretrained(</a>TOKENIZER_DIR<a id="change">)</a>
    transformer = Transformer.load_from_checkpoint(TRANSFORMER_CKPT)
    transformer.eval()
    seoul2jeju = load_seoul2jeju()[:10]
    seouls = [seoul for seoul, _ in seoul2jeju]</code></pre><h3>After Change</h3><pre><code class='java'>
    transformer = Transformer.load_from_checkpoint(transformer_ckpt)
    tokenizer = BertTokenizer.from_pretrained(tokenizer_dir)
    transformer.eval()
    jejus<a id="change"> = </a><a id="change">[</a>config[&quotjeju&quot]<a id="change"></a>]
    X = InferInputsBuilder(tokenizer, config[&quotmax_length&quot])(srcs=jejus)
    tgt_ids = transformer.predict(X)
    for pred in tgt_ids.tolist():</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/eubinecto/dekorde/commit/fd3b05ba0d98e727d7c58233ac0e8c0449890275#diff-239c9195f0b1188d5807fd9c603d9918e73ee42ade63e6f829ba093be9ee0f2fL8' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 76237299</div><div id='project'> Project Name: eubinecto/dekorde</div><div id='commit'> Commit Name: fd3b05ba0d98e727d7c58233ac0e8c0449890275</div><div id='time'> Time: 2021-12-06</div><div id='author'> Author: eubinecto</div><div id='file'> File Name: main_predict.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: main(0)</div><div id='n_method'> N Method Name: main(0)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: main_predict.py</div><div id='n_file'> N File Name: main_predict.py</div><div id='m_start'> M Start Line: 10</div><div id='m_end'> M End Line: 19</div><div id='n_start'> N Start Line: 11</div><div id='n_end'> N End Line: 27</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
            self.embedding.eval()
        else:
            self.embedding = nn.Embedding(vocab_size, 768).to(device)
        self.tokenizer<a id="change"> = </a><a id="change">AutoTokenizer.from_pretrained(</a>bert_type<a id="change">)</a>

        &#47&#47 out MLP
        self.out_drop = nn.Dropout(p=out_drop).to(device)
        self.out_linear = nn.Linear(encoder_dim, vocab_size).to(device)</code></pre><h3>After Change</h3><pre><code class='java'>
        if num_heads is None:
            num_heads = [3, 6, 12, 24]
        if depths is None:
            depths<a id="change"> = </a><a id="change">[</a>2, 2, 6, 2<a id="change"></a>]
        tokenizer = AutoTokenizer.from_pretrained(tokenizer_type)
        self.vocab_size = tokenizer.vocab_size
        self.pad_id = tokenizer.convert_tokens_to_ids("[PAD]")</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/kamino666/video-captioning-transformer/commit/8d6f9ff2e965ba00bd44e7d9dd808ccf01251eee#diff-fada037ad086638e65c7ae77e3d223963e9afaa26326aab0ea718f4013176e43L739' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 76237298</div><div id='project'> Project Name: kamino666/video-captioning-transformer</div><div id='commit'> Commit Name: 8d6f9ff2e965ba00bd44e7d9dd808ccf01251eee</div><div id='time'> Time: 2021-09-25</div><div id='author'> Author: 516015417@qq.com</div><div id='file'> File Name: model.py</div><div id='m_class'> M Class Name: VideoCaptionSwinTransformer</div><div id='n_method'> N Class Name: VideoCaptionSwinTransformer</div><div id='m_method'> M Method Name: __init__(27)</div><div id='n_method'> N Method Name: __init__(29)</div><div id='m_parent_class'> M Parent Class: nn.Module</div><div id='n_parent_class'> N Parent Class: nn.Module</div><div id='m_file'> M File Name: model.py</div><div id='n_file'> N File Name: model.py</div><div id='m_start'> M Start Line: 744</div><div id='m_end'> M End Line: 780</div><div id='n_start'> N Start Line: 733</div><div id='n_end'> N End Line: 772</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        register_new_traced_function(torch.einsum, torch)

    def get_model(self, args) -&gt; torch.nn.Module:
        config<a id="change"> = </a><a id="change">T5Config.from_pretrained(</a>args.model_name_or_path<a id="change">)</a>
        config.output_attentions = False
        config.output_hidden_states = False
        setattr(config, "output_only", True)
        setattr(config, "precomputed_masks", args.precompute_masks)</code></pre><h3>After Change</h3><pre><code class='java'>
        config_cls = T5Config
        tokenizer_class = T5Tokenizer

        explicitly_set_dict<a id="change"> = </a><a id="change">{
            </a>"output_attentions": False,
            "output_hidden_states": False,
            "output_only": True,
            "precomputed_masks": args.precompute_masks<a id="change">,

        }</a>

        model, config, tokenizer = pretrained_model_config_and_tokenizer(model_class=model_cls, config_class=config_cls,
                                                                         tokenizer_class=tokenizer_class,
                                                                         model_name_or_path=args.model_name_or_path,</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/saareliad/ftpipe/commit/8e1feb4f6c06a8d06c7dba686f4095ecbce6b7bc#diff-e4679d169d0473ed2e1d2277ddec5189345772f9f8fbdc859f727239e4416ec8L313' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 76237296</div><div id='project'> Project Name: saareliad/ftpipe</div><div id='commit'> Commit Name: 8e1feb4f6c06a8d06c7dba686f4095ecbce6b7bc</div><div id='time'> Time: 2020-09-10</div><div id='author'> Author: saareliad@campus.technion.ac.il</div><div id='file'> File Name: partitioning_scripts/tasks/t5.py</div><div id='m_class'> M Class Name: T5Partitioner</div><div id='n_method'> N Class Name: T5Partitioner</div><div id='m_method'> M Method Name: get_model(2)</div><div id='n_method'> N Method Name: get_model(2)</div><div id='m_parent_class'> M Parent Class: Partitioner</div><div id='n_parent_class'> N Parent Class: Partitioner</div><div id='m_file'> M File Name: partitioning_scripts/tasks/t5.py</div><div id='n_file'> N File Name: partitioning_scripts/tasks/t5.py</div><div id='m_start'> M Start Line: 314</div><div id='m_end'> M End Line: 339</div><div id='n_start'> N Start Line: 327</div><div id='n_end'> N End Line: 346</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
class TestTriggerTemplatizer(TestCase):
    def test_bert(self):
        template = &quot[T] [T] {arbitrary} [T] {fields} [P]&quot
        tokenizer<a id="change"> = </a><a id="change">AutoTokenizer.from_pretrained(</a>&quotbert-base-cased&quot<a id="change">)</a>
        utils.add_task_specific_tokens(tokenizer)
        templatizer = utils.TriggerTemplatizer(
            template,
            tokenizer,</code></pre><h3>After Change</h3><pre><code class='java'>
        model_inputs, label = templatizer(self.default_instance)

        &#47&#47 Label should be mapped to its token id
        expected_label<a id="change"> = </a>torch.tensor(<a id="change">[</a>self.default_tokenizer.convert_tokens_to_ids([self.default_instance[&quotlabel&quot]])<a id="change"></a>])
        assert torch.equal(expected_label, label)

        &#47&#47 For BERT ouput is expected to have the following keys</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/ucinlp/autoprompt/commit/829537c47b14e9e5e01a894df6d6c4606b922c41#diff-33c13e0b177bacd2f02e29bcb8aea5b49e7ce34901fd8f41fefb65defba1bd33L11' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 76237301</div><div id='project'> Project Name: ucinlp/autoprompt</div><div id='commit'> Commit Name: 829537c47b14e9e5e01a894df6d6c4606b922c41</div><div id='time'> Time: 2020-05-26</div><div id='author'> Author: rloganiv@gmail.com</div><div id='file'> File Name: tests/test_utils.py</div><div id='m_class'> M Class Name: TestTriggerTemplatizer</div><div id='n_method'> N Class Name: TestTriggerTemplatizer</div><div id='m_method'> M Method Name: test_bert(1)</div><div id='n_method'> N Method Name: test_bert(1)</div><div id='m_parent_class'> M Parent Class: TestCase</div><div id='n_parent_class'> N Parent Class: TestCase</div><div id='m_file'> M File Name: tests/test_utils.py</div><div id='n_file'> N File Name: tests/test_utils.py</div><div id='m_start'> M Start Line: 12</div><div id='m_end'> M End Line: 53</div><div id='n_start'> N Start Line: 48</div><div id='n_end'> N End Line: 78</div><BR>