<html><h3>Pattern ID :10536
</h3><img src='36683951.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
        model = torch.load(model_path, map_location=torch.device(device))
    if isinstance(model, dict):
        model = model["model"]  &#47&#47 load model
    hub_model = <a id="change">Model(model.yaml).to(</a>next(model.parameters()).device<a id="change">)</a>  &#47&#47 create
    hub_model.load_state_dict(model.float().state_dict())  &#47&#47 load state_dict
    hub_model.names = model.names  &#47&#47 class names
    model = hub_model</code></pre><h3>After Change</h3><pre><code class='java'>
    hub_model = Model(model.yaml)  &#47&#47 create
    msd = model.state_dict()  &#47&#47 model state_dict
    csd = model.float().state_dict()  &#47&#47 checkpoint state_dict as FP32
    csd<a id="change"> = </a><a id="change">{k: v for k, v in csd.items() if msd[k].shape == v.shape}</a>  &#47&#47 filter
    hub_model.load_state_dict(csd, strict=False)  &#47&#47 load
    hub_model.names = model.names  &#47&#47 class names
    model = hub_model</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 4</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/fcakyon/yolov5-pip/commit/2aefee98fef840e47bab68632a0fdc1319a3ceca#diff-6ed9ba8c59389ed1a496374ba989e215697912bcb4f39180928bbf3e5a755c72L38' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 36683951</div><div id='project'> Project Name: fcakyon/yolov5-pip</div><div id='commit'> Commit Name: 2aefee98fef840e47bab68632a0fdc1319a3ceca</div><div id='time'> Time: 2021-10-13</div><div id='author'> Author: 34196005+fcakyon@users.noreply.github.com</div><div id='file'> File Name: yolov5/helpers.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: load_model(4)</div><div id='n_method'> N Method Name: load_model(4)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: yolov5/helpers.py</div><div id='n_file'> N File Name: yolov5/helpers.py</div><div id='m_start'> M Start Line: 38</div><div id='m_end'> M End Line: 39</div><div id='n_start'> N Start Line: 40</div><div id='n_end'> N End Line: 44</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
				)
		if isinstance(self.criterion, dict):
			if len(self.criterion) == 1 and isinstance(pred, torch.Tensor) and isinstance(y_batch, torch.Tensor):
				return list(self.criterion.values())[0](pred, <a id="change">y_batch.long().to(</a>self.device<a id="change">)</a>)
			assert isinstance(x_batch, dict) and isinstance(y_batch, dict) and isinstance(pred, dict), \
				"If criterion is a dict, x_batch, y_batch and pred must be a dict too."
			batch_loss = sum([</code></pre><h3>After Change</h3><pre><code class='java'>
				)
		if isinstance(self.criterion, dict):
			if isinstance(y_batch, torch.Tensor):
				y_batch<a id="change"> = </a><a id="change">{k: y_batch for k in self.criterion}</a>
			if isinstance(pred, torch.Tensor):
				pred = {k: pred for k in self.criterion}
			assert isinstance(pred, dict) and isinstance(y_batch, dict) and isinstance(pred, dict), \
				"If criterion is a dict, pred, y_batch and pred must be a dict too."</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/neurotorch/neurotorch/commit/a0bba3392f7ae4d80f5436dfc12135482648e50d#diff-0cba0796f28ee0f654756c479c39a76c207b75044c640383428a14864aef8258L21' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 36683949</div><div id='project'> Project Name: neurotorch/neurotorch</div><div id='commit'> Commit Name: a0bba3392f7ae4d80f5436dfc12135482648e50d</div><div id='time'> Time: 2022-06-02</div><div id='author'> Author: 50332514+JeremieGince@users.noreply.github.com</div><div id='file'> File Name: src/neurotorch/trainers/classification.py</div><div id='m_class'> M Class Name: ClassificationTrainer</div><div id='n_method'> N Class Name: ClassificationTrainer</div><div id='m_method'> M Method Name: apply_criterion_on_batch(3)</div><div id='n_method'> N Method Name: apply_criterion_on_batch(3)</div><div id='m_parent_class'> M Parent Class: Trainer</div><div id='n_parent_class'> N Parent Class: Trainer</div><div id='m_file'> M File Name: src/neurotorch/trainers/classification.py</div><div id='n_file'> N File Name: src/neurotorch/trainers/classification.py</div><div id='m_start'> M Start Line: 32</div><div id='m_end'> M End Line: 34</div><div id='n_start'> N Start Line: 38</div><div id='n_end'> N End Line: 42</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
    dummy_input = utils.to(dummy_input, torch.float32)

    model = copy.deepcopy(model)
    model = <a id="change">model.to(</a>&quotcuda&quot<a id="change">)</a>.to(torch.float32).eval()

    with torch.no_grad():
        output = model(dummy_input)</code></pre><h3>After Change</h3><pre><code class='java'>

    input_names = utils.get_names(dummy_input, &quotinput&quot)
    output_names = utils.get_names(output, &quotoutput&quot)
    dynamic_axes<a id="change"> = </a><a id="change">{name: {0: &quotbatch&quot} for name in input_names+output_names}</a>

    if onnx_model_name is None:
        onnx_model_name = &quot/tmp/{}.onnx&quot.format(uuid.uuid4())
</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/media-smart/volksdep/commit/a1faff750f2c17416fa7f66e9fbff61b1ba94636#diff-331524e47fc80b894c5095873948d8b1a1f84ec9154903b527f4dd844e375155L15' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 36683947</div><div id='project'> Project Name: media-smart/volksdep</div><div id='commit'> Commit Name: a1faff750f2c17416fa7f66e9fbff61b1ba94636</div><div id='time'> Time: 2020-05-24</div><div id='author'> Author: hongxiang.cai@media-smart.cn</div><div id='file'> File Name: volksdep/converters/onnx/converter.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: torch2onnx(6)</div><div id='n_method'> N Method Name: torch2onnx(6)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: volksdep/converters/onnx/converter.py</div><div id='n_file'> N File Name: volksdep/converters/onnx/converter.py</div><div id='m_start'> M Start Line: 47</div><div id='m_end'> M End Line: 84</div><div id='n_start'> N Start Line: 46</div><div id='n_end'> N End Line: 75</div><BR>