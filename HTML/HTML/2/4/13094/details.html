<html><h3>Pattern ID :13094
</h3><img src='44227923.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
def main(cfg: DictConfig) -&gt; None:
    print("Loading data")
    folder = ["training", "validation"]
    <a id="change">for </a>i in folder<a id="change">:
        </a>path = Path(cfg.path) / i
        split<a id="change"> = </a>path / "lang_annotations/auto_lang_ann.npy"
        data = np.load(split, allow_pickle=True).reshape(-1)[0]
        task_ann = cfg.val_instructions if "val" in i else cfg.train_instructions
        if cfg.reannotate and "train" in i:</code></pre><h3>After Change</h3><pre><code class='java'>
            language_embedding = model(list(ann))
            embeddings[task]["emb"] = language_embedding.cpu().numpy()
            embeddings[task]["ann"] = ann
        <a id="change">np.save(</a>save_path / "embeddings", embeddings<a id="change">)</a>  &#47&#47 type:ignore
        print("Done saving val language embeddings for Rollouts !")

</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 3</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/mees/calvin/commit/e5b712f12f5a2c5bf461a633771f1f7be42666a2#diff-a8af52d2b408a2118467e90ca6cc196f882296e11f9a1a15d03163a462e8aacbL21' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 44227923</div><div id='project'> Project Name: mees/calvin</div><div id='commit'> Commit Name: e5b712f12f5a2c5bf461a633771f1f7be42666a2</div><div id='time'> Time: 2022-04-14</div><div id='author'> Author: oier.mees@gmail.com</div><div id='file'> File Name: calvin_models/calvin_agent/utils/relabel_with_new_lang_model.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: main(1)</div><div id='n_method'> N Method Name: main(1)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: calvin_models/calvin_agent/utils/relabel_with_new_lang_model.py</div><div id='n_file'> N File Name: calvin_models/calvin_agent/utils/relabel_with_new_lang_model.py</div><div id='m_start'> M Start Line: 21</div><div id='m_end'> M End Line: 41</div><div id='n_start'> N Start Line: 23</div><div id='n_end'> N End Line: 55</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        root = pathlib.Path(tempdir) / &quotroot&quot
        for layer_index, layer_images in enumerate(top_image_tensors):
            layer_dir = root / layer(layer_index)
            <a id="change">for </a>unit_index, <a id="change">unit_images</a> in enumerate(layer_images)<a id="change">:
                </a>unit_dir<a id="change"> = </a>layer_dir / unit(unit_index)
                unit_dir.mkdir(exist_ok=True, parents=True)
                for unit_image_index, unit_image in enumerate(unit_images):
                    unit_image_file = unit_dir / image(unit_image_index)</code></pre><h3>After Change</h3><pre><code class='java'>
        for layer_index, (layer_images, layer_masks) in enumerate(layer_data):
            layer_dir = root / layer(layer_index)
            layer_dir.mkdir(parents=True)
            <a id="change">numpy.save(</a>layer_dir / &quotimages.npy&quot, layer_images.numpy()<a id="change">)</a>
            numpy.save(layer_dir / &quotmasks.npy&quot, layer_masks.numpy())
        yield root

</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/evandez/neuron-descriptions/commit/f07379d8a1cfe1c939ad8b9c43ee89482c451a85#diff-e52e4ddd58b7ef887ab03c04116e676f6280b824ab7469d5d3080e5cba4f2128L47' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 44227921</div><div id='project'> Project Name: evandez/neuron-descriptions</div><div id='commit'> Commit Name: f07379d8a1cfe1c939ad8b9c43ee89482c451a85</div><div id='time'> Time: 2021-04-15</div><div id='author'> Author: evanfredhernandez@gmail.com</div><div id='file'> File Name: tests/conftest.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: top_images_root(2)</div><div id='n_method'> N Method Name: top_images_root(1)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: tests/conftest.py</div><div id='n_file'> N File Name: tests/conftest.py</div><div id='m_start'> M Start Line: 49</div><div id='m_end'> M End Line: 60</div><div id='n_start'> N Start Line: 62</div><div id='n_end'> N End Line: 71</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
    &#47&#47 np.save(result_npy, result)
    
    df = pd.DataFrame({&quotnode_idx&quot: test_nid, &quotlabel&quot: np.argmax(result, axis=-1)})
    <a id="change">for row</a> in df.itertuples()<a id="change">:
        </a>node_idx = getattr(row, &quotnode_idx&quot)
        label = getattr(row, &quotlabel&quot)
        labels[node_idx]<a id="change"> = </a>label
        
    df[&quotlabel&quot] = df[&quotlabel&quot].apply(id2name)
    mged = pd.merge(df, nodes_df[[&quotnode_idx&quot, &quotpaper_id&quot]], on=&quotnode_idx&quot, how=&quotleft&quot)</code></pre><h3>After Change</h3><pre><code class='java'>
        
    result = test_epoch(model, test_dataloader, node_feats, labels, model_cfg[&quotNUM_CLASS&quot], device)
    result_npy = os.path.join(dataset_cfg[&quotOUT_PATH&quot], &quot{}_logits.npy&quot.format(dataset_cfg[&quotTEST_PREFIX&quot]))
    <a id="change">np.save(</a>result_npy, result<a id="change">)</a>
    df = pd.DataFrame({&quotnode_idx&quot: test_nid, &quotlabel&quot: np.argmax(result, axis=-1)})
        
    df[&quotlabel&quot] = df[&quotlabel&quot].apply(id2name)
    mged = pd.merge(df, nodes_df[[&quotnode_idx&quot, &quotpaper_id&quot]], on=&quotnode_idx&quot, how=&quotleft&quot)</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/langgege-cqu/maxp_dgl/commit/bd8491f8470f66bede2d6bbd0a6b003623f9fde6#diff-481f6c37616107eb4c57699c9b47073a4935479bda273af48f3b9d2afd3f9509L105' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 44227914</div><div id='project'> Project Name: langgege-cqu/maxp_dgl</div><div id='commit'> Commit Name: bd8491f8470f66bede2d6bbd0a6b003623f9fde6</div><div id='time'> Time: 2021-11-21</div><div id='author'> Author: 8747734+bugczw@user.noreply.gitee.com</div><div id='file'> File Name: maxp_model_czw/test_yaml.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: test(4)</div><div id='n_method'> N Method Name: test(4)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: maxp_model_czw/test_yaml.py</div><div id='n_file'> N File Name: maxp_model_czw/test_yaml.py</div><div id='m_start'> M Start Line: 121</div><div id='m_end'> M End Line: 127</div><div id='n_start'> N Start Line: 107</div><div id='n_end'> N End Line: 109</div><BR>