<html><h3>Pattern ID :22017
</h3><img src='69865122.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
                                     "model_stage_index": model_stages_index,
                                     "model_stage_title": model_stages_title,
                                     "model_stage_detail": model_stage_detail,
                                     "timestamp": int(format(<a id="change">time.time()</a>, &quot.0f&quot))}
        logging.info("-----Stages{}:{}-----".format(model_stages_index, model_stages_title))
        logging.info("-----Stages{}:{}.....".format(model_stages_index, model_stage_detail))
        self.setup_client_mqtt_mgr()</code></pre><h3>After Change</h3><pre><code class='java'>
                                     "model_stage_index": model_stages_index,
                                     "model_stage_title": model_stages_title,
                                     "model_stage_detail": model_stage_detail,
                                     "timestamp": int(format(<a id="change">time.time_ns()/1000.0</a>, &quot.0f&quot))}
        logging.info("-----Stages{}:{}-----".format(model_stages_index, model_stages_title))
        logging.info("-----Stages{}:{}.....".format(model_stages_index, model_stage_detail))
        self.setup_client_mqtt_mgr()</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 6</div><BR><div id='size'>Non-data size: 3</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/fedml-ai/fedml/commit/14388a3ed38ec89cc2f1d5fc7106a1208709a183#diff-cfaa966ad20b7c4fe1e2568196ec97beb805798368d33b17192f962b871d54b2L816' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 69865122</div><div id='project'> Project Name: fedml-ai/fedml</div><div id='commit'> Commit Name: 14388a3ed38ec89cc2f1d5fc7106a1208709a183</div><div id='time'> Time: 2023-01-10</div><div id='author'> Author: alexliang.kh@gmail.com</div><div id='file'> File Name: python/fedml/cli/model_deployment/device_server_runner.py</div><div id='m_class'> M Class Name: FedMLServerRunner</div><div id='n_method'> N Class Name: FedMLServerRunner</div><div id='m_method'> M Method Name: send_deployment_stages(8)</div><div id='n_method'> N Method Name: send_deployment_stages(8)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: python/fedml/cli/model_deployment/device_server_runner.py</div><div id='n_file'> N File Name: python/fedml/cli/model_deployment/device_server_runner.py</div><div id='m_start'> M Start Line: 816</div><div id='m_end'> M End Line: 816</div><div id='n_start'> N Start Line: 818</div><div id='n_end'> N End Line: 818</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>

            &#47&#47 Display training infos
            if log_interval is not None and iteration % log_interval == 0:
                fps = int((self.num_timesteps - self._num_timesteps_at_start) / (<a id="change">time.time()</a> - self.start_time))
                self.logger.record("time/iterations", iteration, exclude="tensorboard")
                if len(self.ep_info_buffer) &gt; 0 and len(self.ep_info_buffer[0]) &gt; 0:
                    self.logger.record("rollout/ep_rew_mean", safe_mean([ep_info["r"] for ep_info in self.ep_info_buffer]))</code></pre><h3>After Change</h3><pre><code class='java'>

            &#47&#47 Display training infos
            if log_interval is not None and iteration % log_interval == 0:
                time_elapsed = max((<a id="change">time.time_ns()</a> - self.start_time)<a id="change"> / 1e9</a>, sys.float_info.epsilon)
                fps = int((self.num_timesteps - self._num_timesteps_at_start) / time_elapsed)
                self.logger.record("time/iterations", iteration, exclude="tensorboard")
                if len(self.ep_info_buffer) &gt; 0 and len(self.ep_info_buffer[0]) &gt; 0:</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/dlr-rm/stable-baselines3/commit/b1cc15970a40c86b26a247fab5783e025bfe3da1#diff-384b5f21f2bed58d1d6e64da04a42fee52f353fcec38bf410338524336657bd8L225' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 69865123</div><div id='project'> Project Name: dlr-rm/stable-baselines3</div><div id='commit'> Commit Name: b1cc15970a40c86b26a247fab5783e025bfe3da1</div><div id='time'> Time: 2022-07-25</div><div id='author'> Author: adam@gleave.me</div><div id='file'> File Name: stable_baselines3/common/on_policy_algorithm.py</div><div id='m_class'> M Class Name: OnPolicyAlgorithm</div><div id='n_method'> N Class Name: OnPolicyAlgorithm</div><div id='m_method'> M Method Name: learn(10)</div><div id='n_method'> N Method Name: learn(10)</div><div id='m_parent_class'> M Parent Class: BaseAlgorithm</div><div id='n_parent_class'> N Parent Class: BaseAlgorithm</div><div id='m_file'> M File Name: stable_baselines3/common/on_policy_algorithm.py</div><div id='n_file'> N File Name: stable_baselines3/common/on_policy_algorithm.py</div><div id='m_start'> M Start Line: 257</div><div id='m_end'> M End Line: 263</div><div id='n_start'> N Start Line: 258</div><div id='n_end'> N End Line: 265</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
                                     "model_stage_index": model_stages_index,
                                     "model_stage_title": model_stages_title,
                                     "model_stage_detail": model_stage_detail,
                                     "timestamp": int(format(<a id="change">time.time()</a>, &quot.0f&quot))}
        logging.info("-----Stages{}:{}-----".format(model_stages_index, model_stages_title))
        logging.info("-----Stages{}:{}.....".format(model_stages_index, model_stage_detail))
        self.setup_client_mqtt_mgr()</code></pre><h3>After Change</h3><pre><code class='java'>
                                     "model_stage_index": model_stages_index,
                                     "model_stage_title": model_stages_title,
                                     "model_stage_detail": model_stage_detail,
                                     "timestamp": int(format(<a id="change">time.time_ns()/1000.0</a>, &quot.0f&quot))}
        logging.info("-----Stages{}:{}-----".format(model_stages_index, model_stages_title))
        logging.info("-----Stages{}:{}.....".format(model_stages_index, model_stage_detail))
        self.setup_client_mqtt_mgr()</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/fedml-ai/fedml/commit/6e5653085e82eb672ba7ac9a32e99633952f68b1#diff-cfaa966ad20b7c4fe1e2568196ec97beb805798368d33b17192f962b871d54b2L805' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 69865126</div><div id='project'> Project Name: fedml-ai/fedml</div><div id='commit'> Commit Name: 6e5653085e82eb672ba7ac9a32e99633952f68b1</div><div id='time'> Time: 2023-01-10</div><div id='author'> Author: alex.gpt.llm@gmail.com</div><div id='file'> File Name: python/fedml/cli/model_deployment/device_server_runner.py</div><div id='m_class'> M Class Name: FedMLServerRunner</div><div id='n_method'> N Class Name: FedMLServerRunner</div><div id='m_method'> M Method Name: send_deployment_stages(8)</div><div id='n_method'> N Method Name: send_deployment_stages(8)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: python/fedml/cli/model_deployment/device_server_runner.py</div><div id='n_file'> N File Name: python/fedml/cli/model_deployment/device_server_runner.py</div><div id='m_start'> M Start Line: 816</div><div id='m_end'> M End Line: 816</div><div id='n_start'> N Start Line: 818</div><div id='n_end'> N End Line: 818</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        
        Write log.
        
        time_elapsed = <a id="change">time.time()</a> - self.start_time
        fps = int((self.num_timesteps - self._num_timesteps_at_start) / (time_elapsed + 1e-8))
        self.logger.record("time/episodes", self._episode_num, exclude="tensorboard")
        if len(self.ep_info_buffer) &gt; 0 and len(self.ep_info_buffer[0]) &gt; 0:</code></pre><h3>After Change</h3><pre><code class='java'>
        
        Write log.
        
        time_elapsed = max((<a id="change">time.time_ns()</a> - self.start_time)<a id="change"> / 1e9</a>, sys.float_info.epsilon)
        fps = int((self.num_timesteps - self._num_timesteps_at_start) / time_elapsed)
        self.logger.record("time/episodes", self._episode_num, exclude="tensorboard")
        if len(self.ep_info_buffer) &gt; 0 and len(self.ep_info_buffer[0]) &gt; 0:</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/dlr-rm/stable-baselines3/commit/b1cc15970a40c86b26a247fab5783e025bfe3da1#diff-7809dfd549054549abed96b27661447862894a94e6873c67f8f96f4b6842debdL426' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 69865127</div><div id='project'> Project Name: dlr-rm/stable-baselines3</div><div id='commit'> Commit Name: b1cc15970a40c86b26a247fab5783e025bfe3da1</div><div id='time'> Time: 2022-07-25</div><div id='author'> Author: adam@gleave.me</div><div id='file'> File Name: stable_baselines3/common/off_policy_algorithm.py</div><div id='m_class'> M Class Name: OffPolicyAlgorithm</div><div id='n_method'> N Class Name: OffPolicyAlgorithm</div><div id='m_method'> M Method Name: _dump_logs(1)</div><div id='n_method'> N Method Name: _dump_logs(1)</div><div id='m_parent_class'> M Parent Class: BaseAlgorithm</div><div id='n_parent_class'> N Parent Class: BaseAlgorithm</div><div id='m_file'> M File Name: stable_baselines3/common/off_policy_algorithm.py</div><div id='n_file'> N File Name: stable_baselines3/common/off_policy_algorithm.py</div><div id='m_start'> M Start Line: 430</div><div id='m_end'> M End Line: 431</div><div id='n_start'> N Start Line: 431</div><div id='n_end'> N End Line: 432</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        avg_qps = format(avg_qps, &quot.0f&quot)
        avg_latency = format(total_latency / total_request_num / self.ms_per_sec, &quot.6f&quot)

        timestamp = int(format(<a id="change">time.time()</a>, &quot.0f&quot))
        FedMLModelCache.get_instance(self.redis_addr, self.redis_port).set_monitor_metrics(end_point_id, total_latency,
                                                                                           avg_latency,
                                                                                           total_request_num,</code></pre><h3>After Change</h3><pre><code class='java'>
        avg_qps = format(avg_qps, &quot.0f&quot)
        avg_latency = format(total_latency / total_request_num / self.ms_per_sec, &quot.6f&quot)

        timestamp = int(format(<a id="change">time.time_ns()/1000.0</a>, &quot.0f&quot))
        FedMLModelCache.get_instance(self.redis_addr, self.redis_port).set_monitor_metrics(end_point_id, total_latency,
                                                                                           avg_latency,
                                                                                           total_request_num,</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/fedml-ai/fedml/commit/1770f479a573bcb0a4ab04c56308d00b73360b18#diff-9ec8fbd65dc14859a2bd23f9b75eccbeaa95f9538d5081ecd7527078acc941d7L29' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 69865124</div><div id='project'> Project Name: fedml-ai/fedml</div><div id='commit'> Commit Name: 1770f479a573bcb0a4ab04c56308d00b73360b18</div><div id='time'> Time: 2023-01-10</div><div id='author'> Author: alexliang.kh@gmail.com</div><div id='file'> File Name: python/fedml/cli/model_deployment/device_model_monitor.py</div><div id='m_class'> M Class Name: FedMLModelMetrics</div><div id='n_method'> N Class Name: FedMLModelMetrics</div><div id='m_method'> M Method Name: calc_metrics(5)</div><div id='n_method'> N Method Name: calc_metrics(5)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: python/fedml/cli/model_deployment/device_model_monitor.py</div><div id='n_file'> N File Name: python/fedml/cli/model_deployment/device_model_monitor.py</div><div id='m_start'> M Start Line: 46</div><div id='m_end'> M End Line: 46</div><div id='n_start'> N Start Line: 46</div><div id='n_end'> N End Line: 46</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        avg_qps = format(avg_qps, &quot.0f&quot)
        avg_latency = format(total_latency / total_request_num / self.ms_per_sec, &quot.6f&quot)

        timestamp = int(format(<a id="change">time.time()</a>, &quot.0f&quot))
        FedMLModelCache.get_instance(self.redis_addr, self.redis_port).set_monitor_metrics(end_point_id, total_latency,
                                                                                           avg_latency,
                                                                                           total_request_num,</code></pre><h3>After Change</h3><pre><code class='java'>
        avg_qps = format(avg_qps, &quot.0f&quot)
        avg_latency = format(total_latency / total_request_num / self.ms_per_sec, &quot.6f&quot)

        timestamp = int(format(<a id="change">time.time_ns()/1000.0</a>, &quot.0f&quot))
        FedMLModelCache.get_instance(self.redis_addr, self.redis_port).set_monitor_metrics(end_point_id, total_latency,
                                                                                           avg_latency,
                                                                                           total_request_num,</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/fedml-ai/fedml/commit/bfd22b06ca95083b413bd852779053677cab30b7#diff-9ec8fbd65dc14859a2bd23f9b75eccbeaa95f9538d5081ecd7527078acc941d7L29' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 69865125</div><div id='project'> Project Name: fedml-ai/fedml</div><div id='commit'> Commit Name: bfd22b06ca95083b413bd852779053677cab30b7</div><div id='time'> Time: 2023-01-10</div><div id='author'> Author: alex.gpt.llm@gmail.com</div><div id='file'> File Name: python/fedml/cli/model_deployment/device_model_monitor.py</div><div id='m_class'> M Class Name: FedMLModelMetrics</div><div id='n_method'> N Class Name: FedMLModelMetrics</div><div id='m_method'> M Method Name: calc_metrics(5)</div><div id='n_method'> N Method Name: calc_metrics(5)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: python/fedml/cli/model_deployment/device_model_monitor.py</div><div id='n_file'> N File Name: python/fedml/cli/model_deployment/device_model_monitor.py</div><div id='m_start'> M Start Line: 46</div><div id='m_end'> M End Line: 46</div><div id='n_start'> N Start Line: 46</div><div id='n_end'> N End Line: 46</div><BR>