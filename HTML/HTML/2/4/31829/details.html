<html><h3>Pattern ID :31829
</h3><img src='93056248.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
                qi_inferable_quantizers_constants.MAX_RANGE: node_w_qc.weights_quantization_params[RANGE_MAX].flatten(),
                qi_inferable_quantizers_constants.CHANNEL_AXIS: node_w_qc.weights_channels_axis}
    else:
        <a id="change">Logger.critical(</a>f&quotNot supported quantization method for weights inferable quantizers.&quot<a id="change">)</a>  &#47&#47 pragma: no cover


def get_activation_inferable_quantizer_kwargs(node: BaseNode) -&gt; Dict[str, Any]:</code></pre><h3>After Change</h3><pre><code class='java'>
                qi_inferable_quantizers_constants.MAX_RANGE: node_w_qc.weights_quantization_params[RANGE_MAX].flatten(),
                qi_inferable_quantizers_constants.CHANNEL_AXIS: node_w_qc.weights_channels_axis}

    elif <a id="change">quantization_method in [QuantizationMethod.LUT_POT_QUANTIZER, QuantizationMethod.LUT_SYM_QUANTIZER]</a>:
        return {qi_inferable_quantizers_constants.NUM_BITS: node_w_qc.weights_n_bits,
                qi_inferable_quantizers_constants.CLUSTER_CENTERS: node_w_qc.weights_quantization_params[CLUSTER_CENTERS].flatten(),
                qi_inferable_quantizers_constants.THRESHOLD: node_w_qc.weights_quantization_params[SCALE_PER_CHANNEL].flatten(),
                qi_inferable_quantizers_constants.PER_CHANNEL: node_w_qc.weights_per_channel_threshold,
                qi_inferable_quantizers_constants.CHANNEL_AXIS: node_w_qc.weights_channels_axis}
                &#47&#47 TODO: Add MULTIPLIER_N_BITS & EPS to node quantization config

    else:
        <a id="change">Logger.critical(</a>f&quotNot supported quantization method for weights inferable quantizers.&quot<a id="change">)</a>  &#47&#47 pragma: no cover


def get_activation_inferable_quantizer_kwargs(node: BaseNode) -&gt; Dict[str, Any]:</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 4</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/sony/model_optimization/commit/d8d0df9bb1c0b915e5b1c720337c68daa0e5b80d#diff-b35c2cf3b4b5acef207de76d44e67a22dc9f1e8e1ef59595eab41d77e9eef5c0L32' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 93056248</div><div id='project'> Project Name: sony/model_optimization</div><div id='commit'> Commit Name: d8d0df9bb1c0b915e5b1c720337c68daa0e5b80d</div><div id='time'> Time: 2023-03-15</div><div id='author'> Author: 78862769+elad-c@users.noreply.github.com</div><div id='file'> File Name: model_compression_toolkit/exporter/model_wrapper/pytorch/builder/node_to_quantizer.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: get_weights_inferable_quantizer_kwargs(1)</div><div id='n_method'> N Method Name: get_weights_inferable_quantizer_kwargs(1)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: model_compression_toolkit/exporter/model_wrapper/pytorch/builder/node_to_quantizer.py</div><div id='n_file'> N File Name: model_compression_toolkit/exporter/model_wrapper/pytorch/builder/node_to_quantizer.py</div><div id='m_start'> M Start Line: 49</div><div id='m_end'> M End Line: 49</div><div id='n_start'> N Start Line: 32</div><div id='n_end'> N End Line: 59</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        try:
            return await self.websocket.send_bytes(request.SerializeToString())
        except ConnectionResetError:
            <a id="change">self.logger.critical(</a>f&quotserver connection closed already!&quot<a id="change">)</a>

    async def send_dry_run(self):
        Query the dry_run endpoint from Gateway
</code></pre><h3>After Change</h3><pre><code class='java'>
            try:
                return await self.websocket.send_bytes(request.SerializeToString())
            except ConnectionResetError:
                <a id="change">if retry == self.max_attempts</a>:
                    <a id="change">self.logger.critical(</a>f&quotserver connection closed already!&quot<a id="change">)</a>
                    raise
                else:
                    wait_time = random.uniform(0, min(self.initial_backoff*self.backoff_multiplier**(retry-1), self.max_backoff))
                    await asyncio.sleep(wait_time)</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/jina-ai/jina/commit/d0838d37de983a687c743fd969b74deea5937b65#diff-ced4699605c6a8e25ae2afa2e07a06d7bffb3cbff3fb1bea0978fa95a81750b4L158' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 93056247</div><div id='project'> Project Name: jina-ai/jina</div><div id='commit'> Commit Name: d0838d37de983a687c743fd969b74deea5937b65</div><div id='time'> Time: 2022-09-27</div><div id='author'> Author: joan.martinez@jina.ai</div><div id='file'> File Name: jina/clients/base/helper.py</div><div id='m_class'> M Class Name: WebsocketClientlet</div><div id='n_method'> N Class Name: WebsocketClientlet</div><div id='m_method'> M Method Name: send_message(2)</div><div id='n_method'> N Method Name: send_message(2)</div><div id='m_parent_class'> M Parent Class: AioHttpClientlet</div><div id='n_parent_class'> N Parent Class: AioHttpClientlet</div><div id='m_file'> M File Name: jina/clients/base/helper.py</div><div id='n_file'> N File Name: jina/clients/base/helper.py</div><div id='m_start'> M Start Line: 164</div><div id='m_end'> M End Line: 169</div><div id='n_start'> N Start Line: 188</div><div id='n_end'> N End Line: 199</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
                qi_inferable_quantizers_constants.MIN_RANGE: np.asarray([node_qc.activation_quantization_params[RANGE_MIN]]),
                qi_inferable_quantizers_constants.MAX_RANGE: np.asarray([node_qc.activation_quantization_params[RANGE_MAX]])}
    else:
        <a id="change">Logger.critical(</a>f&quotNot supported quantization method for inferable quantizers.&quot<a id="change">)</a>  &#47&#47 pragma: no cover


def get_weights_quantizer_for_node(node: BaseNode) -&gt; BasePyTorchInferableQuantizer:</code></pre><h3>After Change</h3><pre><code class='java'>
                qi_inferable_quantizers_constants.MIN_RANGE: np.asarray([node_qc.activation_quantization_params[RANGE_MIN]]),
                qi_inferable_quantizers_constants.MAX_RANGE: np.asarray([node_qc.activation_quantization_params[RANGE_MAX]])}

    elif <a id="change">quantization_method in [QuantizationMethod.LUT_POT_QUANTIZER]</a>:
        return {qi_inferable_quantizers_constants.NUM_BITS: node_qc.activation_n_bits,
                qi_inferable_quantizers_constants.CLUSTER_CENTERS: np.asarray(
                    [node_qc.activation_quantization_params[CLUSTER_CENTERS]]),
                qi_inferable_quantizers_constants.THRESHOLD: np.asarray(
                    [node_qc.activation_quantization_params[THRESHOLD]]),
                qi_inferable_quantizers_constants.SIGNED: node_qc.activation_quantization_params.get(SIGNED)}
        &#47&#47 TODO: Add MULTIPLIER_N_BITS & EPS to node quantization config
    else:
        <a id="change">Logger.critical(</a>f&quotNot supported quantization method for inferable quantizers.&quot<a id="change">)</a>  &#47&#47 pragma: no cover


def get_weights_quantizer_for_node(node: BaseNode) -&gt; BasePyTorchInferableQuantizer:</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/sony/model_optimization/commit/733379c59cd54a0509db40778380a709742d4436#diff-b35c2cf3b4b5acef207de76d44e67a22dc9f1e8e1ef59595eab41d77e9eef5c0L62' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 93056246</div><div id='project'> Project Name: sony/model_optimization</div><div id='commit'> Commit Name: 733379c59cd54a0509db40778380a709742d4436</div><div id='time'> Time: 2023-03-16</div><div id='author'> Author: 57916763+lapid92@users.noreply.github.com</div><div id='file'> File Name: model_compression_toolkit/exporter/model_wrapper/pytorch/builder/node_to_quantizer.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: get_activation_inferable_quantizer_kwargs(1)</div><div id='n_method'> N Method Name: get_activation_inferable_quantizer_kwargs(1)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: model_compression_toolkit/exporter/model_wrapper/pytorch/builder/node_to_quantizer.py</div><div id='n_file'> N File Name: model_compression_toolkit/exporter/model_wrapper/pytorch/builder/node_to_quantizer.py</div><div id='m_start'> M Start Line: 79</div><div id='m_end'> M End Line: 79</div><div id='n_start'> N Start Line: 64</div><div id='n_end'> N End Line: 88</div><BR>