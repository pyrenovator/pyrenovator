<link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
                layer = self.layers
            elif layer &gt; self.layers:
                raise ValueError(f"Number of layers specified ({layer}) exceed layers in model ({self.layers})!")
            representations1 = hidden_states[<a id="change">torch.arange(</a>num_inputs<a id="change">)</a>[:, None], query_idx1].mean(1)
            representations2 = hidden_states[torch.arange(num_inputs)[:, None], query_idx2].mean(1)
        else:
            representations1 = list(map(lambda x: x[torch.arange(num_inputs)[:, None], query_idx1].mean(1), hidden_states))</code></pre><h3>After Change</h3><pre><code class='java'>
                layer = self.layers
            elif layer &gt; self.layers:
                raise ValueError(f"Number of layers specified ({layer}) exceed layers in model ({self.layers})!")
            representations1 = <a id="change">torch.stack(</a>[hs.squeeze()[idx[0]:idx[1]].mean(0) for hs, idx in zip(hidden_states.split(<a id="change">[1</a>] * num_inputs), query_idx1)]<a id="change">)</a>
            representations2 = torch.stack([hs.squeeze()[idx[0]:idx[1]].mean(0) for hs, idx in zip(hidden_states.split([1] * num_inputs), query_idx2)])
        else:
            representations1 = list(map(lambda x: torch.stack([hs.squeeze()[idx[0]:idx[1]].mean(0) for hs, idx in zip(x.split([1] * num_inputs), query_idx1)]), hidden_states))
            representations2 = list(map(lambda x: torch.stack([hs.squeeze()[idx[0]:idx[1]].mean(0) for hs, idx in zip(x.split([1] * num_inputs), query_idx2)]), hidden_states))</code></pre>