<html><h3>Pattern ID :6439
</h3><img src='22354289.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
        &#47&#47 As it is coming from StackedClimateDataset
        for variable in variables_to_update[0]:
            if variable in self.in_vars:
                <a id="change">self.in_vars.remove(</a>variable<a id="change">)</a>
                for variable_to_add in variables_to_update[0][variable]:
                    self.in_vars.append(variable_to_add)

        for variable in variables_to_update[1]:</code></pre><h3>After Change</h3><pre><code class='java'>
        &#47&#47 )  &#47&#47 TODO add stronger typecheck
        &#47&#47 Assuming that variables_to_update is a list of dict
        &#47&#47 As it is coming from StackedClimateDataset
        in_vars<a id="change">: Sequence[str] = </a>[]
        out_vars: Sequence[str] = []
        for variable in variables_to_update[0]:
            if variable in self.in_vars:
                for variable_to_add in variables_to_update[0][variable]:
                    in_vars.append(variable_to_add)

        for variable in variables_to_update[1]:
            if variable in self.out_vars:
                for variable_to_add in variables_to_update[1][variable]:
                    out_vars.append(variable_to_add)
        &#47&#47&#47&#47 using dict instead of set to preserve insertion order
        self.in_vars<a id="change"> = </a><a id="change">list(</a>dict.fromkeys(in_vars)<a id="change">)</a>
        self.out_vars = list(dict.fromkeys(out_vars))

        return data_len // self.subsample
</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 4</div><BR><div id='size'>Non-data size: 4</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/aditya-grover/climate-learn/commit/8d930517f6b72d9fec5ba857114888d09274a493#diff-455c2b45611c2ff0ba33a1ed25444486047850e7b39f4ce41447072d6010431cL30' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 22354289</div><div id='project'> Project Name: aditya-grover/climate-learn</div><div id='commit'> Commit Name: 8d930517f6b72d9fec5ba857114888d09274a493</div><div id='time'> Time: 2023-04-11</div><div id='author'> Author: prakhar6sharma@gmail.com</div><div id='file'> File Name: src/climate_learn/data/task/downscaling.py</div><div id='m_class'> M Class Name: Downscaling</div><div id='n_method'> N Class Name: Downscaling</div><div id='m_method'> M Method Name: setup(3)</div><div id='n_method'> N Method Name: setup(3)</div><div id='m_parent_class'> M Parent Class: Task</div><div id='n_parent_class'> N Parent Class: Task</div><div id='m_file'> M File Name: src/climate_learn/data/task/downscaling.py</div><div id='n_file'> N File Name: src/climate_learn/data/task/downscaling.py</div><div id='m_start'> M Start Line: 30</div><div id='m_end'> M End Line: 40</div><div id='n_start'> N Start Line: 32</div><div id='n_end'> N End Line: 45</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        &quot&quot&quot
        if self.cols:
            cols = self.cols.copy()
            <a id="change">cols.remove(</a>self.target<a id="change">)</a>
        else:
            cols = list(df_raw.columns)
            cols.remove(self.target)
            cols.remove(&quotdate&quot)</code></pre><h3>After Change</h3><pre><code class='java'>
        border2 = len(df_raw)

        if self.features == &quotM&quot or self.features == &quotMS&quot:
            df_raw<a id="change"> = </a>df_raw[[&quotdate&quot] + cols]
            cols_data = df_raw.columns[1:]
            df_data = df_raw[cols_data]
        elif self.features == &quotS&quot:
            df_raw = df_raw[[&quotdate&quot] + cols + [self.target]]
            df_data = df_raw[[self.target]]

        if self.scale:
            self.scaler.fit(df_data.values)
            data = self.scaler.transform(df_data.values)
        else:
            data = df_data.values

        tmp_stamp = df_raw[[&quotdate&quot]][border1:border2]
        tmp_stamp[&quotdate&quot] = pd.to_datetime(tmp_stamp.date)
        pred_dates = pd.date_range(tmp_stamp.date.values[-1], periods=self.pred_len + 1, freq=self.freq)

        df_stamp = pd.DataFrame(columns=[&quotdate&quot])
        df_stamp.date = list(tmp_stamp.date.values) + list(pred_dates[1:])
        self.future_dates<a id="change"> = </a><a id="change">list(</a>pred_dates[1:]<a id="change">)</a>
        if self.timeenc == 0:
            df_stamp[&quotmonth&quot] = df_stamp.date.apply(lambda row: row.month, 1)
            df_stamp[&quotday&quot] = df_stamp.date.apply(lambda row: row.day, 1)
            df_stamp[&quotweekday&quot] = df_stamp.date.apply(lambda row: row.weekday(), 1)</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/cure-lab/dlinear/commit/27ef39951388d578b3006ab10d4666db14211333#diff-304199ba13001dd0496b0fe74f6fc7095a0f45356eb25f72824392933688ce16L321' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 22354291</div><div id='project'> Project Name: cure-lab/dlinear</div><div id='commit'> Commit Name: 27ef39951388d578b3006ab10d4666db14211333</div><div id='time'> Time: 2023-02-13</div><div id='author'> Author: dmitri.lihhatsov@revolut.com</div><div id='file'> File Name: data_provider/data_loader.py</div><div id='m_class'> M Class Name: Dataset_Pred</div><div id='n_method'> N Class Name: Dataset_Pred</div><div id='m_method'> M Method Name: __read_data__(1)</div><div id='n_method'> N Method Name: __read_data__(1)</div><div id='m_parent_class'> M Parent Class: Dataset</div><div id='n_parent_class'> N Parent Class: Dataset</div><div id='m_file'> M File Name: data_provider/data_loader.py</div><div id='n_file'> N File Name: data_provider/data_loader.py</div><div id='m_start'> M Start Line: 329</div><div id='m_end'> M End Line: 335</div><div id='n_start'> N Start Line: 326</div><div id='n_end'> N End Line: 362</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
                for variable_to_add in variables_to_update[variable]:
                    self.in_vars.append(variable_to_add)
            if variable in self.out_vars:
                <a id="change">self.out_vars.remove(</a>variable<a id="change">)</a>
                for variable_to_add in variables_to_update[variable]:
                    self.out_vars.append(variable_to_add)

        return (</code></pre><h3>After Change</h3><pre><code class='java'>
        self, data_len: int, variables_to_update: Dict[str, Sequence[str]] = {}
    ) -&gt; int:
        &#47&#47 Assuming that variables_to_update is a dict
        in_vars<a id="change">: Sequence[str] = </a>[]
        out_vars: Sequence[str] = []
        for variable in variables_to_update:
            if variable in self.in_vars:
                for variable_to_add in variables_to_update[variable]:
                    in_vars.append(variable_to_add)
            if variable in self.out_vars:
                for variable_to_add in variables_to_update[variable]:
                    out_vars.append(variable_to_add)
        &#47&#47&#47&#47 using dict instead of set to preserve insertion order
        self.in_vars<a id="change"> = </a><a id="change">list(</a>dict.fromkeys(in_vars)<a id="change">)</a>
        self.out_vars = list(dict.fromkeys(out_vars))

        return (
            data_len - ((self.history - 1) * self.window + self.pred_range)</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/aditya-grover/climate-learn/commit/8d930517f6b72d9fec5ba857114888d09274a493#diff-016eb87bc008f0dc26b7b7e0f6bd6a42b40785805fce4254ed8e0afc547fffd3L22' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 22354285</div><div id='project'> Project Name: aditya-grover/climate-learn</div><div id='commit'> Commit Name: 8d930517f6b72d9fec5ba857114888d09274a493</div><div id='time'> Time: 2023-04-11</div><div id='author'> Author: prakhar6sharma@gmail.com</div><div id='file'> File Name: src/climate_learn/data/task/forecasting.py</div><div id='m_class'> M Class Name: Forecasting</div><div id='n_method'> N Class Name: Forecasting</div><div id='m_method'> M Method Name: setup(3)</div><div id='n_method'> N Method Name: setup(3)</div><div id='m_parent_class'> M Parent Class: Task</div><div id='n_parent_class'> N Parent Class: Task</div><div id='m_file'> M File Name: src/climate_learn/data/task/forecasting.py</div><div id='n_file'> N File Name: src/climate_learn/data/task/forecasting.py</div><div id='m_start'> M Start Line: 26</div><div id='m_end'> M End Line: 34</div><div id='n_start'> N Start Line: 27</div><div id='n_end'> N End Line: 38</div><BR>