<html><h3>Pattern ID :25465
</h3><img src='77674401.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
        return {
            "bool": {
                "should": [
                    <a id="change">{
                        </a>"query_string": {
                            "default_field": EsRecordDataFieldNames.words,
                            "default_operator": "AND",
                            "query": text_query,
                            "boost": "2.0",
                        }<a id="change">
                    }</a>,
                    <a id="change">{
                        </a>"query_string": {
                            "default_field": f"{EsRecordDataFieldNames.words}.extended",
                            "default_operator": "AND",
                            "query": text_query,
                        }<a id="change">
                    }</a>,
                ],
                "minimum_should_match": "50%",
            }</code></pre><h3>After Change</h3><pre><code class='java'>
        Filter records matching text query
        if text_query is None:
            return {"match_all": {}}
        return <a id="change">filters.boolean_filter(
            should_filters=[
                {
                    "query_string": {
                        "default_field": EsRecordDataFieldNames.words,
                        "default_operator": "AND",
                        "query": text_query,
                        "boost": "2.0",
                    }
                },
                {
                    "query_string": {
                        "default_field": f"{EsRecordDataFieldNames.words}.extended",
                        "default_operator": "AND",
                        "query": text_query,
                    }
                },
            ],
            minimum_should_match="50%",
        )</a>

    @staticmethod
    def score(
        score: Optional[ScoreRange],</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 3</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/recognai/rubrix/commit/53982401ac652b7a451fa617314234d8c9870148#diff-7b95652e5e523d7cccf494030c3e4f8a651aac903917beb98afc9f836388c0e0L279' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 77674401</div><div id='project'> Project Name: recognai/rubrix</div><div id='commit'> Commit Name: 53982401ac652b7a451fa617314234d8c9870148</div><div id='time'> Time: 2022-01-11</div><div id='author'> Author: frascuchon@gmail.com</div><div id='file'> File Name: src/rubrix/server/commons/es_helpers.py</div><div id='m_class'> M Class Name: filters</div><div id='n_method'> N Class Name: filters</div><div id='m_method'> M Method Name: text_query(1)</div><div id='n_method'> N Method Name: text_query(1)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: src/rubrix/server/commons/es_helpers.py</div><div id='n_file'> N File Name: src/rubrix/server/commons/es_helpers.py</div><div id='m_start'> M Start Line: 279</div><div id='m_end'> M End Line: 300</div><div id='n_start'> N Start Line: 310</div><div id='n_end'> N End Line: 329</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        Filter records matching text query
        if text_query is None:
            return {"match_all": {}}
        return <a id="change">{
            </a>"bool": {
                "should": [
                    <a id="change">{
                        </a>"query_string": {
                            "default_field": EsRecordDataFieldNames.words,
                            "default_operator": "AND",
                            "query": text_query,
                            "boost": "2.0",
                        }<a id="change">
                    }</a>,
                    {
                        "query_string": {
                            "default_field": f"{EsRecordDataFieldNames.words}.extended",
                            "default_operator": "AND",
                            "query": text_query,
                        }
                    },
                ],
                "minimum_should_match": "50%",
            }<a id="change">
        }</a>

    @staticmethod
    def score(
        score: Optional[ScoreRange],</code></pre><h3>After Change</h3><pre><code class='java'>
        Filter records matching text query
        if text_query is None:
            return {"match_all": {}}
        return <a id="change">filters.boolean_filter(
            should_filters=[
                {
                    "query_string": {
                        "default_field": EsRecordDataFieldNames.words,
                        "default_operator": "AND",
                        "query": text_query,
                        "boost": "2.0",
                    }
                },
                {
                    "query_string": {
                        "default_field": f"{EsRecordDataFieldNames.words}.extended",
                        "default_operator": "AND",
                        "query": text_query,
                    }
                },
            ],
            minimum_should_match="50%",
        )</a>

    @staticmethod
    def score(
        score: Optional[ScoreRange],</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/recognai/rubrix/commit/53982401ac652b7a451fa617314234d8c9870148#diff-7b95652e5e523d7cccf494030c3e4f8a651aac903917beb98afc9f836388c0e0L275' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 77674400</div><div id='project'> Project Name: recognai/rubrix</div><div id='commit'> Commit Name: 53982401ac652b7a451fa617314234d8c9870148</div><div id='time'> Time: 2022-01-11</div><div id='author'> Author: frascuchon@gmail.com</div><div id='file'> File Name: src/rubrix/server/commons/es_helpers.py</div><div id='m_class'> M Class Name: filters</div><div id='n_method'> N Class Name: filters</div><div id='m_method'> M Method Name: text_query(1)</div><div id='n_method'> N Method Name: text_query(1)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: src/rubrix/server/commons/es_helpers.py</div><div id='n_file'> N File Name: src/rubrix/server/commons/es_helpers.py</div><div id='m_start'> M Start Line: 279</div><div id='m_end'> M End Line: 300</div><div id='n_start'> N Start Line: 310</div><div id='n_end'> N End Line: 329</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        all_filters.extend(query_filters)

        &#47&#47 TODO: use es_helpers
        return <a id="change">{
            </a>"bool": <a id="change">{
                </a>"must": query_text or {"match_all": {}},
                "filter": {
                    "bool": {
                        "should": all_filters,
                        "minimum_should_match": len(all_filters),
                    }
                }<a id="change">,
            }
        }</a>


class TokenClassificationSearchRequest(BaseModel):
</code></pre><h3>After Change</h3><pre><code class='java'>
        query_text = filters.text_query(self.query_text)
        all_filters.extend(query_filters)

        return <a id="change">filters.boolean_filter(
            must_query=query_text,
            should_filters=all_filters,
            minimum_should_match=len(all_filters),
        )</a>


class TokenClassificationSearchRequest(BaseModel):
</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/recognai/rubrix/commit/909dd8f7f76809b315a995924629519c1ea5d6fb#diff-8f0bc1e93daa5f38723f86cf5fdbff65673ecc702748a112e8a05980b84b905dL368' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 77674373</div><div id='project'> Project Name: recognai/rubrix</div><div id='commit'> Commit Name: 909dd8f7f76809b315a995924629519c1ea5d6fb</div><div id='time'> Time: 2022-03-04</div><div id='author'> Author: francisco@recogn.ai</div><div id='file'> File Name: src/rubrix/server/tasks/token_classification/api/model.py</div><div id='m_class'> M Class Name: TokenClassificationQuery</div><div id='n_method'> N Class Name: TokenClassificationQuery</div><div id='m_method'> M Method Name: as_elasticsearch(1)</div><div id='n_method'> N Method Name: as_elasticsearch(1)</div><div id='m_parent_class'> M Parent Class: BaseSearchQuery</div><div id='n_parent_class'> N Parent Class: BaseSearchQuery</div><div id='m_file'> M File Name: src/rubrix/server/tasks/token_classification/api/model.py</div><div id='n_file'> N File Name: src/rubrix/server/tasks/token_classification/api/model.py</div><div id='m_start'> M Start Line: 374</div><div id='m_end'> M End Line: 402</div><div id='n_start'> N Start Line: 391</div><div id='n_end'> N End Line: 395</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        query_text = filters.text_query(self.query_text)
        all_filters.extend(query_filters)

        return <a id="change">{
            </a>"bool": {
                "must": query_text or <a id="change">{</a>"match_all": {}<a id="change">}</a>,
                "filter": {
                    "bool": {
                        "should": all_filters,
                        "minimum_should_match": len(all_filters),
                    }
                },
            }<a id="change">
        }</a>


class TextClassificationSearchRequest(BaseModel):
    </code></pre><h3>After Change</h3><pre><code class='java'>
        query_text = filters.text_query(self.query_text)
        all_filters.extend(query_filters)

        return <a id="change">filters.boolean_filter(
            must_query=query_text or {"match_all": {}},
            must_not_query=filters.boolean_filter(
                should_filters=[
                    filters.text_query(query) for query in self.uncovered_by_rules
                ]
            )
            if self.uncovered_by_rules
            else None,
            filter_query=filters.boolean_filter(
                should_filters=all_filters, minimum_should_match=len(all_filters)
            )
            if all_filters
            else None,
        )</a>


class TextClassificationSearchRequest(BaseModel):
    </code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/recognai/rubrix/commit/162afa00de61ce9e1f205e9adc3a6510b1ab8e77#diff-b265b96d8564cc2c77e0640b23e9173aac2f53df23b123e0a0c514cd71d80241L492' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 77674379</div><div id='project'> Project Name: recognai/rubrix</div><div id='commit'> Commit Name: 162afa00de61ce9e1f205e9adc3a6510b1ab8e77</div><div id='time'> Time: 2022-02-07</div><div id='author'> Author: frascuchon@gmail.com</div><div id='file'> File Name: src/rubrix/server/tasks/text_classification/api/model.py</div><div id='m_class'> M Class Name: TextClassificationQuery</div><div id='n_method'> N Class Name: TextClassificationQuery</div><div id='m_method'> M Method Name: as_elasticsearch(1)</div><div id='n_method'> N Method Name: as_elasticsearch(1)</div><div id='m_parent_class'> M Parent Class: BaseModel</div><div id='n_parent_class'> N Parent Class: BaseModel</div><div id='m_file'> M File Name: src/rubrix/server/tasks/text_classification/api/model.py</div><div id='n_file'> N File Name: src/rubrix/server/tasks/text_classification/api/model.py</div><div id='m_start'> M Start Line: 498</div><div id='m_end'> M End Line: 525</div><div id='n_start'> N Start Line: 522</div><div id='n_end'> N End Line: 536</div><BR>