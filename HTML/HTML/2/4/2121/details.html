<html><h3>Pattern ID :2121
</h3><img src='9103818.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>

        if self.wall_clock_breakdown:
            self.timers(&quotfalltoall&quot).stop()
            self.time_falltoall = <a id="change">self.timers(&quotfalltoall&quot).elapsed(reset=False) * 1000</a>

        &#47&#47 Re-shape after all-to-all: ecm -&gt; gecm
        dispatched_input = dispatched_input.reshape(self.ep_size,
                                                    self.num_local_experts,</code></pre><h3>After Change</h3><pre><code class='java'>

        if self.wall_clock_breakdown:
            self.timers(&quotfalltoall&quot).stop()
            self.time_falltoall = <a id="change">self.timers(&quotfalltoall&quot).elapsed(reset=False)</a>

        &#47&#47 Re-shape after all-to-all: ecm -&gt; gecm
        dispatched_input = dispatched_input.reshape(self.ep_size,
                                                    self.num_local_experts,</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 3</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/microsoft/deepspeed/commit/80f94c10c552ec79473775adb8902b210656ed76#diff-7d28ff32544f36339d99fdf142c2ab63d7332305758be0ff7ccc94e6350e1476L538' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 9103818</div><div id='project'> Project Name: microsoft/deepspeed</div><div id='commit'> Commit Name: 80f94c10c552ec79473775adb8902b210656ed76</div><div id='time'> Time: 2022-08-25</div><div id='author'> Author: yzs981130@126.com</div><div id='file'> File Name: deepspeed/moe/sharded_moe.py</div><div id='m_class'> M Class Name: MOELayer</div><div id='n_method'> N Class Name: MOELayer</div><div id='m_method'> M Method Name: forward(1)</div><div id='n_method'> N Method Name: forward(1)</div><div id='m_parent_class'> M Parent Class: Base</div><div id='n_parent_class'> N Parent Class: Base</div><div id='m_file'> M File Name: deepspeed/moe/sharded_moe.py</div><div id='n_file'> N File Name: deepspeed/moe/sharded_moe.py</div><div id='m_start'> M Start Line: 538</div><div id='m_end'> M End Line: 579</div><div id='n_start'> N Start Line: 538</div><div id='n_end'> N End Line: 579</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        string = f"rank={torch.distributed.get_rank()} time (ms)"
        for name in names:
            if name in self.timers:
                elapsed_time = (<a id="change">self.timers[name].elapsed(reset=reset) * 1000.0</a> /
                                normalizer)
                string += " | {}: {:.2f}".format(name, elapsed_time)
</code></pre><h3>After Change</h3><pre><code class='java'>
        string = f"rank={torch.distributed.get_rank()} time (ms)"
        for name in names:
            if name in self.timers:
                elapsed_time = (<a id="change">self.timers[name].elapsed(reset=reset)</a> / normalizer)
                string += " | {}: {:.2f}".format(name, elapsed_time)

        log_dist(string, ranks=ranks or [0])</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/microsoft/deepspeed/commit/fee73135980e78f8be7e1a3ff556751623ef6aaa#diff-540f38f75fe7306798e4c58d0987cbab480cca18a976b85016cbeed5564fb1dcL99' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 9103819</div><div id='project'> Project Name: microsoft/deepspeed</div><div id='commit'> Commit Name: fee73135980e78f8be7e1a3ff556751623ef6aaa</div><div id='time'> Time: 2022-04-20</div><div id='author'> Author: olruwase@microsoft.com</div><div id='file'> File Name: deepspeed/utils/timer.py</div><div id='m_class'> M Class Name: SynchronizedWallClockTimer</div><div id='n_method'> N Class Name: SynchronizedWallClockTimer</div><div id='m_method'> M Method Name: log(6)</div><div id='n_method'> N Method Name: log(6)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: deepspeed/utils/timer.py</div><div id='n_file'> N File Name: deepspeed/utils/timer.py</div><div id='m_start'> M Start Line: 105</div><div id='m_end'> M End Line: 105</div><div id='n_start'> N Start Line: 118</div><div id='n_end'> N End Line: 118</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>

        if self.wall_clock_breakdown:
            self.timers(&quotTopKGate&quot).stop()
            self.gate_time = <a id="change">self.timers(&quotTopKGate&quot).elapsed(reset=False) * 1000</a>

        return gate_output

</code></pre><h3>After Change</h3><pre><code class='java'>

        if self.wall_clock_breakdown:
            self.timers(&quotTopKGate&quot).stop()
            self.gate_time = <a id="change">self.timers(&quotTopKGate&quot).elapsed(reset=False)</a>

        return gate_output

</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/microsoft/deepspeed/commit/80f94c10c552ec79473775adb8902b210656ed76#diff-7d28ff32544f36339d99fdf142c2ab63d7332305758be0ff7ccc94e6350e1476L396' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 9103822</div><div id='project'> Project Name: microsoft/deepspeed</div><div id='commit'> Commit Name: 80f94c10c552ec79473775adb8902b210656ed76</div><div id='time'> Time: 2022-08-25</div><div id='author'> Author: yzs981130@126.com</div><div id='file'> File Name: deepspeed/moe/sharded_moe.py</div><div id='m_class'> M Class Name: TopKGate</div><div id='n_method'> N Class Name: TopKGate</div><div id='m_method'> M Method Name: forward(4)</div><div id='n_method'> N Method Name: forward(4)</div><div id='m_parent_class'> M Parent Class: Module</div><div id='n_parent_class'> N Parent Class: Module</div><div id='m_file'> M File Name: deepspeed/moe/sharded_moe.py</div><div id='n_file'> N File Name: deepspeed/moe/sharded_moe.py</div><div id='m_start'> M Start Line: 434</div><div id='m_end'> M End Line: 434</div><div id='n_start'> N Start Line: 434</div><div id='n_end'> N End Line: 434</div><BR>