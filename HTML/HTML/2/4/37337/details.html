<html><h3>Pattern ID :37337
</h3><img src='107484992.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
                    try:
                        ontology_name = self.entity_class_to_ontology_mappings[entity.entity_class]
                        index = self.ontology_index_dict.get(ontology_name, None)
                        <a id="change">if </a>index is not None:
                            metadata_df = index.search(entity.match)
                            for i, row in metadata_df.iterrows():
                                row_dict = <a id="change">row.to_dict()</a>
                                ontology_id = row_dict.pop(IDX)
                                mapping_type<a id="change"> = </a>row_dict.pop(MAPPING_TYPE).tolist()
                                row_dict[NAMESPACE] = self.namespace()
                                new_mapping = Mapping(
                                    source=ontology_name,</code></pre><h3>After Change</h3><pre><code class='java'>
                            fuzzy=self.fuzzy,
                            namespace=self.namespace(),
                        )
                        <a id="change">for </a>mapping in mappings<a id="change">:
                            </a>entity.add_mapping(mapping)
                            self.lookup_cache.update_lookup_cache(entity, mapping)
                    except Exception:
                        doc = find_document_from_entity(docs, entity)</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 4</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/astrazeneca/kazu/commit/2c7b1d8d0ecd2e9ec0dea69dc2823a8178c3c5c7#diff-70cac163c7415c53bffa43163128a843d246ed07804872cad842462fc7a6df2bL62' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 107484992</div><div id='project'> Project Name: astrazeneca/kazu</div><div id='commit'> Commit Name: 2c7b1d8d0ecd2e9ec0dea69dc2823a8178c3c5c7</div><div id='time'> Time: 2021-12-13</div><div id='author'> Author: richard.jackson4@astrazeneca.com</div><div id='file'> File Name: azner/steps/linking/dictionary.py</div><div id='m_class'> M Class Name: DictionaryEntityLinkingStep</div><div id='n_method'> N Class Name: DictionaryEntityLinkingStep</div><div id='m_method'> M Method Name: _run(2)</div><div id='n_method'> N Method Name: _run(2)</div><div id='m_parent_class'> M Parent Class: BaseStep</div><div id='n_parent_class'> N Parent Class: BaseStep</div><div id='m_file'> M File Name: azner/steps/linking/dictionary.py</div><div id='n_file'> N File Name: azner/steps/linking/dictionary.py</div><div id='m_start'> M Start Line: 62</div><div id='m_end'> M End Line: 85</div><div id='n_start'> N Start Line: 69</div><div id='n_end'> N End Line: 78</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
            tokens = data.map(fn, batched=True, remove_columns=data.column_names)
        else:
            &#47&#47 pandas DataFrame
            <a id="change">if </a>hasattr(data, "to_dict"):
                data<a id="change"> = </a><a id="change">data.to_dict(</a>"records"<a id="change">)</a>

            &#47&#47 Re-orient data into columns for efficient batch tokenization
            columns = {}
            for row in data:</code></pre><h3>After Change</h3><pre><code class='java'>
            columns = {}
            if hasattr(data, "columns"):
                &#47&#47 Polars/pandas DataFrame
                <a id="change">for </a>column in data.columns<a id="change">:
                    </a>columns[column] = list(data[column])
            else:
                &#47&#47 List of dicts
                for row in data:</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/neuml/txtai/commit/cd089d63645179829017fdfc2b351c8717d592e4#diff-49590eed488769cbe58e5289f5f7c0c8b614178d6806a860f0094e85d9494194L41' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 107484995</div><div id='project'> Project Name: neuml/txtai</div><div id='commit'> Commit Name: cd089d63645179829017fdfc2b351c8717d592e4</div><div id='time'> Time: 2022-11-29</div><div id='author'> Author: 561939+davidmezzetti@users.noreply.github.com</div><div id='file'> File Name: src/python/txtai/data/base.py</div><div id='m_class'> M Class Name: Data</div><div id='n_method'> N Class Name: Data</div><div id='m_method'> M Method Name: prepare(3)</div><div id='n_method'> N Method Name: prepare(3)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: src/python/txtai/data/base.py</div><div id='n_file'> N File Name: src/python/txtai/data/base.py</div><div id='m_start'> M Start Line: 58</div><div id='m_end'> M End Line: 71</div><div id='n_start'> N Start Line: 58</div><div id='n_end'> N End Line: 73</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
                        continue
                    ontology_name = self.entity_class_to_ontology_mappings[entity.entity_class]
                    index = self.ontology_index_dict.get(ontology_name, None)
                    <a id="change">if </a>index is not None:
                        metadata_df = index.search(result)
                        for i, row in metadata_df.iterrows():
                            metadata_dict<a id="change"> = </a><a id="change">row.to_dict()</a>
                            metadata_dict[NAMESPACE] = self.namespace()
                            ontology_id = metadata_dict.pop(IDX)
                            &#47&#47 note, we set mapping type to inferred as sapbert doesn&quott really have the concept
                            new_mapping = Mapping(</code></pre><h3>After Change</h3><pre><code class='java'>
                        top_n=self.top_n,
                        score_cutoff=self.score_cutoff,
                    )
                    <a id="change">for </a>mapping in mappings<a id="change">:
                        </a>entity.add_mapping(mapping)
                        self.lookup_cache.update_lookup_cache(entity, mapping)
        except Exception:
            affected_doc_ids = [doc.idx for doc in docs]</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/astrazeneca/kazu/commit/e228b464ae80f91804f213422cdc9fc9ebb8e652#diff-7655ebddac188043b1e27e8093eeefb4cb669c6b88b66cecee521c2fe4eacfbbL224' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 107484997</div><div id='project'> Project Name: astrazeneca/kazu</div><div id='commit'> Commit Name: e228b464ae80f91804f213422cdc9fc9ebb8e652</div><div id='time'> Time: 2021-12-13</div><div id='author'> Author: richard.jackson4@astrazeneca.com</div><div id='file'> File Name: azner/steps/linking/sapbert.py</div><div id='m_class'> M Class Name: SapBertForEntityLinkingStep</div><div id='n_method'> N Class Name: SapBertForEntityLinkingStep</div><div id='m_method'> M Method Name: _run(2)</div><div id='n_method'> N Method Name: _run(2)</div><div id='m_parent_class'> M Parent Class: BaseStep</div><div id='n_parent_class'> N Parent Class: BaseStep</div><div id='m_file'> M File Name: azner/steps/linking/sapbert.py</div><div id='n_file'> N File Name: azner/steps/linking/sapbert.py</div><div id='m_start'> M Start Line: 244</div><div id='m_end'> M End Line: 268</div><div id='n_start'> N Start Line: 102</div><div id='n_end'> N End Line: 122</div><BR>