<link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>

&#47&#47 @profile
def hit(data, k):
    <a id="change">tmp_data = </a><a id="change">data.copy()</a>
    def get_hit(x):
        return any(x &gt; 0)
    num_users<a id="change"> = tmp_data[&quotuser_id&quot]</a><a id="change">.nunique()</a>
    mask<a id="change"> = tmp_data[&quotrank&quot]</a><a id="change"> &gt; k</a>
    <a id="change">tmp_data.loc[mask, &quotrank&quot] = -1</a>
    grouped<a id="change"> = tmp_data.groupby(&quotuser_id&quot)[&quotrank&quot].apply(</a>get_hit<a id="change">)</a>
    <a id="change">return grouped.sum()</a><a id="change"> / </a>num_users

&#47&#47 @profile
def mrr(data, k):</code></pre><h3>After Change</h3><pre><code class='java'>
&#47&#47&#47&#47    TopK Metrics    &#47&#47&#47&#47

def hit(data):  
    <a id="change">return </a>any(data &gt; 0)

def mrr(data):
    tmp_x = data[data &gt; 0]</code></pre>