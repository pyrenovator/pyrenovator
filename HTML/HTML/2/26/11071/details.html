<html><h3>Pattern ID :11071
</h3><img src='38139461.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
        
        dataset = self.train_data if dataflag==&quottrain&quot else self.valid_data
        model.eval()
        loss<a id="change"> = 0</a>
        eval_metric<a id="change"> = 0</a>
        data_loader<a id="change"> = </a><a id="change">self.calculator.get_data_loader(</a>dataset<a id="change">, batch_size=64)</a>
        <a id="change">for </a>batch_id, <a id="change">batch_data</a> in <a id="change">enumerate(</a>data_loader<a id="change">):
            bmean_eval_metric</a><a id="change">, bmean_loss = </a><a id="change">self.calculator.test(</a>model, <a id="change">batch_data</a><a id="change">)</a>
            loss<a id="change"> += bmean_loss</a><a id="change"> * len(batch_data</a><a id="change">[0])</a>
            eval_metric<a id="change"> += bmean_eval_metric</a><a id="change"> * </a>len(<a id="change">batch_data[0]</a>)
        eval_metric =1.0 * eval_metric / len(dataset)
        loss = 1.0 * loss / len(dataset)
        return eval_metric<a id="change">, loss</a>

    def unpack(self, received_pkg):
        
        Unpack the package received from the server</code></pre><h3>After Change</h3><pre><code class='java'>
            metric: specified by the task during running time (e.g. metric = [mean_accuracy, mean_loss] when the task is classification)
        
        dataset = self.train_data if dataflag==&quottrain&quot else self.valid_data
        <a id="change">return self.calculator.test(</a>model, dataset<a id="change">)</a>

    def unpack(self, received_pkg):
        
        Unpack the package received from the server</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 19</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/wwzzz/easyfl/commit/0f1f8b5f7345f8d85477170c1df940e264d32898#diff-5f5b152f80519d24105a5156c0f8a01b58fecc1555b880ef3bdbe342000e778fL316' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 38139461</div><div id='project'> Project Name: wwzzz/easyfl</div><div id='commit'> Commit Name: 0f1f8b5f7345f8d85477170c1df940e264d32898</div><div id='time'> Time: 2022-04-22</div><div id='author'> Author: zzz510711928@gmail.com</div><div id='file'> File Name: algorithm/fedbase.py</div><div id='m_class'> M Class Name: BasicClient</div><div id='n_method'> N Class Name: BasicClient</div><div id='m_method'> M Method Name: test(3)</div><div id='n_method'> N Method Name: test(3)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: algorithm/fedbase.py</div><div id='n_file'> N File Name: algorithm/fedbase.py</div><div id='m_start'> M Start Line: 324</div><div id='m_end'> M End Line: 335</div><div id='n_start'> N Start Line: 316</div><div id='n_end'> N End Line: 317</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        
        dataset = self.train_data if dataflag==&quottrain&quot else self.valid_data
        model.eval()
        loss<a id="change"> = 0</a>
        eval_metric<a id="change"> = 0</a>
        data_loader<a id="change"> = </a><a id="change">self.calculator.get_data_loader(</a>dataset<a id="change">, batch_size=64)</a>
        <a id="change">for </a>batch_id, <a id="change">batch_data</a> in <a id="change">enumerate(</a>data_loader<a id="change">):
            </a>bmean_eval_metric<a id="change">, bmean_loss = </a><a id="change">self.calculator.test(</a>model, batch_data<a id="change">)</a>
            loss<a id="change"> += </a>bmean_loss<a id="change"> * </a>len(<a id="change">batch_data[0]</a>)
            eval_metric<a id="change"> += </a>bmean_eval_metric<a id="change"> * len(</a><a id="change">batch_data[0])</a>
        eval_metric =1.0 * eval_metric / len(dataset)
        loss = 1.0 * loss / len(dataset)
        return eval_metric<a id="change">, loss</a>

    def unpack(self, received_pkg):
        
        Unpack the package received from the server</code></pre><h3>After Change</h3><pre><code class='java'>
            metric: specified by the task during running time (e.g. metric = [mean_accuracy, mean_loss] when the task is classification)
        
        dataset = self.train_data if dataflag==&quottrain&quot else self.valid_data
        <a id="change">return self.calculator.test(</a>model, dataset<a id="change">)</a>

    def unpack(self, received_pkg):
        
        Unpack the package received from the server</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/wwzzz/easyfl/commit/0f1f8b5f7345f8d85477170c1df940e264d32898#diff-5f5b152f80519d24105a5156c0f8a01b58fecc1555b880ef3bdbe342000e778fL314' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 38139462</div><div id='project'> Project Name: wwzzz/easyfl</div><div id='commit'> Commit Name: 0f1f8b5f7345f8d85477170c1df940e264d32898</div><div id='time'> Time: 2022-04-22</div><div id='author'> Author: zzz510711928@gmail.com</div><div id='file'> File Name: algorithm/fedbase.py</div><div id='m_class'> M Class Name: BasicClient</div><div id='n_method'> N Class Name: BasicClient</div><div id='m_method'> M Method Name: test(3)</div><div id='n_method'> N Method Name: test(3)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: algorithm/fedbase.py</div><div id='n_file'> N File Name: algorithm/fedbase.py</div><div id='m_start'> M Start Line: 324</div><div id='m_end'> M End Line: 335</div><div id='n_start'> N Start Line: 316</div><div id='n_end'> N End Line: 317</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        if model == None: model = self.result_model
        if self.test_data:
            model.eval()
            loss<a id="change"> = 0</a>
            eval_metric<a id="change"> = 0</a>
            data_loader<a id="change"> = </a><a id="change">self.calculator.get_data_loader(</a>self.test_data<a id="change">, batch_size=64)</a>
            <a id="change">for </a>batch_id, <a id="change">batch_data</a> in <a id="change">enumerate(</a>data_loader<a id="change">):
                </a>bmean_eval_metric<a id="change">, bmean_loss = </a><a id="change">self.calculator.test(</a>model, batch_data<a id="change">)</a>
                loss<a id="change"> += </a>bmean_loss<a id="change"> * len(</a><a id="change">batch_data[1])</a>
                eval_metric<a id="change"> += </a>bmean_eval_metric<a id="change"> * </a>len(<a id="change">batch_data[1]</a>)
            eval_metric /= len(self.test_data)
            loss /= len(self.test_data)
            return eval_metric<a id="change">, loss</a>
        else:
            return -1, -1

class Client(BasicClient):</code></pre><h3>After Change</h3><pre><code class='java'>
    def test(self, model=None):
        if model == None: model = self.result_model
        if self.test_data:
            <a id="change">return self.calculator.test(</a>model, self.test_data<a id="change">)</a>
        else:
            return None

</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/wwzzz/easyfl/commit/0f1f8b5f7345f8d85477170c1df940e264d32898#diff-4b57d79f2971ccf176a26acf15baa90f5eb5fd2f0f72be5ade0f4e858ed17f00L51' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 38139459</div><div id='project'> Project Name: wwzzz/easyfl</div><div id='commit'> Commit Name: 0f1f8b5f7345f8d85477170c1df940e264d32898</div><div id='time'> Time: 2022-04-22</div><div id='author'> Author: zzz510711928@gmail.com</div><div id='file'> File Name: algorithm/afl.py</div><div id='m_class'> M Class Name: Server</div><div id='n_method'> N Class Name: Server</div><div id='m_method'> M Method Name: test(2)</div><div id='n_method'> N Method Name: test(2)</div><div id='m_parent_class'> M Parent Class: BasicServer</div><div id='n_parent_class'> N Parent Class: BasicServer</div><div id='m_file'> M File Name: algorithm/afl.py</div><div id='n_file'> N File Name: algorithm/afl.py</div><div id='m_start'> M Start Line: 52</div><div id='m_end'> M End Line: 66</div><div id='n_start'> N Start Line: 56</div><div id='n_end'> N End Line: 60</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        if model==None: model=self.model
        if self.test_data:
            model.eval()
            loss<a id="change"> = 0</a>
            eval_metric<a id="change"> = 0</a>
            data_loader<a id="change"> = </a><a id="change">self.calculator.get_data_loader(</a>self.test_data<a id="change">, batch_size=64)</a>
            <a id="change">for </a>batch_id, <a id="change">batch_data</a> in <a id="change">enumerate(</a>data_loader<a id="change">):
                </a>bmean_eval_metric<a id="change">, bmean_loss = </a><a id="change">self.calculator.test(</a>model, batch_data<a id="change">)</a>
                loss<a id="change"> += </a>bmean_loss<a id="change"> * len(</a><a id="change">batch_data[0])</a>
                eval_metric<a id="change"> += </a>bmean_eval_metric<a id="change"> * </a>len(<a id="change">batch_data[0]</a>)
            eval_metric /= len(self.test_data)
            loss /= len(self.test_data)
            return eval_metric<a id="change">, loss</a>
        else: return -1,-1

class BasicClient():
    def __init__(self, option, name=&quot&quot, train_data=None, valid_data=None):</code></pre><h3>After Change</h3><pre><code class='java'>
        
        if model==None: model=self.model
        if self.test_data:
            <a id="change">return self.calculator.test(</a>model, self.test_data<a id="change">)</a>
        else:
            return None

    def wait_for_accessibility(self, selected_clients):</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/wwzzz/easyfl/commit/0f1f8b5f7345f8d85477170c1df940e264d32898#diff-5f5b152f80519d24105a5156c0f8a01b58fecc1555b880ef3bdbe342000e778fL233' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 38139471</div><div id='project'> Project Name: wwzzz/easyfl</div><div id='commit'> Commit Name: 0f1f8b5f7345f8d85477170c1df940e264d32898</div><div id='time'> Time: 2022-04-22</div><div id='author'> Author: zzz510711928@gmail.com</div><div id='file'> File Name: algorithm/fedbase.py</div><div id='m_class'> M Class Name: BasicServer</div><div id='n_method'> N Class Name: BasicServer</div><div id='m_method'> M Method Name: test(2)</div><div id='n_method'> N Method Name: test(2)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: algorithm/fedbase.py</div><div id='n_file'> N File Name: algorithm/fedbase.py</div><div id='m_start'> M Start Line: 241</div><div id='m_end'> M End Line: 254</div><div id='n_start'> N Start Line: 244</div><div id='n_end'> N End Line: 248</div><BR>