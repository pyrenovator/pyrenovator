<html><h3>Pattern ID :7694
</h3><img src='25582838.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
        If ``self.rng_key`` is ``None``,
        generate a new ``self.rng_key`` from ``self.rng_seed``.
        
        <a id="change">if self._rng_key is None</a>:
            if self._rng_seed is None:
                seed = 42
                logging.warning(
                    "Seeding RNG key with seed %s. "
                    "Use `pax.seed_rng_key` function to avoid this warning.",
                    seed,
                )
                self.seed_rng_key(seed)

            &#47&#47 Delay the generating of self.rng_key until `next_rng_key` is called.
            &#47&#47 This helps to avoid the problem when `seed_rng_key` is called
            &#47&#47 before jax found TPU cores.
            <a id="change">if self._rng_seed is not None</a>:
                self._rng_key<a id="change"> = </a>jax.random.PRNGKey(self._rng_seed)
            else:
                raise ValueError("Impossible")
</code></pre><h3>After Change</h3><pre><code class='java'>

    def next_rng_key(self) -&gt; KeyArray:
        Return a random rng key. Renew the global random state.
        seed<a id="change"> = </a><a id="change">self._rng.randint(</a>1, <a id="change">999999999</a><a id="change">)</a>
        return jax.random.PRNGKey(seed)

    def get_rng_state(self):
        Return internal random states.</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 7</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/ntt123/pax/commit/92bfcc864bc422d6637ee912d8cf16aae24e6331#diff-5bf4d1516ef68ea3287b35746b467bce30c3eca8028b84cfede7742181cf7c6fL103' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 25582838</div><div id='project'> Project Name: ntt123/pax</div><div id='commit'> Commit Name: 92bfcc864bc422d6637ee912d8cf16aae24e6331</div><div id='time'> Time: 2021-11-15</div><div id='author'> Author: 9960521+NTT123@users.noreply.github.com</div><div id='file'> File Name: pax/_src/core/threading_local.py</div><div id='m_class'> M Class Name: PaxThreadingLocalState</div><div id='n_method'> N Class Name: PaxThreadingLocalState</div><div id='m_method'> M Method Name: next_rng_key(1)</div><div id='n_method'> N Method Name: next_rng_key(1)</div><div id='m_parent_class'> M Parent Class: threading.local</div><div id='n_parent_class'> N Parent Class: threading.local</div><div id='m_file'> M File Name: pax/_src/core/threading_local.py</div><div id='n_file'> N File Name: pax/_src/core/threading_local.py</div><div id='m_start'> M Start Line: 113</div><div id='m_end'> M End Line: 133</div><div id='n_start'> N Start Line: 103</div><div id='n_end'> N End Line: 104</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        ts = np.random.randint(0, self.T, size=(self.n_time_masks, 2))
        for t, mask_end in ts:
            &#47&#47 avoid randint range error
            <a id="change">if len_spectro - t &lt;= 0</a>:
                continue
            t_zero = random.randrange(0, len_spectro - t)

            &#47&#47 avoids randrange error if values are equal and range is empty
            <a id="change">if t_zero == t_zero + t</a>:
                continue

            mask_end<a id="change"> += </a>t_zero
            if replace_with_zero:
                cloned[t_zero:mask_end] = 0
            else:</code></pre><h3>After Change</h3><pre><code class='java'>
        max_frames = cloned.shape[0]
        max_t = int(max_frames * self.max_t_ratio)
        for i in range(self.n_time_masks):
            start<a id="change"> = </a><a id="change">random.randint(0</a>, max_frames - 1<a id="change">)</a>
            length = random.randint(1, max_t)
            end = min(max_frames, start + length)
            if replace_with_zero:
                cloned[start:end, :] = 0</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/yeyupiaoling/masr/commit/15d97fe0e0042abc1e6bfedadb35dc826ed4aed3#diff-b6703d7b62ea26baa7fb88ad312fe333fd8e1e41163a4e5541336f432b2af35eL122' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 25582846</div><div id='project'> Project Name: yeyupiaoling/masr</div><div id='commit'> Commit Name: 15d97fe0e0042abc1e6bfedadb35dc826ed4aed3</div><div id='time'> Time: 2022-09-28</div><div id='author'> Author: yeyupiaoling@foxmail.com</div><div id='file'> File Name: masr/data_utils/augmentor/spec_augment.py</div><div id='m_class'> M Class Name: SpecAugmentor</div><div id='n_method'> N Class Name: SpecAugmentor</div><div id='m_method'> M Method Name: mask_time(3)</div><div id='n_method'> N Method Name: mask_time(3)</div><div id='m_parent_class'> M Parent Class: object</div><div id='n_parent_class'> N Parent Class: object</div><div id='m_file'> M File Name: masr/data_utils/augmentor/spec_augment.py</div><div id='n_file'> N File Name: masr/data_utils/augmentor/spec_augment.py</div><div id='m_start'> M Start Line: 132</div><div id='m_end'> M End Line: 152</div><div id='n_start'> N Start Line: 115</div><div id='n_end'> N End Line: 125</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
            &#47&#47 now find all the track filepaths
            track_filepaths = glob.glob(os.path.join(mix_dir, f"{mix_id}_RAW", "*.wav"))

            <a id="change">if len(track_filepaths) &gt; self.max_num_tracks</a>:
                continue

            &#47&#47 check length of each track
            tracks = []
            for tidx, track_filepath in enumerate(track_filepaths):
                x, sr = torchaudio.load(track_filepath)
                tracks.append(x)

                nbytes = x.element_size() * x.nelement()
                nbytes_loaded += nbytes

                track_num_frames = x.shape[-1]
                <a id="change">if track_num_frames &lt; mix_num_frames</a>:
                    mix_num_frames<a id="change"> = </a>track_num_frames

            &#47&#47 store this example
            example = {</code></pre><h3>After Change</h3><pre><code class='java'>

                    num_frames = torchaudio.info(mix_filepath).num_frames

                    offset<a id="change"> = </a><a id="change">np.random.randint(
                        0</a>,
                        num_frames - self.buffer_audio_length - 1<a id="change">,
                    )</a>

                    &#47&#47 now check the length of the mix
                    y, sr = torchaudio.load(
                        mix_filepath,</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/csteinmetz1/automix-toolkit/commit/0fcdce4c33e652710e5c0682499c65bab52b991b#diff-3b5493e29457d0c2fa425a9c7a85b846becf17818150651f5682153839469d49L48' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 25582841</div><div id='project'> Project Name: csteinmetz1/automix-toolkit</div><div id='commit'> Commit Name: 0fcdce4c33e652710e5c0682499c65bab52b991b</div><div id='time'> Time: 2022-11-28</div><div id='author'> Author: csteinmetz1@gmail.com</div><div id='file'> File Name: automix/data/medleydb.py</div><div id='m_class'> M Class Name: MedleyDBDataset</div><div id='n_method'> N Class Name: MedleyDBDataset</div><div id='m_method'> M Method Name: reload_buffer(1)</div><div id='n_method'> N Method Name: reload_buffer(1)</div><div id='m_parent_class'> M Parent Class: torch.utils.data.Dataset</div><div id='n_parent_class'> N Parent Class: torch.utils.data.Dataset</div><div id='m_file'> M File Name: automix/data/medleydb.py</div><div id='n_file'> N File Name: automix/data/medleydb.py</div><div id='m_start'> M Start Line: 58</div><div id='m_end'> M End Line: 108</div><div id='n_start'> N Start Line: 62</div><div id='n_end'> N End Line: 148</div><BR>