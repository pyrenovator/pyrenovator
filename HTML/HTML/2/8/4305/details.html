<html><h3>Pattern ID :4305
</h3><img src='15814114.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
    
    n_samples = len(df) - n_lags + 1 - n_forecasts

    time = <a id="change">df.loc[:, &quott&quot].iloc[n_lags-1:-n_forecasts]</a>.values
    &#47&#47 time = pd.DataFrame(time)
    time = np.expand_dims(time, axis=1)

    &#47&#47 lags = pd.DataFrame(
    &#47&#47     [df.loc[:, &quoty&quot].iloc[i: i + n_lags].values for i in range(n_samples)]
    &#47&#47 )
    &#47&#47 targets = pd.DataFrame(
    &#47&#47     [df.loc[:, &quoty&quot].iloc[i + n_lags: i + n_lags + n_forecasts].values for i in range(n_samples)]
    &#47&#47 )
    series = df.loc[:, &quoty_scaled&quot].values
    lags = np.array([series[i: i + n_lags] for i in range(n_samples)])
    if n_forecasts &gt; 0:
        targets = [series[i + n_lags: i + n_lags + n_forecasts] for i in range(n_samples)]
    else:
        targets = [[None] * n_samples]
    targets = np.array(targets)
    &#47&#47 if verbose:
    &#47&#47     print("time_idx.shape", time.shape)
    &#47&#47     print("input.shape", lags.shape)
    &#47&#47     print("target.shape", targets.shape)

    &#47&#47 df = pd.concat([time, lags, targets], axis=1)
    &#47&#47 df.columns = ["t"] + ["input_{}".format(num) for num in list(range(len(lags.columns)))] + \
    &#47&#47              ["target_{}".format(num) for num in list(range(len(targets.columns)))]
    &#47&#47 return df
    inputs<a id="change"> = </a>[lags]
    input_names = ["lags"]
    if n_trend == 1:
        inputs<a id="change"> += </a>[time]
        input_names += ["trend"]
    elif n_trend &gt; 1:
        raise NotImplementedError</code></pre><h3>After Change</h3><pre><code class='java'>
    if verbose:
        for key, value in inputs.items():
            print(key, "shape: ", value.shape)
    <a id="change">return </a>inputs<a id="change">, targets</a>


def check_dataframe(df):
    Prepare dataframe for fitting or predicting.</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 7</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/ourownstory/neural_prophet/commit/384f1803a758d07de17db9631d9941c4d7a65de3#diff-8909e3372a9dbfa9801c78cdd6a93d8a7cebb2034e9fd6e129d6aab402e2db96L125' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 15814114</div><div id='project'> Project Name: ourownstory/neural_prophet</div><div id='commit'> Commit Name: 384f1803a758d07de17db9631d9941c4d7a65de3</div><div id='time'> Time: 2020-05-19</div><div id='author'> Author: oskar.triebe@merantix.com</div><div id='file'> File Name: code/make_dataset.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: tabularize_univariate_datetime(4)</div><div id='n_method'> N Method Name: tabularize_univariate_datetime(5)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: code/make_dataset.py</div><div id='n_file'> N File Name: code/make_dataset.py</div><div id='m_start'> M Start Line: 125</div><div id='m_end'> M End Line: 176</div><div id='n_start'> N Start Line: 152</div><div id='n_end'> N End Line: 184</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        dim = -1
    if dim&lt;0:
        dim+=input.ndim
    transpose_dims<a id="change"> = </a>[i for i in range(input.ndim)]
    transpose_dims[0] = dim
    transpose_dims[dim] = 0
    input = input.transpose(transpose_dims)
    index,values = jt.argsort(input,dim=0)
    indices = <a id="change">index[k-1:k]</a>
    values = values[k-1:k]
    indices<a id="change"> = </a>indices.transpose(transpose_dims)
    values = values.transpose(transpose_dims)
    if not keepdim and indices.ndim&gt;1:
        indices = indices.squeeze(dim)</code></pre><h3>After Change</h3><pre><code class='java'>
    if dim&lt;0:
        dim+=input.ndim
    index,values = jt.argsort(input,dim=dim)
    dims = (slice(None)<a id="change"></a>,)*(dim-1)+(slice(k-1,k),)
    indices = index[dims]
    values = values[dims]
    if not keepdim and indices.ndim&gt;1:
        indices = indices.squeeze(dim)
        values = values.squeeze(dim)
    <a id="change">return </a>values,indices

jt.Var.kthvalue = kthvalue
</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/jittor/jittor/commit/8e010e8f612c85bb156af4f0ebeee52e3a02a219#diff-9f0bfce0c0e21a07cd9342d9fcbe7511308c81f70bb9a6b347d23cb72ab0f4a8L435' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 15814117</div><div id='project'> Project Name: jittor/jittor</div><div id='commit'> Commit Name: 8e010e8f612c85bb156af4f0ebeee52e3a02a219</div><div id='time'> Time: 2020-09-09</div><div id='author'> Author: dllgdxlxl@gmail.com</div><div id='file'> File Name: python/jittor/misc.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: kthvalue(4)</div><div id='n_method'> N Method Name: kthvalue(4)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: python/jittor/misc.py</div><div id='n_file'> N File Name: python/jittor/misc.py</div><div id='m_start'> M Start Line: 437</div><div id='m_end'> M End Line: 452</div><div id='n_start'> N Start Line: 422</div><div id='n_end'> N End Line: 432</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>

    def __getitem__(self, index):
        self.len_data = len(self.label[index]) // 10
        appearance_data<a id="change"> = </a>torch.tensor(np.transpose(self.a[index], (0, 3, 2, 1)), dtype=torch.float32)[:self.len_data*10]
        motion_data = <a id="change">torch.tensor(np.transpose(self.m[index], (0, 3, 2, 1)), dtype=torch.float32)[:self.len_data*10]</a>

        target = torch.tensor(self.label[index], dtype=torch.float32)[:self.len_data*10]
        input<a id="change"> = </a>torch.cat([appearance_data, motion_data], dim=1)

        if torch.cuda.is_available():
            input = input.to(&quotcuda:9&quot)</code></pre><h3>After Change</h3><pre><code class='java'>
            video_data = video_data.to(&quotcuda:9&quot)
            label_data = label_data.to(&quotcuda:9&quot)

        <a id="change">return </a>video_data<a id="change">, label_data</a>

</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/tvs-ai/pytorch_rppgs/commit/6caab48639a7e1a74914c93698ffb262b7cc4960#diff-0c593ab7d733ee92ff82d893ee16b208ebb298dc8ee45af18eaf529c0f45f08aL105' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 15814108</div><div id='project'> Project Name: tvs-ai/pytorch_rppgs</div><div id='commit'> Commit Name: 6caab48639a7e1a74914c93698ffb262b7cc4960</div><div id='time'> Time: 2021-12-22</div><div id='author'> Author: yoojin2115@tvstorm.com</div><div id='file'> File Name: dataset/MetaPhysDataset.py</div><div id='m_class'> M Class Name: PersonTask</div><div id='n_method'> N Class Name: PersonTask</div><div id='m_method'> M Method Name: __getitem__(2)</div><div id='n_method'> N Method Name: __getitem__(2)</div><div id='m_parent_class'> M Parent Class: Task</div><div id='n_parent_class'> N Parent Class: Task</div><div id='m_file'> M File Name: dataset/MetaPhysDataset.py</div><div id='n_file'> N File Name: dataset/MetaPhysDataset.py</div><div id='m_start'> M Start Line: 106</div><div id='m_end'> M End Line: 117</div><div id='n_start'> N Start Line: 86</div><div id='n_end'> N End Line: 94</div><BR>