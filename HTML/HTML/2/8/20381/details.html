<html><h3>Pattern ID :20381
</h3><img src='66036891.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
        
        if not matrix:
            return pairwise_distance(x, y, p=2)
        <a id="change">raise </a><a id="change">NotImplementedError()</a>

    @staticmethod
    def manhattan(x: Tensor, y: Tensor, matrix=False) -&gt; Tensor:
        Compute manhattan distance</code></pre><h3>After Change</h3><pre><code class='java'>
            Tensor: shape (batch_size, batch_size) if `matrix` is `True`, (batch_size, 1) otherwise.
        
        if not matrix:
            <a id="change">if y is None</a>:
                <a id="change">raise </a><a id="change">ValueError("y cannot be None while matrix is False"</a><a id="change">)</a>

            distances<a id="change"> = </a>pairwise_distance(x, y, p=2)
        else:

            &#47&#47 Calculate dot product. Shape: (batch_size, batch_size)</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 4</div><BR><div id='size'>Non-data size: 7</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/qdrant/quaterion/commit/b1533b50ba29a80c44c1cd100527a7737e8313f5#diff-ff514672dce24c7f348acf3fa1d3323117dd4d2b9781766101e7a32a7b5e4312L11' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 66036891</div><div id='project'> Project Name: qdrant/quaterion</div><div id='commit'> Commit Name: b1533b50ba29a80c44c1cd100527a7737e8313f5</div><div id='time'> Time: 2022-02-22</div><div id='author'> Author: yusufsarigoz@gmail.com</div><div id='file'> File Name: quaterion/loss/metrics.py</div><div id='m_class'> M Class Name: SiameseDistanceMetric</div><div id='n_method'> N Class Name: SiameseDistanceMetric</div><div id='m_method'> M Method Name: euclidean(4)</div><div id='n_method'> N Method Name: euclidean(3)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: quaterion/loss/metrics.py</div><div id='n_file'> N File Name: quaterion/loss/metrics.py</div><div id='m_start'> M Start Line: 11</div><div id='m_end'> M End Line: 23</div><div id='n_start'> N Start Line: 12</div><div id='n_end'> N End Line: 58</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        
        if not matrix:
            return torch.pairwise_distance(x, y, p=1)
        <a id="change">raise </a><a id="change">NotImplementedError()</a>

    @staticmethod
    def cosine_distance(x: Tensor, y: Tensor = None, matrix=False) -&gt; Tensor:
        Compute cosine distance</code></pre><h3>After Change</h3><pre><code class='java'>
            Tensor: shape (batch_size, batch_size) if `matrix` is `True`, (batch_size,) otherwise.
        
        if not matrix:
            <a id="change">if y is None</a>:
                <a id="change">raise </a><a id="change">ValueError("y cannot be None while matrix is False"</a><a id="change">)</a>

            distances<a id="change"> = </a>torch.pairwise_distance(x, y, p=1)

        else:
</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/qdrant/quaterion/commit/032343e6e07e8e226b303d334d52acdab37106d9#diff-ff514672dce24c7f348acf3fa1d3323117dd4d2b9781766101e7a32a7b5e4312L61' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 66036890</div><div id='project'> Project Name: qdrant/quaterion</div><div id='commit'> Commit Name: 032343e6e07e8e226b303d334d52acdab37106d9</div><div id='time'> Time: 2022-03-14</div><div id='author'> Author: yusufsarigoz@gmail.com</div><div id='file'> File Name: quaterion/loss/metrics.py</div><div id='m_class'> M Class Name: SiameseDistanceMetric</div><div id='n_method'> N Class Name: SiameseDistanceMetric</div><div id='m_method'> M Method Name: manhattan(3)</div><div id='n_method'> N Method Name: manhattan(3)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: quaterion/loss/metrics.py</div><div id='n_file'> N File Name: quaterion/loss/metrics.py</div><div id='m_start'> M Start Line: 61</div><div id='m_end'> M End Line: 73</div><div id='n_start'> N Start Line: 61</div><div id='n_end'> N End Line: 93</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        &#47&#47 Preload all the elements you are going to need at inference.
        &#47&#47 For instance your model, processors, tokenizer that might be needed.
        &#47&#47 This function is only called once, so do all the heavy processing I/O here
        <a id="change">raise </a><a id="change">NotImplementedError(
            </a>"Please implement SentenceSimilarityPipeline __init__ function"<a id="change">
        )</a>

    def __call__(self, inputs: Dict[str, Union[str, List[str]]]) -&gt; List[float]:
        
        Args:</code></pre><h3>After Change</h3><pre><code class='java'>
    ):
        &#47&#47 At the time, only public models from spaCy are allowed in the inference API.
        full_model_path = model_id.split("/")
        <a id="change">if len(full_model_path) != 2</a>:
            <a id="change">raise </a><a id="change">ValueError(
                f"Invalid model_id: {model_id}. It should have a namespace (:namespace:/:model_name:)"</a><a id="change">
            )</a>
        namespace, model_name = full_model_path
        package<a id="change"> = </a>f"https://huggingface.co/{namespace}/{model_name}/resolve/main/{model_name}-any-py3-none-any.whl"
        cache_dir = os.environ["PIP_CACHE"]
        subprocess.check_call(
            [sys.executable, "-m", "pip", "install", "--cache-dir", cache_dir, package]</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/huggingface/huggingface_hub/commit/75e3d92b04b05c46924cfc334d12ae236a5d2a6a#diff-0c061c48ef67c2a2ae8be0ad302468e982fd1113ea028b44ce144e4668ff2d6eL7' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 66036889</div><div id='project'> Project Name: huggingface/huggingface_hub</div><div id='commit'> Commit Name: 75e3d92b04b05c46924cfc334d12ae236a5d2a6a</div><div id='time'> Time: 2021-10-15</div><div id='author'> Author: 60084015+devpramod@users.noreply.github.com</div><div id='file'> File Name: api-inference-community/docker_images/spacy/app/pipelines/sentence_similarity.py</div><div id='m_class'> M Class Name: SentenceSimilarityPipeline</div><div id='n_method'> N Class Name: SentenceSimilarityPipeline</div><div id='m_method'> M Method Name: __init__(2)</div><div id='n_method'> N Method Name: __init__(2)</div><div id='m_parent_class'> M Parent Class: Pipeline</div><div id='n_parent_class'> N Parent Class: Pipeline</div><div id='m_file'> M File Name: api-inference-community/docker_images/spacy/app/pipelines/sentence_similarity.py</div><div id='n_file'> N File Name: api-inference-community/docker_images/spacy/app/pipelines/sentence_similarity.py</div><div id='m_start'> M Start Line: 15</div><div id='m_end'> M End Line: 17</div><div id='n_start'> N Start Line: 15</div><div id='n_end'> N End Line: 29</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
            )
        else:
            &#47&#47 anticipate common mistakes
            <a id="change">raise </a><a id="change">NotImplementedError(</a>"please set expanded=True"<a id="change">)</a> 

    def _get_nearest_labels_expanded(
        self, vector, label_documents, label_field: str="label"</code></pre><h3>After Change</h3><pre><code class='java'>
        similarity_metric: str="cosine",
    ):
        &#47&#47 perform cosine similarity
        <a id="change">if similarity_metric == &quotcosine&quot</a>:
            labels<a id="change"> = </a>self.cosine_similarity(
                query_vector=vector,
                vector_field=label_vector_field,
                documents=label_documents
            )
        else:
            <a id="change">raise </a><a id="change">ValueError("Only cosine similarity metric is supported at the moment."</a><a id="change">)</a>

        &#47&#47 for the label vectors
        if expanded:
            return labels</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/relevanceai/relevanceai/commit/843f1247ac121acd9428f7ff777a4eb1917ea692#diff-1411e3ee8ae29db06f1c8581c1f9c321b226da1bf93357861ed98f5925bfbb22L37' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 66036884</div><div id='project'> Project Name: relevanceai/relevanceai</div><div id='commit'> Commit Name: 843f1247ac121acd9428f7ff777a4eb1917ea692</div><div id='time'> Time: 2022-05-15</div><div id='author'> Author: jacky2wong@gmail.com</div><div id='file'> File Name: relevanceai/operations_new/label/base.py</div><div id='m_class'> M Class Name: LabelBase</div><div id='n_method'> N Class Name: LabelBase</div><div id='m_method'> M Method Name: _get_nearest_labels(7)</div><div id='n_method'> N Method Name: _get_nearest_labels(5)</div><div id='m_parent_class'> M Parent Class: DocUtils</div><div id='n_parent_class'> N Parent Class: DocUtils</div><div id='m_file'> M File Name: relevanceai/operations_new/label/base.py</div><div id='n_file'> N File Name: relevanceai/operations_new/label/base.py</div><div id='m_start'> M Start Line: 37</div><div id='m_end'> M End Line: 47</div><div id='n_start'> N Start Line: 71</div><div id='n_end'> N End Line: 91</div><BR>