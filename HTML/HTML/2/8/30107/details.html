<html><h3>Pattern ID :30107
</h3><img src='89275218.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
        bleu = BLEU(reference_corpus, weights)
        scores = bleu.get_score(generate_corpus)

        results<a id="change"> = {}</a>
        for n_gram in self.n_grams:
            score<a id="change"> = </a>np.array(scores[&quotbleu-{}&quot.format(n_gram)])
            results[&quotbleu-{}&quot.format(n_gram)]<a id="change"> = </a>score.mean()
        for n_gram in self.n_grams:
            score = <a id="change">np.array(</a>scores[&quotbleu-{}-avg&quot.format(n_gram)]<a id="change">)</a>
            results[&quotbleu-{}-avg&quot.format(n_gram)]<a id="change"> = </a>score.mean()
        <a id="change">return </a>results

    def _calc_metrics_info(self, generate_corpus, reference_corpus):
        rget metrics result</code></pre><h3>After Change</h3><pre><code class='java'>
        
        bleu = BLEU(reference_corpus, weights)
        scores = bleu.get_score(generate_corpus)
        <a id="change">return </a>scores

    def _calc_metrics_info(self, generate_corpus, reference_corpus):
        rget metrics result</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 8</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/rucaibox/textbox/commit/d7887fa8ed83bcbd9b5d2e4517fdf566776660f7#diff-c974465930b658191cb680164da9128edc69d26ea0a6dbe1ddeb95f89b07e179L55' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 89275218</div><div id='project'> Project Name: rucaibox/textbox</div><div id='commit'> Commit Name: d7887fa8ed83bcbd9b5d2e4517fdf566776660f7</div><div id='time'> Time: 2021-05-03</div><div id='author'> Author: 602525931@qq.com</div><div id='file'> File Name: textbox/evaluator/bleu_evaluator.py</div><div id='m_class'> M Class Name: BleuEvaluator</div><div id='n_method'> N Class Name: BleuEvaluator</div><div id='m_method'> M Method Name: _bleu(3)</div><div id='n_method'> N Method Name: _bleu(3)</div><div id='m_parent_class'> M Parent Class: AbstractEvaluator</div><div id='n_parent_class'> N Parent Class: AbstractEvaluator</div><div id='m_file'> M File Name: textbox/evaluator/bleu_evaluator.py</div><div id='n_file'> N File Name: textbox/evaluator/bleu_evaluator.py</div><div id='m_start'> M Start Line: 55</div><div id='m_end'> M End Line: 64</div><div id='n_start'> N Start Line: 55</div><div id='n_end'> N End Line: 56</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        bleu = SelfBLEU(generate_corpus, weights)
        scores = bleu.get_score()

        results<a id="change"> = {}</a>
        for n_gram in self.n_grams:
            score<a id="change"> = </a><a id="change">np.array(</a>scores[&quotself-bleu-{}&quot.format(n_gram)]<a id="change">)</a>
            results[&quotself-bleu-{}&quot.format(n_gram)] = score.mean()
        for n_gram in self.n_grams:
            score<a id="change"> = </a>np.array(scores[&quotself-bleu-{}-avg&quot.format(n_gram)])
            results[&quotself-bleu-{}-avg&quot.format(n_gram)]<a id="change"> = </a>score.mean()
        <a id="change">return </a>results

    def _calc_metrics_info(self, generate_corpus, reference_corpus=None):
        rget metrics result</code></pre><h3>After Change</h3><pre><code class='java'>
        
        bleu = SelfBLEU(generate_corpus, weights)
        scores = bleu.get_score()
        <a id="change">return </a>scores

    def _calc_metrics_info(self, generate_corpus, reference_corpus=None):
        rget metrics result</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/rucaibox/textbox/commit/d7887fa8ed83bcbd9b5d2e4517fdf566776660f7#diff-744a49a2d0487c98e251d334aa8cc1f92985f5e77b6f8caf4740113a4c678a27L31' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 89275219</div><div id='project'> Project Name: rucaibox/textbox</div><div id='commit'> Commit Name: d7887fa8ed83bcbd9b5d2e4517fdf566776660f7</div><div id='time'> Time: 2021-05-03</div><div id='author'> Author: 602525931@qq.com</div><div id='file'> File Name: textbox/evaluator/selfbleu_evaluator.py</div><div id='m_class'> M Class Name: SelfBleuEvaluator</div><div id='n_method'> N Class Name: SelfBleuEvaluator</div><div id='m_method'> M Method Name: _self_bleu(2)</div><div id='n_method'> N Method Name: _self_bleu(2)</div><div id='m_parent_class'> M Parent Class: AbstractEvaluator</div><div id='n_parent_class'> N Parent Class: AbstractEvaluator</div><div id='m_file'> M File Name: textbox/evaluator/selfbleu_evaluator.py</div><div id='n_file'> N File Name: textbox/evaluator/selfbleu_evaluator.py</div><div id='m_start'> M Start Line: 53</div><div id='m_end'> M End Line: 62</div><div id='n_start'> N Start Line: 53</div><div id='n_end'> N End Line: 54</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>

            col_idxs.append(np.arange(start_index, end_index + 1, 1))  &#47&#47 correct for not including upper bound

        col_idxs = <a id="change">np.array(</a>col_idxs<a id="change">)</a>

        assert row_idxs.shape == col_idxs.shape == (self.batch_size, self.num_bptt)

        &#47&#47 numpy advanced indexing

        o = self._prepare(self.o[row_idxs, col_idxs]).view(self.batch_size, self.num_bptt, self.o_dim)
        a = self._prepare(self.a[row_idxs, col_idxs]).view(self.batch_size, self.num_bptt, self.a_dim)
        r<a id="change"> = </a>self._prepare(self.r[row_idxs, col_idxs]).view(self.batch_size, self.num_bptt, 1)
        no = self._prepare(self.no[row_idxs, col_idxs]).view(self.batch_size, self.num_bptt, self.o_dim)
        d = self._prepare(self.d[row_idxs, col_idxs]).view(self.batch_size, self.num_bptt, 1)
        m = self._prepare(self.m[row_idxs, col_idxs]).view(self.batch_size, self.num_bptt, 1)

        <a id="change">return </a>RecurrentBatch(o, a, r, no, d, m)
</code></pre><h3>After Change</h3><pre><code class='java'>
        &#47&#47 3 3 3 3 3 3 3 3 3 3
        &#47&#47 4 4 4 4 4 4 4 4 4 4

        col_idxs_for_o<a id="change"> = </a>[]
        col_idxs_for_others = <a id="change">[]</a>

        for ep_len in ep_lens:

            final_index = ep_len - 1  &#47&#47 the last valid index of the episode

            &#47&#47 first +1 is to correct for over subtraction
            &#47&#47 second +1 is to correct for the fact that np.random.randint does not include upper bound

            if ep_len &gt;= self.num_bptt:
                start_index = np.random.randint((final_index - self.num_bptt + 1) + 1)
            elif ep_len &lt; self.num_bptt:  &#47&#47 this is the case for which mask is actually useful
                start_index = 0

            end_index = start_index + (self.num_bptt - 1)  &#47&#47 correct for over addition

            col_idxs_for_o.append(np.arange(start_index, end_index + 1 + 1, 1))  &#47&#47 correct for not including upper bound
            col_idxs_for_others.append(np.arange(start_index, end_index + 1, 1))

        col_idxs_for_o<a id="change"> = </a>np.array(col_idxs_for_o)
        col_idxs_for_others<a id="change"> = </a>np.array(col_idxs_for_others)

        assert row_idxs_for_o.shape == col_idxs_for_o.shape == (self.batch_size, self.num_bptt + 1)
        assert row_idxs_for_others.shape == col_idxs_for_others.shape == (self.batch_size, self.num_bptt)

        &#47&#47 numpy advanced indexing

        o = self._prepare(self.o[row_idxs_for_o, col_idxs_for_o]).view(self.batch_size, self.num_bptt+1, self.o_dim)
        a = self._prepare(self.a[row_idxs_for_others, col_idxs_for_others]).view(self.batch_size, self.num_bptt, self.a_dim)
        r = self._prepare(self.r[row_idxs_for_others, col_idxs_for_others]).view(self.batch_size, self.num_bptt, 1)
        d = self._prepare(self.d[row_idxs_for_others, col_idxs_for_others]).view(self.batch_size, self.num_bptt, 1)
        m = self._prepare(self.m[row_idxs_for_others, col_idxs_for_others]).view(self.batch_size, self.num_bptt, 1)

        <a id="change">return </a>RecurrentBatch(o, a, r, d, m)
</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/zhihanyang2022/off-policy-continuous-control/commit/ff05c5d10e3338ae6468407f3fdf47eed1a22559#diff-1507009ab57c9d4a09b2f6569e1a96597dc18c8ec7bf05b1135e5e636786df85L109' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 89275206</div><div id='project'> Project Name: zhihanyang2022/off-policy-continuous-control</div><div id='commit'> Commit Name: ff05c5d10e3338ae6468407f3fdf47eed1a22559</div><div id='time'> Time: 2021-05-23</div><div id='author'> Author: yangz2@carleton.edu</div><div id='file'> File Name: offpcc/basics/replay_buffer_recurrent.py</div><div id='m_class'> M Class Name: RecurrentReplayBuffer</div><div id='n_method'> N Class Name: RecurrentReplayBuffer</div><div id='m_method'> M Method Name: sample(1)</div><div id='n_method'> N Method Name: sample(1)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: offpcc/basics/replay_buffer_recurrent.py</div><div id='n_file'> N File Name: offpcc/basics/replay_buffer_recurrent.py</div><div id='m_start'> M Start Line: 132</div><div id='m_end'> M End Line: 171</div><div id='n_start'> N Start Line: 120</div><div id='n_end'> N End Line: 173</div><BR>