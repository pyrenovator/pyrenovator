<html><h3>Pattern ID :41389
</h3><img src='116453170.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
                x_min = np.min(true_verts[:,t+1,:], axis=0)
                x_max = np.max(true_verts[:,t+1,:], axis=0)

                x_range<a id="change"> = </a>x_max-x_min
                true_area = np.prod(x_range)

                &#47&#47 true_hull = ConvexHull(true_verts[:, t+1, :])
                &#47&#47 true_area = true_hull.volume

                Abp, bbp = range_to_polytope(backprojection_sets[t].range)
                estimated_verts = pypoman.polygon.compute_polygon_hull(Abp, bbp)
                estimated_hull = ConvexHull(estimated_verts)
                estimated_area = estimated_hull.volume
                
                print(<a id="change">&quotestimated: {} --- true: {}&quot.format(</a>estimated_area, true_area<a id="change">)</a>)
                print(&quotestimated range: {} --- true range: {}&quot.format(backprojection_sets[t].range, x_range))

                errors.append((estimated_area - true_area) / true_area)</code></pre><h3>After Change</h3><pre><code class='java'>
                num_samples=1e8
            )
            true_verts = np.flip(true_verts_reversed, axis=1)
            num_steps = <a id="change">len(</a>backprojection_sets<a id="change">)</a>


            <a id="change">for t</a> in <a id="change">range(</a>num_steps<a id="change">):
                &#47&#47 x_min = np.min(true_verts[:,t+1,:], axis=0)
                &#47&#47 x_max = np.max(true_verts[:,t+1,:], axis=0)

                &#47&#47 x_range = x_max-x_min
                &#47&#47 true_area = np.prod(x_range)
                </a>true_hull = ConvexHull(true_verts[:, t+1, :])
                true_area<a id="change"> = </a>true_hull.volume

                &#47&#47 true_hull = ConvexHull(true_verts[:, t+1, :])
                &#47&#47 true_area = true_hull.volume</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 6</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/mit-acl/nn_robustness_analysis/commit/b7a8819901416af543775010a3817dc7675efd68#diff-5978197704dcd1496e7c63190c3f5ed724cc12268853c47f8d2f34ac84a7a27eL333' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 116453170</div><div id='project'> Project Name: mit-acl/nn_robustness_analysis</div><div id='commit'> Commit Name: b7a8819901416af543775010a3817dc7675efd68</div><div id='time'> Time: 2022-08-12</div><div id='author'> Author: nrober1122@gmail.com</div><div id='file'> File Name: nn_closed_loop/nn_closed_loop/partitioners/ClosedLoopPartitioner.py</div><div id='m_class'> M Class Name: ClosedLoopPartitioner</div><div id='n_method'> N Class Name: ClosedLoopPartitioner</div><div id='m_method'> M Method Name: get_backprojection_error(6)</div><div id='n_method'> N Method Name: get_backprojection_error(5)</div><div id='m_parent_class'> M Parent Class: partitioners.Partitioner</div><div id='n_parent_class'> N Parent Class: partitioners.Partitioner</div><div id='m_file'> M File Name: nn_closed_loop/nn_closed_loop/partitioners/ClosedLoopPartitioner.py</div><div id='n_file'> N File Name: nn_closed_loop/nn_closed_loop/partitioners/ClosedLoopPartitioner.py</div><div id='m_start'> M Start Line: 333</div><div id='m_end'> M End Line: 392</div><div id='n_start'> N Start Line: 338</div><div id='n_end'> N End Line: 435</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>

    if type(regex_strs) is str and replace:
        regex_strs = word_replace_back(regex_strs)
        split_keys<a id="change"> = </a>word_replace_back(split_keys)
        qualities = word_replace_back(qualities)
    for regex_str in regex_strs:
        print("check regs {}. log found: ".format(osp.join(prefix_dir, regex_str)))
        log_found = glob.glob(osp.join(prefix_dir, regex_str))
        dirs.extend(log_found)
        &#47&#47 print("regex str :{}. log found".format(regex_str))
        for log in log_found:
            print(log)

    results = plot_util.load_results(dirs, names=qualities + [xlabel],
                                     enable_monitor=False, x_bound=[xlabel, x_bound], use_buf=use_buf)
    print("---- load dataset --- ")
    &#47&#47 y_names = [&quotacc/adjusted_r2&quot, &quotacc/accurancy_trans&quot]
    &#47&#47 eval_policy/coupon_avg_rate
    &#47&#47 postfixs = [&quotcoupon_avg_rate&quot, &quotcoupon_predict_rate&quot, &quotroi_avg&quot, &quotroi_predict&quot, &quotsum_avg_gmv&quot, &quotsum_fos&quot,
    &#47&#47             &quotsum_predict_gmv&quot, &quotsum_spend&quot]
    &#47&#47 old
    &#47&#47 for idx, quality in enumerate(qualities):
    &#47&#47     y_names = [quality]
    &#47&#47     &#47&#47 y_names = [&quoteval_policy/&quot + postfix, &quoteval_real/&quot + postfix, &quoteval_zero/&quot + postfix]
    &#47&#47     &#47&#47 split_fn: 我们要对这个指标分成多张子图的时候用的
    &#47&#47     &#47&#47 group_fn: r 是遍历到的progress.csv的名字， split_keys 是我们要区分的实验组；y_names是我们要评估的指标
    &#47&#47     plot_util.plot_results(results, xy_fn= lambda r, y_names: csv_to_xy(r, DEFAULT_X_NAME, y_names),
    &#47&#47                            &#47&#47 xy_fn=lambda r: ts2xy(r[&quotmonitor&quot], &quotinfo/TimestepsSoFar&quot, &quotdiff/driver_1_2_std&quot),
    &#47&#47                            &#47&#47 split_fn=lambda r: picture_split(taskpath=r, split_keys=split_keys, y_names=y_names)[0],
    &#47&#47                            group_fn=lambda r: picture_split(taskpath=r, split_keys=split_keys, y_names=y_names), &#47&#47 picture_split(taskpath=r, y_names=y_names),
    &#47&#47                            average_group=True, resample=int(1e3),
    &#47&#47                            ylabel=quality, xlabel=DEFAULT_X_NAME)
    &#47&#47     file_name = "r:{},k:{},q:{}.png".format(regex_strs, split_keys, quality)
    &#47&#47     file_name = word_replace(file_name)
    &#47&#47
    &#47&#47     import os
    &#47&#47     dir_name = "../res/pic/" + prefix_dir[2:] + &quot/&quot
    &#47&#47     os.makedirs(dir_name, exist_ok=True)
    &#47&#47     plt.savefig(dir_name + file_name)
    &#47&#47     print("res related location: {}".format("../pic/" + prefix_dir[2:] + file_name))

    y_names = qualities &#47&#47 []
    if ylabel is None:
        ylabel = qualities

    &#47&#47 y_names = [&quoteval_policy/&quot + postfix, &quoteval_real/&quot + postfix, &quoteval_zero/&quot + postfix]
    &#47&#47 split_fn: 我们要对这个指标分成多张子图的时候用的
    &#47&#47 group_fn: r 是遍历到的progress.csv的名字， split_keys 是我们要区分的实验组；y_names是我们要评估的指标
    _, _, lgd, texts = plot_util.plot_results(results, xy_fn= lambda r, y_names: csv_to_xy(r, DEFAULT_X_NAME, y_names,
                                                                                           scale_dict, x_bound=x_bound, x_start=x_start, y_bound=y_bound,
                                                                                           remove_outlier=remove_outlier),
                           &#47&#47 xy_fn=lambda r: ts2xy(r[&quotmonitor&quot], &quotinfo/TimestepsSoFar&quot, &quotdiff/driver_1_2_std&quot),
                           &#47&#47 split_fn=lambda r: picture_split(taskpath=r, split_keys=split_keys, y_names=y_names)[0],
                           group_fn=lambda r: picture_split(taskpath=r, split_keys=split_keys, y_names=y_names), &#47&#47 picture_split(taskpath=r, y_names=y_names),
                           average_group=True, resample=resample,
                           legend_outside=legend_outside, smooth_step=smooth_step,
                           ylabel=ylabel, xlabel=xlabel, replace_legend_keys=replace_legend_keys,
                            *args, **kwargs)
    print("--- complete process ---")
    file_name = <a id="change">"r:{},k:{},q:{}.pdf".format(</a>regex_strs, split_keys, qualities<a id="change">)</a>
    file_name = word_replace(file_name)
    if save_name is not None:
        import os
        dir_name = "../res/pic/" + prefix_dir[2:] + &quot/&quot</code></pre><h3>After Change</h3><pre><code class='java'>
    scale_dict = {}
    if misc_scale_index is None:
        misc_scale_index = []
    <a id="change">for i</a> in <a id="change">range(len(</a>qualities<a id="change">)</a><a id="change">):
        </a>if i in misc_scale_index:
            scale_dict[qualities[i]] = misc_scale[misc_scale_index.index(i)]
        else:
            scale_dict[qualities[i]]<a id="change"> = </a>1
    _, _, lgd, texts = plot_util.plot_results(results, xy_fn= lambda r, y_names: csv_to_xy(r, DEFAULT_X_NAME, y_names,
                                                                                           scale_dict, x_start=x_start, y_bound=y_bound,
                                                                                           remove_outlier=remove_outlier),</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/xionghuichen/rlassistant/commit/c960619032588e7490bfcecc6c8aa20a04a0bddf#diff-a8c3aff055596448cd598dd02c9f760327d2126ed0fb81a01e0173d529481ddbL91' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 116453195</div><div id='project'> Project Name: xionghuichen/rlassistant</div><div id='commit'> Commit Name: c960619032588e7490bfcecc6c8aa20a04a0bddf</div><div id='time'> Time: 2020-12-21</div><div id='author'> Author: zpcxh95@outlook.com</div><div id='file'> File Name: RLA/easy_plot/plot_func.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: plot_res_func(17)</div><div id='n_method'> N Method Name: plot_res_func(19)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: RLA/easy_plot/plot_func.py</div><div id='n_file'> N File Name: RLA/easy_plot/plot_func.py</div><div id='m_start'> M Start Line: 91</div><div id='m_end'> M End Line: 173</div><div id='n_start'> N Start Line: 95</div><div id='n_end'> N End Line: 150</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
            pred_ner, pred_rel = self.model(data_item, is_test=True)
        length = len([c for c in data_item[&quottext&quot][0]])  &#47&#47 测试的时候只有一个样例
        pred_ner, pred_rel = pred_ner[0], pred_rel[0]
        pred_rel_list<a id="change"> = </a>[]
        loc = pred_rel.nonzero()
        for item in loc:
            item = item.cpu().numpy()
            if math.fabs(item[2]) &lt; 0.1:
                continue
            pred_rel_list.append([item[0], item[1], self.id2rel[item[2]]])
        token_pred = []
        cnt = 0
        for i in pred_ner:
            if cnt &gt;= length:
                break
            token_pred.append(self.id2token_type[i])
            cnt += 1
        print("token_pred: {}".format(token_pred))
        print(data_item[&quottext&quot][0])
        print(<a id="change">"pred_rel_list: {}".format(</a>pred_rel_list<a id="change">)</a>)
        self.model.train(True)
        rel_triple = self.convert2StandardOutput(data_item, 0, token_pred, pred_rel_list)
        &#47&#47 print("提取得到的关系三元组:\n {}".format(rel_triple))</code></pre><h3>After Change</h3><pre><code class='java'>
        texts = [text for text in data_item[&quottext&quot]]
        lengths = [len([c for c in data_item[&quottext&quot][i]]) for i in range(self.config.batch_size)] &#47&#47 测试的时候只有一个样例
        token_pred = [[] for _ in range(self.config.batch_size)]
        <a id="change">for i</a> in <a id="change">range(len(</a>pred_ner<a id="change">)</a><a id="change">):
            </a>cnt = 0
            for id in pred_ner[i]:
                token_pred[i].append(self.id2token_type[id])
                cnt += 1
                if cnt &gt;= lengths[i]:
                    break
        self.model.train(True)
        rel_triple_list<a id="change"> = </a>[]
        for i in range(self.config.batch_size):
            rel_triple = self.convert2StandardOutput(data_item, i, token_pred[i], pred_rel_list[i])
            rel_triple_list.append(rel_triple)</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/mangonihao/multiheadjointentityrelationextraction_simple/commit/2a04d85796b2ad1e63aef4a04461dc6aa05ea4c1#diff-075d5e201e6fa33310a0829d04f69714642c915794e8b2dfaacd31c8d32e0a3fL176' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 116453183</div><div id='project'> Project Name: mangonihao/multiheadjointentityrelationextraction_simple</div><div id='commit'> Commit Name: 2a04d85796b2ad1e63aef4a04461dc6aa05ea4c1</div><div id='time'> Time: 2021-03-27</div><div id='author'> Author: 2075419247@qq.com</div><div id='file'> File Name: mains/trainer.py</div><div id='m_class'> M Class Name: Trainer</div><div id='n_method'> N Class Name: Trainer</div><div id='m_method'> M Method Name: predict(1)</div><div id='n_method'> N Method Name: predict(1)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: mains/trainer.py</div><div id='n_file'> N File Name: mains/trainer.py</div><div id='m_start'> M Start Line: 182</div><div id='m_end'> M End Line: 204</div><div id='n_start'> N Start Line: 183</div><div id='n_end'> N End Line: 206</div><BR>