<html><h3>Pattern ID :3342
</h3><img src='13055936.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>

    for i, (images, captions) in enumerate(data_loader):
        for image, caption in zip(images, captions):
            <a id="change">with </a>Document<a id="change">() as document:
                </a>document.text = caption
                document.modality = &quottext&quot
                document.mime_type = &quottext/plain&quot
            with Document() as gt:</code></pre><h3>After Change</h3><pre><code class='java'>
    )
    for i, (images, captions) in enumerate(data_loader):
        for image, caption in zip(images, captions):
            <a id="change">if mode == &quottext2image&quot</a>:
                <a id="change">with </a>Document<a id="change">() as document:
                    </a>document.text = caption
                    document.modality = &quottext&quot
                    document.mime_type = &quottext/plain&quot
                with Document() as gt:
                    match = Document()
                    match.tags[&quotid&quot] = hash(image)
                    gt.matches.append(match)
                yield document, gt
            elif mode == &quotimage2text&quot:
                with Document() as document:
                    document.buffer<a id="change"> = </a>image
                    document.modality = &quotimage&quot
                    document.mime_type = &quotimage/jpeg&quot
                with Document() as gt:
                    match = Document()
                    match.tags[&quotid&quot]<a id="change"> = </a>caption
                    gt.matches.append(match)
                yield document<a id="change">, gt</a>
            else:
                msg = f&quotNot supported mode {mode}.&quot
                msg += &quotexpected `image2text` or `text2image`&quot
                raise ValueError(msg)</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 4</div><BR><div id='size'>Non-data size: 7</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/jina-ai/examples/commit/2b546b95f95bf4d2b1e7fae732de8d3b1e2929d5#diff-819cefc0ef828fb5a5362afcf7903fe60f785aabd9ff56213d08b2f5c54f285aL37' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 13055936</div><div id='project'> Project Name: jina-ai/examples</div><div id='commit'> Commit Name: 2b546b95f95bf4d2b1e7fae732de8d3b1e2929d5</div><div id='time'> Time: 2021-03-03</div><div id='author'> Author: bo.wang@jina.ai</div><div id='file'> File Name: cross-modal-search/evaluate.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: evaluation_generator(4)</div><div id='n_method'> N Method Name: evaluation_generator(3)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: cross-modal-search/evaluate.py</div><div id='n_file'> N File Name: cross-modal-search/evaluate.py</div><div id='m_start'> M Start Line: 50</div><div id='m_end'> M End Line: 58</div><div id='n_start'> N Start Line: 37</div><div id='n_end'> N End Line: 74</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        Run the task model from the outputs of the `_tokenize` function.
        
        results = []
        <a id="change">with </a>static_mode_guard<a id="change">():
            </a>for batch in inputs[&quotdata_loader&quot]:
                text1_ids, text1_segment_ids, text2_ids, text2_segment_ids = self._batchify_fn(
                    batch)
                self.input_handles[0].copy_from_cpu(text1_ids)</code></pre><h3>After Change</h3><pre><code class='java'>
        Run the task model from the outputs of the `_tokenize` function.
        
        results = []
        <a id="change">if ("rocketqa" in self.model_name)</a>:
            with static_mode_guard():
                for batch in inputs[&quotdata_loader&quot]:
                    input_ids<a id="change">, segment_ids = </a>self._batchify_fn(batch)
                    self.input_handles[0].copy_from_cpu(input_ids)
                    self.input_handles[1].copy_from_cpu(segment_ids)
                    self.predictor.run()
                    scores<a id="change"> = </a>self.output_handle[0].copy_to_cpu().tolist()
                    results.extend(scores)
        else:
            <a id="change">with </a>static_mode_guard<a id="change">():
                </a>for batch in inputs[&quotdata_loader&quot]:
                    text1_ids, text1_segment_ids, text2_ids, text2_segment_ids = self._batchify_fn(
                        batch)
                    self.input_handles[0].copy_from_cpu(text1_ids)</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/paddlepaddle/paddlenlp/commit/4bbf1b08ff72f986bf937966e137653ff122ed7b#diff-b59deaec6ce13b715f1fb815d27a75de4ada456633e34fe1bf85e1882c07c11fL162' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 13055879</div><div id='project'> Project Name: paddlepaddle/paddlenlp</div><div id='commit'> Commit Name: 4bbf1b08ff72f986bf937966e137653ff122ed7b</div><div id='time'> Time: 2022-08-19</div><div id='author'> Author: w5688414@gmail.com</div><div id='file'> File Name: paddlenlp/taskflow/text_similarity.py</div><div id='m_class'> M Class Name: TextSimilarityTask</div><div id='n_method'> N Class Name: TextSimilarityTask</div><div id='m_method'> M Method Name: _run_model(2)</div><div id='n_method'> N Method Name: _run_model(2)</div><div id='m_parent_class'> M Parent Class: Task</div><div id='n_parent_class'> N Parent Class: Task</div><div id='m_file'> M File Name: paddlenlp/taskflow/text_similarity.py</div><div id='n_file'> N File Name: paddlenlp/taskflow/text_similarity.py</div><div id='m_start'> M Start Line: 167</div><div id='m_end'> M End Line: 187</div><div id='n_start'> N Start Line: 251</div><div id='n_end'> N End Line: 282</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>

    def encode(self, destination, image, malloc):
        if isinstance(image, Image):
            <a id="change">with </a>io<a id="change">.BytesIO() as output:
                </a>image.save(output, format="GIF")
                contents = np.frombuffer(output.getvalue(), dtype=&quot&lt;u1&quot)
                destination[&quotdata_ptr&quot], storage = malloc(len(contents))
                storage[:] = contents</code></pre><h3>After Change</h3><pre><code class='java'>
            destination[&quotheight&quot], destination[&quotwidth&quot] = image.size
            destination[&quotmode&quot] = IMAGE_MODES[self.write_mode]

            <a id="change">if self.write_mode == &quotjpg&quot</a>:
                <a id="change">with </a>io<a id="change">.BytesIO() as output:
                    </a>image.save(output, format="GIF")
                    contents = np.frombuffer(output.getvalue(), dtype=&quot&lt;u1&quot)
                    destination[&quotdata_ptr&quot], storage = malloc(len(contents))
                    storage[:] = contents
            elif self.write_mode == &quotraw&quot:
                image_np = np.array(image).transpose(2, 0, 1)
                assert image_np.dtype == np.uint8
                image_np = np.ascontiguousarray(image_np).view(&quot&lt;u1&quot).reshape(-1)
                destination<a id="change">[&quotdata_ptr&quot], storage = </a>malloc(len(image_np))
                storage[:]<a id="change"> = </a>image_np
            else:
                raise ValueError(f"Unsupported write mode {self.write_mode}")
</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/libffcv/ffcv/commit/39f5d7c7fec86c99d802f202c47796791102da98#diff-e76ee4ff74ff6d77372c69e4e7425237b68658635a780d8c92b53c8ba3e36dd4L93' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 13055878</div><div id='project'> Project Name: libffcv/ffcv</div><div id='commit'> Commit Name: 39f5d7c7fec86c99d802f202c47796791102da98</div><div id='time'> Time: 2021-10-19</div><div id='author'> Author: leclerc@mit.edu</div><div id='file'> File Name: ffcv/fields.py</div><div id='m_class'> M Class Name: RGBImageField</div><div id='n_method'> N Class Name: RGBImageField</div><div id='m_method'> M Method Name: encode(4)</div><div id='n_method'> N Method Name: encode(4)</div><div id='m_parent_class'> M Parent Class: Field</div><div id='n_parent_class'> N Parent Class: Field</div><div id='m_file'> M File Name: ffcv/fields.py</div><div id='n_file'> N File Name: ffcv/fields.py</div><div id='m_start'> M Start Line: 95</div><div id='m_end'> M End Line: 103</div><div id='n_start'> N Start Line: 95</div><div id='n_end'> N End Line: 113</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        model (Joblib model) the model/pipeline that was trained on the iris dataset.

    
    <a id="change">with </a>urlopen<a id="change">(_MODEL_URL) as f:
        </a>model = joblib.load(f)

    return model
</code></pre><h3>After Change</h3><pre><code class='java'>
        model (Joblib model) the model/pipeline that was trained on the iris dataset.

    
    <a id="change">if sklearn.__version__ == &quot1.0.1&quot</a>:
        <a id="change">with </a>urlopen<a id="change">(_MODEL_URL) as f:
            </a>model = joblib.load(f)
    else:
        model<a id="change"> = </a>_build_model()
        train<a id="change">, _ = </a>load_data()
        model.fit(train.features_columns, train.label_col)
    return model
</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/deepchecks/deepchecks/commit/552ebe5abfa8153b37593a1f8a0b369d9d8dab25#diff-2cb221ac484ef7ba91caf14e3e60fe88a3f8a4045eb1445bfff5b700d6ac3293L122' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 13055935</div><div id='project'> Project Name: deepchecks/deepchecks</div><div id='commit'> Commit Name: 552ebe5abfa8153b37593a1f8a0b369d9d8dab25</div><div id='time'> Time: 2022-01-20</div><div id='author'> Author: 42312361+benisraeldan@users.noreply.github.com</div><div id='file'> File Name: deepchecks/datasets/classification/iris.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: load_fitted_model(0)</div><div id='n_method'> N Method Name: load_fitted_model(0)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: deepchecks/datasets/classification/iris.py</div><div id='n_file'> N File Name: deepchecks/datasets/classification/iris.py</div><div id='m_start'> M Start Line: 129</div><div id='m_end'> M End Line: 132</div><div id='n_start'> N Start Line: 132</div><div id='n_end'> N End Line: 139</div><BR>