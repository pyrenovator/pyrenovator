<html><h3>Pattern ID :4371
</h3><img src='16109847.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
    else:
        _line_count = config.gen_lines

    <a id="change">while </a>True<a id="change">:
        </a>rec = _predict_chars(model, sp, start_string, config).data
        _valid<a id="change"> = </a>None
        try:
            if <a id="change">not line_validator</a>:
                yield gen_text(text=rec, valid=None, explain=None, delimiter=delim)
            else:
                check = line_validator(rec)
                if check is False:
                    _valid = False
                    invalid += 1
                else:
                    _valid = True
                yield gen_text(text=rec, valid=_valid, explain=None, delimiter=delim)
        except Exception as err:
            &#47&#47 logging.warning(f&quotLine failed validation: {rec} errored with {str(err)}&quot)
            invalid<a id="change"> += </a>1
            yield gen_text(text=rec, valid=False, explain=str(err), delimiter=delim)
        else:
            if line_validator and _valid:</code></pre><h3>After Change</h3><pre><code class='java'>

    num_workers, chunks = split_work(parallelism, _line_count)

    <a id="change">if num_workers == 1</a>:  &#47&#47 Sequential operation
        gen<a id="change"> = </a>Generator(settings)
        yield from gen.generate_next(_line_count)
    else:
        yield from generate_parallel(settings, num_workers, chunks)</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 4</div><BR><div id='size'>Non-data size: 7</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/gretelai/gretel-synthetics/commit/deb22ec34ee12cf49d8176c17464dea254085f39#diff-5d9f866774f7e1911a2d3b25e1bd34396327fdcbdc24a6864de3fc82ef8e9e56L36' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 16109847</div><div id='project'> Project Name: gretelai/gretel-synthetics</div><div id='commit'> Commit Name: deb22ec34ee12cf49d8176c17464dea254085f39</div><div id='time'> Time: 2020-08-04</div><div id='author'> Author: 2822367+misberner@users.noreply.github.com</div><div id='file'> File Name: src/gretel_synthetics/generate.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: generate_text(6)</div><div id='n_method'> N Method Name: generate_text(5)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: src/gretel_synthetics/generate.py</div><div id='n_file'> N File Name: src/gretel_synthetics/generate.py</div><div id='m_start'> M Start Line: 164</div><div id='m_end'> M End Line: 206</div><div id='n_start'> N Start Line: 36</div><div id='n_end'> N End Line: 113</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
	font_size = round(w / (line_count * 1.2))
	rows = h // font_size
	cols = w // font_size
	<a id="change">while </a>rows * cols &lt; len(text)<a id="change"> :
		</a>font_size<a id="change"> -= </a>1
		rows = h<a id="change"> // </a>font_size
		cols<a id="change"> = </a>w // font_size
	bgsize = int(max(font_size * 0.025, 1)) if bg else 0
	spacing_y = 0&#47&#47int(max(font_size * 0.05, 1))
	spacing_x = spacing_y</code></pre><h3>After Change</h3><pre><code class='java'>
	fg_avg = (fg[0] + fg[1] + fg[2]) / 3
	if bg :
		bg_avg = (bg[0] + bg[1] + bg[2]) / 3
		<a id="change">if abs(fg_avg - bg_avg) &lt; 40</a> :
			bg<a id="change"> = </a>None
	bgsize = int(max(font_size * 0.07, 1)) if bg else 0
	spacing_y = 0&#47&#47int(max(font_size * 0.05, 1))
	spacing_x = spacing_y</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/zyddnys/manga-image-translator/commit/605e7ecd9cf3b0a00b67fab40020c269a7bea4a3#diff-a00d57a134f11bad95204dec4abd6df6ae878f21b5826d1211aa9e4570e77203L253' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 16110032</div><div id='project'> Project Name: zyddnys/manga-image-translator</div><div id='commit'> Commit Name: 605e7ecd9cf3b0a00b67fab40020c269a7bea4a3</div><div id='time'> Time: 2021-07-26</div><div id='author'> Author: zyddnys@outlook.com</div><div id='file'> File Name: text_render.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: put_text_vertical(13)</div><div id='n_method'> N Method Name: put_text_vertical(11)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: text_render.py</div><div id='n_file'> N File Name: text_render.py</div><div id='m_start'> M Start Line: 256</div><div id='m_end'> M End Line: 289</div><div id='n_start'> N Start Line: 264</div><div id='n_end'> N End Line: 304</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        callback.on_rollout_start()
        continue_training = True

        <a id="change">while </a>should_collect_more_steps(train_freq, num_collected_steps, num_collected_episodes)<a id="change">:
            </a>done = False
            episode_reward, episode_timesteps = 0.0, 0

            while not done:

                if self.use_sde and self.sde_sample_freq &gt; 0 and num_collected_steps % self.sde_sample_freq == 0:
                    &#47&#47 Sample a new noise matrix
                    self.actor.reset_noise()

                &#47&#47 Select action randomly or according to policy
                action, buffer_action = self._sample_action(learning_starts, action_noise)

                &#47&#47 Rescale and perform action
                new_obs, reward, done, infos = env.step(action)

                self.num_timesteps += 1
                episode_timesteps<a id="change"> += </a>1
                num_collected_steps += 1

                &#47&#47 Give access to local variables
                callback.update_locals(locals())
                &#47&#47 Only stop training if return value is False, not when it is None.
                if callback.on_step() is False:
                    return RolloutReturn(0.0, num_collected_steps, num_collected_episodes, continue_training=False)

                episode_reward<a id="change"> += </a>reward

                &#47&#47 Retrieve reward and episode length if using Monitor wrapper
                self._update_info_buffer(infos, done)

                &#47&#47 Store data in replay buffer (normalized action and unnormalized observation)
                self._store_transition(replay_buffer, buffer_action, new_obs, reward, done, infos)

                self._update_current_progress_remaining(self.num_timesteps, self._total_timesteps)

                &#47&#47 For DQN, check if the target network should be updated
                &#47&#47 and update the exploration schedule
                &#47&#47 For SAC/TD3, the update is done as the same time as the gradient update
                &#47&#47 see https://github.com/hill-a/stable-baselines/issues/900
                self._on_step()

                if <a id="change">not should_collect_more_steps(train_freq, num_collected_steps, num_collected_episodes)</a>:
                    break

            if done:</code></pre><h3>After Change</h3><pre><code class='java'>
            assert train_freq.unit == TrainFrequencyUnit.STEP, "You must use only one env when doing episodic training."

        &#47&#47 Vectorize action noise if needed
        <a id="change">if </a>action_noise is not None and <a id="change">env.num_envs &gt; 1</a> and not isinstance(action_noise, VectorizedActionNoise):
            action_noise<a id="change"> = </a>VectorizedActionNoise(action_noise, env.num_envs)

        if self.use_sde:
            self.actor.reset_noise(env.num_envs)</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/dlr-rm/stable-baselines3/commit/507ed1762e62bd6c4e85ea572ba166b69116b1ac#diff-7809dfd549054549abed96b27661447862894a94e6873c67f8f96f4b6842debdL512' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 16109874</div><div id='project'> Project Name: dlr-rm/stable-baselines3</div><div id='commit'> Commit Name: 507ed1762e62bd6c4e85ea572ba166b69116b1ac</div><div id='time'> Time: 2021-12-01</div><div id='author'> Author: antonin.raffin@ensta.org</div><div id='file'> File Name: stable_baselines3/common/off_policy_algorithm.py</div><div id='m_class'> M Class Name: OffPolicyAlgorithm</div><div id='n_method'> N Class Name: OffPolicyAlgorithm</div><div id='m_method'> M Method Name: collect_rollouts(8)</div><div id='n_method'> N Method Name: collect_rollouts(8)</div><div id='m_parent_class'> M Parent Class: BaseAlgorithm</div><div id='n_parent_class'> N Parent Class: BaseAlgorithm</div><div id='m_file'> M File Name: stable_baselines3/common/off_policy_algorithm.py</div><div id='n_file'> N File Name: stable_baselines3/common/off_policy_algorithm.py</div><div id='m_start'> M Start Line: 544</div><div id='m_end'> M End Line: 619</div><div id='n_start'> N Start Line: 565</div><div id='n_end'> N End Line: 628</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
	font_size = round(h / (line_count * 1.2))
	rows = h // font_size
	cols = w // font_size
	<a id="change">while </a>rows * cols &lt; len(text)<a id="change"> :
		</a>font_size<a id="change"> -= </a>1
		rows = h<a id="change"> // </a>font_size
		cols<a id="change"> = </a>w // font_size
	bgsize = int(max(font_size * 0.025, 1)) if bg else 0
	spacing_x = 0&#47&#47int(max(font_size * 0.05, 1))
	spacing_y = spacing_x</code></pre><h3>After Change</h3><pre><code class='java'>
	fg_avg = (fg[0] + fg[1] + fg[2]) / 3
	if bg :
		bg_avg = (bg[0] + bg[1] + bg[2]) / 3
		<a id="change">if abs(fg_avg - bg_avg) &lt; 40</a> :
			bg<a id="change"> = </a>None
	bgsize = int(max(font_size * 0.07, 1)) if bg else 0
	spacing_x = 0&#47&#47int(max(font_size * 0.05, 1))
	spacing_y = spacing_x</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/zyddnys/manga-image-translator/commit/605e7ecd9cf3b0a00b67fab40020c269a7bea4a3#diff-a00d57a134f11bad95204dec4abd6df6ae878f21b5826d1211aa9e4570e77203L295' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 16110078</div><div id='project'> Project Name: zyddnys/manga-image-translator</div><div id='commit'> Commit Name: 605e7ecd9cf3b0a00b67fab40020c269a7bea4a3</div><div id='time'> Time: 2021-07-26</div><div id='author'> Author: zyddnys@outlook.com</div><div id='file'> File Name: text_render.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: put_text_horizontal(13)</div><div id='n_method'> N Method Name: put_text_horizontal(11)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: text_render.py</div><div id='n_file'> N File Name: text_render.py</div><div id='m_start'> M Start Line: 296</div><div id='m_end'> M End Line: 331</div><div id='n_start'> N Start Line: 310</div><div id='n_end'> N End Line: 350</div><BR>