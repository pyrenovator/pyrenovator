<html><h3>Pattern ID :31081
</h3><img src='91306529.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
    ret[..., 2, 2] = q00 - q11 - q22 + q33

    temp = -2 * quaternion / quaternion_norm
    jac = <a id="change">quaternion.new_zeros(</a>size<a id="change"> + </a>(<a id="change">3</a><a id="change">, 4</a>)<a id="change">)</a>
    jac[..., :, :1] = temp[..., 1:].view(size + (3, 1))
    jac[..., :, 1:] = _hat_autograd_fn(temp[..., 1:])
    jac[..., 0, 1] = -temp[..., 0]
    jac[..., 1, 2] = -temp[..., 0]</code></pre><h3>After Change</h3><pre><code class='java'>
    ret[..., 2, 2] = q00 - q11 - q22 + q33

    temp = -2 * quaternion / quaternion_norm
    jac = <a id="change">quaternion.new_zeros(</a>*size, <a id="change">3</a>, <a id="change">4</a><a id="change">)</a>
    jac[..., :, :1] = temp[..., 1:].view(*size, 3, 1)
    jac[..., :, 1:] = _hat_autograd_fn(temp[..., 1:])
    jac[..., 0, 1] = -temp[..., 0]
    jac[..., 1, 2] = -temp[..., 0]</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 5</div><BR><div id='size'>Non-data size: 4</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/facebookresearch/theseus/commit/1c490f68fe7ac48e7a29dcb129babe3a225f73b1#diff-83558085f2c82ad7c8cad66c30ce54ee61215a24b69c263efe924ee8f1660d29L736' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 91306529</div><div id='project'> Project Name: facebookresearch/theseus</div><div id='commit'> Commit Name: 1c490f68fe7ac48e7a29dcb129babe3a225f73b1</div><div id='time'> Time: 2023-05-04</div><div id='author'> Author: 6612911+fantaosha@users.noreply.github.com</div><div id='file'> File Name: theseus/labs/lie/functional/so3_impl.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: _jquaternion_to_rotation_impl(1)</div><div id='n_method'> N Method Name: _jquaternion_to_rotation_impl(1)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: theseus/labs/lie/functional/so3_impl.py</div><div id='n_file'> N File Name: theseus/labs/lie/functional/so3_impl.py</div><div id='m_start'> M Start Line: 736</div><div id='m_end'> M End Line: 767</div><div id='n_start'> N Start Line: 748</div><div id='n_end'> N End Line: 779</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
    q33 = z * z

    size = quaternion.shape[:-1]
    ret = <a id="change">quaternion.new_zeros(</a>size<a id="change"> + </a>(<a id="change">3</a><a id="change">, 3</a>)<a id="change">)</a>
    ret[..., 0, 0] = q00 + q11 - q22 - q33
    ret[..., 0, 1] = 2 * (q12 - q03)
    ret[..., 0, 2] = 2 * (q13 + q02)
    ret[..., 1, 0] = 2 * (q12 + q03)</code></pre><h3>After Change</h3><pre><code class='java'>
    q33 = z * z

    size = quaternion.shape[:-1]
    ret = <a id="change">quaternion.new_zeros(</a>*size, <a id="change">3</a>, <a id="change">3</a><a id="change">)</a>
    ret[..., 0, 0] = q00 + q11 - q22 - q33
    ret[..., 0, 1] = 2 * (q12 - q03)
    ret[..., 0, 2] = 2 * (q13 + q02)
    ret[..., 1, 0] = 2 * (q12 + q03)</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/facebookresearch/theseus/commit/1c490f68fe7ac48e7a29dcb129babe3a225f73b1#diff-83558085f2c82ad7c8cad66c30ce54ee61215a24b69c263efe924ee8f1660d29L692' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 91306528</div><div id='project'> Project Name: facebookresearch/theseus</div><div id='commit'> Commit Name: 1c490f68fe7ac48e7a29dcb129babe3a225f73b1</div><div id='time'> Time: 2023-05-04</div><div id='author'> Author: 6612911+fantaosha@users.noreply.github.com</div><div id='file'> File Name: theseus/labs/lie/functional/so3_impl.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: _quaternion_to_rotation_impl(1)</div><div id='n_method'> N Method Name: _quaternion_to_rotation_impl(1)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: theseus/labs/lie/functional/so3_impl.py</div><div id='n_file'> N File Name: theseus/labs/lie/functional/so3_impl.py</div><div id='m_start'> M Start Line: 697</div><div id='m_end'> M End Line: 715</div><div id='n_start'> N Start Line: 709</div><div id='n_end'> N End Line: 727</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
    if tangent_vector.shape[-1] == 1:
        tangent_vector = tangent_vector.squeeze(-1)
    size = tangent_vector.shape[:-1]
    matrix = <a id="change">tangent_vector.new_zeros(</a>size<a id="change"> + </a>(<a id="change">3</a><a id="change">, 3</a>)<a id="change">)</a>
    matrix[..., 0, 1] = -tangent_vector[..., 2]
    matrix[..., 0, 2] = tangent_vector[..., 1]
    matrix[..., 1, 2] = -tangent_vector[..., 0]
    matrix[..., 1, 0] = tangent_vector[..., 2]</code></pre><h3>After Change</h3><pre><code class='java'>
    if tangent_vector.shape[-1] == 1:
        tangent_vector = tangent_vector.squeeze(-1)
    size = tangent_vector.shape[:-1]
    matrix = <a id="change">tangent_vector.new_zeros(</a>*size, <a id="change">3</a>, <a id="change">3</a><a id="change">)</a>
    matrix[..., 0, 1] = -tangent_vector[..., 2]
    matrix[..., 0, 2] = tangent_vector[..., 1]
    matrix[..., 1, 2] = -tangent_vector[..., 0]
    matrix[..., 1, 0] = tangent_vector[..., 2]</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/facebookresearch/theseus/commit/1c490f68fe7ac48e7a29dcb129babe3a225f73b1#diff-83558085f2c82ad7c8cad66c30ce54ee61215a24b69c263efe924ee8f1660d29L504' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 91306531</div><div id='project'> Project Name: facebookresearch/theseus</div><div id='commit'> Commit Name: 1c490f68fe7ac48e7a29dcb129babe3a225f73b1</div><div id='time'> Time: 2023-05-04</div><div id='author'> Author: 6612911+fantaosha@users.noreply.github.com</div><div id='file'> File Name: theseus/labs/lie/functional/so3_impl.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: _hat_impl(1)</div><div id='n_method'> N Method Name: _hat_impl(1)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: theseus/labs/lie/functional/so3_impl.py</div><div id='n_file'> N File Name: theseus/labs/lie/functional/so3_impl.py</div><div id='m_start'> M Start Line: 507</div><div id='m_end'> M End Line: 509</div><div id='n_start'> N Start Line: 519</div><div id='n_end'> N End Line: 521</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
    q23 = y * z
    q33 = z * z

    ret = <a id="change">quaternion.new_zeros(</a>quaternion.shape[0], <a id="change">3</a>, <a id="change">3</a><a id="change">)</a>
    ret[:, 0, 0] = q00 + q11 - q22 - q33
    ret[:, 0, 1] = 2 * (q12 - q03)
    ret[:, 0, 2] = 2 * (q13 + q02)
    ret[:, 1, 0] = 2 * (q12 + q03)</code></pre><h3>After Change</h3><pre><code class='java'>
    q33 = z * z

    size = quaternion.shape[:-1]
    ret = <a id="change">quaternion.new_zeros(</a>size<a id="change"> + </a>(<a id="change">3</a><a id="change">, 3</a>)<a id="change">)</a>
    ret[..., 0, 0] = q00 + q11 - q22 - q33
    ret[..., 0, 1] = 2 * (q12 - q03)
    ret[..., 0, 2] = 2 * (q13 + q02)
    ret[..., 1, 0] = 2 * (q12 + q03)</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/facebookresearch/theseus/commit/6275951cff1fd0152ad84fc4f93e25cb32d9efae#diff-83558085f2c82ad7c8cad66c30ce54ee61215a24b69c263efe924ee8f1660d29L720' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 91306530</div><div id='project'> Project Name: facebookresearch/theseus</div><div id='commit'> Commit Name: 6275951cff1fd0152ad84fc4f93e25cb32d9efae</div><div id='time'> Time: 2023-05-03</div><div id='author'> Author: 6612911+fantaosha@users.noreply.github.com</div><div id='file'> File Name: theseus/labs/lie/functional/so3_impl.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: _quaternion_to_rotation_impl(1)</div><div id='n_method'> N Method Name: _quaternion_to_rotation_impl(1)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: theseus/labs/lie/functional/so3_impl.py</div><div id='n_file'> N File Name: theseus/labs/lie/functional/so3_impl.py</div><div id='m_start'> M Start Line: 725</div><div id='m_end'> M End Line: 751</div><div id='n_start'> N Start Line: 697</div><div id='n_end'> N End Line: 724</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
&#47&#47 -----------------------------------------------------------------------------
def _hat_impl(tangent_vector: torch.Tensor) -&gt; torch.Tensor:
    check_tangent_vector(tangent_vector)
    matrix = <a id="change">tangent_vector.new_zeros(</a>tangent_vector.shape[0], <a id="change">3</a>, <a id="change">3</a><a id="change">)</a>
    matrix[..., 0, 1] = -tangent_vector[..., 2].view(-1)
    matrix[..., 0, 2] = tangent_vector[..., 1].view(-1)
    matrix[..., 1, 2] = -tangent_vector[..., 0].view(-1)
    matrix[..., 1, 0] = tangent_vector[..., 2].view(-1)</code></pre><h3>After Change</h3><pre><code class='java'>
    if tangent_vector.shape[-1] == 1:
        tangent_vector = tangent_vector.squeeze(-1)
    size = tangent_vector.shape[:-1]
    matrix = <a id="change">tangent_vector.new_zeros(</a>size<a id="change"> + </a>(<a id="change">3</a><a id="change">, 3</a>)<a id="change">)</a>
    matrix[..., 0, 1] = -tangent_vector[..., 2]
    matrix[..., 0, 2] = tangent_vector[..., 1]
    matrix[..., 1, 2] = -tangent_vector[..., 0]
    matrix[..., 1, 0] = tangent_vector[..., 2]</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/facebookresearch/theseus/commit/6275951cff1fd0152ad84fc4f93e25cb32d9efae#diff-83558085f2c82ad7c8cad66c30ce54ee61215a24b69c263efe924ee8f1660d29L537' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 91306516</div><div id='project'> Project Name: facebookresearch/theseus</div><div id='commit'> Commit Name: 6275951cff1fd0152ad84fc4f93e25cb32d9efae</div><div id='time'> Time: 2023-05-03</div><div id='author'> Author: 6612911+fantaosha@users.noreply.github.com</div><div id='file'> File Name: theseus/labs/lie/functional/so3_impl.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: _hat_impl(1)</div><div id='n_method'> N Method Name: _hat_impl(1)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: theseus/labs/lie/functional/so3_impl.py</div><div id='n_file'> N File Name: theseus/labs/lie/functional/so3_impl.py</div><div id='m_start'> M Start Line: 539</div><div id='m_end'> M End Line: 545</div><div id='n_start'> N Start Line: 506</div><div id='n_end'> N End Line: 515</div><BR>