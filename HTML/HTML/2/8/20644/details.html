<html><h3>Pattern ID :20644
</h3><img src='66498724.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
            b=+embeddings_init_bound,
        )

        norms<a id="change"> = </a><a id="change">torch.norm(</a>self.relation_embeddings.weight<a id="change">, p=2, dim=1)</a>.data
        self.relation_embeddings.weight.data<a id="change"> = </a><a id="change">self.relation_embeddings.weight.data.div(
            norms.view(self.num_relations, 1).expand_as(</a>self.relation_embeddings.weight<a id="change">)</a><a id="change">,
        )</a>

    def apply_forward_constraints(self):
        &#47&#47 Normalize embeddings of entities
        functional.normalize(self.entity_embeddings.weight.data, out=self.entity_embeddings.weight.data)</code></pre><h3>After Change</h3><pre><code class='java'>
        )

        &#47&#47 Initialise relation embeddings to unit length
        <a id="change">functional.normalize(</a>self.relation_embeddings.weight.data<a id="change">, out=self.relation_embeddings.weight.data)</a>

    def apply_forward_constraints(self):
        &#47&#47 Normalize embeddings of entities
        functional.normalize(self.entity_embeddings.weight.data, out=self.entity_embeddings.weight.data)</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 8</div><BR><div id='size'>Non-data size: 7</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/pykeen/pykeen/commit/a207f9ec5f05f8a12706d9055426ed944fa217e5#diff-4865434c43e813165bfde432849e6f263dcaab87d65c0a4fbb7cf4d07d784b91L61' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 66498724</div><div id='project'> Project Name: pykeen/pykeen</div><div id='commit'> Commit Name: a207f9ec5f05f8a12706d9055426ed944fa217e5</div><div id='time'> Time: 2019-07-23</div><div id='author'> Author: berrendorf@dbs.ifi.lmu.de</div><div id='file'> File Name: src/poem/models/unimodal/distmult.py</div><div id='m_class'> M Class Name: DistMult</div><div id='n_method'> N Class Name: DistMult</div><div id='m_method'> M Method Name: _init_embeddings(1)</div><div id='n_method'> N Method Name: _init_embeddings(1)</div><div id='m_parent_class'> M Parent Class: BaseModule</div><div id='n_parent_class'> N Parent Class: BaseModule</div><div id='m_file'> M File Name: src/poem/models/unimodal/distmult.py</div><div id='n_file'> N File Name: src/poem/models/unimodal/distmult.py</div><div id='m_start'> M Start Line: 61</div><div id='m_end'> M End Line: 78</div><div id='n_start'> N Start Line: 76</div><div id='n_end'> N End Line: 76</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        )

    def apply_forward_constraints(self):
        norms<a id="change"> = </a><a id="change">torch.norm(</a>self.entity_embeddings.weight<a id="change">, p=2, dim=1)</a>.data
        self.entity_embeddings.weight.data<a id="change"> = </a><a id="change">self.entity_embeddings.weight.data.div(
            norms.view(self.num_entities, 1).expand_as(</a>self.entity_embeddings.weight<a id="change">)</a><a id="change">,
        )</a>
        self.forward_constraint_applied = True

    def forward_owa(self, triples):
        if not self.forward_constraint_applied:</code></pre><h3>After Change</h3><pre><code class='java'>
        )

    def apply_forward_constraints(self):
        <a id="change">functional.normalize(</a>self.entity_embeddings.weight.data<a id="change">, out=self.entity_embeddings.weight.data)</a>
        self.forward_constraint_applied = True

    def forward_owa(self, triples):
        if not self.forward_constraint_applied:</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/pykeen/pykeen/commit/f13843b629def1d12c05f9406c9db0c29a3020b7#diff-bcbe9bc7a97e915feb60100152ed00d26038b10eb6b7684e6de101adf06e766eL84' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 66498722</div><div id='project'> Project Name: pykeen/pykeen</div><div id='commit'> Commit Name: f13843b629def1d12c05f9406c9db0c29a3020b7</div><div id='time'> Time: 2019-07-18</div><div id='author'> Author: berrendorf@dbs.ifi.lmu.de</div><div id='file'> File Name: src/poem/models/unimodal/trans_e.py</div><div id='m_class'> M Class Name: TransE</div><div id='n_method'> N Class Name: TransE</div><div id='m_method'> M Method Name: apply_forward_constraints(1)</div><div id='n_method'> N Method Name: apply_forward_constraints(1)</div><div id='m_parent_class'> M Parent Class: BaseModule</div><div id='n_parent_class'> N Parent Class: BaseModule</div><div id='m_file'> M File Name: src/poem/models/unimodal/trans_e.py</div><div id='n_file'> N File Name: src/poem/models/unimodal/trans_e.py</div><div id='m_start'> M Start Line: 85</div><div id='m_end'> M End Line: 88</div><div id='n_start'> N Start Line: 86</div><div id='n_end'> N End Line: 86</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>

    def apply_forward_constraints(self):
        &#47&#47 Normalise embeddings of entities
        norms<a id="change"> = </a><a id="change">torch.norm(</a>self.entity_embeddings.weight<a id="change">, p=2, dim=1)</a>.data
        self.entity_embeddings.weight.data<a id="change"> = </a><a id="change">self.entity_embeddings.weight.data.div(
            norms.view(self.num_entities, 1).expand_as(</a>self.entity_embeddings.weight<a id="change">)</a><a id="change">,
        )</a>
        self.forward_constraint_applied = True

    def forward_owa(self, triples):
        if not self.forward_constraint_applied:</code></pre><h3>After Change</h3><pre><code class='java'>

    def apply_forward_constraints(self):
        &#47&#47 Normalise embeddings of entities
        <a id="change">functional.normalize(</a>self.entity_embeddings.weight.data<a id="change">, out=self.entity_embeddings.weight.data)</a>
        self.forward_constraint_applied = True

    def forward_owa(self, triples):
        if not self.forward_constraint_applied:</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/pykeen/pykeen/commit/f13843b629def1d12c05f9406c9db0c29a3020b7#diff-31693468ce8f4163ed07592e01cc06d9c5017a02d66852e7498e4f546281e68dL88' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 66498723</div><div id='project'> Project Name: pykeen/pykeen</div><div id='commit'> Commit Name: f13843b629def1d12c05f9406c9db0c29a3020b7</div><div id='time'> Time: 2019-07-18</div><div id='author'> Author: berrendorf@dbs.ifi.lmu.de</div><div id='file'> File Name: src/poem/models/unimodal/structured_embedding.py</div><div id='m_class'> M Class Name: StructuredEmbedding</div><div id='n_method'> N Class Name: StructuredEmbedding</div><div id='m_method'> M Method Name: apply_forward_constraints(1)</div><div id='n_method'> N Method Name: apply_forward_constraints(1)</div><div id='m_parent_class'> M Parent Class: BaseModule</div><div id='n_parent_class'> N Parent Class: BaseModule</div><div id='m_file'> M File Name: src/poem/models/unimodal/structured_embedding.py</div><div id='n_file'> N File Name: src/poem/models/unimodal/structured_embedding.py</div><div id='m_start'> M Start Line: 90</div><div id='m_end'> M End Line: 93</div><div id='n_start'> N Start Line: 91</div><div id='n_end'> N End Line: 91</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
            b=relation_embeddings_init_bound,
        )

        norms<a id="change"> = </a><a id="change">torch.norm(</a>self.relation_embeddings.weight<a id="change">, p=2, dim=1)</a>.data
        self.relation_embeddings.weight.data<a id="change"> = </a><a id="change">self.relation_embeddings.weight.data.div(
            norms.view(self.num_relations, 1).expand_as(</a>self.relation_embeddings.weight<a id="change">)</a><a id="change">,
        )</a>

    def _project_entities(self, entity_embs, projection_matrix_embs):
        projected_entity_embs = torch.einsum(&quotnk,nkd-&gt;nd&quot, [entity_embs, projection_matrix_embs])
        projected_entity_embs = torch.clamp(projected_entity_embs, max=1.)</code></pre><h3>After Change</h3><pre><code class='java'>
        )

        &#47&#47 Initialise relation embeddings to unit length
        <a id="change">functional.normalize(</a>self.relation_embeddings.weight.data<a id="change">, out=self.relation_embeddings.weight.data)</a>

    def _project_entities(self, entity_embs, projection_matrix_embs):
        projected_entity_embs = torch.einsum(&quotnk,nkd-&gt;nd&quot, [entity_embs, projection_matrix_embs])
        projected_entity_embs = torch.clamp(projected_entity_embs, max=1.)</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/pykeen/pykeen/commit/a207f9ec5f05f8a12706d9055426ed944fa217e5#diff-a10ab784ece2a2ce81f9cd64d1af60d76cb7765d79fc917fdae8aa447e1a2adfL75' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 66498720</div><div id='project'> Project Name: pykeen/pykeen</div><div id='commit'> Commit Name: a207f9ec5f05f8a12706d9055426ed944fa217e5</div><div id='time'> Time: 2019-07-23</div><div id='author'> Author: berrendorf@dbs.ifi.lmu.de</div><div id='file'> File Name: src/poem/models/unimodal/trans_r.py</div><div id='m_class'> M Class Name: TransR</div><div id='n_method'> N Class Name: TransR</div><div id='m_method'> M Method Name: _init_embeddings(1)</div><div id='n_method'> N Method Name: _init_embeddings(1)</div><div id='m_parent_class'> M Parent Class: BaseModule</div><div id='n_parent_class'> N Parent Class: BaseModule</div><div id='m_file'> M File Name: src/poem/models/unimodal/trans_r.py</div><div id='n_file'> N File Name: src/poem/models/unimodal/trans_r.py</div><div id='m_start'> M Start Line: 78</div><div id='m_end'> M End Line: 103</div><div id='n_start'> N Start Line: 102</div><div id='n_end'> N End Line: 102</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>

    def apply_forward_constraints(self):
        &#47&#47 Normalise the normal vectors by their l2 norms
        norms<a id="change"> = </a><a id="change">torch.norm(</a>self.normal_vector_embeddings.weight<a id="change">, p=2, dim=1)</a>.data
        self.normal_vector_embeddings.weight.data<a id="change"> = </a><a id="change">self.normal_vector_embeddings.weight.data.div(
            norms.view(self.num_relations, 1).expand_as(</a>self.normal_vector_embeddings.weight<a id="change">)</a><a id="change">,
        )</a>
        self.forward_constraint_applied = True
</code></pre><h3>After Change</h3><pre><code class='java'>

    def apply_forward_constraints(self):
        &#47&#47 Normalise the normal vectors by their l2 norms
        <a id="change">functional.normalize(</a>self.normal_vector_embeddings.weight.data<a id="change">, out=self.normal_vector_embeddings.weight.data)</a>
        self.forward_constraint_applied = True
</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/pykeen/pykeen/commit/f13843b629def1d12c05f9406c9db0c29a3020b7#diff-87ab5712103752cf76a9c8485bb43be323153016708b4c745ea7187e0cba5410L151' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 66498721</div><div id='project'> Project Name: pykeen/pykeen</div><div id='commit'> Commit Name: f13843b629def1d12c05f9406c9db0c29a3020b7</div><div id='time'> Time: 2019-07-18</div><div id='author'> Author: berrendorf@dbs.ifi.lmu.de</div><div id='file'> File Name: src/poem/models/unimodal/trans_h.py</div><div id='m_class'> M Class Name: TransH</div><div id='n_method'> N Class Name: TransH</div><div id='m_method'> M Method Name: apply_forward_constraints(1)</div><div id='n_method'> N Method Name: apply_forward_constraints(1)</div><div id='m_parent_class'> M Parent Class: BaseModule</div><div id='n_parent_class'> N Parent Class: BaseModule</div><div id='m_file'> M File Name: src/poem/models/unimodal/trans_h.py</div><div id='n_file'> N File Name: src/poem/models/unimodal/trans_h.py</div><div id='m_start'> M Start Line: 153</div><div id='m_end'> M End Line: 156</div><div id='n_start'> N Start Line: 154</div><div id='n_end'> N End Line: 154</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
            b=+embeddings_init_bound,
        )

        norms<a id="change"> = </a><a id="change">torch.norm(</a>self.relation_embeddings.weight<a id="change">, p=2, dim=1)</a>.data
        self.relation_embeddings.weight.data<a id="change"> = </a><a id="change">self.relation_embeddings.weight.data.div(
            norms.view(self.num_relations, 1).expand_as(</a>self.relation_embeddings.weight<a id="change">)</a><a id="change">,
        )</a>

    def apply_forward_constraints(self):
        functional.normalize(self.entity_embeddings.weight.data, out=self.entity_embeddings.weight.data)
        self.forward_constraint_applied = True</code></pre><h3>After Change</h3><pre><code class='java'>
        )

        &#47&#47 Initialise relation embeddings to unit length
        <a id="change">functional.normalize(</a>self.relation_embeddings.weight.data<a id="change">, out=self.relation_embeddings.weight.data)</a>

    def apply_forward_constraints(self):
        functional.normalize(self.entity_embeddings.weight.data, out=self.entity_embeddings.weight.data)
        self.forward_constraint_applied = True</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/pykeen/pykeen/commit/a207f9ec5f05f8a12706d9055426ed944fa217e5#diff-bcbe9bc7a97e915feb60100152ed00d26038b10eb6b7684e6de101adf06e766eL64' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 66498718</div><div id='project'> Project Name: pykeen/pykeen</div><div id='commit'> Commit Name: a207f9ec5f05f8a12706d9055426ed944fa217e5</div><div id='time'> Time: 2019-07-23</div><div id='author'> Author: berrendorf@dbs.ifi.lmu.de</div><div id='file'> File Name: src/poem/models/unimodal/trans_e.py</div><div id='m_class'> M Class Name: TransE</div><div id='n_method'> N Class Name: TransE</div><div id='m_method'> M Method Name: _init_embeddings(1)</div><div id='n_method'> N Method Name: _init_embeddings(1)</div><div id='m_parent_class'> M Parent Class: BaseModule</div><div id='n_parent_class'> N Parent Class: BaseModule</div><div id='m_file'> M File Name: src/poem/models/unimodal/trans_e.py</div><div id='n_file'> N File Name: src/poem/models/unimodal/trans_e.py</div><div id='m_start'> M Start Line: 66</div><div id='m_end'> M End Line: 82</div><div id='n_start'> N Start Line: 80</div><div id='n_end'> N End Line: 80</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>

    def apply_forward_constraints(self):
        &#47&#47 Normalize embeddings of entities
        norms<a id="change"> = </a><a id="change">torch.norm(</a>self.entity_embeddings.weight<a id="change">, p=2, dim=1)</a>.data
        self.entity_embeddings.weight.data<a id="change"> = </a><a id="change">self.entity_embeddings.weight.data.div(
            norms.view(self.num_entities, 1).expand_as(</a>self.entity_embeddings.weight<a id="change">)</a><a id="change">,
        )</a>
        self.forward_constraint_applied = True

    def forward_owa(self, triples):
        if not self.forward_constraint_applied:</code></pre><h3>After Change</h3><pre><code class='java'>

    def apply_forward_constraints(self):
        &#47&#47 Normalize embeddings of entities
        <a id="change">functional.normalize(</a>self.entity_embeddings.weight.data<a id="change">, out=self.entity_embeddings.weight.data)</a>
        self.forward_constraint_applied = True

    def forward_owa(self, triples):
        if not self.forward_constraint_applied:</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/pykeen/pykeen/commit/f13843b629def1d12c05f9406c9db0c29a3020b7#diff-4865434c43e813165bfde432849e6f263dcaab87d65c0a4fbb7cf4d07d784b91L80' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 66498719</div><div id='project'> Project Name: pykeen/pykeen</div><div id='commit'> Commit Name: f13843b629def1d12c05f9406c9db0c29a3020b7</div><div id='time'> Time: 2019-07-18</div><div id='author'> Author: berrendorf@dbs.ifi.lmu.de</div><div id='file'> File Name: src/poem/models/unimodal/distmult.py</div><div id='m_class'> M Class Name: DistMult</div><div id='n_method'> N Class Name: DistMult</div><div id='m_method'> M Method Name: apply_forward_constraints(1)</div><div id='n_method'> N Method Name: apply_forward_constraints(1)</div><div id='m_parent_class'> M Parent Class: BaseModule</div><div id='n_parent_class'> N Parent Class: BaseModule</div><div id='m_file'> M File Name: src/poem/models/unimodal/distmult.py</div><div id='n_file'> N File Name: src/poem/models/unimodal/distmult.py</div><div id='m_start'> M Start Line: 82</div><div id='m_end'> M End Line: 85</div><div id='n_start'> N Start Line: 83</div><div id='n_end'> N End Line: 83</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>

        &#47&#47 FIXME @mehdi why aren&quott the right relation embeddings initialized?

        norms<a id="change"> = </a><a id="change">torch.norm(</a>self.left_relation_embeddings.weight<a id="change">, p=2, dim=1)</a>.data
        self.left_relation_embeddings.weight.data<a id="change"> = </a><a id="change">self.left_relation_embeddings.weight.data.div(
            norms.view(self.num_relations, 1).expand_as(</a>self.left_relation_embeddings.weight<a id="change">)</a><a id="change">,
        )</a>

    def apply_forward_constraints(self):
        &#47&#47 Normalise embeddings of entities
        functional.normalize(self.entity_embeddings.weight.data, out=self.entity_embeddings.weight.data)</code></pre><h3>After Change</h3><pre><code class='java'>
        &#47&#47 FIXME @mehdi why aren&quott the right relation embeddings initialized?

        &#47&#47 Initialise left relation embeddings to unit length
        <a id="change">functional.normalize(</a>self.left_relation_embeddings.weight.data<a id="change">, out=self.left_relation_embeddings.weight.data)</a>

    def apply_forward_constraints(self):
        &#47&#47 Normalise embeddings of entities
        functional.normalize(self.entity_embeddings.weight.data, out=self.entity_embeddings.weight.data)</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/pykeen/pykeen/commit/a207f9ec5f05f8a12706d9055426ed944fa217e5#diff-31693468ce8f4163ed07592e01cc06d9c5017a02d66852e7498e4f546281e68dL64' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 66498717</div><div id='project'> Project Name: pykeen/pykeen</div><div id='commit'> Commit Name: a207f9ec5f05f8a12706d9055426ed944fa217e5</div><div id='time'> Time: 2019-07-23</div><div id='author'> Author: berrendorf@dbs.ifi.lmu.de</div><div id='file'> File Name: src/poem/models/unimodal/structured_embedding.py</div><div id='m_class'> M Class Name: StructuredEmbedding</div><div id='n_method'> N Class Name: StructuredEmbedding</div><div id='m_method'> M Method Name: _init_embeddings(1)</div><div id='n_method'> N Method Name: _init_embeddings(1)</div><div id='m_parent_class'> M Parent Class: BaseModule</div><div id='n_parent_class'> N Parent Class: BaseModule</div><div id='m_file'> M File Name: src/poem/models/unimodal/structured_embedding.py</div><div id='n_file'> N File Name: src/poem/models/unimodal/structured_embedding.py</div><div id='m_start'> M Start Line: 66</div><div id='m_end'> M End Line: 86</div><div id='n_start'> N Start Line: 84</div><div id='n_end'> N End Line: 84</div><BR>