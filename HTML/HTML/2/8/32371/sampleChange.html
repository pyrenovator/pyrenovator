<link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
                                                   moving_variance_initializer=&quotones&quot)(conv, training=False)
        relu = tf.nn.relu(bn)

        model<a id="change"> = </a>tf.keras.Model(inputs=inputs, outputs=relu)

        np.random.seed(0)
        w_shape = model._layers[0].input.shape
        numpy_data = np.random.rand(1, w_shape[1], w_shape[2], w_shape[3]).astype(np.float32)
        baseline_output = model(numpy_data)

        <a id="change">fold_all_batch_norms(</a>model<a id="change">)</a>

        output_after_fold = model(numpy_data)

        <a id="change">self.assertFalse(</a>np.allclose(baseline_output, output_after_fold, atol=0)<a id="change">)</a>
        <a id="change">self.assertTrue(</a>np.allclose(baseline_output, output_after_fold, atol=1e-4)<a id="change">)</a>

    def test_bn_fold_with_linear_layer(self):
        
        Custom Model where BN layer is followed by Dense layer</code></pre><h3>After Change</h3><pre><code class='java'>
                                                       moving_variance_initializer=&quotones&quot)(conv, training=False)
            relu = tf.nn.relu(bn)

            model<a id="change"> = </a>tf.keras.Model(inputs=inputs, outputs=relu)

            np.random.seed(0)
            w_shape = model._layers[0].input.shape
            numpy_data = np.random.rand(1, w_shape[1], w_shape[2], w_shape[3]).astype(np.float32)
            baseline_output = model(numpy_data)

            <a id="change">fold_all_batch_norms(</a>model<a id="change">)</a>

            output_after_fold = model(numpy_data)

            <a id="change">self.assertFalse(</a>np.allclose(baseline_output, output_after_fold, atol=0)<a id="change">)</a>
            <a id="change">self.assertTrue(</a>np.allclose(baseline_output, output_after_fold, atol=1e-4)<a id="change">)</a>

    def test_bn_fold_with_linear_layer(self):
        
        Custom Model where BN layer is followed by Dense layer</code></pre>