<html><h3>Pattern ID :15056
</h3><img src='50520578.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
            op, j = genotype[k]
            if j == 0:
                u = &quotc_{k-2}&quot
            elif <a id="change">j == 1</a>:
                u = &quotc_{k-1}&quot
            else:
                u<a id="change"> = </a>str(j-2)
            v<a id="change"> = </a>str(i)
            g.edge(u, v, label=op, fillcolor=&quotgray&quot)

    g.node(&quotc_{k}&quot, fillcolor=&quotpalegoldenrod&quot)</code></pre><h3>After Change</h3><pre><code class='java'>
                g.edge(xs[x_i], str(i))
                g.edge(str(i),&quotadd&quot+str(node))
                i += 1
        xs.append(<a id="change">&quotadd&quot</a><a id="change">+</a><a id="change">str(</a>node<a id="change">)</a>)
        
    g.node(&quotconcat&quot, label=&quotC&quot, fillcolor=&quotpalegoldenrod&quot)
    for name in xs[-3:]:</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 4</div><BR><div id='size'>Non-data size: 6</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/woodywff/nas_3d_unet/commit/a545a3bf9ef55ec3f9d7881f84079f44027753e6#diff-38a8c5358d8bcad31aafbfd0c7db8c8edeb23a4b2162eb9e835438d204a20913L31' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 50520578</div><div id='project'> Project Name: woodywff/nas_3d_unet</div><div id='commit'> Commit Name: a545a3bf9ef55ec3f9d7881f84079f44027753e6</div><div id='time'> Time: 2020-04-07</div><div id='author'> Author: woodywff@aliyun.com</div><div id='file'> File Name: helper.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: visualize(4)</div><div id='n_method'> N Method Name: visualize(4)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: helper.py</div><div id='n_file'> N File Name: helper.py</div><div id='m_start'> M Start Line: 31</div><div id='m_end'> M End Line: 70</div><div id='n_start'> N Start Line: 34</div><div id='n_end'> N End Line: 71</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
    for i in range(steps):
        g.node(str(i), fillcolor=&quotlightblue&quot)

    for <a id="change">i</a> in range(steps):
        for k in [2*i, 2*i+1]:
            op, j = genotype[k]
            if j == 0:
                u<a id="change"> = </a>&quotc_{k-2}&quot
            elif <a id="change">j == 1</a>:
                u = &quotc_{k-1}&quot
            else:
                u<a id="change"> = </a>str(j-2)
            v = str(i)
            g.edge(u, v, label=op, fillcolor=&quotgray&quot)
</code></pre><h3>After Change</h3><pre><code class='java'>
                g.edge(xs[x_i], str(i))
                g.edge(str(i),&quotadd&quot+str(node))
                i += 1
        xs.append(<a id="change">&quotadd&quot</a><a id="change">+</a><a id="change">str(</a>node<a id="change">)</a>)
        
    g.node(&quotconcat&quot, label=&quotC&quot, fillcolor=&quotpalegoldenrod&quot)
    for name in xs[-3:]:</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/woodywff/nas_3d_unet/commit/a545a3bf9ef55ec3f9d7881f84079f44027753e6#diff-38a8c5358d8bcad31aafbfd0c7db8c8edeb23a4b2162eb9e835438d204a20913L29' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 50520576</div><div id='project'> Project Name: woodywff/nas_3d_unet</div><div id='commit'> Commit Name: a545a3bf9ef55ec3f9d7881f84079f44027753e6</div><div id='time'> Time: 2020-04-07</div><div id='author'> Author: woodywff@aliyun.com</div><div id='file'> File Name: helper.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: visualize(4)</div><div id='n_method'> N Method Name: visualize(4)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: helper.py</div><div id='n_file'> N File Name: helper.py</div><div id='m_start'> M Start Line: 31</div><div id='m_end'> M End Line: 70</div><div id='n_start'> N Start Line: 34</div><div id='n_end'> N End Line: 71</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
  def expr(self):
    ret = [f"{self.offset}"] if self.offset != 0 else []
    acc = 1
    for <a id="change">i</a>,(d,s) in enumerate(self.shape_strides[::-1]):
      <a id="change">if </a>d != 1 and <a id="change">s != 0</a>:
        lr<a id="change"> = </a>divmodidx(acc, d, i != len(self.shape_strides)-1 and d != prod(self.shape))
        lr = f"({lr}*{s})" if s != 1 else lr
        ret.append(lr)
      acc<a id="change"> *= </a>d
    return &quotidx=&quot + (&quot+&quot.join(ret) if len(ret) &gt; 0 else "0")

  &#47&#47 generate an expression if you have a variable or expression for each index</code></pre><h3>After Change</h3><pre><code class='java'>

  @functools.cached_property
  def expr(self):
    return <a id="change">&quotidx=&quot</a><a id="change"> + </a><a id="change">str(</a>self.expr_node(Variable(&quotidx&quot, 0, prod([x[0] for x in self.shape_strides])-1))<a id="change">)</a>

  &#47&#47 generate an expression if you have a variable or expression for each index
  def expr_idxs(self, idxs):
    return Variable.sum([Variable.num(self.offset)] + [Variable(idxs[i], 0, sh-1)*st for i,(sh,st) in enumerate(zip(self.shape, self.strides)) if sh != 1 and st != 0])</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/geohot/tinygrad/commit/2b47ee401f8e5e187b2ce048a59b0d70fc93de49#diff-11e06225c072e5ae917d1e5883dec7c8de89c310442a8960607eb591f7168d96L38' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 50520529</div><div id='project'> Project Name: geohot/tinygrad</div><div id='commit'> Commit Name: 2b47ee401f8e5e187b2ce048a59b0d70fc93de49</div><div id='time'> Time: 2023-01-19</div><div id='author'> Author: 72895+geohot@users.noreply.github.com</div><div id='file'> File Name: tinygrad/shapetracker.py</div><div id='m_class'> M Class Name: View</div><div id='n_method'> N Class Name: View</div><div id='m_method'> M Method Name: expr(1)</div><div id='n_method'> N Method Name: expr(1)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: tinygrad/shapetracker.py</div><div id='n_file'> N File Name: tinygrad/shapetracker.py</div><div id='m_start'> M Start Line: 39</div><div id='m_end'> M End Line: 47</div><div id='n_start'> N Start Line: 45</div><div id='n_end'> N End Line: 45</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
    with torch.no_grad():
      _, outs = model(xes, training=False)
      a = nn.Softmax()(outs)
    for <a id="change">ii</a> in range(len(outs)):
      total<a id="change"> += </a>1
      <a id="change">if outs[ii].tolist().index(max(outs[ii])) == y_batch[ii]</a>:
        correct<a id="change"> += </a>1
      pts.append([a[ii][1], y_batch[ii]])
  print((float(correct)/total))
  if auprc:</code></pre><h3>After Change</h3><pre><code class='java'>
    print("acc: "+str(accuracy_score(true, pred)))
    return accuracy_score(true, pred)
  elif task == "multilabel":
    print(<a id="change">" f1_micro: "</a><a id="change">+</a><a id="change">str(</a>f1_score(true, pred, average="micro")<a id="change">)</a>+\
        " f1_macro: "+str(f1_score(true, pred, average="macro")))
    return f1_score(true, pred, average="micro"), f1_score(true, pred, average="macro")
</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/pliang279/multibench/commit/08e57215227c5575c74f7942e287340eb5e50eb7#diff-328705d89964545233518bba0c6d09aacc4a473df36c6e5b9b3f14e0d2c24af5L84' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 50520587</div><div id='project'> Project Name: pliang279/multibench</div><div id='commit'> Commit Name: 08e57215227c5575c74f7942e287340eb5e50eb7</div><div id='time'> Time: 2021-06-06</div><div id='author'> Author: ztwu_nil@zju.edu.cn</div><div id='file'> File Name: training_structures/MFM.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: test_MFM(4)</div><div id='n_method'> N Method Name: test_MFM(3)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: training_structures/MFM.py</div><div id='n_file'> N File Name: training_structures/MFM.py</div><div id='m_start'> M Start Line: 85</div><div id='m_end'> M End Line: 103</div><div id='n_start'> N Start Line: 115</div><div id='n_end'> N End Line: 144</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
    with torch.no_grad():
      _, outs = model(xes, training=False)
      a = nn.Softmax()(outs)
    for <a id="change">ii</a> in range(len(outs)):
      total<a id="change"> += </a>1
      <a id="change">if outs[ii].tolist().index(max(outs[ii])) == y_batch[ii]</a>:
        correct<a id="change"> += </a>1
      pts.append([a[ii][1], y_batch[ii]])
  print((float(correct)/total))
  if auprc:</code></pre><h3>After Change</h3><pre><code class='java'>
  if auprc:
    print(AUPRC(pts))
  if task == "classification":
    print(<a id="change">"acc: "</a><a id="change">+</a><a id="change">str(</a>accuracy_score(true, pred)<a id="change">)</a>)
    return accuracy_score(true, pred)
  elif task == "multilabel":
    print(" f1_micro: "+str(f1_score(true, pred, average="micro"))+\</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/pliang279/multibench/commit/e8df377596458671f3a074b2f5d41a118b3fe6ae#diff-328705d89964545233518bba0c6d09aacc4a473df36c6e5b9b3f14e0d2c24af5L84' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 50520591</div><div id='project'> Project Name: pliang279/multibench</div><div id='commit'> Commit Name: e8df377596458671f3a074b2f5d41a118b3fe6ae</div><div id='time'> Time: 2021-06-06</div><div id='author'> Author: ztwu_nil@zju.edu.cn</div><div id='file'> File Name: training_structures/MFM.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: test_MFM(4)</div><div id='n_method'> N Method Name: test_MFM(3)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: training_structures/MFM.py</div><div id='n_file'> N File Name: training_structures/MFM.py</div><div id='m_start'> M Start Line: 85</div><div id='m_end'> M End Line: 103</div><div id='n_start'> N Start Line: 115</div><div id='n_end'> N End Line: 144</div><BR>