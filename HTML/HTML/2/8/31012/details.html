<html><h3>Pattern ID :31012
</h3><img src='91073145.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
class ContainerMeta(type):
    def __new__(cls, name, bases, dict):
        assert "_reverse_lookup" not in dict
        <a id="change">dict["_reverse_lookup"]</a> = {value: key for key, value in dict.items()}
        &#47&#47 Check that all values are unique
        assert (
            len(dict) == len(dict["_reverse_lookup"]) + 1</code></pre><h3>After Change</h3><pre><code class='java'>
        _dict = {}
        _reverse_lookup = {}
        i = 0
        <a id="change">for </a>key, value in dict.items()<a id="change">:
            </a><a id="change">if </a><a id="change">key.startswith("__"</a><a id="change">)</a> and key.endswith("__"):
                _dict[key] = value
            else:
                <a id="change">_dict[key]</a><a id="change"> = </a>i
                _reverse_lookup[i] = value
                i += 1
        _dict["_reverse_lookup"] = _reverse_lookup</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 6</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/patrick-kidger/diffrax/commit/f2a568e33ce330289f8aff46dca257f1f6861cb7#diff-bdc71a460a5233a45b99359a2b7976d5368510fc449bb159fb2619f958b77220L20' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 91073145</div><div id='project'> Project Name: patrick-kidger/diffrax</div><div id='commit'> Commit Name: f2a568e33ce330289f8aff46dca257f1f6861cb7</div><div id='time'> Time: 2021-08-16</div><div id='author'> Author: 33688385+patrick-kidger@users.noreply.github.com</div><div id='file'> File Name: diffrax/misc/misc.py</div><div id='m_class'> M Class Name: ContainerMeta</div><div id='n_method'> N Class Name: ContainerMeta</div><div id='m_method'> M Method Name: __new__(4)</div><div id='n_method'> N Method Name: __new__(4)</div><div id='m_parent_class'> M Parent Class: type</div><div id='n_parent_class'> N Parent Class: type</div><div id='m_file'> M File Name: diffrax/misc/misc.py</div><div id='n_file'> N File Name: diffrax/misc/misc.py</div><div id='m_start'> M Start Line: 20</div><div id='m_end'> M End Line: 25</div><div id='n_start'> N Start Line: 20</div><div id='n_end'> N End Line: 31</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
    if list(state_dict.keys())[0].startswith("module."):
        state_dict = {k[7:]: v for k, v in checkpoint["state_dict"].items()}
    if list(state_dict.keys())[0].startswith("model."):
        state_dict = {k[6:]: v for k, v in <a id="change">checkpoint["state_dict"]</a>.items()}

    model_state_dict = (
        model.module.state_dict() if hasattr(model, "module") else model.state_dict()</code></pre><h3>After Change</h3><pre><code class='java'>

def load_model_weight(model, checkpoint, logger):
    state_dict = checkpoint["state_dict"].copy()
    <a id="change">for </a>k in checkpoint["state_dict"]<a id="change">:
        &#47&#47 convert average model weights
        </a><a id="change">if </a><a id="change">k.startswith("avg_model."</a><a id="change">)</a>:
            v = state_dict.pop(k)
            <a id="change">state_dict[k[4:]]</a><a id="change"> = </a>v
    &#47&#47 strip prefix of state_dict
    if list(state_dict.keys())[0].startswith("module."):
        state_dict = {k[7:]: v for k, v in state_dict.items()}</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/rangilyu/nanodet/commit/5967031aebaae62627a4f7606499bcd2ac310981#diff-af0a7481341b7336f79d66ce8dc32894e1755e28d22feb9ae2cf53e4417443daL24' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 91073144</div><div id='project'> Project Name: rangilyu/nanodet</div><div id='commit'> Commit Name: 5967031aebaae62627a4f7606499bcd2ac310981</div><div id='time'> Time: 2021-12-23</div><div id='author'> Author: lyuchqi@gmail.com</div><div id='file'> File Name: nanodet/util/check_point.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: load_model_weight(3)</div><div id='n_method'> N Method Name: load_model_weight(3)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: nanodet/util/check_point.py</div><div id='n_file'> N File Name: nanodet/util/check_point.py</div><div id='m_start'> M Start Line: 28</div><div id='m_end'> M End Line: 30</div><div id='n_start'> N Start Line: 25</div><div id='n_end'> N End Line: 35</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>

    with_oneapi = ml_config.get("with_oneapi")
    if with_oneapi:
        <a id="change">runtime_envs["ML_WITH_ONEAP"]</a> = with_oneapi

    with_mpi = ml_config.get("with_mpi")
    if with_mpi:</code></pre><h3>After Change</h3><pre><code class='java'>
    ml_config = runtime_config.get(ML_RUNTIME_CONFIG_KEY, {})

    &#47&#47 export each flags started with &quotwith_&quot
    <a id="change">for </a>key in ml_config<a id="change">:
        </a><a id="change">if </a><a id="change">key.startswith("with_"</a><a id="change">)</a>:
            with_flag = ml_config.get(key)
            if with_flag:
                with_flag_var = "ML_{}".format(key.upper())
                <a id="change">runtime_envs[with_flag_var]</a><a id="change"> = </a>with_flag

    return runtime_envs
</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/oap-project/cloudtik/commit/3f4e1f447265be4fbb5d118d9f6619cac0060bd6#diff-ded600deb1d236984f09cc78afa50940b3637544c1509be90c4b61f0ffa4a046L37' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 91073141</div><div id='project'> Project Name: oap-project/cloudtik</div><div id='commit'> Commit Name: 3f4e1f447265be4fbb5d118d9f6619cac0060bd6</div><div id='time'> Time: 2023-01-17</div><div id='author'> Author: haifeng.chen@intel.com</div><div id='file'> File Name: python/cloudtik/runtime/ml/utils.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: _with_runtime_environment_variables(4)</div><div id='n_method'> N Method Name: _with_runtime_environment_variables(4)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: python/cloudtik/runtime/ml/utils.py</div><div id='n_file'> N File Name: python/cloudtik/runtime/ml/utils.py</div><div id='m_start'> M Start Line: 38</div><div id='m_end'> M End Line: 54</div><div id='n_start'> N Start Line: 38</div><div id='n_end'> N End Line: 50</div><BR>