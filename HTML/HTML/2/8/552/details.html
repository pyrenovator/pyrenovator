<html><h3>Pattern ID :552
</h3><img src='2844690.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>


def save_weights(self, path, cutoff=-1):
    fp<a id="change"> = open(</a>path, <a id="change">&quotwb&quot</a><a id="change">)</a>
    self.header_info[3] = self.seen  &#47&#47 number of images seen during training
    self.header_info.tofile(fp)

    &#47&#47 Iterate through layers
    for i, (module_def, module) in enumerate(zip(self.module_defs[:cutoff], self.module_list[:cutoff])):
        if module_def[&quottype&quot] == &quotconvolutional&quot:
            conv_layer = module[0]
            &#47&#47 If batch norm, load bn first
            if module_def[&quotbatch_normalize&quot]:
                bn_layer = module[1]
                bn_layer.bias.data.cpu().numpy().tofile(fp)
                bn_layer.weight.data.cpu().numpy().tofile(fp)
                bn_layer.running_mean.data.cpu().numpy().tofile(fp)
                bn_layer.running_var.data.cpu().numpy().tofile(fp)
            &#47&#47 Load conv bias
            else:
                conv_layer.bias.data.cpu().numpy().tofile(fp)
            &#47&#47 Load conv weights
            conv_layer.weight.data.cpu().numpy().tofile(fp)

    <a id="change">fp.close()</a>
</code></pre><h3>After Change</h3><pre><code class='java'>
def save_weights(self, path=&quotmodel.weights&quot, cutoff=-1):
    &#47&#47 Converts a PyTorch model to Darket format (*.pt to *.weights)
    &#47&#47 Note: Does not work if model.fuse() is applied
    <a id="change">with open(</a><a id="change">path, &quotwb&quot) as f:
        </a>self.header_info[3] = self.seen  &#47&#47 number of images seen during training
        self.header_info.tofile(f)

        &#47&#47 Iterate through layers</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 4</div><BR><div id='size'>Non-data size: 6</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/nightsnack/yolobile/commit/85a4cf004237fae25fe833ae58fb13c599c06852#diff-dcfeaa5ac3dffd54264034760914588d92fc7395c81eaa9274715840dc28100bL323' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 2844690</div><div id='project'> Project Name: nightsnack/yolobile</div><div id='commit'> Commit Name: 85a4cf004237fae25fe833ae58fb13c599c06852</div><div id='time'> Time: 2019-04-23</div><div id='author'> Author: glenn.jocher@ultralytics.com</div><div id='file'> File Name: models.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: save_weights(3)</div><div id='n_method'> N Method Name: save_weights(3)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: models.py</div><div id='n_file'> N File Name: models.py</div><div id='m_start'> M Start Line: 323</div><div id='m_end'> M End Line: 344</div><div id='n_start'> N Start Line: 328</div><div id='n_end'> N End Line: 349</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
    def test_native_functions_yaml(self):
        operators_found = set()
        regex = re.compile(r"^(\w*)(\(|\.)")
        file<a id="change"> = open(</a>aten_native_yaml, <a id="change">&quotr&quot</a><a id="change">)</a>
        for f in yaml.safe_load(file.read()):
            f = f[&quotfunc&quot]
            ret = f.split(&quot-&gt;&quot)[1].strip()
            name = regex.findall(f)[0][0]
            if name in all_operators_with_namedtuple_return:
                operators_found.add(name)
                continue
            if &quot_backward&quot in name or name.endswith(&quot_forward&quot):
                continue
            if not ret.startswith(&quot(&quot):
                continue
            if ret == &quot()&quot:
                continue
            ret = ret[1:-1].split(&quot,&quot)
            for r in ret:
                r = r.strip()
                self.assertEqual(len(r.split()), 1,
                                 &quotonly allowlisted operators are allowed to have named return type, got &quot + name)
        <a id="change">file.close()</a>
        self.assertEqual(all_operators_with_namedtuple_return, operators_found, textwrap.dedent(
        Some elements in the `all_operators_with_namedtuple_return` of test_namedtuple_return_api.py
        could not be found. Do you forget to update test_namedtuple_return_api.py after renaming some
        operator?</code></pre><h3>After Change</h3><pre><code class='java'>
    def test_native_functions_yaml(self):
        operators_found = set()
        regex = re.compile(r"^(\w*)(\(|\.)")
        <a id="change">with open(</a><a id="change">aten_native_yaml, &quotr&quot) as file:
            </a>for f in yaml.safe_load(file.read()):
                f = f[&quotfunc&quot]
                ret = f.split(&quot-&gt;&quot)[1].strip()
                name = regex.findall(f)[0][0]</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/pytorch/pytorch/commit/51d12548b00f2edd2e2c2c2e6224a45532894e76#diff-2b70b559a337a78b31562d0e1e916b750229615fc23cd2bb56480889dfdcdb06L34' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 2844689</div><div id='project'> Project Name: pytorch/pytorch</div><div id='commit'> Commit Name: 51d12548b00f2edd2e2c2c2e6224a45532894e76</div><div id='time'> Time: 2022-08-07</div><div id='author'> Author: 58959422+se4ml@users.noreply.github.com</div><div id='file'> File Name: test/test_namedtuple_return_api.py</div><div id='m_class'> M Class Name: TestNamedTupleAPI</div><div id='n_method'> N Class Name: TestNamedTupleAPI</div><div id='m_method'> M Method Name: test_native_functions_yaml(1)</div><div id='n_method'> N Method Name: test_native_functions_yaml(1)</div><div id='m_parent_class'> M Parent Class: TestCase</div><div id='n_parent_class'> N Parent Class: TestCase</div><div id='m_file'> M File Name: test/test_namedtuple_return_api.py</div><div id='n_file'> N File Name: test/test_namedtuple_return_api.py</div><div id='m_start'> M Start Line: 37</div><div id='m_end'> M End Line: 56</div><div id='n_start'> N Start Line: 37</div><div id='n_end'> N End Line: 57</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
                    np.save(new_img_path, new_img)
                    embedding_dict[new_img_name] = embedding_list
        json_bin = json.dumps(embedding_dict)
        out_file<a id="change"> = open(</a>os.path.join(prcssd_folder_path, "embeddings.json"), <a id="change">"w"</a><a id="change">)</a>
        out_file.write(json_bin)
        <a id="change">out_file.close()</a>


def parse_args():
    Parses command line arguments</code></pre><h3>After Change</h3><pre><code class='java'>
                    np.save(new_img_path, new_img)
                    embedding_dict[new_img_name] = embedding_list
        json_bin = json.dumps(embedding_dict)
        <a id="change">with open(</a><a id="change">os.path.join(prcssd_folder_path, "embeddings.json"), "w") as out_file:
            </a>out_file.write(json_bin)


def parse_args():</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/maximintegratedai/ai8x-training/commit/b28e867bfe95f7c7f552a7aed95717f786f6ecda#diff-cf35a2b081b53237862e90f3773c39da9cd388fd95ff58b80ce170322efcc3f8L92' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 2844694</div><div id='project'> Project Name: maximintegratedai/ai8x-training</div><div id='commit'> Commit Name: b28e867bfe95f7c7f552a7aed95717f786f6ecda</div><div id='time'> Time: 2021-05-18</div><div id='author'> Author: 38257113+ermanok@users.noreply.github.com</div><div id='file'> File Name: datasets/face_id/gen_vggface2_embeddings.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: main(2)</div><div id='n_method'> N Method Name: main(2)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: datasets/face_id/gen_vggface2_embeddings.py</div><div id='n_file'> N File Name: datasets/face_id/gen_vggface2_embeddings.py</div><div id='m_start'> M Start Line: 136</div><div id='m_end'> M End Line: 138</div><div id='n_start'> N Start Line: 137</div><div id='n_end'> N End Line: 140</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        cutoff = 15

    &#47&#47 Open the weights file
    fp<a id="change"> = open(</a>weights, <a id="change">&quotrb&quot</a><a id="change">)</a>
    header = np.fromfile(fp, dtype=np.int32, count=5)  &#47&#47 First five are header values

    &#47&#47 Needed to write header when saving weights
    self.header_info = header

    self.seen = header[3]  &#47&#47 number of images seen during training
    weights = np.fromfile(fp, dtype=np.float32)  &#47&#47 The rest are weights
    <a id="change">fp.close()</a>

    ptr = 0
    for i, (module_def, module) in enumerate(zip(self.module_defs[:cutoff], self.module_list[:cutoff])):
        if module_def[&quottype&quot] == &quotconvolutional&quot:</code></pre><h3>After Change</h3><pre><code class='java'>
        cutoff = 15

    &#47&#47 Open the weights file
    <a id="change">with open(</a><a id="change">weights, &quotrb&quot) as f:
        </a>header = np.fromfile(f, dtype=np.int32, count=5)  &#47&#47 First five are header values

        &#47&#47 Needed to write header when saving weights
        self.header_info = header</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/nightsnack/yolobile/commit/85a4cf004237fae25fe833ae58fb13c599c06852#diff-dcfeaa5ac3dffd54264034760914588d92fc7395c81eaa9274715840dc28100bL254' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 2844692</div><div id='project'> Project Name: nightsnack/yolobile</div><div id='commit'> Commit Name: 85a4cf004237fae25fe833ae58fb13c599c06852</div><div id='time'> Time: 2019-04-23</div><div id='author'> Author: glenn.jocher@ultralytics.com</div><div id='file'> File Name: models.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: load_darknet_weights(3)</div><div id='n_method'> N Method Name: load_darknet_weights(3)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: models.py</div><div id='n_file'> N File Name: models.py</div><div id='m_start'> M Start Line: 273</div><div id='m_end'> M End Line: 281</div><div id='n_start'> N Start Line: 277</div><div id='n_end'> N End Line: 286</div><BR>