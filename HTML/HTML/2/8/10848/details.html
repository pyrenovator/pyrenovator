<html><h3>Pattern ID :10848
</h3><img src='37403833.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
        generated_noise = generated_noise.int()
        bright_regions = img.sum(1) &gt; brightness_threshold * img.shape[1]
        for ch in range(img.shape[1]):
            <a id="change">gnch = </a>generated_noise[:, ch]
            gnch[bright_regions]<a id="change"> = gnch[bright_regions]</a><a id="change"> * -</a>1
            generated_noise[:, ch] = gnch

        anom = (anom.int() + generated_noise).clamp(0, 255).byte()</code></pre><h3>After Change</h3><pre><code class='java'>

        &#47&#47 invert noise if difference of malformed and original is less than threshold and inverted difference is higher
        diff = ((anom.int() + generated_noise).clamp(0, 255) - anom.int())
        diff = <a id="change">diff.reshape(anom.size(0), -1).sum(</a>1<a id="change">)</a>.float().div(np.prod(anom.shape)).abs()
        diffi = (<a id="change">(anom.int() - generated_noise).clamp(</a>0, 255<a id="change">)</a> - anom.int())
        diffi = diffi.reshape(anom.size(0), -1).sum(1).float().div(np.prod(anom.shape)).abs()
        inv = [i for i, (d, di) in enumerate(zip(diff, diffi)) if d &lt; invert_threshold and di &gt; d]
        generated_noise[inv]<a id="change"> = </a>-generated_noise[inv]

        anom = (anom.int() + generated_noise).clamp(0, 255).byte()
</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 8</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/liznerski/fcdd/commit/d110aa8b141dc13f47156da913a6b4f9d64ddc74#diff-fb7d9650a48b1de740043527c5d5e928e02fb69b57694006eafa311d213e906cL139' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 37403833</div><div id='project'> Project Name: liznerski/fcdd</div><div id='commit'> Commit Name: d110aa8b141dc13f47156da913a6b4f9d64ddc74</div><div id='time'> Time: 2020-10-12</div><div id='author'> Author: p_liznersk13@cs.uni-kl.de</div><div id='file'> File Name: python/fcdd/datasets/online_superviser.py</div><div id='m_class'> M Class Name: OnlineSuperviser</div><div id='n_method'> N Class Name: OnlineSuperviser</div><div id='m_method'> M Method Name: __malformed_normal(8)</div><div id='n_method'> N Method Name: __malformed_normal(8)</div><div id='m_parent_class'> M Parent Class: ImgGTTargetTransform</div><div id='n_parent_class'> N Parent Class: ImgGTTargetTransform</div><div id='m_file'> M File Name: python/fcdd/datasets/online_superviser.py</div><div id='n_file'> N File Name: python/fcdd/datasets/online_superviser.py</div><div id='m_start'> M Start Line: 139</div><div id='m_end'> M End Line: 146</div><div id='n_start'> N Start Line: 143</div><div id='n_end'> N End Line: 151</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        generated_noise = generated_noise.int()
        bright_regions = img.sum(1) &gt; brightness_threshold * img.shape[1]
        for ch in range(img.shape[1]):
            <a id="change">gnch = </a>generated_noise[:, ch]
            gnch[bright_regions] = <a id="change">gnch[bright_regions] * -</a>1
            generated_noise[:, ch]<a id="change"> = </a>gnch

        anom = (anom.int() + generated_noise).clamp(0, 255).byte()
</code></pre><h3>After Change</h3><pre><code class='java'>
        anom = img.clone()

        &#47&#47 invert noise if difference of malformed and original is less than threshold and inverted difference is higher
        diff = (<a id="change">(anom.int() + generated_noise).clamp(</a>0, 255<a id="change">)</a> - anom.int())
        diff = diff.reshape(anom.size(0), -1).sum(1).float().div(np.prod(anom.shape)).abs()
        diffi = ((anom.int() - generated_noise).clamp(0, 255) - anom.int())
        diffi = <a id="change">diffi.reshape(anom.size(0), -1).sum(</a>1<a id="change">)</a>.float().div(np.prod(anom.shape)).abs()
        inv<a id="change"> = </a>[i for i, (d, di) in enumerate(zip(diff, diffi)) if d &lt; invert_threshold and di &gt; d]
        generated_noise[inv] = -generated_noise[inv]

        anom = (anom.int() + generated_noise).clamp(0, 255).byte()</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/liznerski/fcdd/commit/d110aa8b141dc13f47156da913a6b4f9d64ddc74#diff-fb7d9650a48b1de740043527c5d5e928e02fb69b57694006eafa311d213e906cL133' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 37403838</div><div id='project'> Project Name: liznerski/fcdd</div><div id='commit'> Commit Name: d110aa8b141dc13f47156da913a6b4f9d64ddc74</div><div id='time'> Time: 2020-10-12</div><div id='author'> Author: p_liznersk13@cs.uni-kl.de</div><div id='file'> File Name: python/fcdd/datasets/online_superviser.py</div><div id='m_class'> M Class Name: OnlineSuperviser</div><div id='n_method'> N Class Name: OnlineSuperviser</div><div id='m_method'> M Method Name: __malformed_normal(8)</div><div id='n_method'> N Method Name: __malformed_normal(8)</div><div id='m_parent_class'> M Parent Class: ImgGTTargetTransform</div><div id='n_parent_class'> N Parent Class: ImgGTTargetTransform</div><div id='m_file'> M File Name: python/fcdd/datasets/online_superviser.py</div><div id='n_file'> N File Name: python/fcdd/datasets/online_superviser.py</div><div id='m_start'> M Start Line: 139</div><div id='m_end'> M End Line: 146</div><div id='n_start'> N Start Line: 143</div><div id='n_end'> N End Line: 151</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        &#47&#47 score_paired = score_paired.sum(dim=0)&#47&#47 + score_paired.sum(dim=1)
        score_unpaired = score_unpaired[1:]
        &#47&#47 print(score_unpaired)
        <a id="change">score_paired = </a>1 - score_unpaired
        &#47&#47 print(pred_bp)
        pairs_not_nan = torch.logical_not(torch.isnan(pairs))
        loss  = <a id="change">torch.sum(</a>pairs[pairs_not_nan[:, 0], 0] * score_unpaired[pairs_not_nan[:, 0]]<a id="change">)</a>
        loss<a id="change"> += </a>torch.sum(pairs[pairs_not_nan[:, 1], 1]<a id="change"> * </a><a id="change">score_paired[pairs_not_nan[:, 1]]</a>)

        return loss
</code></pre><h3>After Change</h3><pre><code class='java'>
        score_unpaired = score_unpaired[pairs_not_nan]
        &#47&#47print(pairs * (score_unpaired-0.5))
        &#47&#47print(score_unpaired&gt;0.5)
        loss<a id="change"> = </a>torch.sum(<a id="change">torch.clamp(</a>pairs * (score_unpaired-0.5)<a id="change">, min=0)</a>)

        return loss
</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/mxfold/mxfold2/commit/a86008280f05fa4f18683884f52b063ae571ad72#diff-40c7dafe6bf4ae19d9896b17c5ef72d560791abfcb151c955d1f5348a9df295cL125' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 37403829</div><div id='project'> Project Name: mxfold/mxfold2</div><div id='commit'> Commit Name: a86008280f05fa4f18683884f52b063ae571ad72</div><div id='time'> Time: 2020-01-14</div><div id='author'> Author: satoken@bio.keio.ac.jp</div><div id='file'> File Name: dnnfold/train.py</div><div id='m_class'> M Class Name: PiecewiseLoss</div><div id='n_method'> N Class Name: PiecewiseLoss</div><div id='m_method'> M Method Name: loss_unknown_structure(6)</div><div id='n_method'> N Method Name: loss_unknown_structure(6)</div><div id='m_parent_class'> M Parent Class: nn.Module</div><div id='n_parent_class'> N Parent Class: nn.Module</div><div id='m_file'> M File Name: dnnfold/train.py</div><div id='n_file'> N File Name: dnnfold/train.py</div><div id='m_start'> M Start Line: 126</div><div id='m_end'> M End Line: 136</div><div id='n_start'> N Start Line: 127</div><div id='n_end'> N End Line: 141</div><BR>