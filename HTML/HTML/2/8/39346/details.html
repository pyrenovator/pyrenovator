<html><h3>Pattern ID :39346
</h3><img src='111658982.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
        for object_item in object_list:
            object_dict = {}
            object_dict.update({"frame_number": frame_number})
            <a id="change">for </a>key, value in object_item.items()<a id="change">:
                </a>if isinstance(value, (list, tuple)):
                    for i, item in enumerate(value):
                        object_dict.update({str(key) + "_" + str(i): item})
                else:
                    <a id="change">object_dict.update({</a>key: value<a id="change">}</a><a id="change">)</a>

            if not os.path.exists(file_path):
                with open(file_path, "w", newline="") as csvfile:
                    field_names = list(object_dict.keys())</code></pre><h3>After Change</h3><pre><code class='java'>

    @staticmethod
    def log_objects(object_list, frame_number, file_path):
        <a id="change">if len(object_list) != 0</a>:
            start = time.perf_counter()
            object_dict<a id="change"> = </a>list(map(lambda x: prepare_object(x, frame_number), object_list))

            if not os.path.exists(file_path):
                with open(file_path, "w", newline="") as csvfile:</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 6</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/neuralet/smart-social-distancing/commit/d8886c3554a6d7caaabfed394a4bd1f999393fc3#diff-86bafb917077c7ee560882a998e3606b0e91a0f2546355536a11366e2f3e6187L30' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 111658982</div><div id='project'> Project Name: neuralet/smart-social-distancing</div><div id='commit'> Commit Name: d8886c3554a6d7caaabfed394a4bd1f999393fc3</div><div id='time'> Time: 2020-04-13</div><div id='author'> Author: alpha.carinae29@gmail.com</div><div id='file'> File Name: libs/loggers/csv_logger.py</div><div id='m_class'> M Class Name: Logger</div><div id='n_method'> N Class Name: Logger</div><div id='m_method'> M Method Name: log_objects(3)</div><div id='n_method'> N Method Name: log_objects(3)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: libs/loggers/csv_logger.py</div><div id='n_file'> N File Name: libs/loggers/csv_logger.py</div><div id='m_start'> M Start Line: 30</div><div id='m_end'> M End Line: 51</div><div id='n_start'> N Start Line: 43</div><div id='n_end'> N End Line: 59</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
            object_dict.update({"frame_number": frame_number})
            for key, value in object_item.items():
                if isinstance(value, (list, tuple)):
                    <a id="change">for </a>i, <a id="change">item</a> in enumerate(value)<a id="change">:
                        </a><a id="change">object_dict.update({</a>str(key) + "_" + str(i): item<a id="change">}</a><a id="change">)</a>
                else:
                    object_dict.update({key: value})

            if not os.path.exists(file_path):</code></pre><h3>After Change</h3><pre><code class='java'>

    @staticmethod
    def log_objects(object_list, frame_number, file_path):
        <a id="change">if len(object_list) != 0</a>:
            start = time.perf_counter()
            object_dict<a id="change"> = </a>list(map(lambda x: prepare_object(x, frame_number), object_list))

            if not os.path.exists(file_path):
                with open(file_path, "w", newline="") as csvfile:</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/neuralet/smart-social-distancing/commit/d8886c3554a6d7caaabfed394a4bd1f999393fc3#diff-86bafb917077c7ee560882a998e3606b0e91a0f2546355536a11366e2f3e6187L29' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 111659014</div><div id='project'> Project Name: neuralet/smart-social-distancing</div><div id='commit'> Commit Name: d8886c3554a6d7caaabfed394a4bd1f999393fc3</div><div id='time'> Time: 2020-04-13</div><div id='author'> Author: alpha.carinae29@gmail.com</div><div id='file'> File Name: libs/loggers/csv_logger.py</div><div id='m_class'> M Class Name: Logger</div><div id='n_method'> N Class Name: Logger</div><div id='m_method'> M Method Name: log_objects(3)</div><div id='n_method'> N Method Name: log_objects(3)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: libs/loggers/csv_logger.py</div><div id='n_file'> N File Name: libs/loggers/csv_logger.py</div><div id='m_start'> M Start Line: 30</div><div id='m_end'> M End Line: 51</div><div id='n_start'> N Start Line: 43</div><div id='n_end'> N End Line: 59</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        with g.local_scope():
            h_prime = []
            emb = emb.permute(1, 0, 2).contiguous()
            <a id="change">for </a><a id="change">i</a> in range(self.num_heads)<a id="change">:
                </a>g.edata[&quotalpha&quot] = edge_attention[:, i]
                <a id="change">g.srcdata.update({</a>&quotemb&quot: emb[i]<a id="change">}</a><a id="change">)</a>
                g.update_all(Fn.u_mul_e(&quotemb&quot, &quotalpha&quot, &quotm&quot),
                             Fn.sum(&quotm&quot, &quotemb&quot))
                h_prime.append(g.ndata[&quotemb&quot])
            h_output = torch.cat(h_prime, dim=1)</code></pre><h3>After Change</h3><pre><code class='java'>
            res_attn = g.edata[&quotalpha&quot]
            edge_attention = edge_attention * \
                             (1 - self.beta) + res_attn * self.beta
        <a id="change">if self.num_heads == 1</a>:
            edge_attention<a id="change"> = </a>edge_attention[:, 0]
            edge_attention = edge_attention.unsqueeze(1)

        with g.local_scope():</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/bupt-gamma/openhgnn/commit/c2a6b5ad048e2d937b6642b0106dad5faa75a335#diff-59f1f6852baf41601055fbdbc029a635a162bb43b4244576cc8c6184f15c96d5L156' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 111658978</div><div id='project'> Project Name: bupt-gamma/openhgnn</div><div id='commit'> Commit Name: c2a6b5ad048e2d937b6642b0106dad5faa75a335</div><div id='time'> Time: 2022-02-25</div><div id='author'> Author: 996179900@qq.com</div><div id='file'> File Name: openhgnn/models/SimpleHGN.py</div><div id='m_class'> M Class Name: SimpleHGNConv</div><div id='n_method'> N Class Name: SimpleHGNConv</div><div id='m_method'> M Method Name: forward(3)</div><div id='n_method'> N Method Name: forward(3)</div><div id='m_parent_class'> M Parent Class: nn.Module</div><div id='n_parent_class'> N Parent Class: nn.Module</div><div id='m_file'> M File Name: openhgnn/models/SimpleHGN.py</div><div id='n_file'> N File Name: openhgnn/models/SimpleHGN.py</div><div id='m_start'> M Start Line: 159</div><div id='m_end'> M End Line: 190</div><div id='n_start'> N Start Line: 158</div><div id='n_end'> N End Line: 190</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
            resources_usage_batch.resource_demands)

        cluster_full = False
        <a id="change">for </a><a id="change">resource_message</a> in resources_usage_batch.batch<a id="change">:
            </a>node_id = resource_message.get(&quotnode_id&quot)
            last_heartbeat_time = resource_message.get(&quotlast_heartbeat_time&quot)
            &#47&#47 Generate node type config based on reported node list.

            if (hasattr(resource_message, "cluster_full")
                    and resource_message.get(&quotcluster_full&quot)):
                &#47&#47 Aggregate this flag across all batches.
                cluster_full = True
            &#47&#47 FIXME: implement the dynamic adjustment
            resource_load = {}
            total_resources = {}
            available_resources = <a id="change">{}</a>


            use_node_id_as_ip = (self.cluster_scaler is not None
                                 and self.cluster_scaler.config["provider"].get(
                        "use_node_id_as_ip", False))

            &#47&#47 "use_node_id_as_ip" is a hack meant to address situations in
            &#47&#47 which there&quots more than one service node residing at a given ip.

            &#47&#47 TODO: Stop using ips as node identifiers.
            &#47&#47 (1) generating node ids when launching nodes, and
            &#47&#47 (2) propagating the node id to the start command so the node will
            &#47&#47 report resource stats under its assigned node id.

            if use_node_id_as_ip:
                ip = node_id.hex()
            else:
                ip = resource_message["resource"].get("ip")
            <a id="change">self.load_metrics.update(</a>ip, node_id, last_heartbeat_time, total_resources,
                                     available_resources, resource_load,
                                     waiting_bundles, infeasible_bundles,
                                     cluster_full<a id="change">)</a>

    def update_resource_requests(self):
        Fetches resource requests from the internal KV and updates load.
        if not kv_initialized():</code></pre><h3>After Change</h3><pre><code class='java'>
            &#47&#47 reset if there is a success
            self.load_metrics_failures = 0
        except Exception as e:
            <a id="change">if self.load_metrics_failures == 0</a> or self.load_metrics_failures == MAX_FAILURES_FOR_LOGGING:
                &#47&#47 detailed form
                error<a id="change"> = </a>traceback.format_exc()
                logger.exception(f"Load metrics update failed with the following error:\n{error}")
            elif self.load_metrics_failures &lt; MAX_FAILURES_FOR_LOGGING:
                &#47&#47 short form</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/oap-project/cloudtik/commit/e78c1c90a42471343f81b183643dd2a8bb977d19#diff-68026e3934fb197c61e99bd80d1b5ec63df71a7942f4f825a3c985a834963c71L138' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 111659006</div><div id='project'> Project Name: oap-project/cloudtik</div><div id='commit'> Commit Name: e78c1c90a42471343f81b183643dd2a8bb977d19</div><div id='time'> Time: 2022-03-29</div><div id='author'> Author: haifeng.chen@intel.com</div><div id='file'> File Name: python/cloudtik/core/_private/service/cloudtik_cluster_controller.py</div><div id='m_class'> M Class Name: ClusterController</div><div id='n_method'> N Class Name: ClusterController</div><div id='m_method'> M Method Name: update_load_metrics(1)</div><div id='n_method'> N Method Name: update_load_metrics(1)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: python/cloudtik/core/_private/service/cloudtik_cluster_controller.py</div><div id='n_file'> N File Name: python/cloudtik/core/_private/service/cloudtik_cluster_controller.py</div><div id='m_start'> M Start Line: 142</div><div id='m_end'> M End Line: 185</div><div id='n_start'> N Start Line: 143</div><div id='n_end'> N End Line: 162</div><BR>