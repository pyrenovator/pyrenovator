<html><h3>Pattern ID :9939
</h3><img src='35583262.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
            batch_size, state_len, seq_len).to(self.device)
        for i in range(state_len):
            for j in range(seq_len):
                <a id="change">for </a>k in <a id="change">range(</a>batch_size<a id="change">)</a><a id="change">:
                    </a>attn_energies[k, i, j] = self.score(
                        out_state[k][i], history[k][j])
        return F.softmax(attn_energies, dim=2)
</code></pre><h3>After Change</h3><pre><code class='java'>
            history = history.permute(0, 2, 1)  &#47&#47 batch_size * hidden_size * history_len
            attn_energies = torch.bmm(out_state, history)
        elif self.method == &quotgeneral&quot:
            history<a id="change"> = </a>self.attn(history)
            history<a id="change"> = </a><a id="change">history.permute(0</a>, <a id="change">2</a>, <a id="change">1</a><a id="change">)</a>
            attn_energies = torch.bmm(out_state, history)
        return F.softmax(attn_energies, dim=2)

</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 5</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/libcity/bigscity-libcity/commit/ec61c9cd984d1c86ee715380ed3b65b4222c8d1f#diff-e952722699ca3186325fca5947706a0f1eb9b447d1d51063beaddb3480efa998L33' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 35583262</div><div id='project'> Project Name: libcity/bigscity-libcity</div><div id='commit'> Commit Name: ec61c9cd984d1c86ee715380ed3b65b4222c8d1f</div><div id='time'> Time: 2021-05-06</div><div id='author'> Author: 33283819+WenMellors@users.noreply.github.com</div><div id='file'> File Name: trafficdl/model/trajectory_loc_prediction/DeepMove.py</div><div id='m_class'> M Class Name: Attn</div><div id='n_method'> N Class Name: Attn</div><div id='m_method'> M Method Name: forward(3)</div><div id='n_method'> N Method Name: forward(3)</div><div id='m_parent_class'> M Parent Class: nn.Module</div><div id='n_parent_class'> N Parent Class: nn.Module</div><div id='m_file'> M File Name: trafficdl/model/trajectory_loc_prediction/DeepMove.py</div><div id='n_file'> N File Name: trafficdl/model/trajectory_loc_prediction/DeepMove.py</div><div id='m_start'> M Start Line: 33</div><div id='m_end'> M End Line: 43</div><div id='n_start'> N Start Line: 38</div><div id='n_end'> N End Line: 45</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
    if num &gt; 1:
        pieces = []

        <a id="change">for </a>i in <a id="change">range(</a>1, num + 1<a id="change">)</a><a id="change">:

            </a>start = piece_length * (i - 1)
            end = piece_length * i
            piece = spec[:, start:end]
</code></pre><h3>After Change</h3><pre><code class='java'>
        return spec
    else:
        chunks = torch.split(spec, chunk_size, dim=1)
        to_be_masked<a id="change"> = </a>torch.stack(list(chunks[:-1]), dim=0).unsqueeze(1)
        time_mask(to_be_masked)
        freq_mask(to_be_masked)
        masked<a id="change"> = </a><a id="change">to_be_masked.squeeze(1).permute(1</a>, <a id="change">0</a>, <a id="change">2</a><a id="change">)</a>.reshape((spec.shape[0], -1))
        return torch.cat([masked, chunks[-1]], dim=1)

</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/ivankunyankin/quartznet-asr/commit/28f999e7cfbefb66c9545f32e76a7454a7432aac#diff-09d0cbaf891d623ac245ccf84485a687b554217349ca55557c60b33234b969aeL55' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 35583406</div><div id='project'> Project Name: ivankunyankin/quartznet-asr</div><div id='commit'> Commit Name: 28f999e7cfbefb66c9545f32e76a7454a7432aac</div><div id='time'> Time: 2021-07-01</div><div id='author'> Author: IKunyankin@gmail.com</div><div id='file'> File Name: utils.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: augment(4)</div><div id='n_method'> N Method Name: augment(4)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: utils.py</div><div id='n_file'> N File Name: utils.py</div><div id='m_start'> M Start Line: 57</div><div id='m_end'> M End Line: 82</div><div id='n_start'> N Start Line: 57</div><div id='n_end'> N End Line: 74</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        data = Data(edge_index=edge_index, edge_attr=None, num_nodes=num_nodes)
        lambda_max = LaplacianLambdaMax()(data).lambda_max
        outputs = []
        <a id="change">for </a>time_step in <a id="change">range(</a>num_of_timesteps<a id="change">)</a><a id="change">:
            </a>outputs.append(torch.unsqueeze(self.cheb_conv(x=x[:,:,:,time_step], edge_index=edge_index,
                batch = batch_size, lambda_max=lambda_max), -1))

        spatial_gcn = F.relu(torch.cat(outputs, dim=-1)) &#47&#47 (b,N,F,T)</code></pre><h3>After Change</h3><pre><code class='java'>
                batch = batch_size, lambda_max=lambda_max), -1))
        spatial_gcn = F.relu(torch.cat(outputs, dim=-1)) &#47&#47 (b,N,F,T)
        &quot&quot&quot
        tmp<a id="change"> = </a>x.permute(2,0,1,3).reshape(num_of_vertices, in_channels, num_of_timesteps*batch_size) &#47&#47 (N_nodes, F_in, B*T_in)
        tmp<a id="change"> = </a><a id="change">tmp.permute(2</a>,<a id="change">0</a>,<a id="change">1</a><a id="change">)</a> &#47&#47 (B*T_in, N_nodes, F_in)
        output = F.relu(self.cheb_conv(x=tmp, edge_index=edge_index,
                batch = batch_size*num_of_timesteps, lambda_max=lambda_max))
        spatial_gcn = output.permute(1,2,0).reshape(num_of_vertices,self.nb_time_filter,batch_size,num_of_timesteps).permute(2,0,1,3) &#47&#47 (B,N_nodes,F_out,T_in)</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/benedekrozemberczki/pytorch_geometric_temporal/commit/509a541a01913f5b45859b801c48b5fd264bd94a#diff-21666376be83b64a4fa768847ddfc3e4e7076772ef843870e346158dd7205045L18' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 35583164</div><div id='project'> Project Name: benedekrozemberczki/pytorch_geometric_temporal</div><div id='commit'> Commit Name: 509a541a01913f5b45859b801c48b5fd264bd94a</div><div id='time'> Time: 2021-03-18</div><div id='author'> Author: He_YX@outlook.com</div><div id='file'> File Name: torch_geometric_temporal/nn/convolutional/mstgcn.py</div><div id='m_class'> M Class Name: MSTGCN_block</div><div id='n_method'> N Class Name: MSTGCN_block</div><div id='m_method'> M Method Name: forward(4)</div><div id='n_method'> N Method Name: forward(4)</div><div id='m_parent_class'> M Parent Class: nn.Module</div><div id='n_parent_class'> N Parent Class: nn.Module</div><div id='m_file'> M File Name: torch_geometric_temporal/nn/convolutional/mstgcn.py</div><div id='n_file'> N File Name: torch_geometric_temporal/nn/convolutional/mstgcn.py</div><div id='m_start'> M Start Line: 36</div><div id='m_end'> M End Line: 41</div><div id='n_start'> N Start Line: 44</div><div id='n_end'> N End Line: 48</div><BR>