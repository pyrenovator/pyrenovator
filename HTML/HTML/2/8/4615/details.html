<html><h3>Pattern ID :4615
</h3><img src='16604924.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
                              if paragraph_id != -1 and
                              article_id not in full_articles)

        article_ids_full_list<a id="change"> = &quot,&quot.join(</a><a id="change">f"\"{id_}\"" for id_ in full_articles)</a>
        sql_query = f
        SELECT article_id, section_name, paragraph_id, text
        FROM (
                 SELECT *</code></pre><h3>After Change</h3><pre><code class='java'>
                                     engine=self.connection)
        self.df_chosen_texts = self.df_chosen_texts.append(articles)

        <a id="change">for </a>(article_id, paragraph_pos_in_article) in just_paragraphs<a id="change">:
            </a>paragraph = retrieve_paragraph(article_id,
                                           paragraph_pos_in_article,
                                           engine=self.connection)
            self.df_chosen_texts<a id="change"> = </a>self.df_chosen_texts.append(paragraph)

    def get_chosen_texts(self):
        Retrieve the currently saved items.</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 6</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/bluebrain/search/commit/6dbc2fe8f01adb39650da97fb8473111884cd0c1#diff-3f76d0104a34956d9f1469f7d89da92e5ed57880a4a0c4eaa4fc5086e6af2e65L150' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 16604924</div><div id='project'> Project Name: bluebrain/search</div><div id='commit'> Commit Name: 6dbc2fe8f01adb39650da97fb8473111884cd0c1</div><div id='time'> Time: 2020-08-04</div><div id='author'> Author: francesco.casalegno@gmail.com</div><div id='file'> File Name: src/bbsearch/widgets/article_saver.py</div><div id='m_class'> M Class Name: ArticleSaver</div><div id='n_method'> N Class Name: ArticleSaver</div><div id='m_method'> M Method Name: _update_chosen_texts(1)</div><div id='n_method'> N Method Name: _update_chosen_texts(1)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: src/bbsearch/widgets/article_saver.py</div><div id='n_file'> N File Name: src/bbsearch/widgets/article_saver.py</div><div id='m_start'> M Start Line: 150</div><div id='m_end'> M End Line: 190</div><div id='n_start'> N Start Line: 184</div><div id='n_end'> N End Line: 198</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
        full_articles = set(article_id
                            for article_id, paragraph_id in self.state
                            if paragraph_id == -1)
        just_paragraphs = set(<a id="change">paragraph_id</a>
                              <a id="change">for</a> article_id, paragraph_id in self.state
                              if paragraph_id != -1 and
                              article_id not in full_articles)

        article_ids_full_list = &quot,&quot.join(f"\"{id_}\"" for id_ in full_articles)
        sql_query = f
        SELECT article_id, section_name, paragraph_id, text
        FROM (
                 SELECT *
                 FROM paragraphs
                 WHERE sha IN (
                     SELECT sha
                     FROM article_id_2_sha
                     WHERE article_id IN ({article_ids_full_list})
                 )
             ) p
                 INNER JOIN
             article_id_2_sha a
             ON a.sha = p.sha;
        
        df_extractions_full = pd.read_sql(sql_query, self.connection)

        paragraph_ids_list<a id="change"> = &quot,&quot.join(</a>f"\"{id_}\""<a id="change"> for id_ in just_paragraphs)</a>
        sql_query = f
        SELECT article_id, section_name, paragraph_id, text
        FROM (
                 SELECT *</code></pre><h3>After Change</h3><pre><code class='java'>
                                     engine=self.connection)
        self.df_chosen_texts = self.df_chosen_texts.append(articles)

        <a id="change">for </a>(article_id, <a id="change">paragraph_pos_in_article</a>) in just_paragraphs<a id="change">:
            </a>paragraph = retrieve_paragraph(article_id,
                                           paragraph_pos_in_article,
                                           engine=self.connection)
            self.df_chosen_texts<a id="change"> = </a>self.df_chosen_texts.append(paragraph)

    def get_chosen_texts(self):
        Retrieve the currently saved items.</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/bluebrain/search/commit/6dbc2fe8f01adb39650da97fb8473111884cd0c1#diff-3f76d0104a34956d9f1469f7d89da92e5ed57880a4a0c4eaa4fc5086e6af2e65L145' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 16604927</div><div id='project'> Project Name: bluebrain/search</div><div id='commit'> Commit Name: 6dbc2fe8f01adb39650da97fb8473111884cd0c1</div><div id='time'> Time: 2020-08-04</div><div id='author'> Author: francesco.casalegno@gmail.com</div><div id='file'> File Name: src/bbsearch/widgets/article_saver.py</div><div id='m_class'> M Class Name: ArticleSaver</div><div id='n_method'> N Class Name: ArticleSaver</div><div id='m_method'> M Method Name: _update_chosen_texts(1)</div><div id='n_method'> N Method Name: _update_chosen_texts(1)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: src/bbsearch/widgets/article_saver.py</div><div id='n_file'> N File Name: src/bbsearch/widgets/article_saver.py</div><div id='m_start'> M Start Line: 150</div><div id='m_end'> M End Line: 190</div><div id='n_start'> N Start Line: 184</div><div id='n_end'> N End Line: 198</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
            for i in range(0, len(all_examples), batch_size)
        ]
        &#47&#47 The new key is the concatenation of the keys of each example in the batch
        expected_keys_per_batch<a id="change"> = </a>[
            [<a id="change">"_".join(</a><a id="change">key for key, _ in all_examples[i : i + batch_size])</a>] * len(examples)
            for i, examples in zip(range(0, len(all_examples), batch_size), expected_examples_per_batch)
        ]
        &#47&#47 Combine keys and examples</code></pre><h3>After Change</h3><pre><code class='java'>
    else:
        &#47&#47 For batched map we have to format the examples as a batch (i.e. in one single dictionary) to pass the batch to the function
        all_transformed_examples = []
        <a id="change">for batch_offset</a> in range(0, len(all_examples), batch_size)<a id="change">:
            </a>examples<a id="change"> = </a>all_examples[batch_offset : batch_offset + batch_size]
            batch = _examples_to_batch(examples)
            transformed_batch = func(batch)
            all_transformed_examples.extend(_batch_to_examples(transformed_batch))</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/huggingface/datasets/commit/4b9334007e069ad71630ba36283d3abafba42174#diff-17766e93a3448f2734ed819adaf8c1d84dacece94f0f8c19687002c62071700dL186' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 16604926</div><div id='project'> Project Name: huggingface/datasets</div><div id='commit'> Commit Name: 4b9334007e069ad71630ba36283d3abafba42174</div><div id='time'> Time: 2022-03-07</div><div id='author'> Author: 42851186+lhoestq@users.noreply.github.com</div><div id='file'> File Name: tests/test_iterable_dataset.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: test_mapped_examples_iterable(4)</div><div id='n_method'> N Method Name: test_mapped_examples_iterable(4)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: tests/test_iterable_dataset.py</div><div id='n_file'> N File Name: tests/test_iterable_dataset.py</div><div id='m_start'> M Start Line: 189</div><div id='m_end'> M End Line: 208</div><div id='n_start'> N Start Line: 184</div><div id='n_end'> N End Line: 197</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
    out_dir = Path("out/{}_pred_model".format(timestamp))
    out_dir.mkdir(parents=True)

    data_in_type<a id="change"> = &quot&quot.join(</a><a id="change">s for s in cfg.in_type if not s.isdigit())</a>
    num_channels = int(&quot&quot.join(i for i in cfg.in_type if i.isdigit()))
    num_classes = SYNPICK_CLASSES + 1 if cfg.include_gripper else SYNPICK_CLASSES
    vid_type = (data_in_type, num_channels)
</code></pre><h3>After Change</h3><pre><code class='java'>
                    real = targets_full if use_full_input else targets
                    loss += scale * loss_fn(pred, real)
                if model_losses is not None:
                    <a id="change">for loss_value</a> in model_losses.values()<a id="change">:
                        </a>loss<a id="change"> += </a>loss_value

                &#47&#47 bwd
                optimizer.zero_grad()</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/ais-bonn/vp-suite/commit/fad2f90c44c219d2af842dddbb66ecc4feae7d7c#diff-ae790e80446d6edc7fea49f259f7d4f0a3ea73438f2c7039c2b0e930160c2e41L18' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 16604920</div><div id='project'> Project Name: ais-bonn/vp-suite</div><div id='commit'> Commit Name: fad2f90c44c219d2af842dddbb66ecc4feae7d7c</div><div id='time'> Time: 2021-09-01</div><div id='author'> Author: boltres@ais.uni-bonn.de</div><div id='file'> File Name: train_pred_model.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: main(1)</div><div id='n_method'> N Method Name: main(1)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: train_pred_model.py</div><div id='n_file'> N File Name: train_pred_model.py</div><div id='m_start'> M Start Line: 26</div><div id='m_end'> M End Line: 149</div><div id='n_start'> N Start Line: 26</div><div id='n_end'> N End Line: 158</div><BR>