<html><h3>Pattern ID :41489
</h3><img src='116618913.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
            all_files = self.files_ids
            &#47&#47 all_files = sorted(os.listdir(self.pdfs_dir))
        idx=0
        <a id="change">for </a><a id="change">pdf_filename</a> in <a id="change">tqdm(</a>all_files<a id="change">)</a><a id="change">:
            &#47&#47 if &quotpdf&quot in pdf_filename:
            </a><a id="change">try:
                </a>self.add_paper(pdf_filename,idx,use_ocr=use_ocr,save_dict=save_dict,report=report)
            <a id="change">except</a>:
                pass
            if idx % 500 == 0 and path_chunks:
                print(&quot  Saving idx {} for filename {}&quot.format(idx, pdf_filename))
                self.save(path_chunks)
            idx<a id="change"> += </a>1
        print(&quotObjs problem exported in objectives_pbs.txt&quot)</code></pre><h3>After Change</h3><pre><code class='java'>
    @update_naimai_dois
    def get_papers(self,update_dois=False):
        self.get_infos()
        <a id="change">for </a>idx_in_metadata_df,arxiv_id in <a id="change">tqdm(</a>enumerate(self.files_ids)<a id="change">, total=len(self.files_ids)):
            </a>self.add_paper(arxiv_id=arxiv_id,idx_in_metadata_df=idx_in_metadata_df)

        print(&quotObjs problem exported in objectives_pbs.txt&quot)</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 7</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/yassinekdi/naimai/commit/2a8f5ccef65981fdb95ad1dd93bc58dce7762fbf#diff-0664d7ed12233c62025d0fa57f17b6d937fdc11f29247c08296a19f518a91d69L49' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 116618913</div><div id='project'> Project Name: yassinekdi/naimai</div><div id='commit'> Commit Name: 2a8f5ccef65981fdb95ad1dd93bc58dce7762fbf</div><div id='time'> Time: 2022-02-21</div><div id='author'> Author: keptsa@yahoo.fr</div><div id='file'> File Name: papers/arxiv.py</div><div id='m_class'> M Class Name: papers_arxiv</div><div id='n_method'> N Class Name: papers_arxiv</div><div id='m_method'> M Method Name: get_papers(2)</div><div id='n_method'> N Method Name: get_papers(7)</div><div id='m_parent_class'> M Parent Class: papers</div><div id='n_parent_class'> N Parent Class: papers</div><div id='m_file'> M File Name: papers/arxiv.py</div><div id='n_file'> N File Name: papers/arxiv.py</div><div id='m_start'> M Start Line: 49</div><div id='m_end'> M End Line: 66</div><div id='n_start'> N Start Line: 79</div><div id='n_end'> N End Line: 84</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
    files = list(data_dir.glob(&quot**/*.mid&quot))
    &#47&#47 files = files[:1000]

    <a id="change">for </a><a id="change">f</a> in <a id="change">tqdm(</a>files<a id="change">)</a><a id="change">:
        </a><a id="change">try:
            </a>mid = mido.MidiFile(f)
        <a id="change">except </a>Exception:
            continue
        
        g = (Path(dest_path) / f.relative_to(data_path)).with_suffix(&quot.pkl&quot)
        g.parent.mkdir(parents=True, exist_ok=True)

        tempos = {m.tempo for tr in mid.tracks for m in tr if m.type==&quotset_tempo&quot}
        if len(tempos)!=1:
            continue
        micros_per_beat = tuple(tempos)[0]

        s_per_tick<a id="change"> = </a>micros_per_beat / mid.ticks_per_beat / 1e6

        for i,tr in enumerate(mid.tracks):
            seq = [m for m in tr if m.type==&quotnote_on&quot and m.velocity]</code></pre><h3>After Change</h3><pre><code class='java'>

    with Pool(n_jobs) as pool:
        &#47&#47 p.imap_unordered(ft.partial(process, data_path, dest_path), tqdm(files), 32)
        <a id="change">for </a>_ in <a id="change">tqdm(</a>pool.imap_unordered(process, zip(files, files_out), 32)<a id="change">):
            </a>pass
       

if __name__=="__main__":</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/intelligent-instruments-lab/iil-python-tools/commit/dbb5cf68b2b6902addf71a598302850beb1473cf#diff-9d738772070de4df243e741743f664299e8ce7ef188e1d5d6f035c83cce242d9L9' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 116618912</div><div id='project'> Project Name: intelligent-instruments-lab/iil-python-tools</div><div id='commit'> Commit Name: dbb5cf68b2b6902addf71a598302850beb1473cf</div><div id='time'> Time: 2022-02-21</div><div id='author'> Author: victor.shepardson@gmail.com</div><div id='file'> File Name: scripts/lakh_prep.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: main(3)</div><div id='n_method'> N Method Name: main(3)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: scripts/lakh_prep.py</div><div id='n_file'> N File Name: scripts/lakh_prep.py</div><div id='m_start'> M Start Line: 11</div><div id='m_end'> M End Line: 43</div><div id='n_start'> N Start Line: 41</div><div id='n_end'> N End Line: 56</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>

def GetAllFilesFeat(file_paths):
    file_feats = {}
    <a id="change">for </a><a id="change">file</a> in <a id="change">tqdm(</a>file_paths<a id="change">)</a><a id="change">:
        </a><a id="change">try:
            </a>image = jpeg4py.JPEG(file).decode()
        <a id="change">except </a>Exception as ex:
            image = cv2.imread(file)
        image<a id="change"> = </a>cv2.cvtColor(image, cv2.COLOR_RGB2GRAY)
        lbp = local_binary_pattern(image, 8, 1)
        feat = np.histogram(lbp, 128)[0]
        feat = torch.tensor(feat).unsqueeze(0).cuda()</code></pre><h3>After Change</h3><pre><code class='java'>
    lbp_loader = torch.utils.data.DataLoader(lbp_set, batch_size=8, shuffle=False, num_workers=cpu_count() / 2)
    &#47&#47 lbp_loader = torch.utils.data.DataLoader(lbp_set, batch_size=8, shuffle=False, num_workers=0)

    <a id="change">for </a>feat in <a id="change">tqdm(</a>lbp_loader<a id="change">):
        </a>if isinstance(file_feats, dict) is True:
            file_feats = feat
        else:
            file_feats = torch.cat((file_feats, feat), 0)</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/leoluopy/groupfacepytorch/commit/80355d53f4d903f1ad03a00c50127ece75ccc56c#diff-e2b054a4371e1ec7f3d6441681e31ec5fa1e22a181e51148fc976bdb9775df95L17' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 116618903</div><div id='project'> Project Name: leoluopy/groupfacepytorch</div><div id='commit'> Commit Name: 80355d53f4d903f1ad03a00c50127ece75ccc56c</div><div id='time'> Time: 2021-02-03</div><div id='author'> Author: lpy1990fff</div><div id='file'> File Name: cluster_ims.py</div><div id='m_class'> M Class Name: AnonimousClass</div><div id='n_method'> N Class Name: AnonimousClass</div><div id='m_method'> M Method Name: GetAllFilesFeat(1)</div><div id='n_method'> N Method Name: GetAllFilesFeat(1)</div><div id='m_parent_class'> M Parent Class: </div><div id='n_parent_class'> N Parent Class: </div><div id='m_file'> M File Name: cluster_ims.py</div><div id='n_file'> N File Name: cluster_ims.py</div><div id='m_start'> M Start Line: 19</div><div id='m_end'> M End Line: 32</div><div id='n_start'> N Start Line: 44</div><div id='n_end'> N End Line: 53</div><BR>